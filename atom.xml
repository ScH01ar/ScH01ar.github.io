<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Y&#39;s blog</title>
  
  
  <link href="https://sch01ar.github.io/atom.xml" rel="self"/>
  
  <link href="https://sch01ar.github.io/"/>
  <updated>2023-12-21T04:09:24.649Z</updated>
  <id>https://sch01ar.github.io/</id>
  
  <author>
    <name>Roo1e</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>2023å¼ºç½‘æ¯</title>
    <link href="https://sch01ar.github.io/2023/12/19/2023%E5%BC%BA%E7%BD%91%E6%9D%AF/"/>
    <id>https://sch01ar.github.io/2023/12/19/2023%E5%BC%BA%E7%BD%91%E6%9D%AF/</id>
    <published>2023-12-19T12:05:45.000Z</published>
    <updated>2023-12-21T04:09:24.649Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å¼ºç½‘æ˜¯å¼ºè€…çš„ç½‘ç»œå®‰å…¨ç«èµ›ï¼Œæˆ‘å¤ªèœäº†ã€‚ã€‚æ…¢æ…¢å¤ç›˜ï¼Œä¼°è®¡å¾—å¤ç›˜åˆ°æ˜å¹´äº†ã€‚</p></blockquote><h2 id="not-only-rsa118-solves">not only rsa(118 solves)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> bytes_to_long<br><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> flag<br><span class="hljs-keyword">import</span> os<br><br>n = <span class="hljs-number">6249734963373034215610144758924910630356277447014258270888329547267471837899275103421406467763122499270790512099702898939814547982931674247240623063334781529511973585977522269522704997379194673181703247780179146749499072297334876619475914747479522310651303344623434565831770309615574478274456549054332451773452773119453059618433160299319070430295124113199473337940505806777950838270849</span><br>e = <span class="hljs-number">641747</span><br>m = bytes_to_long(flag)<br><br>flag = flag + os.urandom(n.bit_length() // <span class="hljs-number">8</span> - <span class="hljs-built_in">len</span>(flag) - <span class="hljs-number">1</span>)<br>m = bytes_to_long(flag)<br><br>c = <span class="hljs-built_in">pow</span>(m, e, n)<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;out.txt&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;n = &#125;</span>&quot;</span>, file=f)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;e = &#125;</span>&quot;</span>, file=f)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;c = &#125;</span>&quot;</span>, file=f)<br><br></code></pre></td></tr></table></figure><p>é¢˜ç›®ä¸­nå¯åˆ†è§£ä¸”<code>n=p^5</code>ï¼Œä½†eä¸phiä¸äº’ç´ ã€‚å¥½ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ä¸€ä¸ªç®€å•çš„æœ‰é™åŸŸåˆ†è§£ã€‚<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">mp=GF(p)(c).nth_root(e, <span class="hljs-built_in">all</span>=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure>åœ¨æµ‹è¯•äº†<code>GF(p)</code>å’Œ<code>GF(p^2)</code>éƒ½å¯ä»¥å¼€å‡ºæ ¹ï¼Œä½†æ­¤é¢˜è‚¯å®šæ— æ³•ä½¿ç”¨CRTæ±‚mçš„ï¼Œnçš„å› å­åªæœ‰pï¼Œé‚£ä¹ˆå°±åªèƒ½å°è¯•ç»§ç»­å¼€æ ¹äº†ã€‚ã€‚ã€‚ä½†æ˜¯<code>GF(p^3)</code>åŸŸä¸‹å¼€æ ¹æˆ‘çš„sageå·²ç»è·‘ä¸å‡ºæ¥äº†ï¼Œæ›´ä½•å†µç›´æ¥å»æ±‚<code>GF(p^5)</code>è¿™é¢˜ä¹Ÿå°±æ–­åœ¨è¿™é‡Œäº†ï¼Œä½†æ˜¯æ¯”èµ›æ—¶ä¸€ç›´å‡ºè§£ï¼Œæ€€ç–‘æ˜¯ä¸æ˜¯æœ‰åˆ«çš„ç®€å•è§£æ³•ã€‚</p><p>èµ›åçœ‹wpçœŸæ— è¯­ã€‚ã€‚æœ‰é™åŸŸå¼€æ ¹åšå¤šäº†ï¼Œæ²¡æƒ³åˆ°æœ‰é™ç¯ä¹Ÿå¯ä»¥å¼€æ ¹ï¼ŒåŸŸç›¸å¯¹ç¯æ¥è¯´æ›´ä¸ºä¸¥æ ¼ï¼Œç¯ä¸Šå¯ä»¥å¼€æ ¹ä½†åŸŸä¸Šä¸ä¸€å®šå¯ä»¥ã€‚æ­¤é¢˜åœ¨ç¯<code>Zmod(p^5)</code>ä¸Šå¯ä»¥å®ç°ç§’å¼€æ ¹ã€‚</p><p>ç›´æ¥æ¬åˆ«äººè„šæœ¬äº† <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> tqdm<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> long_to_bytes<br>p = <span class="hljs-number">91027438112295439314606669837102361953591324472804851543344131406676387779969</span><br>e = <span class="hljs-number">641747</span><br>c = <span class="hljs-number">730024611795626517480532940587152891926416120514706825368440230330259913837764632826884065065554839415540061752397144140563698277864414584568812699048873820551131185796851863064509294123861487954267708318027370912496252338232193619491860340395824180108335802813022066531232025997349683725357024257420090981323217296019482516072036780365510855555146547481407283231721904830868033930943</span><br>n = p ^ <span class="hljs-number">5</span><br>K = Zmod(p ^ <span class="hljs-number">5</span>)<br>a = K(c).nth_root(e)<br>b = K(<span class="hljs-number">1</span>).nth_root(e)<br>a = <span class="hljs-built_in">int</span>(a)<br>b = <span class="hljs-built_in">int</span>(b)<br><span class="hljs-built_in">print</span>(b, a)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tqdm(<span class="hljs-built_in">range</span>(e)):<br>    a = (a*b) % n<br>    m = long_to_bytes(<span class="hljs-built_in">int</span>(a))<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">b&quot;flag&quot;</span> <span class="hljs-keyword">in</span> m:<br>        <span class="hljs-built_in">print</span>(m)<br>        <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure></p><h2 id="discrete_log_task36-solves">discrete_log_task(36 solves)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> Crypto.Util.Padding <span class="hljs-keyword">import</span> pad<br>flag = <span class="hljs-string">&#x27;flag&#123;d3b07b0d416ebb&#125;&#x27;</span><br><br><span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(flag) &lt;= <span class="hljs-number">45</span><br><span class="hljs-keyword">assert</span> flag.startswith(<span class="hljs-string">&#x27;flag&#123;&#x27;</span>)<br><span class="hljs-keyword">assert</span> flag.endswith(<span class="hljs-string">&#x27;&#125;&#x27;</span>)<br><br>m = bytes_to_long(pad(flag.encode(), <span class="hljs-number">128</span>))<br><br>p = <span class="hljs-number">0xf6e82946a9e7657cebcd14018a314a33c48b80552169f3069923d49c301f8dbfc6a1ca82902fc99a9e8aff92cef927e8695baeba694ad79b309af3b6a190514cb6bfa98bbda651f9dc8f80d8490a47e8b7b22ba32dd5f24fd7ee058b4f6659726b9ac50c8a7f97c3c4a48f830bc2767a15c16fe28a9b9f4ca3949ab6eb2e53c3</span><br>g = <span class="hljs-number">5</span><br><br><span class="hljs-keyword">assert</span> m &lt; (p - <span class="hljs-number">1</span>)<br><br>c = <span class="hljs-built_in">pow</span>(g, m, p)<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;out.txt&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;p = &#125;</span>&quot;</span>, file=f)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;g = &#125;</span>&quot;</span>, file=f)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;c = &#125;</span>&quot;</span>, file=f)<br></code></pre></td></tr></table></figure><p>éå¸¸æ ‡å‡†çš„ä¸€ä¸ªdlpï¼Œå¹¶ä¸”è¿™ä¸ªpæ˜¯éå¸¸å®‰å…¨çš„ï¼Œ<spanclass="math inline">\(\frac{p-1}{2}\)</span>ä¹Ÿæ˜¯ä¸€ä¸ªç´ æ•°ï¼Œæ‰€ä»¥è¿™é¢˜æˆ‘ä¹Ÿæ²¡æƒ³åˆ°æœ‰ä»€ä¹ˆåŠæ³•ã€‚èµ›æ—¶ç¡®å®çŒœäº†ä¸€ä¸‹è¿™ä¸ªå‡flagç»™çš„æš—ç¤ºï¼Œæ˜¯ä¸æ˜¯flagåªå¯èƒ½æ˜¯16è¿›åˆ¶å­—ç¬¦ï¼Ÿä½†ä½æ•°ä¹Ÿä¸ç¡®å®šï¼Œè¿˜ç»è¿‡äº†padï¼Œè§‰å¾—ä¸å¤ªå¥½ç»§ç»­è¿›è¡Œä¸‹å»ã€‚</p><p>èµ›åwpçœ‹åˆ°ç¡®å®æ˜¯çˆ†ç ´çš„æ€è·¯ï¼Œé‡‡ç”¨çš„æ˜¯<code>meet in middle</code>ä¸­é—´ç›¸é‡æ”»å‡»ã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦æ„é€ å‡ºä¸­é—´ç›¸é‡çš„å¼å­ã€‚&gt; ä¸‹é¢ä¸ºäº†ä¹¦å†™ç®€ä¾¿ï¼ŒflagæœªçŸ¥ä½æ•°ä¸º12ä½ï¼Œè¿™ä¸ªå¯é€šè¿‡çˆ†ç ´æ±‚å¾—ã€‚</p><p>ç¡®å®šå¥½ä½æ•°ä¹‹åï¼Œflagçš„å¤´å°¾åˆ†åˆ«æ˜¯<code>flag&#123;</code>å’Œ<code>&#125;+padding</code>ï¼Œè¿™é‡Œ<code>padding</code>æ˜¯ç¡®å®šçš„ã€‚<span class="math display">\[m=mh\cdot 2^{(128-5)\cdot 8}+mm\cdot2^{(128-5-12)\cdot 8}+ml\]</span> <span class="math display">\[c=g^m\;mod\; p\]</span> <span class="math display">\[g^{2^{888}\cdotmm}\equiv c\cdot (g^{2^{984}\cdot mh+ml})^{-1} \;mod\;p\]</span>ç­‰å¼ä¸­åªæœ‰å·¦ä¾§<code>mm</code>æ˜¯12ä½æœªçŸ¥çš„å­—ç¬¦ä¸²ï¼Œæƒ³åŠæ³•å°†å…¶æ‹†å¼€ï¼Œæ”¾åˆ°ç­‰å¼ä¸¤ä¾§å°±å¯è¿›è¡Œä¸­é—´ç›¸é‡ã€‚<span class="math display">\[mm=half_1+half_2\]</span> <spanclass="math display">\[g^{2^{888}\cdot (half_1+half_2)}\equiv c\cdot(g^{2^{984}\cdot mh+ml})^{-1} \;mod\;p\]</span> ä¸‹ä¸€æ­¥è®¡ç®—<spanclass="math inline">\(x=inverse(2^{888},\phi(p))\)</span>,å¾— <spanclass="math display">\[g^{half_1+half_2}\equiv (c\cdot (g^{2^{984}\cdotmh+ml})^{-1})^x \;mod\;p\]</span>è¯´å®è¯å½“æ—¶çœ‹åˆ«çš„å¸ˆå‚…åšå®¢æ—¶è¿™ä¸ªå¼å­å¤æ‚çš„è®©æˆ‘å¥‡æ€ªä¸ºä»€ä¹ˆä¹˜äº†è¿™æ ·çš„ä¸€ä¸ªxï¼Ÿå…¶å®å°±æ˜¯rsaé‚£å¥—å•Šã€‚ã€‚<spanclass="math inline">\(c=m^e\;mod\;p,c^d=m\;mod\;p\)</span></p><p>è®°<span class="math inline">\(A=(c\cdot (g^{2^{984}\cdotmh+ml})^{-1})^x\)</span></p><p>æœ€åä¸€æ­¥å˜æ¢ <span class="math display">\[g^{half_1}\equiv A\cdotg^{-half_2}\;mod\;p\]</span>ç”±äºAé€šè¿‡è®¡ç®—å¯æ±‚ï¼Œæ¥ä¸‹æ¥å°±æ˜¯çˆ†ç ´half1å’Œhalf2æ‰¾åˆ°ä½¿ç­‰å¼æˆç«‹çš„å€¼ï¼Œå¤§å¤§å‡å°äº†çˆ†ç ´å¤æ‚åº¦ã€‚<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> itertools<br><span class="hljs-keyword">from</span> gmpy2 <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> Crypto.Util.Padding <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> tqdm<br>p = <span class="hljs-number">173383907346370188246634353442514171630882212643019826706575120637048836061602034776136960080336351252616860522273644431927909101923807914940397420063587913080793842100264484222211278105783220210128152062330954876427406484701993115395306434064667136148361558851998019806319799444970703714594938822660931343299</span><br><br>g = <span class="hljs-number">5</span><br><br>c = <span class="hljs-number">105956730578629949992232286714779776923846577007389446302378719229216496867835280661431342821159505656015790792811649783966417989318584221840008436316642333656736724414761508478750342102083967959048112859470526771487533503436337125728018422740023680376681927932966058904269005466550073181194896860353202252854</span><br><br>q = <span class="hljs-number">86691953673185094123317176721257085815441106321509913353287560318524418030801017388068480040168175626308430261136822215963954550961903957470198710031793956540396921050132242111105639052891610105064076031165477438213703242350996557697653217032333568074180779425999009903159899722485351857297469411330465671649</span><br><br>flag_len = <span class="hljs-number">12</span><br>fake_flag_pad = <span class="hljs-string">&#x27;flag&#123;&#x27;</span>.encode() + <span class="hljs-string">&#x27;\x00&#x27;</span>.encode()*flag_len+<span class="hljs-string">&#x27;&#125;&#x27;</span>.encode()<br>flag_pattern = (pad(fake_flag_pad, <span class="hljs-number">128</span>))<br>flag_pattern = bytes_to_long(flag_pattern)<br>pattern = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">888</span><br>cc = c * inverse(<span class="hljs-built_in">pow</span>(g, flag_pattern, p), p) % p<br><br>cc = <span class="hljs-built_in">pow</span>(cc, inverse(pattern, q), p)<br>table = [<span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>, <span class="hljs-string">&#x27;4&#x27;</span>, <span class="hljs-string">&#x27;5&#x27;</span>, <span class="hljs-string">&#x27;6&#x27;</span>,<br>         <span class="hljs-string">&#x27;7&#x27;</span>, <span class="hljs-string">&#x27;8&#x27;</span>, <span class="hljs-string">&#x27;9&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>, <span class="hljs-string">&#x27;e&#x27;</span>, <span class="hljs-string">&#x27;f&#x27;</span>]<br><br>dic = <span class="hljs-built_in">dict</span>()<br>gtemp = <span class="hljs-built_in">pow</span>(g, <span class="hljs-number">2</span>**<span class="hljs-number">48</span>, p)<br><br><span class="hljs-keyword">for</span> half_flag1 <span class="hljs-keyword">in</span> tqdm(itertools.product(table, repeat=<span class="hljs-number">6</span>)):<br>    half_flag1 = bytes_to_long(<span class="hljs-string">&#x27;&#x27;</span>.join(half_flag1).encode())<br>    temp = cc * powmod(gtemp, -(half_flag1), p) % p<br>    dic[temp] = half_flag1<br><br><span class="hljs-keyword">for</span> half_flag2 <span class="hljs-keyword">in</span> tqdm(itertools.product(table, repeat=<span class="hljs-number">6</span>)):<br>    half_flag2 = bytes_to_long(<span class="hljs-string">&#x27;&#x27;</span>.join(half_flag2).encode())<br>    temp = powmod(g, half_flag2, p)<br>    <span class="hljs-keyword">if</span> temp <span class="hljs-keyword">in</span> dic:<br>        <span class="hljs-built_in">print</span>(long_to_bytes(dic[temp]) + long_to_bytes(half_flag2))<br></code></pre></td></tr></table></figure> ## guess game(20 solves)å¯¹ç§°å¯†ç é¢˜ï¼Œåº”è¯¥æ˜¯å·®åˆ†åˆ†æï¼Œæš‚æ—¶æ²¡çœ‹åˆ°é¢„æœŸè§£ã€‚éƒ½æ˜¯ç›´æ¥çˆ†ç ´ç¢°è¿æ°”ğŸ˜„ï¼Œè„šæœ¬å°±å‡ è¡Œï¼Œä¸€ç›´å‘1å°±å®Œäº†ã€‚## babyrsa(14 solves) è®ºæ–‡é¢˜ï¼Œå€¼å¾—ä¸€å¤ç°ã€‚ ## 1515(10 solves)è®ºæ–‡é¢˜ï¼Œä¹‹åç»“åˆä¸€é“å…¶ä»–é¢˜ç›®ä¸€èµ·è¯´æ˜ï¼Œåƒæ˜¯ä¹‹å‰åšè¿‡çš„ä¸€é“plusç‰ˆæœ¬ã€‚ ##recovery(3 solves) è¿™ä¸ªç®—äº†ï¼Œè‚¯å®šå¤ä¸åŠ¨ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;å¼ºç½‘æ˜¯å¼ºè€…çš„ç½‘ç»œå®‰å…¨ç«èµ›ï¼Œæˆ‘å¤ªèœäº†ã€‚ã€‚æ…¢æ…¢å¤ç›˜ï¼Œä¼°è®¡å¾—å¤ç›˜åˆ°æ˜å¹´äº†ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;not-only-rsa118-solves&quot;&gt;not only rsa(118 solves)&lt;/h2&gt;
&lt;figure c</summary>
      
    
    
    
    <category term="CTF" scheme="https://sch01ar.github.io/categories/CTF/"/>
    
    
  </entry>
  
  <entry>
    <title>2023DASCTF X 0psu3åä¸€æœˆæŒ‘æˆ˜èµ›</title>
    <link href="https://sch01ar.github.io/2023/12/12/20230psu3CTF/"/>
    <id>https://sch01ar.github.io/2023/12/12/20230psu3CTF/</id>
    <published>2023-12-12T11:05:45.000Z</published>
    <updated>2023-12-19T12:01:39.688Z</updated>
    
    <content type="html"><![CDATA[<h2 id="generateprime">GeneratePrime</h2><blockquote><p>è§£æœ€å¤šçš„é¢˜ï¼Œä½†æˆ‘ä¸ä¼šåšã€‚èµ›åä¸€çœ‹wpï¼Œå¥½å•ŠåŸæ¥æ˜¯åŸé¢˜ã€‚ç ”ç©¶ä¸€ä¸‹åŸç†ï¼Œæ„Ÿè§‰ç¡®å®éš¾åº¦å¯ä»¥ã€‚</p></blockquote><h3 id="é¢˜ç›®">é¢˜ç›®</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> getPrime, isPrime, bytes_to_long<br><span class="hljs-keyword">import</span> os<br><br><span class="hljs-keyword">def</span> 0psu3_The_best(sz, d):<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        p = getPrime(sz)<br>        pp = <span class="hljs-built_in">sum</span>([p**i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(d)])<br>        <span class="hljs-keyword">if</span> isPrime(pp):<br>            <span class="hljs-keyword">return</span> p, pp<br><br><br>p, q = 0psu3_The_best(<span class="hljs-number">512</span>, <span class="hljs-number">5</span>)<br>r = getPrime(<span class="hljs-number">512</span> * <span class="hljs-number">5</span>)<br>n = p * q * r<br>e = <span class="hljs-number">65537</span><br>flag=<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;flag.txt&quot;</span>, <span class="hljs-string">&quot;rb&quot;</span>).read().strip()<br>flag1=flag+os.urandom(<span class="hljs-number">128</span>)<br>m=bytes_to_long(flag1)<br><br>c = <span class="hljs-built_in">pow</span>(m, e, n)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;n = &#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;e = &#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;c = &#125;</span>&quot;</span>)<br><br><br><span class="hljs-comment">#n=43090231453250894711427929679917165532091051269639380881822679198388872373018031295429558758883298138388596507242928145888959963579111847255588834248367032580980272245414738073179172684104908272069503607376171584936239696444309039211273376010193165083254209608051430794825261116490356392215410064858020176711199543381037420111454942356936721487016187240237683725310306748046587503625096246489043270381153251813360521583717685413070481576320194446237522118380283335294528606720928637529817170809666802598938788405154468683850385277659812316577873886708164549255359514776884765904417881419804464020855420288884972204146588152412816874161445668955639456202226751519881834234916642218078966066353317917939418964763844067220460513388433020071277477619189495465483910271310025371745344364984826481983188861624474015117761898377237745775289039922285111681410319016537270412509750339539020876501534842403407208957382830000761065368861209033791387480377889838737241326116532852335478193204425626487166234964754732945953080086117315162916374952094149599597509405176646068341218684523765974759907645226607364627690026025662221036766148813918691578120023886400197652148214238256715089883892069133754778609710846757189987335827693169644541734443763194942694587436469448973201513131503797898892822373949177030567791519349220158287318717788746060997955057747930375117780320371517616412423571775682868481089431670802944047375824503353609019686495670630728618082254293585479431369645935654024149490741245953271830453426444847467908952699660750809490650479987</span><br><span class="hljs-comment">#e=65537</span><br><span class="hljs-comment">#c=30862228874892553476569860337345503267926249096036551213683005116620750680365154103242717714230966827288361499342464202425467642950081816675486231250411347472976482409360391136808439034217688010072648722396312121758844966972323513456884732046270240934002095706243044210312663525491282667971502534420245427643076262414036655243117610886157895994101178663474990136516153062956803591842233732498519246731337518545018734984319536536205092573418457928952414660837594265802406473201400259189950484841504227372735345451459452313825309333631615286962304963039625162366186574440146535361888708570569938418676320446653266676364765870547213167058713058609788316647593834008151805692510044158607162858906528913516242904419457446211348504248317409844426309455978985314882123424453618672960876022996245213882467954521212481418830104602302179759479012618982228223244131619557639469872139485197176384683400796204681045965981417650462297978265085323342772310690638049411549216990505001950512428646871875659468885490055363436412364532718888124906227240501145227269727887236864060558999336443165765870556727793253297515155026234234422303238380776900105115890363548589834345888430695886678231459920101695996112312269637459823479947618045447071359886515163416153117176539752947700226596291435270282598638974889205601333097978743387412651687356072223691445472690647184292120882095587563356691450107194982597794937293154289560470269606300576216128045797481404606810315677962659136641943747123985144899464108823536597185386155005111274476874957827391438859327653936</span><br></code></pre></td></tr></table></figure><h3 id="åˆ†æ">åˆ†æ</h3><p>å‚è€ƒ<ahref="https://tangcuxiaojikuai.xyz/post/ea445335.html">åšå®¢</a> <spanclass="math display">\[n=(p^4+p^3+p^2+p+1)\cdot p\cdot r\]</span></p><p><spanclass="math display">\[p^5-1=(p-1)\cdot(p^4+p^3+p^2+p+1)=(p-1)\cdotq\]</span></p><p>æ„é€ ä¸€ä¸ªé˜¶ä¸º<spanclass="math inline">\(p^5-1\)</span>çš„åŸŸï¼Œåˆ©ç”¨å…¶ç”Ÿæˆå…ƒ<spanclass="math inline">\(g\)</span>è®¡ç®—<spanclass="math inline">\(g^n\)</span>çš„é˜¶ã€‚</p><p><spanclass="math display">\[order(g^n)=\frac{p^5-1}{gcd(n,p^5-1)}=\frac{p^5-1}{q}=p-1\]</span></p><p>å¯¹äºé˜¶çš„å®šä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°é˜¶ä¸º<spanclass="math inline">\(p-1\)</span>çš„ä»»æ„å…ƒç´ <spanclass="math inline">\(a\)</span>æ»¡è¶³<spanclass="math inline">\(a^{p-1}=1\)</span>ï¼Œ<spanclass="math inline">\(1\)</span>æŒ‡å¹ºå…ƒã€‚</p><p>å‚è€ƒä¸Šè¿°åšå®¢ï¼Œåº”ç”¨ç¾¤ç¯åŸŸçš„æ€§è´¨å¾—åˆ°<spanclass="math inline">\(g^n=ax^2+bx+c\)</span>ï¼Œå³è¡¨ç¤ºæˆåº¦æœ€å¤§ä¸ºäºŒçš„å¤šé¡¹å¼ã€‚</p><p>ç»“åˆä¸Šè¿°ä¸¤å¼å†™æˆå¦‚ä¸‹å½¢å¼ï¼š <spanclass="math display">\[(0x^2+0x+c)^{p-1}=1,c \in (0,p)\]</span></p><p>æ­¤æ—¶ç”¨åˆ°å¦ä¸€æ¡æ€§è´¨ï¼Œé˜¶ä¸º<spanclass="math inline">\(p-1\)</span>çš„å…ƒç´ ä¸ªæ•°ä¸º<spanclass="math inline">\(\phi(p-1)\)</span>ä¸ªï¼Œè€Œ<spanclass="math inline">\(c\)</span>çš„å–å€¼ä¸ªæ•°è¦å¤§äº<spanclass="math inline">\(\phi(p-1)\)</span>ä¸ªï¼Œå› æ­¤<spanclass="math inline">\(g^n\)</span>åªèƒ½ç”±å¸¸æ•°äº§ç”Ÿã€‚</p><p>è‡³æ­¤ä¸Šè¿°çš„åˆ†æéƒ½æ˜¯åœ¨é˜¶ä¸º<spanclass="math inline">\(p^5-1\)</span>çš„ç¯ä¸Šè¿›è¡Œçš„è®¨è®ºï¼Œè€Œå®é™…å½“ä¸­æˆ‘ä»¬å¹¶æ²¡æœ‰pï¼Œå€˜è‹¥æ„é€ å‡ºæ¨¡<spanclass="math inline">\(n\)</span>çš„ç¯ï¼Œé‚£ä¹ˆåœ¨è¯¥ç¯ä¸Šè®¡ç®—å¾—åˆ°çš„<spanclass="math inline">\(g^n\)</span>çš„ä¸€æ¬¡é¡¹å’ŒäºŒæ¬¡é¡¹ç³»æ•°åº”è¯¥éƒ½æ˜¯<spanclass="math inline">\(kp\)</span>ï¼Œè¿™æ ·å†ä¸<spanclass="math inline">\(n\)</span>æ±‚è§£gcdå³å¯ã€‚</p><h3 id="exp">exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python">k = <span class="hljs-number">5</span><br>n=<br>e=<span class="hljs-number">65537</span><br>c=<br><br>R = Zmod(n)[<span class="hljs-string">&quot;x&quot;</span>]<br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    Q = R.quo(R.random_element(k))<br>    pp1 = gcd(ZZ(<span class="hljs-built_in">list</span>(Q.random_element() ^ n)[<span class="hljs-number">1</span>]), n)<br>    <span class="hljs-keyword">if</span> pp1 != <span class="hljs-number">1</span>:<br>        <span class="hljs-built_in">print</span>(pp1)<br>        qq = <span class="hljs-built_in">sum</span>([pp1**i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(k)])<br>        rr = n // (pp1 * qq)<br>        <span class="hljs-keyword">assert</span> n == pp1 * qq * rr<br>        <span class="hljs-keyword">break</span><br>phi = (pp - <span class="hljs-number">1</span>) * (qq - <span class="hljs-number">1</span>) * (rr - <span class="hljs-number">1</span>)<br>d = <span class="hljs-built_in">pow</span>(e, -<span class="hljs-number">1</span>, phi)<br>m = <span class="hljs-built_in">pow</span>(c, d, n)<br><span class="hljs-built_in">print</span>(long_to_bytes(<span class="hljs-built_in">int</span>(m))<br></code></pre></td></tr></table></figure><h2 id="findprime">FindPrime</h2><blockquote><p>æ²¡å•¥æ„æ€ï¼Œå°±å—¯ç¼ï¼Œagcd+amm</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> gmpy2 <span class="hljs-keyword">import</span> *<br>P=getPrime(<span class="hljs-built_in">int</span>(<span class="hljs-number">512</span>))<br>p_list=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">30</span>):<br>    q=getPrime(<span class="hljs-number">1024</span>)<br>    r=getPrime(<span class="hljs-number">450</span>)<br>    l=q*P+r<br>    p_list.append(l)<br>path1=<span class="hljs-string">&quot;D:/CTFé¢˜ç›®\å¯†ç \å‡ºé¢˜1/&quot;</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;output.txt&quot;</span>,<span class="hljs-string">&#x27;w&#x27;</span>)<span class="hljs-keyword">as</span> f1:<br>    <span class="hljs-keyword">for</span> val <span class="hljs-keyword">in</span> p_list:<br>        f1.write(<span class="hljs-built_in">str</span>(val))<br>        f1.write(<span class="hljs-string">&quot;\n&quot;</span>)<br><br>Q=getPrime(<span class="hljs-number">512</span>)<br>N=P*Q<br>e=e1*e2<br>m=bytes_to_long(flag2)<br>c=<span class="hljs-built_in">pow</span>(m,e,N)<br><span class="hljs-keyword">assert</span> m&lt;N<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;N=&quot;</span>,N)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;e=&quot;</span>,e)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;c=&quot;</span>,c)<br><br><span class="hljs-comment">#N=68770027076980723946939075792572969610228738501865973895618044035550466673326811210718966610231582633896160130057212343512606374318082678735227998163020559923237005947682357783487924911009663067842443440348588088325506801639924926097944176357432282915587075930988972621730524537492705984723766652062305363027</span><br><span class="hljs-comment">#e=30899846873</span><br><span class="hljs-comment">#c=46935517038224473812546067305866276864169387205589347201858550096671613860700878462369638807831295923952343159795466895818221029692119135003812788250010552362110290387383510093277209478665971066986914981717774698233220968427990066291572377851164878122374241804989577737820368814455456808941766309324614067608</span><br><br></code></pre></td></tr></table></figure><h3 id="exp-1">exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sympy.ntheory.modular <span class="hljs-keyword">import</span> crt<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br>n = <span class="hljs-number">68770027076980723946939075792572969610228738501865973895618044035550466673326811210718966610231582633896160130057212343512606374318082678735227998163020559923237005947682357783487924911009663067842443440348588088325506801639924926097944176357432282915587075930988972621730524537492705984723766652062305363027</span><br><br>c = <span class="hljs-number">46935517038224473812546067305866276864169387205589347201858550096671613860700878462369638807831295923952343159795466895818221029692119135003812788250010552362110290387383510093277209478665971066986914981717774698233220968427990066291572377851164878122374241804989577737820368814455456808941766309324614067608</span><br>p = <span class="hljs-number">8475751295865335034925394592760419247986527875671629878727167186701425140981793707985425024055132199826439868047385642931090550239766413089832011638673209</span><br>q = n//p<br>e = [<span class="hljs-number">7</span>,<span class="hljs-number">191</span>,<span class="hljs-number">23111329</span>]<br>N = n<br>d1 = inverse(e[<span class="hljs-number">2</span>],(p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>))<br>c = <span class="hljs-built_in">pow</span>(c,d1,N)<br><br><span class="hljs-comment">#p</span><br>dp1 = inverse(<span class="hljs-number">191</span>,p-<span class="hljs-number">1</span>)<br>cp = <span class="hljs-built_in">pow</span>(c,dp1,p)<br>PR.&lt;x&gt; = Zmod(p)[]<br>f = x^<span class="hljs-number">7</span> - cp<br>resp = f.roots()<br><br><span class="hljs-comment">#q</span><br>PR.&lt;x&gt; = Zmod(q)[]<br>f = x^(<span class="hljs-number">191</span>*<span class="hljs-number">7</span>) - c<br>resq = f.roots()<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> resp:<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> resq:<br>        ti = <span class="hljs-built_in">int</span>(i[<span class="hljs-number">0</span>])<br>        tj = <span class="hljs-built_in">int</span>(j[<span class="hljs-number">0</span>])<br>        n = [p,q]<br>        c = [ti,tj]<br>        m = crt(n,c)[<span class="hljs-number">0</span>]<br>        <span class="hljs-keyword">if</span>(<span class="hljs-string">b&quot;DASCTF&quot;</span> <span class="hljs-keyword">in</span> long_to_bytes(<span class="hljs-built_in">int</span>(m))):<br>            <span class="hljs-built_in">print</span>(long_to_bytes(<span class="hljs-built_in">int</span>(m)))<br><br></code></pre></td></tr></table></figure><h2 id="mathfactor1">MathFactor1</h2><h3 id="é¢˜ç›®-1">é¢˜ç›®</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br>p=getPrime(<span class="hljs-number">512</span>)<br>q=getPrime(<span class="hljs-number">512</span>)<br>n=p*q<br>d=(p**<span class="hljs-number">21</span>+q**<span class="hljs-number">17</span>)<br>d1=d&amp;(<span class="hljs-number">2</span>**<span class="hljs-number">300</span>-<span class="hljs-number">1</span>)<br><br>flag=<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;flag.txt&quot;</span>).read().strip()<br><span class="hljs-keyword">import</span> os<br><br>flag=flag+os.urandom(<span class="hljs-number">60</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;n = &#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;e = &#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;c = &#125;</span>&quot;</span>)<br><br><span class="hljs-comment">#n=89049581381915401856270440494182068395799559452947499744642830361236578373835725708887668528820916651578050248209041339369091828040992115394942524278397293747808840107939504743946806866214713225533666120894844131211241905215662457238793580469827973839976134854993162976454283311566973255659612267446150515233</span><br><span class="hljs-comment">#e=65537</span><br><span class="hljs-comment">#c=16305239798028293699632813396005973660370581911030264211210444559974188415332021689054795983319112132645051076901780239982290095820283651929773925636804434706351474493000010749679965744672518110692104573489299874390925347271040454693791271882869477780584606934066152476594086178041874762147934091597942667138</span><br><span class="hljs-comment">#d1=1253867202722198232827428701701674148965306906567632781415318063046179456643047348348144258</span><br></code></pre></td></tr></table></figure><h3 id="æ€è·¯ä¸€">æ€è·¯ä¸€</h3><p>ç»™äº†<spanclass="math inline">\(p^{21}+q^{17}\)</span>çš„ä½ä½ï¼Œç›¸å½“äºç»™äº†ä¸€ç»„å‰ªææ¡ä»¶ï¼Œä»ä½ä½å¼€å§‹çˆ†ç ´å³å¯ï¼Œæœ€åå¾—åˆ°çš„<code>p_list</code>éƒ½ä¸ç®—é•¿ï¼Œéå†ä¸€ä¸‹é€šè¿‡<code>coppersmith</code>æ‰“ä¸€ä¸ªé«˜ä½å°±å¯ã€‚è¿™æ˜¯å®˜æ–¹wpç»™çš„è§£æ³•ï¼Œç”¨å‰ªæç¡®å®ä¸å¥½æƒ³ï¼Œç»™äº†è¿™æ ·ä¸€ä¸ªé™åˆ¶å‰ªææ•ˆæœç¡®å®æŒºå¥½ã€‚<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_pq</span>(<span class="hljs-params">n,d1</span>):<br>    a = [<span class="hljs-number">0</span>]<br>    b = [<span class="hljs-number">0</span>]<br>    maskx = <span class="hljs-number">1</span><br>    maskn = <span class="hljs-number">2</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">300</span>):<br>        nbit = n % maskn<br>        t_a = []<br>        t_b = []<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(a)):<br>            <span class="hljs-keyword">for</span> aa <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>):<br>                <span class="hljs-keyword">for</span> bb <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>):<br>                    d=d1% maskn<br>                    tmp2 = n % maskn<br>                    tmp_p=(aa * maskn // <span class="hljs-number">2</span> + a[j])<br>                    tmp_q=(bb * maskn // <span class="hljs-number">2</span> + b[j])<br>                    tmp1 =(tmp_p**<span class="hljs-number">21</span>+tmp_q**<span class="hljs-number">17</span>) % maskn<br>                    tmp3=(tmp_p*tmp_q)%maskn<br>                    <span class="hljs-keyword">if</span> tmp2 == tmp3:<br>                        <span class="hljs-keyword">if</span> tmp1==d:<br>                            t_a.append(aa * maskn // <span class="hljs-number">2</span> + a[j])<br>                            t_b.append(bb * maskn // <span class="hljs-number">2</span> + b[j])<br>        maskx *= <span class="hljs-number">2</span><br>        maskn *= <span class="hljs-number">2</span><br>        a = t_a<br>        b = t_b<br>    <span class="hljs-keyword">return</span> a,b<br><br>n=<span class="hljs-number">89049581381915401856270440494182068395799559452947499744642830361236578373835725708887668528820916651578050248209041339369091828040992115394942524278397293747808840107939504743946806866214713225533666120894844131211241905215662457238793580469827973839976134854993162976454283311566973255659612267446150515233</span><br>e=<span class="hljs-number">65537</span><br>c=<span class="hljs-number">16305239798028293699632813396005973660370581911030264211210444559974188415332021689054795983319112132645051076901780239982290095820283651929773925636804434706351474493000010749679965744672518110692104573489299874390925347271040454693791271882869477780584606934066152476594086178041874762147934091597942667138</span><br>d1=<span class="hljs-number">1253867202722198232827428701701674148965306906567632781415318063046179456643047348348144258</span><br>p_list,q_list=get_pq(n,d1)<br>R.&lt;x&gt;=Zmod(n)[]<br><span class="hljs-keyword">for</span> p_ <span class="hljs-keyword">in</span> p_list:<br>    f=p_+<span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>,<span class="hljs-number">299</span>)*x<br>    f1=f.monic()<br>    r=f1.small_roots(X=<span class="hljs-number">2</span>^<span class="hljs-number">214</span>,beta=<span class="hljs-number">0.49</span>)<br>    <span class="hljs-keyword">if</span> r:<br>        p=f(r[<span class="hljs-number">0</span>])<br>        p=<span class="hljs-built_in">int</span>(p)<br>        <span class="hljs-built_in">print</span>(p)<br>        <span class="hljs-keyword">assert</span> isPrime(p)<br>        q=n//p<br>        phi=(p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)<br>        d=invert(e,phi)<br>        m=<span class="hljs-built_in">pow</span>(c,d,n)<br>        flag=long_to_bytes(<span class="hljs-built_in">int</span>(m))<br>        <span class="hljs-built_in">print</span>(flag)<br>        <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure></p><h3 id="æ€è·¯äºŒ">æ€è·¯äºŒ</h3><p>é€šè¿‡è§£æ¨¡<spanclass="math inline">\(2^{300}\)</span>çš„æ–¹ç¨‹æ¥å¾—åˆ°å¯èƒ½çš„ä½300ä½pï¼Œ<spanclass="math inline">\(d=p^{21}+q^{17}\)</span>ï¼Œå†éå†æ±‚é«˜ä½å³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">p = var(<span class="hljs-string">&#x27;p&#x27;</span>)<br>p0 = solve_mod([p^<span class="hljs-number">38</span> - d1*p^<span class="hljs-number">17</span> + n^<span class="hljs-number">17</span>  == <span class="hljs-number">0</span>], <span class="hljs-number">2</span>^<span class="hljs-number">300</span>)<br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;generateprime&quot;&gt;GeneratePrime&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;è§£æœ€å¤šçš„é¢˜ï¼Œä½†æˆ‘ä¸ä¼šåšã€‚èµ›åä¸€çœ‹wpï¼Œå¥½å•ŠåŸæ¥æ˜¯åŸé¢˜ã€‚ç ”ç©¶ä¸€ä¸‹åŸç†ï¼Œæ„Ÿè§‰ç¡®å®éš¾åº¦å¯ä»¥ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;é¢˜ç›®&quot;&gt;é¢˜ç›®&lt;/h3&gt;
</summary>
      
    
    
    
    <category term="CTF" scheme="https://sch01ar.github.io/categories/CTF/"/>
    
    
  </entry>
  
  <entry>
    <title>æ ¼å¯†ç </title>
    <link href="https://sch01ar.github.io/2023/11/10/lattice/"/>
    <id>https://sch01ar.github.io/2023/11/10/lattice/</id>
    <published>2023-11-10T13:05:45.000Z</published>
    <updated>2023-11-11T01:24:42.882Z</updated>
    
    <content type="html"><![CDATA[<h2 id="çº¿æ€§ä»£æ•°å‰ç½®çŸ¥è¯†">çº¿æ€§ä»£æ•°å‰ç½®çŸ¥è¯†</h2><blockquote><p>å…ˆå›é¡¾ä¸€ä¸‹å­¦æ ¡çº¿ä»£è¯¾ç¨‹è®²è¿‡çš„å‡ ä¸ªæ¦‚å¿µ</p></blockquote><h3 id="å‘é‡ç©ºé—´">å‘é‡ç©ºé—´</h3><p>è®¾<span class="math inline">\(V\)</span>æ˜¯ n å…ƒå‘é‡çš„é›†åˆï¼Œå¦‚æœ<spanclass="math inline">\(V\)</span>éç©ºï¼Œå¹¶ä¸”å¯¹äºå‘é‡çš„çº¿æ€§è¿ç®—å°é—­(å³å¯¹ä»»æ„<span class="math inline">\(\boldsymbol{v_1} \in V,\boldsymbol{v_2} \inV,k \in \mathbb{R}\)</span> ï¼Œéƒ½æœ‰ <spanclass="math inline">\(\boldsymbol{v_1+v_2} \in V,k\boldsymbol{v_1} \inV\)</span> )ï¼Œåˆ™ç§° <span class="math inline">\(V\)</span>æ˜¯ä¸€ä¸ª<strong>å‘é‡ç©ºé—´</strong>ã€‚</p><h3 id="å‘é‡ç©ºé—´çš„åŸºä¸ç»´æ•°">å‘é‡ç©ºé—´çš„åŸºä¸ç»´æ•°</h3><p>å‘é‡ç©ºé—´<spanclass="math inline">\(V\)</span>çš„ä¸€ä¸ªæå¤§æ— å…³ç»„å«åš<spanclass="math inline">\(V\)</span>çš„ä¸€ä¸ª<strong>åŸº</strong>ï¼Œ<spanclass="math inline">\(V\)</span> çš„ç§©å«åš<spanclass="math inline">\(V\)</span>çš„<strong>ç»´æ•°</strong>ï¼Œè®°ä½œ<spanclass="math inline">\(dim(V)\)</span>ã€‚è‹¥ <spanclass="math inline">\(dim(V)=r\)</span>ï¼Œåˆ™ç§°<spanclass="math inline">\(V\)</span>ä¸º<spanclass="math inline">\(r\)</span>ç»´å‘é‡ç©ºé—´ã€‚</p><p>è‹¥å·²çŸ¥<span class="math inline">\(r\)</span>ç»´å‘é‡ç©ºé—´<spanclass="math inline">\(V\)</span>çš„åŸºä¸º<spanclass="math inline">\(\boldsymbol{v_1,v_2,\cdots,v_r}\)</span>ï¼Œåˆ™å‘é‡ç©ºé—´<spanclass="math inline">\(V\)</span>å¯ä»¥è¡¨ç¤ºæˆ</p><p><span class="math display">\[V=\{ \boldsymbol{v}=x_1\boldsymbol{v_1}+x_2\boldsymbol{v_2}+\cdots+x_r\boldsymbol{v_r} | x_1,x_2,\cdots,x_r \in \mathbb{R}\}\]</span></p><h3id="å‘é‡æ­£äº¤ä¸æ–½å¯†ç‰¹schmidtæ­£äº¤åŒ–">å‘é‡æ­£äº¤ä¸æ–½å¯†ç‰¹(Schmidt)æ­£äº¤åŒ–</h3><p>å½“<span class="math inline">\(\boldsymbol{a\neq 0,b\neq0}\)</span>æ—¶ï¼Œå½“<spanclass="math inline">\((\boldsymbol{a,b}=0)\)</span>ï¼Œå³<spanclass="math inline">\(\boldsymbol{a^Tb}=0\)</span>æ—¶ï¼Œç§°å‘é‡<spanclass="math inline">\(\boldsymbol{a,b}\)</span>æ­£äº¤ã€‚</p><p>ç”±ä¸¤ä¸¤æ­£äº¤çš„éé›¶å‘é‡ç»„æˆçš„å‘é‡ç»„ç§°ä¸º<strong>æ­£äº¤å‘é‡ç»„</strong>ï¼Œç”±å•ä½å‘é‡ç»„æˆçš„æ­£äº¤å‘é‡ç»„ç§°ä¸º<strong>æ ‡å‡†æ­£äº¤å‘é‡ç»„</strong>ã€‚</p><p><spanclass="math inline">\(n\)</span>ç»´æ¬§æ°ç©ºé—´æ±‚è§£æ­£äº¤åŸº,ä¸€ç»„åŸºåº•ä¸º<spanclass="math inline">\((\alpha_1,\alpha_2,\cdots,\alpha_n)\)</span></p><ul><li>Step1:ä»¤ <span class="math inline">\(\beta_1=\alpha_1\)</span></li><li>Step2:è®¡ç®—<span class="math inline">\(\alpha_2\)</span>åœ¨<spanclass="math inline">\(\beta_1\)</span>æ–¹å‘ä¸Šçš„æŠ•å½±ï¼Œå¹¶åšå·®å¾—åˆ° <spanclass="math display">\[\beta_2=\alpha-\frac{(\beta_1,\alpha_2)}{(\beta_1,\beta_1)}\beta_1\]</span></li><li>Step3:è®¡ç®—<span class="math inline">\(\alpha_3\)</span>åœ¨å‘é‡<spanclass="math inline">\(\beta_1,\beta_2\)</span>æ–¹å‘çš„æŠ•å½±ï¼Œç»§ç»­åšå·®å¾—åˆ°<spanclass="math inline">\(\beta_3\)</span></li></ul><h2 id="æ ¼">æ ¼</h2><p><span class="math inline">\(n\)</span>å…ƒå‘é‡çš„é›†åˆ <spanclass="math inline">\(v_1,\cdots,v_n \in\mathbb{R}^n\)</span>ï¼Œæ ¼ï¼ˆLatticesï¼‰å°±æ˜¯è¿™äº›å‘é‡çš„çº¿æ€§ç»„åˆ</p><p><span class="math display">\[L=\{a_1v_1+a_2v_2+\cdots+a_nv_n \mida_1,a_2,\cdots,a_n \in \mathbb{Z}\}\]</span></p><p>å¯¹æ¯”å‘é‡ç©ºé—´çš„å®šä¹‰ï¼Œå¯ä»¥å‘ç°ç³»æ•°æ˜¯æ•´æ•°ï¼Œå› æ­¤å®šä¹‰å‡ºæ¥çš„æ ¼ç©ºé—´æ˜¯ä¸€äº›æ ¼ç‚¹ï¼Œè€Œéè¿ç»­çš„å‘é‡ç©ºé—´ã€‚</p><p>ä¸‹å›¾æ˜¯ä¸€ä¸ªäºŒç»´æ ¼ï¼Œå¹³è¡Œå››è¾¹å½¢çš„ä¸€ç»„é‚»è¾¹æ˜¯æ ¼çš„åŸºåº•ã€‚é€šè¿‡å¯¹è¿™ä¸¤ä¸ªå‘é‡ä¸æ–­è¿›è¡Œçº¿æ€§ç»„åˆï¼Œé‚£ä¹ˆå°±äº§ç”Ÿäº†å¾ˆå¤šæ ¼ç‚¹ï¼Œå°±å½¢æˆäº†ä¸€ä¸ªæ ¼ã€‚<img src="/img/lattice.png" /></p><h3 id="åŸºæœ¬åŸŸ">åŸºæœ¬åŸŸ</h3><p>å‡å®š <span class="math inline">\(v_1,v_2,\cdots,v_n\)</span> æ˜¯æ ¼<span class="math inline">\(L\)</span> çš„åŸºï¼Œ<spanclass="math inline">\(F\{v_1,v_2,\cdots,v_n\}=\{a_1v_1+a_2v_2+\cdots+a_nv_n\mid a_1,a_2,\cdots,a_n \in [0,1]\}\)</span></p><p>ä¸Šå›¾ä¸­çš„å¹³è¡Œå››è¾¹å½¢ï¼Œå°±æ˜¯äºŒç»´æ ¼ä¸­ä¸€ç»„åŸºåº•æ„æˆçš„åŸºæœ¬åŸŸã€‚</p><p>æ ¼åŸºæœ¬åŸŸçš„<strong>ä½“ç§¯</strong>ç­‰äºæ ¼çš„<strong>è¡Œåˆ—å¼</strong>çš„å€¼ï¼ŒåŸºæœ¬åŸŸçš„ä½“ç§¯å°±æ˜¯ç§¯åˆ†ï¼Œè€Œè¿™ä¹Ÿæ­£æ˜¯è¡Œåˆ—å¼çš„å‡ ä½•æ„ä¹‰ï¼Œ<spanclass="math inline">\(Volume(F\{v_1,v_2,\cdots,v_n\})=det(L)\)</span></p><h3 id="çŸ©é˜µè¡¨ç¤º">çŸ©é˜µè¡¨ç¤º</h3><p>å‡å®š <span class="math inline">\(v_1,v_2,\cdots,v_n\)</span> æ˜¯æ ¼<span class="math inline">\(L\)</span> çš„åŸºï¼Œ<spanclass="math inline">\(w_1,w_2,\cdots,w_n \inL\)</span>ï¼Œåˆ™å¿…ç„¶å­˜åœ¨æ•´ç³»æ•° <span class="math inline">\(a_{ij}\)</span>ä½¿å¾—ï¼š</p><p><span class="math display">\[\begin{cases} w_1=a_{11}v_1+a_{12}v_2+\cdots+a_{1n}v_n \\w_2=a_{21}v_1+a_{22}v_2+\cdots+a_{2n}v_n \\ \vdots \\w_n=a_{n1}v_1+a_{n2}v_2+\cdots+a_{nn}v_n \end{cases}\]</span></p><p>å¯ä»¥æå–å‡ºä¸€ä¸ªç³»æ•°çŸ©é˜µ</p><p><span class="math display">\[A=\begin{bmatrix}a_{1,1} &amp; a_{1,2} &amp; \ldots &amp; a_{1,n}\\a_{2,1} &amp; a_{2,2} &amp; \ldots &amp; a_{2,n}\\\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\a_{n,1} &amp; a_{n,2} &amp; \ldots &amp; a_{n,n}\end{bmatrix}\]</span></p><p>è¿›è€Œå°†ä¸Šè¿°æ–¹ç¨‹ç»„è½¬æ¢ä¸ºçŸ©é˜µè¡¨ç¤º<spanclass="math inline">\(\boldsymbol{w}=A * \boldsymbol{v}\)</span></p><h2 id="lllbkz-ç®—æ³•">LLL/BKZ ç®—æ³•</h2><blockquote><p>ä¹‹å‰æ‰“å›½é™…èµ›çœ‹åˆ° discord é‡Œä¸€ç›´æœ‰äººèµç¾ <ahref="https://github.com/keeganryan/flatter">flatter</a>ï¼Œåº”è¯¥æ˜¯åŠ é€Ÿ LLLç”¨çš„ï¼Œæˆ‘è¿˜æ²¡é…å¥½ç¯å¢ƒã€‚</p></blockquote><p>ä¸€ç§<strong>æ ¼åŸºçº¦ç®€</strong>ç®—æ³•ï¼Œå¯ä»¥æ‰¾åˆ°æ ¼ä¸Šçš„ä¸€ç»„æœ€çŸ­çš„<strong>æ­£äº¤åŸº</strong>ã€‚</p><p>åœ¨<code>Sagemath</code>ä¸­å¯ä»¥ç›´æ¥è°ƒç”¨å‡½æ•°ã€‚</p><p>ä½†å¯¹äºå‡½æ•°çš„å®ç°ä»¥åŠç®—æ³•çš„åŸç†æ²¡å¿…è¦æ·±ç©¶ï¼Œåœ¨å…·ä½“é¢˜ç›®å½“ä¸­ä¼šä½¿ç”¨å³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">M = matrix(ZZ,[[],[]])<br>L = M.LLL()<br>L = M.BKZ(block_size=<span class="hljs-number">2</span>)<br>x = L[<span class="hljs-number">0</span>]<br></code></pre></td></tr></table></figure><p>ä¸‹å›¾æ˜¯é«˜æ–¯å¯å‘å¼ï¼Œä¸ºæˆ‘ä»¬å±•ç¤ºäº†æ ¼ä¸Šæœ€çŸ­å‘é‡çš„<strong>æ¬§å‡ é‡Œå¾—èŒƒæ•°</strong>çš„å¤§è‡´èŒƒå›´ã€‚<img src="/img/gsqf.png" /></p><p>è¿™æ ·æˆ‘ä»¬å°±çŸ¥é“æ„é€ å‡ºæ¥çš„æ ¼ï¼Œæ˜¯å¦å¯ä»¥è§„çº¦å‡ºæˆ‘ä»¬çš„ç›®æ ‡å‘é‡ï¼Œä¹Ÿä¸ºæˆ‘ä»¬è°ƒæ•´æ ¼çš„å¹³è¡¡æä¾›äº†æ€è·¯ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨ä»¥ä¸‹å‡ ä¸ªé—®é¢˜å½“ä¸­å…·ä½“çœ‹ä¸€ä¸‹<code>LLL</code>ç®—æ³•çš„åº”ç”¨ã€‚</p><h2 id="lattice-åº”ç”¨">lattice åº”ç”¨</h2><p>ä¸‹é¢å°†é¦–å…ˆä»‹ç»ä¸¤ä¸ªæœ€åŸºæœ¬é—®é¢˜<code>SVP</code>å’Œ<code>CVP</code>ï¼Œè¿™æ˜¯æ ¼ä¸Šçš„ä¸¤ä¸ªå›°éš¾é—®é¢˜ï¼Œéƒ½å±äºNP å®Œå…¨é—®é¢˜ã€‚å› æ­¤åœ¨è¿™ä¸¤ä¸ªå›°éš¾é—®é¢˜ä¸Šä¹Ÿå°†å»¶ä¼¸å‡ºå¾ˆå¤šæ ¼å¯†ç ä½“ç³»ã€‚</p><h3 id="svp">SVP</h3><blockquote><p>æœ€çŸ­å‘é‡é—®é¢˜(Shortest Vector Problemï¼ŒSVP)</p></blockquote><p>è¿™æ˜¯æœ€åŸºæœ¬çš„ä¸€ä¸ªé—®é¢˜ï¼Œåç»­å¾ˆå¤šæ ¼é—®é¢˜æœ€ç»ˆéƒ½è½¬æ¢æˆäº†<code>SVP</code>é—®é¢˜ï¼Œä»<code>LLL</code>ç®—æ³•ä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œæœ€ç»ˆå¾—åˆ°çš„æ˜¯æ ¼ä¸Šçš„æœ€çŸ­æ­£äº¤å‘é‡ç»„ã€‚</p><p>ä¸‹é¢ä»ä¸€ä¸ªä¾‹å­æ¥ä»‹ç»æ ¼çš„æ„é€ å’Œ LLL çš„åº”ç”¨ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">p = getPrime(<span class="hljs-number">1023</span>)<br>q = getPrime(<span class="hljs-number">1023</span>)<br>f = getPrime(<span class="hljs-number">2048</span>)<br>g = getPrime(<span class="hljs-number">2048</span>)<br>f =<br>g =<br><span class="hljs-keyword">assert</span> (p * f - <span class="hljs-number">58</span> * f + q) % g == <span class="hljs-number">44</span><br></code></pre></td></tr></table></figure><p><span class="math display">\[(p*f - 58 * f + q) \% g = 44\]</span><span class="math display">\[k\cdot g+44=(p-58)\cdot f+q\]</span>æˆ‘ä»¬ç›®çš„æ˜¯é€šè¿‡<span class="math inline">\(f,g\)</span>æ±‚å‡º<spanclass="math inline">\(p,q\)</span>ï¼Œä»ä»£ç çš„å®šä¹‰å¯ä»¥çœ‹åˆ°ï¼Œ<spanclass="math inline">\(p,q\)</span>çš„ä½æ•°ç›¸æ¯”äº<spanclass="math inline">\(f,g\)</span>æ¥è¯´å¾ˆå°ï¼Œå› æ­¤å¯ä»¥åº”ç”¨æ ¼çš„æ€è·¯ï¼Œæ„é€ ä¸€ä¸ªåˆé€‚çš„æ ¼ï¼Œè§„çº¦å‡º<spanclass="math inline">\((p,q)\)</span></p><p>å†™å‡ºå¦‚ä¸‹æ–¹ç¨‹ç»„ <span class="math display">\[k\cdot g-(p-58)\cdotf=q-44\]</span> <span class="math display">\[k\cdot 0-(p-58)\cdot(-1)=p-58\]</span>å¯ä»¥çœ‹åˆ°ç¬¬äºŒä¸ªå¼å­æ˜¯ä¸€ä¸ªæ’ç­‰å¼ï¼Œåœ¨æ„é€ æ ¼æ—¶æˆ‘ä»¬é€šå¸¸éœ€è¦åŠ å…¥è¿™æ ·çš„æ’ç­‰å¼ã€‚</p><p>ä¸‹é¢å°†æ–¹ç¨‹ç»„è½¬æ¢ä¸ºçŸ©é˜µã€‚</p><p><span class="math display">\[(k,p-58)Â \begin{bmatrix}0&amp;g\\1&amp;-fÂ \end{bmatrix}=(p-58,q-44)\]</span></p><p>å¾—åˆ°äº†<spanclass="math inline">\(v*B=w\)</span>çš„å½¢å¼ã€‚åœ¨è¿™ä¸ªå¼å­ä¸­æˆ‘ä»¬å…³å¿ƒçš„æ˜¯<spanclass="math inline">\(w\)</span>å‘é‡æ˜¯å¦æ˜¯æ ¼<spanclass="math inline">\(B\)</span>ä¸Šçš„æœ€çŸ­å‘é‡ï¼Œ<spanclass="math inline">\(v\)</span>è¿™æ˜¯çº¿æ€§ç»„åˆçš„ç³»æ•°å¹¶ä¸ç”¨è¿‡å¤šå…³æ³¨ã€‚</p><p>åœ¨ä»‹ç»<strong>é«˜æ–¯å¯å‘å¼</strong>çš„æ—¶å€™ï¼Œæåˆ°äº†æ ¼ä¸Šæœ€çŸ­å‘é‡çš„<strong>æ¬§å‡ é‡Œå¾—èŒƒæ•°</strong>çš„å¤§è‡´èŒƒå›´ï¼Œæˆ‘ä»¬ç°åœ¨éªŒè¯ä¸€ä¸‹ï¼Œçœ‹çœ‹<spanclass="math inline">\(w\)</span>æ˜¯å¦æ˜¯æ ¼<spanclass="math inline">\(B\)</span>ä¸Šçš„æœ€çŸ­å‘é‡ï¼Œå³æ¯”è¾ƒé•¿åº¦<spanclass="math inline">\(||w||\)</span>å’Œé«˜æ–¯æœŸæœ›å€¼<spanclass="math inline">\(\sigma(det(B))\)</span></p><p><span class="math display">\[||w|| = \sqrt{(p-58)^2+(q-44)^2}\approx2^{1024}\]</span> <span class="math display">\[\sigma(det(B))\approxdet(B)^{1/2}=\sqrt{g}\approx 2^{1024}\]</span></p><p>äºæ˜¯<span class="math inline">\(w\)</span>å¤§æ¦‚ç‡ä¸ºæ ¼<spanclass="math inline">\(B\)</span>ä¸Šçš„æœ€çŸ­å‘é‡ï¼Œæ„é€ æ ¼<spanclass="math inline">\(B\)</span>è¿›è¡Œ<code>LLL</code>ç®—æ³•å³å¯ã€‚</p><p>è¿˜æœ‰ä¸ªä¾‹å­å¯ä»¥çœ‹<ahref="https://sch01ar.github.io/2022/11/29/%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98%E7%AE%97%E6%B3%95/">èƒŒåŒ…åŠ å¯†</a></p><h3 id="cvp">CVP</h3><blockquote><p>æœ€è¿‘å‘é‡é—®é¢˜(Closest Vector Problem)ï¼Œæ ¼ä¸Šå¦ä¸€ä¸ªæœ€å¸¸è§çš„é—®é¢˜ã€‚</p></blockquote><p>ç»™å®šæ ¼<span class="math inline">\(L\)</span>çš„ä¸€ç»„åŸºä¸å‘é‡<spanclass="math inline">\(v\)</span>ï¼Œæ‰¾åˆ°åœ¨<spanclass="math inline">\(L\)</span>ä¸Šç¦»<spanclass="math inline">\(v\)</span>æœ€è¿‘çš„ä¸€ä¸ªå‘é‡ã€‚</p><p>æ–¹ä¾¿ç†è§£è¿˜æ˜¯çœ‹ä¸€ä¸‹å‡ ä½•æ„ä¹‰ï¼Œåœ¨è¿ç»­ç©ºé—´ä¸­ä»»æ‰¾ä¸€ç‚¹<spanclass="math inline">\(p\)</span>ï¼ˆæ³¨æ„ï¼šä¸ä¸€å®šåœ¨æ ¼ä¸Šï¼‰ï¼Œè¦æ‰¾åˆ°æ ¼ä¸Šè·ç¦»ç‚¹<spanclass="math inline">\(p\)</span>æœ€è¿‘çš„ä¸€ä¸ªç‚¹ã€‚</p><h3 id="lwe">LWE</h3><blockquote><p>LWE é—®é¢˜(Learn With Error)</p></blockquote><h3 id="acd">ACD</h3><blockquote><p>ACD é—®é¢˜(<a href="https://eprint.iacr.org/2016/215.pdf">ApproximateCommon Divisor</a>)ï¼Œè¿‘ä¼¼å…¬çº¦æ•°(åº”è¯¥ä¹Ÿå¯ä»¥å« AGCD)</p></blockquote><p>ç»™å®š<span class="math inline">\(t\)</span>ç»„<spanclass="math inline">\(x_i\)</span>æ»¡è¶³ï¼š<spanclass="math inline">\(x_i=pq_i+r_i\)</span></p><p><span class="math inline">\(x_i\)</span> å·²çŸ¥ï¼Œ<spanclass="math inline">\(p\)</span> ä¸º <spanclass="math inline">\(\alpha\)</span> ä½ï¼Œ<spanclass="math inline">\(q_i\)</span> ä¸º <spanclass="math inline">\(\beta\)</span> ä½ ï¼Œ<spanclass="math inline">\(r_i\)</span> ä¸º <spanclass="math inline">\(\rho\)</span> ä½ï¼ˆ<span class="math inline">\(\rho\lt\lt \alpha\)</span>ï¼‰ï¼Œæ±‚ <spanclass="math inline">\(p\)</span>ã€‚</p><p><span class="math inline">\(p\)</span>ç›¸å½“äº<spanclass="math inline">\(t\)</span>ç»„<spanclass="math inline">\(x\)</span>çš„è¿‘ä¼¼å…¬çº¦æ•°ï¼Œå› æ­¤è¦æ±‚äº†<spanclass="math inline">\(r_i \lt\lt p\)</span></p><p>æ„é€ </p><p><span class="math display">\[(q_0,q_1,\cdots,q_t)\begin{bmatrix}2^{\rho} &amp; x_1 &amp; x_2 &amp; \cdots &amp; x_t \newline 0 &amp;-x_0 &amp; 0 &amp; \cdots &amp; 0 \newline 0 &amp; 0 &amp; -x_0 &amp;\cdots &amp; 0 \newline \vdots &amp; \vdots &amp; \vdots &amp; \ddots&amp; \vdots \newline 0 &amp; 0 &amp; 0 &amp; \cdots &amp;-x_0\end{bmatrix}=(q_02^{\rho},q_0x_1-q_1x_0,\cdots,q_0x_t-q_tx_0)=(q_02^{\rho},q_0r_1-q_1r_0,\cdots,q_0r_t-q_tr_0)\]</span></p><p>è®°ä¸º <span class="math inline">\(v\cdot B=w\)</span>ã€‚</p><p>ä½¿ç”¨<code>LLL</code>ç®—æ³•å¾—åˆ° <spanclass="math inline">\(q_02^{\rho}\)</span>åå°±å¯ä»¥æ±‚å‡º<spanclass="math inline">\(p\)</span>ã€‚</p><h3 id="hnp">HNP</h3>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;çº¿æ€§ä»£æ•°å‰ç½®çŸ¥è¯†&quot;&gt;çº¿æ€§ä»£æ•°å‰ç½®çŸ¥è¯†&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;å…ˆå›é¡¾ä¸€ä¸‹å­¦æ ¡çº¿ä»£è¯¾ç¨‹è®²è¿‡çš„å‡ ä¸ªæ¦‚å¿µ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;å‘é‡ç©ºé—´&quot;&gt;å‘é‡ç©ºé—´&lt;/h3&gt;
&lt;p&gt;è®¾&lt;span class=&quot;math inline&quot;&gt;\</summary>
      
    
    
    
    <category term="CTF" scheme="https://sch01ar.github.io/categories/CTF/"/>
    
    
    <category term="lattice" scheme="https://sch01ar.github.io/tags/lattice/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€äº›å…³äºp^qé—®é¢˜å‰ªæç®—æ³•</title>
    <link href="https://sch01ar.github.io/2023/11/07/%E5%89%AA%E6%9E%9D/"/>
    <id>https://sch01ar.github.io/2023/11/07/%E5%89%AA%E6%9E%9D/</id>
    <published>2023-11-07T04:05:45.000Z</published>
    <updated>2023-11-07T08:16:17.464Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ­¤ç¯‡æ–‡ç« é’ˆå¯¹ RSA ä¸­ p^q ç›¸å…³é—®é¢˜åŠå˜ç§åšä¸€ä¸ªæ€»ç»“ã€‚ä¹‹å‰åšè¿‡å¾ˆå¤š p^qç›¸å…³çš„é—®é¢˜ï¼Œä½†æ˜¯æ€è·¯å¤§å·®ä¸å·®ï¼Œå‘¨æœ«æ‰“äº†é¹åŸæ¯ï¼Œå¤ç°æ—¶å‘ç°è¦ç»“åˆ copper å’Œdfs æ¥å‰ªæã€‚</p></blockquote><p>å‚è€ƒæ–‡ç« </p><p>https://tangcuxiaojikuai.xyz/post/342113ee.html</p><p>https://mp.weixin.qq.com/s/Bi0iQOXwM5UlntrtdRL1oA</p><h2 id="pq">p^q</h2><h3 id="æœç´¢æ–¹å¼">æœç´¢æ–¹å¼</h3><ul><li>ä»ä½ä½æœç´¢ï¼Œåœ¨å·²çŸ¥ p^q å’Œ p*qçš„æƒ…å†µä¸‹ï¼Œç”±äºå¼‚æˆ–æ˜¯æŒ‰ä½è¿›è¡Œçš„ï¼Œå¯¹äºæ¯ä¸€ä½å¼‚æˆ–çš„ç»“æœæ¥è¯´ï¼Œpã€qè¯¥ä½çš„ç»„åˆæƒ…å†µæœ‰ 4 ç§<code>[1,0][0,1][1,1][0,0]</code></li></ul><h3 id="å‰ªææ¡ä»¶">å‰ªææ¡ä»¶</h3><ul><li>åˆ©ç”¨<code>p*q==n</code>è¿™ä¸€æ¡ä»¶æ¥è¿›è¡Œç­›é€‰ï¼Œç”±äºæ˜¯ä»ä½ä½å¼€å§‹çˆ†ç ´ï¼Œå› æ­¤æ»¡è¶³<spanclass="math inline">\(p_{low}*q_{low}==n_{low}\)</span></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_pq</span>(<span class="hljs-params">n, x</span>):<br>    a = [<span class="hljs-number">0</span>]<br>    b = [<span class="hljs-number">0</span>]<br>    maskx = <span class="hljs-number">1</span><br>    maskn = <span class="hljs-number">2</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1024</span>):<br>        xbit = (x &amp; maskx) &gt;&gt; i<br>        nbit = n % maskn<br>        t_a = []<br>        t_b = []<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(a)):<br>            <span class="hljs-keyword">for</span> aa <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>):<br>                <span class="hljs-keyword">for</span> bb <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>):<br>                    <span class="hljs-keyword">if</span> aa ^ bb == xbit:<br>                        tmp2 = n % maskn<br>                        tmp1 = (aa * maskn // <span class="hljs-number">2</span> + a[j]) * (bb * maskn // <span class="hljs-number">2</span> + b[j]) % maskn<br>                        <span class="hljs-keyword">if</span> tmp1 == tmp2:<br>                            t_a.append(aa * maskn // <span class="hljs-number">2</span> + a[j])<br>                            t_b.append(bb * maskn // <span class="hljs-number">2</span> + b[j])<br>        maskx *= <span class="hljs-number">2</span><br>        maskn *= <span class="hljs-number">2</span><br>        a = t_a<br>        b = t_b<br>    <span class="hljs-keyword">for</span> a1, b1 <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(a, b):<br>        <span class="hljs-keyword">if</span> a1 * b1 == n1:<br>            <span class="hljs-keyword">return</span> a1, b1<br></code></pre></td></tr></table></figure><h2 id="pq_rev">p^q_rev</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">p = getPrime(<span class="hljs-number">256</span>)<br>q = getPrime(<span class="hljs-number">256</span>)<br>_q = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">bin</span>(q)[<span class="hljs-number">2</span>:][::-<span class="hljs-number">1</span>] , <span class="hljs-number">2</span>)<br>n = p * q<br>gift = p ^ q_<br></code></pre></td></tr></table></figure><h3 id="æœç´¢æ–¹å¼-1">æœç´¢æ–¹å¼</h3><ul><li>ä»ä¸¤ç«¯çˆ†ç ´</li><li>æ¯ä¸€æ¬¡æœç´¢ï¼Œéœ€åˆ©ç”¨å½“å‰ gift ä¸¤ç«¯çš„ bit ä½ã€‚è¿™æ˜¯å› ä¸ºï¼Œgiftçš„å½“å‰æœ€é«˜ä½å¯¹åº” p çš„æœ€é«˜ä½åŠ q çš„æœ€ä½ä½ï¼Œgift çš„å½“å‰æœ€ä½ä½å¯¹åº” pçš„æœ€ä½ä½åŠ q çš„æœ€é«˜ä½</li></ul><h3 id="å‰ªææ¡ä»¶-1">å‰ªææ¡ä»¶</h3><ul><li>å°† pã€q æœªæœç´¢åˆ°çš„ä½å…¨å¡« 0ï¼Œä¹˜ç§¯åº”å°äº n</li><li>å°† pã€q æœªæœç´¢åˆ°çš„ä½å…¨å¡« 1ï¼Œä¹˜ç§¯åº”å¤§äº n</li><li>pã€q ä½ k ä½ä¹˜ç§¯å†å–ä½ k ä½ï¼Œåº”ä¸ n çš„ä½ k ä½ç›¸åŒ</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> sys<br>sys.setrecursionlimit(<span class="hljs-number">1500</span>)<br><br>pxorq = <span class="hljs-number">47761879279815109356923025519387920397647575481870870315845640832106405230526</span><br>n = <span class="hljs-number">10310021142875344535823132048350287610122830618624222175188882916320750885684668357543070611134424902255744858233485983896082731376191044874283981089774677</span><br>c = <span class="hljs-number">999963120986258459742830847940927620860107164857685447047839375819380831715400110131705491405902374029088041611909274341590559275004502111124764419485191</span><br>e = <span class="hljs-number">65537</span><br>pxorq = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">bin</span>(pxorq)[<span class="hljs-number">2</span>:]).zfill(<span class="hljs-number">256</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">find</span>(<span class="hljs-params">ph,qh,pl,ql</span>):<br>    l = <span class="hljs-built_in">len</span>(ph)<br>    tmp0 = ph + (<span class="hljs-number">256</span>-<span class="hljs-number">2</span>*l)*<span class="hljs-string">&quot;0&quot;</span> + pl<br>    tmp1 = ph + (<span class="hljs-number">256</span>-<span class="hljs-number">2</span>*l)*<span class="hljs-string">&quot;1&quot;</span> + pl<br>    tmq0 = qh + (<span class="hljs-number">256</span>-<span class="hljs-number">2</span>*l)*<span class="hljs-string">&quot;0&quot;</span> + ql<br>    tmq1 = qh + (<span class="hljs-number">256</span>-<span class="hljs-number">2</span>*l)*<span class="hljs-string">&quot;1&quot;</span> + ql<br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">int</span>(tmp0,<span class="hljs-number">2</span>)*<span class="hljs-built_in">int</span>(tmq0,<span class="hljs-number">2</span>) &gt; n):<br>        <span class="hljs-keyword">return</span><br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">int</span>(tmp1,<span class="hljs-number">2</span>)*<span class="hljs-built_in">int</span>(tmq1,<span class="hljs-number">2</span>) &lt; n):<br>        <span class="hljs-keyword">return</span><br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">int</span>(pl,<span class="hljs-number">2</span>)*<span class="hljs-built_in">int</span>(ql,<span class="hljs-number">2</span>) % (<span class="hljs-number">2</span>**(l-<span class="hljs-number">1</span>)) != n % (<span class="hljs-number">2</span>**(l-<span class="hljs-number">1</span>))):<br>        <span class="hljs-keyword">return</span><br><br>    <span class="hljs-keyword">if</span>(l == <span class="hljs-number">128</span>):<br>        pp0 = <span class="hljs-built_in">int</span>(tmp0,<span class="hljs-number">2</span>)<br>        <span class="hljs-keyword">if</span>(n % pp0 == <span class="hljs-number">0</span>):<br>            pf = pp0<br>            qf = n//pp0<br>            phi = (pf-<span class="hljs-number">1</span>)*(qf-<span class="hljs-number">1</span>)<br>            d = inverse(e,phi)<br>            m1 = <span class="hljs-built_in">pow</span>(c,d,n)<br>            <span class="hljs-built_in">print</span>(long_to_bytes(m1))<br>            exit()<br><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">if</span>(pxorq[l] == <span class="hljs-string">&quot;1&quot;</span> <span class="hljs-keyword">and</span> pxorq[<span class="hljs-number">255</span>-l] == <span class="hljs-string">&quot;1&quot;</span>):<br>            find(ph+<span class="hljs-string">&quot;1&quot;</span>,qh+<span class="hljs-string">&quot;0&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>+pl,<span class="hljs-string">&quot;0&quot;</span>+ql)<br>            find(ph+<span class="hljs-string">&quot;0&quot;</span>,qh+<span class="hljs-string">&quot;0&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>+pl,<span class="hljs-string">&quot;1&quot;</span>+ql)<br>            find(ph+<span class="hljs-string">&quot;1&quot;</span>,qh+<span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-string">&quot;0&quot;</span>+pl,<span class="hljs-string">&quot;0&quot;</span>+ql)<br>            find(ph+<span class="hljs-string">&quot;0&quot;</span>,qh+<span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-string">&quot;0&quot;</span>+pl,<span class="hljs-string">&quot;1&quot;</span>+ql)<br>        <span class="hljs-keyword">elif</span>(pxorq[l] == <span class="hljs-string">&quot;1&quot;</span> <span class="hljs-keyword">and</span> pxorq[<span class="hljs-number">255</span>-l] == <span class="hljs-string">&quot;0&quot;</span>):<br>            find(ph+<span class="hljs-string">&quot;1&quot;</span>,qh+<span class="hljs-string">&quot;0&quot;</span>,<span class="hljs-string">&quot;0&quot;</span>+pl,<span class="hljs-string">&quot;0&quot;</span>+ql)<br>            find(ph+<span class="hljs-string">&quot;0&quot;</span>,qh+<span class="hljs-string">&quot;0&quot;</span>,<span class="hljs-string">&quot;0&quot;</span>+pl,<span class="hljs-string">&quot;1&quot;</span>+ql)<br>            find(ph+<span class="hljs-string">&quot;1&quot;</span>,qh+<span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>+pl,<span class="hljs-string">&quot;0&quot;</span>+ql)<br>            find(ph+<span class="hljs-string">&quot;0&quot;</span>,qh+<span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>+pl,<span class="hljs-string">&quot;1&quot;</span>+ql)<br>        <span class="hljs-keyword">elif</span>(pxorq[l] == <span class="hljs-string">&quot;0&quot;</span> <span class="hljs-keyword">and</span> pxorq[<span class="hljs-number">255</span>-l] == <span class="hljs-string">&quot;1&quot;</span>):<br>            find(ph+<span class="hljs-string">&quot;0&quot;</span>,qh+<span class="hljs-string">&quot;0&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>+pl,<span class="hljs-string">&quot;0&quot;</span>+ql)<br>            find(ph+<span class="hljs-string">&quot;0&quot;</span>,qh+<span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-string">&quot;0&quot;</span>+pl,<span class="hljs-string">&quot;0&quot;</span>+ql)<br>            find(ph+<span class="hljs-string">&quot;1&quot;</span>,qh+<span class="hljs-string">&quot;0&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>+pl,<span class="hljs-string">&quot;1&quot;</span>+ql)<br>            find(ph+<span class="hljs-string">&quot;1&quot;</span>,qh+<span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-string">&quot;0&quot;</span>+pl,<span class="hljs-string">&quot;1&quot;</span>+ql)<br>        <span class="hljs-keyword">elif</span>(pxorq[l] == <span class="hljs-string">&quot;0&quot;</span> <span class="hljs-keyword">and</span> pxorq[<span class="hljs-number">255</span>-l] == <span class="hljs-string">&quot;0&quot;</span>):<br>            find(ph+<span class="hljs-string">&quot;0&quot;</span>,qh+<span class="hljs-string">&quot;0&quot;</span>,<span class="hljs-string">&quot;0&quot;</span>+pl,<span class="hljs-string">&quot;0&quot;</span>+ql)<br>            find(ph+<span class="hljs-string">&quot;1&quot;</span>,qh+<span class="hljs-string">&quot;0&quot;</span>,<span class="hljs-string">&quot;0&quot;</span>+pl,<span class="hljs-string">&quot;1&quot;</span>+ql)<br>            find(ph+<span class="hljs-string">&quot;0&quot;</span>,qh+<span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>+pl,<span class="hljs-string">&quot;0&quot;</span>+ql)<br>            find(ph+<span class="hljs-string">&quot;1&quot;</span>,qh+<span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>+pl,<span class="hljs-string">&quot;1&quot;</span>+ql)<br><br>find(<span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>)<br></code></pre></td></tr></table></figure><h2 id="pqnbits">p^(q&gt;&gt;nbits)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">P = getPrime(<span class="hljs-number">512</span>)<br>Q = getPrime(<span class="hljs-number">512</span>)<br>N = P * Q<br>gift = P ^ (Q &gt;&gt; <span class="hljs-number">16</span>)<br></code></pre></td></tr></table></figure><h3 id="æ€è·¯">æ€è·¯</h3><p>è¿™ä¸ªå…¶å®å¹¶ä¸ç®—å‰ªæäº†ï¼Œå› ä¸º gift çš„é«˜ 16 ä½å°±æ˜¯ P çš„é«˜ 16 ä½ã€‚ç”¨ Né™¤ä»¥ P åå¾—åˆ°çš„å°±æ˜¯ Q çš„é«˜ä½ï¼Œå†æ¬¡åˆ©ç”¨ Q çš„é«˜ä½å’Œ giftï¼Œå¯ä»¥æ±‚å‡º P çš„ 16ï½ 32 ä½ï¼Œä»¥æ­¤ç±»æ¨æ¥æ¢å¤ Pã€Qã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python">pbar = gift &gt;&gt;(<span class="hljs-number">512</span>-<span class="hljs-number">16</span>)<br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    <span class="hljs-keyword">try</span>:<br>        qbar = (N&gt;&gt;(<span class="hljs-number">1024</span> - pbar.bit_length()*<span class="hljs-number">2</span>))//pbar<br>        qbar = qbar&gt;&gt;<span class="hljs-number">6</span><br>        gifts = gift^(qbar&lt;&lt;(<span class="hljs-number">512</span>-<span class="hljs-number">16</span>-qbar.bit_length()))<br>        pbar = gifts &gt;&gt; (<span class="hljs-number">512</span>-<span class="hljs-number">16</span>-qbar.bit_length())<br>    <span class="hljs-keyword">except</span>:<br>        <span class="hljs-keyword">break</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">64</span>):<br>    <span class="hljs-keyword">if</span> N%((pbar&lt;&lt;<span class="hljs-number">6</span>)+i) == <span class="hljs-number">0</span>:<br>        p = (pbar&lt;&lt;<span class="hljs-number">6</span>)+i<br>        q = N//p<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] p =&quot;</span>,p)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[+] q =&quot;</span>,q)<br>        <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure><h2 id="pqnbits-1">(p^q)&gt;&gt;nbits</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">nbits = <span class="hljs-number">512</span><br>p = getPrime(nbits)<br>q = getPrime(nbits)<br>leakBits = <span class="hljs-number">262</span><br>leak = (p ^ q) &gt;&gt; (nbits - leakBits)<br></code></pre></td></tr></table></figure><h3 id="æœç´¢æ–¹å¼-2">æœç´¢æ–¹å¼</h3><ul><li>ä»é«˜ä½æœç´¢</li><li>p çš„é«˜ä½ä¹˜ q çš„é«˜ä½çš„å‰åŠéƒ¨åˆ†ç­‰äº n çš„é«˜ä½</li></ul><h3 id="å‰ªææ¡ä»¶-2">å‰ªææ¡ä»¶</h3><ul><li>ä½ä½å…¨è¡¥ 0ï¼Œç›¸ä¹˜ç»“æœ &lt; n</li><li>ä½ä½å…¨è¡¥ 1ï¼Œç›¸ä¹˜ç»“æœ &gt; n</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python">p=<span class="hljs-string">&#x27;1&#x27;</span><br>q=<span class="hljs-string">&#x27;1&#x27;</span><br><br>P=[p]<br>Q=[q]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">261</span>):<br>    PP=[]<br>    QQ=[]<br>    <span class="hljs-keyword">for</span> a <span class="hljs-keyword">in</span> <span class="hljs-string">&#x27;01&#x27;</span>:<br>        <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> <span class="hljs-string">&#x27;01&#x27;</span>:<br>            <span class="hljs-keyword">for</span> pnew,qnew <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(P,Q):<br>                pnew = pnew+a<br>                qnew = qnew+b<br>                tmp = <span class="hljs-built_in">int</span>(pnew,<span class="hljs-number">2</span>)*<span class="hljs-built_in">int</span>(qnew,<span class="hljs-number">2</span>)<br>                <span class="hljs-keyword">if</span> xor(pnew,qnew) == leak[:<span class="hljs-number">2</span>+i] <span class="hljs-keyword">and</span>  tmp&gt;&gt;(tmp.bit_length()-i//<span class="hljs-number">2</span>)== n&gt;&gt;(n.bit_length()-i//<span class="hljs-number">2</span>) <span class="hljs-keyword">and</span> (<span class="hljs-built_in">int</span>(pnew.ljust(<span class="hljs-number">512</span>,<span class="hljs-string">&#x27;0&#x27;</span>),<span class="hljs-number">2</span>)*<span class="hljs-built_in">int</span>(qnew.ljust(<span class="hljs-number">512</span>,<span class="hljs-string">&#x27;0&#x27;</span>),<span class="hljs-number">2</span>) &lt; n)  <span class="hljs-keyword">and</span> (<span class="hljs-built_in">int</span>(pnew.ljust(<span class="hljs-number">512</span>,<span class="hljs-string">&#x27;1&#x27;</span>),<span class="hljs-number">2</span>)*<span class="hljs-built_in">int</span>(qnew.ljust(<span class="hljs-number">512</span>,<span class="hljs-string">&#x27;1&#x27;</span>),<span class="hljs-number">2</span>) &gt; n) :<br>                    PP.append(pnew)<br>                    QQ.append(qnew)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(P))<br>    P = PP.copy()<br>    Q = QQ.copy()<br><span class="hljs-built_in">print</span>(P)<br></code></pre></td></tr></table></figure><h3 id="coppersmith">coppersmith</h3><p>ä¸Šè¿°å‰ªæåªèƒ½æ±‚å‡ºé«˜ 262 ä½äº†ï¼Œæœ‰å¤šç§ç»„åˆï¼Œä½†ä»ç¼ºå°‘ä½ 250ä½ï¼Œå› æ­¤éœ€è¦ç”¨åˆ° coppersmith æ¥æ±‚è§£ã€‚</p><p>åœ¨å…·ä½“åº”ç”¨æƒ…æ™¯ä¸­åº”å½“é€‚å½“è°ƒæ•´<code>beta</code>å’Œ<code>epsilon</code>ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> *<br>R.&lt;x&gt; = Zmod(n)[]<br><span class="hljs-keyword">for</span> pbar <span class="hljs-keyword">in</span> tqdm(P[::-<span class="hljs-number">1</span>]):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>):<br><br>        tmp = <span class="hljs-built_in">int</span>(pbar,<span class="hljs-number">2</span>)&lt;&lt;<span class="hljs-number">5</span><br>        tmp+=i<br>        f = tmp*<span class="hljs-number">2</span>**<span class="hljs-number">245</span> + x<br>        xx = f.monic().small_roots(X=<span class="hljs-number">2</span>^<span class="hljs-number">245</span>,beta=<span class="hljs-number">0.47</span>,epsilon=<span class="hljs-number">0.02</span>)<br>        <span class="hljs-keyword">if</span> xx:<br>            p = f(xx[<span class="hljs-number">0</span>])<br>            <span class="hljs-built_in">print</span>(p)<br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;æ­¤ç¯‡æ–‡ç« é’ˆå¯¹ RSA ä¸­ p^q ç›¸å…³é—®é¢˜åŠå˜ç§åšä¸€ä¸ªæ€»ç»“ã€‚ä¹‹å‰åšè¿‡å¾ˆå¤š p^q
ç›¸å…³çš„é—®é¢˜ï¼Œä½†æ˜¯æ€è·¯å¤§å·®ä¸å·®ï¼Œå‘¨æœ«æ‰“äº†é¹åŸæ¯ï¼Œå¤ç°æ—¶å‘ç°è¦ç»“åˆ copper å’Œ
dfs æ¥å‰ªæã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å‚è€ƒæ–‡ç« &lt;/p&gt;
&lt;p&gt;</summary>
      
    
    
    
    <category term="CTF" scheme="https://sch01ar.github.io/categories/CTF/"/>
    
    
  </entry>
  
  <entry>
    <title>2023CBCTF</title>
    <link href="https://sch01ar.github.io/2023/11/01/2023CBCTF/"/>
    <id>https://sch01ar.github.io/2023/11/01/2023CBCTF/</id>
    <published>2023-11-01T12:23:06.239Z</published>
    <updated>2023-11-02T11:34:49.710Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä¹‹å‰å’Œ N1CTFæ’äº†ï¼Œä½†æ˜¯æ¯”èµ›é¢˜ç›®è´¨é‡å¾ˆé«˜ï¼Œå½“æ—¶æµ…çœ‹äº†ä¸€ä¸‹ï¼Œç°åœ¨è¡¥ä¸€ä¸‹ã€‚</p></blockquote><h2 id="cb_curve">CB_Curve</h2><p>åˆ©ç”¨ Grobner åŸºè§£ Pç‚¹ï¼Œåç»­å¤ç°æ‰çŸ¥é“è¿™æ˜¯<code>HUFF</code>æ›²çº¿ï¼Œæ ¹æ®è®ºæ–‡æ–¹æ³•å¾—åˆ°æ›²çº¿çš„å®šä¹‰å’Œæ˜ å°„æ–¹æ³•ï¼Œè¿™æ ·å°±å¯å¾—åˆ°ç»´å°”æ–¯ç‰¹æ‹‰æ–¯å½¢å¼ï¼Œåç»­é€šè¿‡å…‰æ»‘é˜¶æ±‚è§£ç¦»æ•£å¯¹æ•°å³å¯ã€‚</p><p>å…³äº GrobneråŸºçš„åº”ç”¨ï¼Œæƒ³åˆ°æš‘å‡<code>0x401</code>å¸ˆå‚…å‡ºçš„ä¸€é“é¢˜ï¼Œåç»­å†™åœ¨è¿™é“é¢˜åé¢ï¼ŒåŠ æ·±ä¸€ä¸‹å°è±¡ã€‚</p><p>æ›²çº¿å½¢å¼</p><p><span class="math display">\[x(a^2y-1)â‰¡y(bx^2-1) mod \quad p\]</span></p><p>æ›²çº¿æ˜ å°„</p><p><span class="math display">\[(x,y)â†’(\frac{bx-ay}{y-x},\frac{b-a}{y-x})\]</span></p><p>ç›®æ ‡æ›²çº¿</p><p><span class="math display">\[y^2â‰¡x^3+(a+b)x^2+abx \quad mod \quad p\]</span></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> randint<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CB_curve</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        self.p = <span class="hljs-number">1141741939958844590498346884870015122543626602665954681008204697160652371664923</span><br>        self.a = <span class="hljs-number">727131475903635498678013730344448225340496007388151739960305539398192321065043</span><br>        self.b = <span class="hljs-number">840714623434321649308065401328602364673881568379142278640950034404861312007307</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">self, P, Q</span>):<br>        <span class="hljs-keyword">if</span> P == -<span class="hljs-number">1</span>:<br>            <span class="hljs-keyword">return</span> Q<br>        (x1, y1) = P<br>        (x2, y2) = Q<br>        x3 = (x1+x2)*(<span class="hljs-number">1</span>+self.a*y1*y2)*inverse((<span class="hljs-number">1</span>+self.b*x1*x2)<br>                                              * (<span class="hljs-number">1</span>-self.a*y1*y2), self.p) % self.p<br>        y3 = (y1+y2)*(<span class="hljs-number">1</span>+self.b*x1*x2)*inverse((<span class="hljs-number">1</span>-self.b*x1*x2)<br>                                              * (<span class="hljs-number">1</span>+self.a*y1*y2), self.p) % self.p<br>        <span class="hljs-keyword">return</span> (x3, y3)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">mul</span>(<span class="hljs-params">self, x, P</span>):<br>        Q = -<span class="hljs-number">1</span><br>        <span class="hljs-keyword">while</span> x &gt; <span class="hljs-number">0</span>:<br>            <span class="hljs-keyword">if</span> x &amp; <span class="hljs-number">1</span>:<br>                Q = self.add(Q, P)<br>            P = self.add(P, P)<br>            x = x &gt;&gt; <span class="hljs-number">1</span><br>        <span class="hljs-keyword">return</span> Q<br><br>    <span class="hljs-comment"># def negG(self, G):</span><br>    <span class="hljs-comment">#     return self.mul(order-1, G)</span><br><br><br><span class="hljs-comment"># pl = [908996880816674413953945844149350915331956247471480600840221415119794882139724, 971918808384910355828135603762747020183688585728289421786279444571287619529246, 1285550352531583269956802123237391199017403081800977678246201935580429758051904, 1551774945769448705387900437472951015954157193946719575845523359198154668857591, 676185408751480221545400062950292727848016906516506232986883519673765317932582,</span><br><span class="hljs-comment">#       1250300209784131850574858927023046353058343552115735540789593580037130054384362, 1298409778422699298367007023890818793557023853717180295526932023194697263501748, 1332552452292482549702793642987623159617988974910321945878093492007278710993114, 1030239404875082841481045525469865919289388171602293245905162820968158543176773, 1154148024180033719999293176590867264297899817449945744942661351655533433871621]</span><br><span class="hljs-comment"># ph = [584297112520340495757457954416165393828472756298945167299482077258411155766756, 886432149227960827335266910774569034430464592640209168563805700117347063152246, 613528590036968449893421430816319461615130635882647544978722093413694101540550, 576162106332135829961234799085370038425761945928004579456101802617485243023987, 627570890346195626159365118862437334953500165050236216404858019114288681512171,</span><br><span class="hljs-comment">#       1015503424232985454098149884321288932492551183126601131968495641510550575005042, 1532737675157046782602115678180407262847166210963507805526455422934164759886583, 1540047002602145805476906585925538790245968214992837106009502002588479779602195, 505097517314409449404205152068185149808364887623922221197462411159844816865696, 873498218680784138428154510303205366133389839886911286745954821800632158315951]</span><br>ecc = CB_curve()<br><span class="hljs-comment"># G = (586066762126624229327260483658353973556531595840920560414263113786807168248797,</span><br><span class="hljs-comment">#      66727759687879628160487324122999265926655929132333860726404158613654375336028)</span><br><span class="hljs-comment"># # P = (ecc.mul(bytes_to_long(flag),G)[0],randint(1,ecc.p))</span><br><span class="hljs-comment"># Q = (460843895959181097343292934009653542386784127282375019764638432240505304648101,</span><br><span class="hljs-comment">#      739422832583403823403837831802136107593509589942947902014204968923412689379907)</span><br>a = ecc.a<br>b = ecc.b<br>p = ecc.p<br><span class="hljs-comment"># R.&lt; x1, y1, e &gt;= PolynomialRing(Zmod(p))</span><br><span class="hljs-comment"># R = PolynomialRing(Zmod(p), [&#x27;x1&#x27;, &#x27;y1&#x27;, &#x27;e&#x27;])</span><br><br><span class="hljs-comment"># F = []</span><br><span class="hljs-comment"># r = []</span><br><span class="hljs-comment"># for i in range(10):</span><br><span class="hljs-comment">#     r.append(ecc.mul(10-i, Q))</span><br><span class="hljs-comment"># for i in range(10):</span><br><span class="hljs-comment">#     x2, y2 = r[i]</span><br><span class="hljs-comment">#     f = (ph[i] - e)*(1+b*x1*x2)*(1-a*y1*y2)-(x1+x2)*(1+a*y1*y2)</span><br><span class="hljs-comment">#     F.append(f)</span><br><span class="hljs-comment"># res = Ideal(F).groebner_basis()</span><br><span class="hljs-comment"># [x1 + 239643535167901657800210470774814532510308869595840873642845564328410464397042, y1 + 146109242247186884695587727086539555907710369392694609972293964300672819401615, e + 716700711017198421972376297958894204723153539777056104579499803899129208364755]</span><br><br><br>E = EllipticCurve(GF(p), [<span class="hljs-number">0</span>, a+b, <span class="hljs-number">0</span>, a*b, <span class="hljs-number">0</span>])<br>x1 = -<span class="hljs-number">239643535167901657800210470774814532510308869595840873642845564328410464397042</span> % p<br><br><br>G = (<span class="hljs-number">586066762126624229327260483658353973556531595840920560414263113786807168248797</span>,<br>     <span class="hljs-number">66727759687879628160487324122999265926655929132333860726404158613654375336028</span>)<br><br><span class="hljs-comment"># R.&lt;y1&gt; = PolynomialRing(GF(p))</span><br><span class="hljs-comment"># f = x1*(a*y1^2-1)-y1*(b*x1^2-1)</span><br><span class="hljs-comment"># y1 = int(f.roots()[1][0])</span><br><br>y1 = <span class="hljs-number">672929595307990944197873882889709005621738844588134711458648048321447534353147</span><br>P = (<span class="hljs-built_in">int</span>(x1), <span class="hljs-built_in">int</span>(y1))<br>G = E((b*G[<span class="hljs-number">0</span>] - a*G[<span class="hljs-number">1</span>]) * inverse_mod(G[<span class="hljs-number">1</span>]-G[<span class="hljs-number">0</span>], p) %<br>      p, (b-a)*inverse_mod(G[<span class="hljs-number">1</span>]-G[<span class="hljs-number">0</span>], p) % p)<br>P = E((b*P[<span class="hljs-number">0</span>] - a*P[<span class="hljs-number">1</span>]) * inverse_mod(P[<span class="hljs-number">1</span>]-P[<span class="hljs-number">0</span>], p) %<br>      p, (b-a)*inverse_mod(P[<span class="hljs-number">1</span>]-P[<span class="hljs-number">0</span>], p) % p)<br>order = G.order()<br>order = <span class="hljs-number">570870969979422295249173442435007561272085504844186092739816337605942962972880</span><br>primes = [<span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">16</span>, <span class="hljs-number">37</span>, <span class="hljs-number">271</span>, <span class="hljs-number">4297</span>, <span class="hljs-number">6983</span>,<br>          <span class="hljs-number">9679</span>, <span class="hljs-number">52631</span>, <span class="hljs-number">139571</span>, <span class="hljs-number">84666937</span>, <span class="hljs-number">558977989</span>]<br>logs = []<br><span class="hljs-keyword">for</span> fac <span class="hljs-keyword">in</span> primes:<br>    t = <span class="hljs-built_in">int</span>(order)//<span class="hljs-built_in">int</span>(fac)<br>    log = discrete_log(t*P, t*G, operation=<span class="hljs-string">&#x27;+&#x27;</span>)<br>    logs += [log]<br>m = crt(logs, primes)<br><br><span class="hljs-built_in">print</span>(long_to_bytes(m))<br><span class="hljs-comment"># b&#x27;DASCTF&#123;goodathuff&#125;&#x27;</span><br></code></pre></td></tr></table></figure><h3 id="ezalgebradasctf-2023-0x401">ezAlgebra(DASCTF 2023 &amp;0X401)</h3><p>é¢˜ç›®æè¿°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> getPrime, bytes_to_long<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt</span>(<span class="hljs-params">Wo, Xue, Hui, Le, Kai</span>):<br>    Qi = <span class="hljs-number">1997</span><br>    Che = Wo+Hui <span class="hljs-keyword">if</span> Le == <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> Wo*Hui<br>    <span class="hljs-keyword">while</span> (Xue):<br>        Qi += (<span class="hljs-built_in">pow</span>(Che, Xue, Kai)) % Kai<br>        Xue -= <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> Qi<br><br><br>l = <span class="hljs-number">512</span><br>m = bytes_to_long(flag)<br>p = getPrime(l)<br>q = getPrime(l//<span class="hljs-number">2</span>)<br>r = getPrime(l//<span class="hljs-number">2</span>)<br>n = p * q * r<br>t = getrandbits(<span class="hljs-number">32</span>)<br>c1 = encrypt(t, <span class="hljs-number">4</span>, p, <span class="hljs-number">1</span>, n)<br>c2 = encrypt(m, <span class="hljs-number">19</span>, t, <span class="hljs-number">0</span>, q)<br>c3 = encrypt(m, <span class="hljs-number">19</span>, t, <span class="hljs-number">1</span>, q)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;n = <span class="hljs-subst">&#123;n&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;c1 = <span class="hljs-subst">&#123;c1&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;c2 = <span class="hljs-subst">&#123;c2&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;c3 = <span class="hljs-subst">&#123;c3&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure><p>ä¸€å…ƒ coppersimth ç”¨ c1 æ±‚ tï¼Œä»è€Œè·å¾— p</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">PR.&lt;t&gt;= PolynomialRing(Zmod(n))<br>f = t ^ <span class="hljs-number">4</span>+t ^ <span class="hljs-number">3</span>+t ^ <span class="hljs-number">2</span>+t+<span class="hljs-number">1997</span>-c1<br>root = f.small_roots(X=<span class="hljs-number">2</span>^<span class="hljs-number">32</span>,beta=<span class="hljs-number">0.4</span>)<br><span class="hljs-built_in">print</span>(root)<br>t=<span class="hljs-number">2915836867</span><br>kp = t ^ <span class="hljs-number">4</span>+t ^ <span class="hljs-number">3</span>+t ^ <span class="hljs-number">2</span>+t+<span class="hljs-number">1997</span>-c1<br>p = GCD(kp, n)<br></code></pre></td></tr></table></figure><p>æ ¹æ® c2ã€c3 å»ºç«‹ä¸¤ä¸ªå¤šé¡¹å¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">P.&lt;m,t&gt; = PolynomialRing(Zmod(n))<br>f1 = <span class="hljs-number">1997</span> - c3<br>f2 = <span class="hljs-number">1997</span> - c2<br>f3 = t-<span class="hljs-number">2915836867</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">20</span>):<br>    f1 += (m + t)^i<br>    f2 += (m * t)^i<br></code></pre></td></tr></table></figure><p>è™½ç„¶åªæœ‰ m æœªçŸ¥ï¼Œä½†ä½¿ç”¨ Grobner åŸºéœ€è¦è‡³å°‘äºŒå…ƒå¤šé¡¹å¼ï¼Œæ‰€ä»¥å¼•å…¥tï¼ŒåŒç†å¼•å…¥<code>f3 = t-2915836867</code>ï¼Œæ¥ä¸‹æ¥é‡‡ç”¨ Grobnerè·å¾—ç†æƒ³åŸºå³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">G = [f1,f2,f3]<br>B = Ideal(G).groebner_basis()<br><br><span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> B:<br>    <span class="hljs-built_in">print</span>(x)<br></code></pre></td></tr></table></figure><p>æœ€ç»ˆè§£ flag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">q = <span class="hljs-number">87038069032840052005520908272237788908169043580221040711149494083975743478969</span><br>m = -<span class="hljs-number">21158731716376226090392498841915660119151249151578293634082749989659307225047065454562556490794720241251831294269248252992828782428316834166828404876181491874871787144664849984606114249820338190252050491223066273953777506705536480844475141933848618113343415375867066617512805575869013694523034573111259114274</span> % q<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10000000</span>):<br>    flag = i*q+m<br>    flag = long_to_bytes(flag)<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">b&#x27;dasctf&#x27;</span> <span class="hljs-keyword">in</span> flag:<br>        <span class="hljs-built_in">print</span>(flag)<br>        <span class="hljs-comment"># break</span><br></code></pre></td></tr></table></figure><h2 id="cb_rsa">CB_RSA</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> gmpy2 <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> libnum <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> random<br>n1 = <span class="hljs-number">65634094430927080732256164808833233563732628654160389042977689628512527168256899310662239009610512772020503283842588142453533499954947692968978190310627721338357432052800695091789711809256924541784954080619073213358228083200846540676931341013554634493581962527475555869292091755676130810562421465063412235309</span><br>n2 = <span class="hljs-number">103670293685965841863872863719573676572683187403862749665555450164387906552249974071743238931253290278574192713467491802940810851806104430306195931179902098180199167945649526235613636163362672777298968943319216325949503045377100235181706964846408396946496139224344270391027205106691880999410424150216806861393</span><br>(e1, noise1, c1) = (<span class="hljs-number">1743</span>, <span class="hljs-number">44560588075773853612820227436439937514195680734214431948441190347878274184937952381785302837541202705212687700521129385632776241537669208088777729355349833215443048466316517110778502508209433792603420158786772339233397583637570006255153020675167597396958251208681121668808253767520416175569161674463861719776</span>, <span class="hljs-number">65643009354198075182587766550521107063140340983433852821580802983736094225036497335607400197479623208915379722646955329855681601551282788854644359967909570360251550766970054185510197999091645907461580987639650262519866292285164258262387411847857812391136042309550813795587776534035784065962779853621152905983</span>)<br>(e2, noise2, c2) = (<span class="hljs-number">1325</span>, <span class="hljs-number">35282006599813744140721262875292395887558561517759721467291789696459426702600397172655624765281531167221787036009507833425145071265739486735993631460189629709591456017092661028839951392247601628468621576100035700437892164435424035004463142959219067199451575338270613300215815894328788753564798153516122567683</span>, <span class="hljs-number">50327632090778183759544755226710110702046850880299488259739672542025916422119065179822210884622225945376465802069464782311211031263046593145733701591371950349735709553105217501410716570601397725812709771348772095131473415552527749452347866778401205442409443726952960806789526845194216490544108773715759733714</span>)<br>c = <span class="hljs-number">124349762993424531697403299350944207725577290992189948388824124986066269514204313888980321088629462472088631052329128042837153718129149149661961926557818023704330462282009415874674794190206220980118413541269327644472633791532767765585035518183177197863522573410860341245613331398610013697803459403446614221369</span><br>e = <span class="hljs-number">0x10001</span><br>f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;enc.txt&#x27;</span>,<span class="hljs-string">&#x27;r&#x27;</span>).read().strip().split(<span class="hljs-string">&#x27;n&#x27;</span>)<br>cipher = [i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> f]<br>cipher = cipher[:-<span class="hljs-number">1</span>]<br>cipher = [<span class="hljs-built_in">int</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> cipher]<br>flag = <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> cipher:<br>    <span class="hljs-keyword">if</span> jacobi(i,n1)==-<span class="hljs-number">1</span>:<br>        flag += <span class="hljs-string">&#x27;0&#x27;</span><br>    <span class="hljs-keyword">else</span>:<br>        flag += <span class="hljs-string">&#x27;1&#x27;</span><br><br>p = <span class="hljs-built_in">int</span>(flag[::-<span class="hljs-number">1</span>],<span class="hljs-number">2</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;p = &#x27;</span>+<span class="hljs-built_in">str</span>(p))<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">attack</span>(<span class="hljs-params">c1, c2, noise1, noise2,  e1, e2 , n</span>):<br><br>    PR.&lt;x&gt;=PolynomialRing(Zmod(n))<br>    g1 = (x + noise1)^e1 - c1<br>    g2 = (x + noise2)^e2 - c2<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">gcd</span>(<span class="hljs-params">g1, g2</span>):<br>        <span class="hljs-keyword">while</span> g2:<br>            g1, g2 = g2, g1 % g2<br>        <span class="hljs-keyword">return</span> g1.monic()<br>    <span class="hljs-built_in">print</span>(gcd(g1, g2))<br>    <span class="hljs-keyword">return</span> -gcd(g1, g2)[<span class="hljs-number">0</span>]<br><br>q = <span class="hljs-built_in">int</span>(attack(c1, c2, noise1, noise2,  e1, e2 , n2))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;q = &#x27;</span> +<span class="hljs-built_in">str</span>(q))<br>n = p*q<br>phi = (p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)<br>d = inverse_mod(e,phi)<br>m = power_mod(c,d,n)<br><span class="hljs-built_in">print</span>(long_to_bytes(m))<br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;ä¹‹å‰å’Œ N1CTF
æ’äº†ï¼Œä½†æ˜¯æ¯”èµ›é¢˜ç›®è´¨é‡å¾ˆé«˜ï¼Œå½“æ—¶æµ…çœ‹äº†ä¸€ä¸‹ï¼Œç°åœ¨è¡¥ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;cb_curve&quot;&gt;CB_Curve&lt;/h2&gt;
&lt;p&gt;åˆ©ç”¨ Grobner åŸºè§£ P
ç‚¹ï¼Œåç»­å¤ç°æ‰çŸ¥é“è¿™æ˜¯&lt;code</summary>
      
    
    
    
    <category term="CTF" scheme="https://sch01ar.github.io/categories/CTF/"/>
    
    
  </entry>
  
  <entry>
    <title>2023ACTF</title>
    <link href="https://sch01ar.github.io/2023/10/30/2023ACTF/"/>
    <id>https://sch01ar.github.io/2023/10/30/2023ACTF/</id>
    <published>2023-10-30T12:05:45.000Z</published>
    <updated>2023-10-31T09:16:26.024Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å‘¨æœ«æ‰“äº†ä¸€ä¸‹ ACTFï¼Œé¢˜ç›®è´¨é‡å¾ˆé«˜ã€‚æ€»å…± 6 é“é¢˜ç›®åšäº† 3é“ï¼Œæœ‰ä¸€é“å¡ç€ç­‰åç»­å¤ç°ã€‚æœ€è¿‘å¤ªç´¯äº†ï¼Œå‘¨æœ«æ¯”èµ›ï¼Œå‘¨å†…å¤ç°ã€‚ã€‚ã€‚ğŸ­ğŸ­æˆ‘å•Šï¼Œæ‰“ CTF æ‰“çš„ï¼</p></blockquote><h2 id="mdh">MDH</h2><blockquote><p>æ‰‹å¿«æŠ¢äº†ä¸ªä¸‰è¡€ hh</p></blockquote><p>çœ‹åˆ°è¿™é“é¢˜ç¬¬ä¸€ååº”æ˜¯æ­»å»çš„çº¿ä»£å¼€å§‹æ”»å‡»æˆ‘ï¼Œå¥½åœ¨è¿˜æœ‰ç‚¹å°è±¡ï¼Œå¯¹äºçŸ©é˜µçš„è¿¹æ¥è¯´ï¼Œå°±æ˜¯å¯¹è§’çº¿å…ƒç´ çš„å’Œã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha256<br><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> flag<br><br>r = <span class="hljs-number">128</span><br>c = <span class="hljs-number">96</span><br>p = <span class="hljs-number">308955606868885551120230861462612873078105583047156930179459717798715109629</span><br>Fp = GF(p)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">gen</span>():<br>    a1 = random_matrix(Fp, r, c)<br>    a2 = random_matrix(Fp, r, c)<br>    A = a1 * a2.T<br>    <span class="hljs-keyword">return</span> (a1, a2), A<br><br>sk_alice, pk_alice = gen()<br>sk_bob, pk_bob = gen()<br>shared = (sk_alice[<span class="hljs-number">0</span>].T * pk_bob * sk_alice[<span class="hljs-number">1</span>]).trace()<br>ct = <span class="hljs-built_in">int</span>(sha256(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>(shared)).encode()).hexdigest(), <span class="hljs-number">16</span>) ^^ <span class="hljs-built_in">int</span>.from_bytes(flag, <span class="hljs-string">&#x27;big&#x27;</span>)<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;output.txt&#x27;</span>, <span class="hljs-string">&#x27;wb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    f.write(<span class="hljs-built_in">str</span>(ct).encode() + <span class="hljs-string">b&#x27;\n&#x27;</span>)<br>    f.write(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">list</span>(pk_alice)).encode() + <span class="hljs-string">b&#x27;\n&#x27;</span>)<br>    f.write(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">list</span>(pk_bob)).encode() + <span class="hljs-string">b&#x27;\n&#x27;</span>)<br><br></code></pre></td></tr></table></figure><p>å°†<code>shared</code>çš„çŸ©é˜µè¡¨ç¤ºä¸º<spanclass="math inline">\(a_1^T\cdot b_1\cdot b_2^T \cdot a_2\)</span></p><p>è€Œé¢˜ç›®å·²çŸ¥<span class="math inline">\(PKA=a_1\cdot a_2^T,PKB=b_1\cdotb_2^T\)</span></p><p>å¯¹äºè¿¹çš„ä¸€ä¸ªæ€§è´¨æ¥è¯´ï¼Œè‹¥å¹²å‘é‡ç›¸ä¹˜æ‰€å¾—çš„æ–¹é˜µï¼Œæ”¹å˜å…¶ç›¸ä¹˜é¡ºåºï¼ŒçŸ©é˜µçš„è¿¹éƒ½åº”ä¸€è‡´ã€‚</p><p>å› æ­¤åªéœ€è®¡ç®—<span class="math inline">\(PKA^T\cdotPKB\)</span>çš„è¿¹å³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha256<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br>p = <span class="hljs-number">308955606868885551120230861462612873078105583047156930179459717798715109629</span><br>Fp = GF(p)<br>pk_alice=matrix(Fp,pk_alice)<br>pk_bob=matrix(Fp,pk_bob)<br>tmp2=pk_alice*pk_bob.T<br><span class="hljs-built_in">print</span>(tmp2.trace())<br>shared = <span class="hljs-number">229215835499100713048005195047655740191791862411327976508820034350300131774</span><br>ct = <span class="hljs-number">8308943029741424587523612386337754255889681699670071706719724435165094611096603769021839263</span><br>flag = <span class="hljs-built_in">int</span>(sha256(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>(shared)).encode()).hexdigest(), <span class="hljs-number">16</span>) ^ ct<br><span class="hljs-built_in">print</span>(long_to_bytes(flag))<br></code></pre></td></tr></table></figure><h2 id="claw-crane">claw crane</h2><blockquote><p>é¢˜å¦‚å…¶åï¼ŒçœŸç‰›é­”æŠ“å¨ƒå¨ƒ</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python3</span><br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> (<br>    bytes_to_long, long_to_bytes<br>)<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> md5<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> signal<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> random<br><br>BITS = <span class="hljs-number">128</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ClawCrane</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-literal">None</span>:<br>        self.seed = bytes_to_long(os.urandom(BITS//<span class="hljs-number">8</span>))<br>        self.bless = <span class="hljs-number">0</span><br>        self.score = <span class="hljs-number">0</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_input</span>(<span class="hljs-params">self, prompt=<span class="hljs-string">&quot;&gt; &quot;</span></span>):<br>        <span class="hljs-built_in">print</span>(prompt, end=<span class="hljs-string">&quot;&quot;</span>)<br>        sys.stdout.flush()<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">input</span>()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">check_pos</span>(<span class="hljs-params">self, pos, moves</span>):<br>        col, row = <span class="hljs-number">0</span>, <span class="hljs-number">0</span><br>        <span class="hljs-keyword">for</span> move <span class="hljs-keyword">in</span> moves:<br>            <span class="hljs-keyword">if</span> move == <span class="hljs-string">&quot;W&quot;</span>:<br>                <span class="hljs-keyword">if</span> row &lt; <span class="hljs-number">15</span>:<br>                    row += <span class="hljs-number">1</span><br>            <span class="hljs-keyword">elif</span> move == <span class="hljs-string">&quot;S&quot;</span>:<br>                <span class="hljs-keyword">if</span> row &gt; <span class="hljs-number">0</span>:<br>                    row -= <span class="hljs-number">1</span><br>            <span class="hljs-keyword">elif</span> move == <span class="hljs-string">&quot;A&quot;</span>:<br>                <span class="hljs-keyword">if</span> col &gt; <span class="hljs-number">0</span>:<br>                    col -= <span class="hljs-number">1</span><br>            <span class="hljs-keyword">elif</span> move == <span class="hljs-string">&quot;D&quot;</span>:<br>                <span class="hljs-keyword">if</span> col &lt; <span class="hljs-number">15</span>:<br>                    col += <span class="hljs-number">1</span><br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span><br>        <span class="hljs-built_in">print</span>(col, row)<br>        <span class="hljs-keyword">return</span> pos == [col, row]<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">gen_chaos</span>(<span class="hljs-params">self, inp</span>):<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">mapping</span>(<span class="hljs-params">x</span>):<br>            <span class="hljs-keyword">if</span> x == <span class="hljs-string">&#x27;W&#x27;</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;0&quot;</span><br>            <span class="hljs-keyword">if</span> x == <span class="hljs-string">&#x27;S&#x27;</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;1&quot;</span><br>            <span class="hljs-keyword">if</span> x == <span class="hljs-string">&#x27;A&#x27;</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;2&quot;</span><br>            <span class="hljs-keyword">if</span> x == <span class="hljs-string">&#x27;D&#x27;</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;3&quot;</span><br>        vs = <span class="hljs-built_in">int</span>(<span class="hljs-string">&quot;&quot;</span>.join(<span class="hljs-built_in">map</span>(mapping, inp)), <span class="hljs-number">4</span>)<br>        chaos = bytes_to_long(md5(<br>            long_to_bytes((self.seed + vs) % <span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>, BITS))<br>        ).digest())<br>        self.seed = (self.seed + chaos + <span class="hljs-number">1</span>) % <span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>, BITS)<br>        <span class="hljs-keyword">return</span> chaos<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">destiny_claw</span>(<span class="hljs-params">self, delta</span>):<br>        bits = <span class="hljs-built_in">bin</span>(delta)[<span class="hljs-number">2</span>:]<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(bits) &lt; <span class="hljs-number">128</span>+self.bless:<br>            bits += <span class="hljs-string">&quot;0&quot;</span>*(<span class="hljs-number">128</span>+self.bless - <span class="hljs-built_in">len</span>(bits))<br>        c = random.choice(bits)<br>        <span class="hljs-built_in">print</span>(bits)<br>        <span class="hljs-keyword">if</span> c == <span class="hljs-string">&#x27;0&#x27;</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self</span>):<br>        pos = [random.randrange(<span class="hljs-number">1</span>, <span class="hljs-number">16</span>), random.randrange(<span class="hljs-number">1</span>, <span class="hljs-number">16</span>)]<br>        moves = self.get_input(<span class="hljs-string">f&quot;i am at <span class="hljs-subst">&#123;pos&#125;</span>, claw me.\nYour moves: &quot;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(moves) &gt; <span class="hljs-number">100</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;too many steps&quot;</span>)<br>            <span class="hljs-keyword">return</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.check_pos(pos, moves):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;sorry, clawed nothing&quot;</span>)<br>            <span class="hljs-keyword">return</span><br>        r = self.gen_chaos(moves[:<span class="hljs-number">64</span>])<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;choas: <span class="hljs-subst">&#123;r&#125;</span>&quot;</span>)<br>        p, q = <span class="hljs-built_in">map</span>(<span class="hljs-built_in">int</span>, self.get_input(<br>            <span class="hljs-string">f&quot;give me your claw using p,q and p,q in [0, 18446744073709551615] (e.g.: 1,1): &quot;</span>).split(<span class="hljs-string">&quot;,&quot;</span>))<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> (p &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> p &lt; <span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>, BITS//<span class="hljs-number">2</span>) <span class="hljs-keyword">and</span> q &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> q &lt; <span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>, BITS//<span class="hljs-number">2</span>)):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;not in range&quot;</span>)<br>            <span class="hljs-keyword">return</span><br>        delta = <span class="hljs-built_in">abs</span>(r*q - p*<span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>, BITS))<br>        <span class="hljs-keyword">if</span> self.destiny_claw(delta):<br>            self.score += <span class="hljs-number">10</span><br>            self.bless = <span class="hljs-number">0</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;you clawed it&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            self.bless += <span class="hljs-number">16</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;sorry, clawed nothing&quot;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    signal.alarm(<span class="hljs-number">600</span>)<br>    cc = ClawCrane()<br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">256</span>):<br>        <span class="hljs-keyword">try</span>:<br>            cc.run()<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;your score: <span class="hljs-subst">&#123;cc.score&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;abort&quot;</span>)<br>            <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">if</span> cc.score &gt;= <span class="hljs-number">2220</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;flag: <span class="hljs-subst">&#123;<span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;/flag.txt&#x27;</span>).read()&#125;</span>&quot;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    main()<br><br></code></pre></td></tr></table></figure><p>æ€»ä¹‹å°±æ˜¯è¦åœ¨ä½ æ„é€ å‡ºçš„ 128 ä½æ•°å½“ä¸­éšæœºé€‰æ‹©é€‰åˆ° 0 æ‰ä¼šåŠ åˆ†ï¼Œ256æ¬¡ä¸­éœ€è¦æ­£ç¡® 220 æ¬¡ï¼Œå› æ­¤å°±æƒ³æ–¹è®¾æ³•è®©æ•°å­—çš„ 2 è¿›åˆ¶ 0å¤šä¸€äº›ï¼Œ<code>delta = abs(r * q - p * pow(2, 128))</code>ï¼Œrå·²çŸ¥ï¼Œéœ€è¦æˆ‘ä»¬ä¼ å…¥ pã€qï¼Œç”±äº<span class="math inline">\(p\cdot2^{128}\)</span>ç›¸å½“äºå·¦ç§» 128 ä½ï¼Œå› æ­¤æˆ‘ä»¬ä¹Ÿè¦è®© rq çš„ä½ä½å°½å¯èƒ½ä¹Ÿä¸º0ï¼Œq ä¸èƒ½è¶…è¿‡ 2^64 æ¬¡æ–¹ï¼Œå› æ­¤ q çš„å–å€¼å¯ä»¥ä¸º<spanclass="math inline">\(2^{63},2^{63}+2^{62},2^{62}......\)</span>å¯¹äºç»™å®šçš„ r å’Œ q è®¡ç®—ä¸€ä¸ª p å€¼ï¼Œåœ¨å¤šç»„å½“ä¸­è¿›è¡Œ delta ä¸­ 0ä¸ªæ•°çš„è®¡ç®—ï¼Œé€‰æ‹© 0 ä¸ªæ•°æœ€é«˜çš„ä¸€ç»„ pã€q å‘é€ï¼Œåˆ†æ•°å¯ä»¥ç¨³å®šåœ¨ 2000ä»¥ä¸Šï¼Œè¿æ°”å¥½ä¸€ä¼šå°±å‡ºäº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment"># context.log_level = &#x27;debug&#x27;</span><br>round1=<span class="hljs-number">0</span><br>score=<span class="hljs-number">0</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">check</span>(<span class="hljs-params">delta</span>):<br>    nums=<span class="hljs-number">0</span><br>    bits = <span class="hljs-built_in">str</span>(<span class="hljs-built_in">bin</span>(delta)[<span class="hljs-number">2</span>:])<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(bits)):<br>        <span class="hljs-keyword">if</span> bits[i]==<span class="hljs-string">&#x27;0&#x27;</span>:<br>            nums+=<span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> nums<br><br><span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>    round1+=<span class="hljs-number">1</span><br>    io = remote(<span class="hljs-string">&#x27;120.46.65.156&#x27;</span>, <span class="hljs-number">19991</span>)<br>    count=<span class="hljs-number">0</span><br>    <span class="hljs-built_in">print</span>(round1)<br>    <span class="hljs-built_in">print</span>(score)<br>    <span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">try</span>:<br>            tmp=io.recvuntil(<span class="hljs-string">b&#x27;],&#x27;</span>)<br>            <span class="hljs-comment"># print(tmp)</span><br>            pos=<span class="hljs-built_in">eval</span>(tmp[<span class="hljs-number">8</span>:-<span class="hljs-number">1</span>])<br>            <span class="hljs-comment"># print(pos)</span><br>            io.recvuntil(<span class="hljs-string">b&#x27;moves: &#x27;</span>)<br>            pay=pos[<span class="hljs-number">0</span>]*<span class="hljs-string">&#x27;D&#x27;</span>+pos[<span class="hljs-number">1</span>]*<span class="hljs-string">&#x27;W&#x27;</span><br>            io.sendline(pay.encode())<br>            <span class="hljs-comment"># print(io.recv())</span><br>            io.recvline()<br>            r=<span class="hljs-built_in">int</span>(io.recvline()[<span class="hljs-number">7</span>:-<span class="hljs-number">1</span>].decode())<br>            <span class="hljs-comment"># print(r)</span><br>            io.recvuntil(<span class="hljs-string">b&#x27;1,1): &#x27;</span>)<br>            <span class="hljs-comment"># åˆå§‹åŒ–å˜é‡</span><br>            max_re = -<span class="hljs-number">1</span><br>            best_p = -<span class="hljs-number">1</span><br>            best_q = -<span class="hljs-number">1</span><br><br>            <span class="hljs-comment"># å¾ªç¯ç”Ÿæˆ q å’Œ p çš„ç»„åˆï¼Œè®¡ç®— delta å’Œ re</span><br>            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">512</span>):<br>                q = <span class="hljs-number">0</span><br>                <span class="hljs-keyword">if</span> i &amp; <span class="hljs-number">1</span>:<br>                    q += <span class="hljs-number">2</span> ** <span class="hljs-number">55</span><br>                <span class="hljs-keyword">if</span> i &amp; <span class="hljs-number">2</span>:<br>                    q += <span class="hljs-number">2</span> ** <span class="hljs-number">56</span><br>                <span class="hljs-keyword">if</span> i &amp; <span class="hljs-number">4</span>:<br>                    q += <span class="hljs-number">2</span> ** <span class="hljs-number">57</span><br>                <span class="hljs-keyword">if</span> i &amp; <span class="hljs-number">8</span>:<br>                    q += <span class="hljs-number">2</span> ** <span class="hljs-number">58</span><br>                <span class="hljs-keyword">if</span> i &amp; <span class="hljs-number">16</span>:<br>                    q += <span class="hljs-number">2</span> ** <span class="hljs-number">59</span><br>                <span class="hljs-keyword">if</span> i &amp; <span class="hljs-number">32</span>:<br>                    q += <span class="hljs-number">2</span> ** <span class="hljs-number">60</span><br>                <span class="hljs-keyword">if</span> i &amp; <span class="hljs-number">64</span>:<br>                    q += <span class="hljs-number">2</span> ** <span class="hljs-number">61</span><br>                <span class="hljs-keyword">if</span> i &amp; <span class="hljs-number">128</span>:<br>                    q += <span class="hljs-number">2</span> ** <span class="hljs-number">62</span><br>                <span class="hljs-keyword">if</span> i &amp; <span class="hljs-number">256</span>:<br>                    q += <span class="hljs-number">2</span> ** <span class="hljs-number">63</span><br><br><br>                p = (r * q) // (<span class="hljs-number">2</span> ** <span class="hljs-number">128</span>)<br>                delta = <span class="hljs-built_in">abs</span>(r * q - p * <span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>, <span class="hljs-number">128</span>))<br>                re0 = check(delta)<br><br>                <span class="hljs-keyword">if</span> re0 &gt; max_re:<br>                    max_re = re0<br>                    best_p = p<br>                    best_q = q<br><br>            io.sendline((<span class="hljs-built_in">str</span>(best_p)+<span class="hljs-string">&#x27;,&#x27;</span>+<span class="hljs-built_in">str</span>(best_q)).encode())<br>            io.recvline()<br>            tmp=io.recvline()<br>            score=<span class="hljs-built_in">int</span>(tmp[<span class="hljs-number">12</span>:-<span class="hljs-number">1</span>])<br>            count+=<span class="hljs-number">1</span><br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">if</span> count&gt;=<span class="hljs-number">256</span>:<br>        <span class="hljs-built_in">print</span>(io.recv())<br>        <span class="hljs-keyword">break</span><br></code></pre></td></tr></table></figure><h2 id="easy-rsa">Easy RSA</h2><p>é¢˜ç›®</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> flag<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">genKey</span>(<span class="hljs-params">nbits, dbits</span>):<br>    bbits = (nbits // <span class="hljs-number">2</span> - dbits) // <span class="hljs-number">2</span><br><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        a = getRandomNBitInteger(dbits)<br>        b = getRandomNBitInteger(bbits)<br>        c = getRandomNBitInteger(bbits)<br>        p1 = a * b * c + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> isPrime(p1):<br>            <span class="hljs-built_in">print</span>(a)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;p1 =&quot;</span>, p1)<br>            <span class="hljs-keyword">break</span><br><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        d = getRandomNBitInteger(dbits)<br>        p2 = b * c * d + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> isPrime(p2):<br>            <span class="hljs-built_in">print</span>(d)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;p2 =&quot;</span>, p2)<br>            <span class="hljs-keyword">break</span><br><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        e = getRandomNBitInteger(bbits)<br>        f = getRandomNBitInteger(bbits)<br>        q1 = e * d * f + <span class="hljs-number">1</span><br>        p3 = a * e * f + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> isPrime(q1) <span class="hljs-keyword">and</span> isPrime(p3):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;p3 =&quot;</span>, p3)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;q1 =&quot;</span>, q1)<br>            <span class="hljs-keyword">break</span><br><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        d_ = getRandomNBitInteger(dbits)<br>        <span class="hljs-keyword">if</span> GCD(a * b * c * d * e * f, d_) != <span class="hljs-number">1</span>:<br>            <span class="hljs-keyword">continue</span><br>        e_ = inverse(d_, a * b * c * d * e * f)<br>        k1 = (e_ * d_ - <span class="hljs-number">1</span>) // (a * b * c * d * e * f)<br>        <span class="hljs-keyword">assert</span> e_ * d_ == (a * b * c * d * e * f) * k1 + <span class="hljs-number">1</span><br>        q2 = k1 * e * f + <span class="hljs-number">1</span><br>        q3 = k1 * b * c + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> isPrime(q2) <span class="hljs-keyword">and</span> isPrime(q3):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;q2 =&quot;</span>, q2)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;q3 =&quot;</span>, q3)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;e =&quot;</span>, e_)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;d =&quot;</span>, d_)<br>            <span class="hljs-keyword">break</span><br><br>    n1 = p1 * q1<br>    n2 = p2 * q2<br>    n3 = p3 * q3<br><br>    <span class="hljs-keyword">assert</span> <span class="hljs-built_in">pow</span>(<span class="hljs-built_in">pow</span>(<span class="hljs-number">0xdeadbeef</span>, e_, n1), d_, n1) == <span class="hljs-number">0xdeadbeef</span><br>    <span class="hljs-keyword">assert</span> <span class="hljs-built_in">pow</span>(<span class="hljs-built_in">pow</span>(<span class="hljs-number">0xdeadbeef</span>, e_, n2), d_, n2) == <span class="hljs-number">0xdeadbeef</span><br>    <span class="hljs-keyword">assert</span> <span class="hljs-built_in">pow</span>(<span class="hljs-built_in">pow</span>(<span class="hljs-number">0xdeadbeef</span>, e_, n3), d_, n3) == <span class="hljs-number">0xdeadbeef</span><br><br>    <span class="hljs-keyword">return</span> (e_, n1, n2, n3)<br><br><br>nbits = <span class="hljs-number">0x600</span><br>dbits = <span class="hljs-number">0x210</span><br><br>m = bytes_to_long(flag)<br>e, n1, n2, n3 = genKey(nbits, dbits)<br>c = <span class="hljs-built_in">pow</span>(m, e, n1)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;c =&quot;</span>, c)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;e =&quot;</span>, e)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;n1 =&quot;</span>, n1)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;n2 =&quot;</span>, n2)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;n3 =&quot;</span>, n3)<br><br><span class="hljs-comment"># c = 63442255298812942222810837512019302954917822996915527697525497640413662503768308023517128481053593562877494934841788054865410798751447333551319775025362132176942795107214528962480350398519459474033659025815248579631003928932688495682277210240277909527931445899728273182691941548330126199931886748296031014210795428593631253184315074234352536885430181103986084755140024577780815130067722355861473639612699372152970688687877075365330095265612016350599320999156644</span><br><span class="hljs-comment"># e = 272785315258275494478303901715994595013215169713087273945370833673873860340153367010424559026764907254821416435761617347240970711252213646287464416524071944646705551816941437389777294159359383356817408302841561284559712640940354294840597133394851851877857751302209309529938795265777557840238332937938235024502686737802184255165075195042860413556866222562167425361146312096189555572705076252573222261842045286782816083933952875990572937346408235562417656218440227</span><br><span class="hljs-comment"># n1 = 473173031410877037287927970398347001343136400938581274026578368211539730987889738033351265663756061524526288423355193643110804217683860550767181983527932872361546531994961481442866335447011683462904976896894011884907968495626837219900141842587071512040734664898328709989285205714628355052565784162841441867556282849760230635164284802614010844226671736675222842060257156860013384955769045790763119616939897544697150710631300004180868397245728064351907334273953201</span><br><span class="hljs-comment"># n2 = 327163771871802208683424470007561712270872666244394076667663345333853591836596054597471607916850284565474732679392694515656845653581599800514388800663813830528483334021178531162556250468743461443904645773493383915711571062775922446922917130005772040139744330987272549252540089872170217864935146429898458644025927741607569303966038195226388964722300472005107075179204987774627759625183739199425329481632596633992804636690274844290983438078815836605603147141262181</span><br><span class="hljs-comment"># n3 = 442893163857502334109676162774199722362644200933618691728267162172376730137502879609506615568680508257973678725536472848428042122350184530077765734033425406055810373669798840851851090476687785235612051747082232947418290952863499263547598032467577778461061567081620676910480684540883879257518083587862219344609851852177109722186714811329766477552794034774928983660538381764930765795290189612024799300768559485810526074992569676241537503405494203262336327709010421</span><br><br></code></pre></td></tr></table></figure><p>å…³é”®ä¿¡æ¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">assert</span> <span class="hljs-built_in">pow</span>(<span class="hljs-built_in">pow</span>(<span class="hljs-number">0xdeadbeef</span>, e_, n1), d_, n1) == <span class="hljs-number">0xdeadbeef</span><br><span class="hljs-keyword">assert</span> <span class="hljs-built_in">pow</span>(<span class="hljs-built_in">pow</span>(<span class="hljs-number">0xdeadbeef</span>, e_, n2), d_, n2) == <span class="hljs-number">0xdeadbeef</span><br><span class="hljs-keyword">assert</span> <span class="hljs-built_in">pow</span>(<span class="hljs-built_in">pow</span>(<span class="hljs-number">0xdeadbeef</span>, e_, n3), d_, n3) == <span class="hljs-number">0xdeadbeef</span><br></code></pre></td></tr></table></figure><p>è¯´æ˜äº†è¿™ä¸€ç»„<code>e_,d_</code>æ»¡è¶³ä¸‰ä¸ªæ¨¡æ•° nï¼Œç›¸å½“äºå·²çŸ¥ä¸‰ç»„nã€eï¼Œå¯¹äºé¢˜ç›®æ‰€é™åˆ¶çš„ d çš„ä½æ•°ï¼Œåˆšå¥½æ»¡è¶³é€ æ ¼çš„æƒ…å†µ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><br>c =<br>e =<br>n1 =<br>n2 =<br>n3 =<br>t = <span class="hljs-number">3</span><br>N = [n1, n2, n3]<br>e = [e, e, e]<br>B = Matrix(ZZ, t+<span class="hljs-number">1</span>, t+<span class="hljs-number">1</span>)<br>M = gmpy2.iroot(<span class="hljs-built_in">int</span>(N[t-<span class="hljs-number">1</span>]), <span class="hljs-built_in">int</span>(<span class="hljs-number">2</span>))[<span class="hljs-number">0</span>]<br>B[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>] = M<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, t+<span class="hljs-number">1</span>):<br>    B[i, i] = -N[i-<span class="hljs-number">1</span>]<br>    B[<span class="hljs-number">0</span>, i] = e[i-<span class="hljs-number">1</span>]<br>Blll = B.LLL()<br>d = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">abs</span>(Blll[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]//M))<br><span class="hljs-built_in">print</span>(long_to_bytes(<span class="hljs-built_in">pow</span>(c, d, n1)))<br></code></pre></td></tr></table></figure><h3 id="review">Review</h3><p>æ­¤éƒ¨åˆ†åœ¨é˜…è¯»å…¶ä½™é˜Ÿä¼ wpåçš„å¤ç›˜ï¼Œå¯¹äºä¸Šé¢˜ï¼Œæ ¼çš„å…·ä½“æ„é€ æ€è·¯æè¿°å¦‚ä¸‹ï¼š</p><p><span class="math display">\[\begin{aligned}ED -k_1N_1 &amp;= 1+k_1x_1 \\ED -aN_2 &amp;= 1+ax_2 \\ED -dN_3 &amp;= 1+dx_3\end{aligned}\]</span></p><p>æ„é€ æ ¼:</p><p><span class="math display">\[\begin{bmatrix}2^{767} &amp; E &amp;E&amp;E\\0 &amp; -N_1 &amp;0&amp;0\\0 &amp; 0 &amp;-N_2&amp;0\\0 &amp; 0 &amp;0&amp;-N_3\\\end{bmatrix}\]</span></p><h2 id="mid-rsaèµ›åå¤ç°">Mid RSA(èµ›åå¤ç°)</h2><p>ä¸ Easy ä¸åŒçš„åœ°æ–¹åœ¨äºå°† dä½æ•°æé«˜ï¼ŒåŸæœ¬çš„æ ¼æ— æ³•è§„çº¦å‡ºæ¥ï¼Œå½“æ—¶è°ƒæ ¼å­è°ƒåäº†ï¼Œä½†æ˜¯çœŸæ²¡æƒ³åˆ°æœ¬åœ°ç”Ÿæˆä¸€ç»„æ•°å’Œä¸Šä¸€é¢˜å¯¹æ¯”ä¸€ä¸‹ï¼Œä¸Šé¢˜çš„æ ¼å­æ‹¿è¿‡æ¥åªæ˜¯å·®äº†å‡ ä½ä½ä½ã€‚ã€‚ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">nbits = <span class="hljs-number">0x600</span><br>dbits = <span class="hljs-number">0x240</span><br></code></pre></td></tr></table></figure><p>å¯¹äº</p><p><span class="math display">\[\begin{aligned}e(d_h\times2^{16}+d_l) -1 &amp;= k_1\phi(N_1) \\e(d_h\times2^{16}+d_l) -1 &amp;= k_2\phi(N_2) \\e(d_h\times2^{16}+d_l) -1 &amp;= k_3\phi(N_3)\end{aligned}\]</span></p><p>æœ‰</p><p><span class="math display">\[\begin{aligned}e2^{16}d_h+ed_l -k_1N_1 &amp;= 1+k_1s_1 \\e2^{16}d_h+ed_l -k_2N_2 &amp;= 1+k_2s_2 \\e2^{16}d_h+ed_l -k_3N_3 &amp;= 1+k_3s_3\end{aligned}\]</span></p><p>æ„é€ æ ¼:</p><p><span class="math display">\[\begin{bmatrix}1 &amp; e2^{16} &amp;e2^{16}&amp;e2^{16}&amp;0\\0 &amp; -N_1 &amp;0&amp;0&amp;0\\0 &amp; 0 &amp;-N_2&amp;0&amp;0\\0 &amp; 0 &amp;0&amp;-N_3&amp;0\\0 &amp; ed_l&amp;ed_l&amp;ed_l&amp;1\\\end{bmatrix}\]</span></p><p>æ„é€ æ–¹æ³•å‚è€ƒæ˜Ÿç›Ÿ 0HB å¸ˆå‚…ï¼Œè‡³äºä¸ºä½•æ˜¯ä½ä½ 16ä½ï¼Œå¸ˆå‚…ç»™å‡ºçš„è§£é‡Šæ˜¯ï¼Œæœ¬åœ°æµ‹äº†ä¸€ç»„æ•°æ®ï¼Œå‘ç°ç”¨ä¸Šä¸€é¢˜çš„æ ¼å­è·‘å‡ºæ¥ç›¸å·®äº†16 ä½ï¼Œä½†å…·ä½“ç›¸å·®å¤šå°‘è¿˜éœ€è¦å…·ä½“ç ”ç©¶ï¼Œç”±äº 16ä½å·²è¶³å¤Ÿçˆ†ç ´ï¼Œå› æ­¤å…¬å¼ä¸­å†™ä¸ºäº† 16 æ¬¡æ–¹ã€‚</p><p>ç»æœ¬äººæµ‹è¯•ï¼Œå¯¹äºæœ¬é¢˜çš„ d ç¼ºå¤±äº† 7 ä½ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> tqdm<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br>c = <span class="hljs-number">598823083137858565473505718525815255620672892612784824187302545127574115000325539999824374357957135208478070797113625659118825530731575573239221853507638809719397849963861367352055486212696958923800593172417262351719477530809870735637329898331854130533160020420263724619225174940214193740379571953951059401685115164634005411478583529751890781498407518739069969017597521632392997743956791839564573371955246955738575593780508817401390102856295102225132502636316844</span><br>e = <span class="hljs-number">334726528702628887205076146544909357751287869200972341824248480332256143541098971600873722567713812425364296038771650383962046800505086167635487091757206238206029361844181642521606953049529231154613145553220809927001722518303114599682529196697410089598230645579658906203453435640824934159645602447676974027474924465177723434855318446073578465621382859962701578350462059764095163424218813852195709023435581237538699769359084386399099644884006684995755938605201771</span><br>n1 = <span class="hljs-number">621786427956510577894657745225233425730501124908354697121702414978035232119311662357181409283130180887720760732555757426221953950475736078765267856308595870951635246720750862259255389006679454647170476427262240270915881126875224574474706572728931213060252787326765271752969318854360970801540289807965575654629288558728966771231501959974533484678236051025940684114262451777094234017210230731492336480895879764397821363102224085859281971513276968559080593778873231</span><br>n2 = <span class="hljs-number">335133378611627373902246132362791381335635839627660359611198202073307340179794138179041524058800936207811546752188713855950891460382258433727589232119735602364790267515558352318957355100518427499530387075144776790492766973547088838586041648900788325902589777445641895775357091753360428198189998860317775077739054298868885308909495601041757108114540069950359802851809227248145281594107487276003206931533768902437356652676341735882783415106786497390475670647453821</span><br>n3 = <span class="hljs-number">220290953009399899705676642623181513318918775662713704923101352853965768389363281894663344270979715555659079125651553079702318700200824118622766698792556506368153467944348604006011828780474050012010677204862020009069971864222175380878120025727369117819196954091417740367068284457817961773989542151049465711430065838517386380261817772422927774945414543880659243592749932727798690742051285364898081188510009069286094647222933710799481899960520270189522155672272451</span><br>N = [n1, n2, n3]<br>e = [e, e, e]<br>t = <span class="hljs-number">4</span><br>lowbits = <span class="hljs-number">7</span><br><br><span class="hljs-keyword">for</span> dl <span class="hljs-keyword">in</span> tqdm(<span class="hljs-built_in">range</span>(<span class="hljs-number">2</span> ^ lowbits)):<br>    B = Matrix(ZZ, t+<span class="hljs-number">1</span>, t+<span class="hljs-number">1</span>)<br>    B[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>] = <span class="hljs-number">2</span> ^ (<span class="hljs-number">767</span>+lowbits)<br>    B[t, t] = <span class="hljs-number">2</span> ^ (<span class="hljs-number">767</span>+<span class="hljs-number">576</span>)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, t):<br>        B[i, i] = N[i-<span class="hljs-number">1</span>]<br>        B[<span class="hljs-number">0</span>, i] = e[i-<span class="hljs-number">1</span>]*<span class="hljs-number">2</span> ^ lowbits<br>        B[t, i] = e[i-<span class="hljs-number">1</span>]*dl<br><br>    Mat_LLL = B.LLL()<br><br>    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> Mat_LLL:<br>        dh = <span class="hljs-built_in">abs</span>(line[<span class="hljs-number">0</span>])//<span class="hljs-number">2</span> ^ (lowbits+<span class="hljs-number">767</span>)<br>        d = <span class="hljs-built_in">int</span>((dh &lt;&lt; lowbits)+dl)<br><br>        m = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">pow</span>(c, d, n1))<br>        flag1 = long_to_bytes(m)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">b&#x27;ACTF&#123;&#x27;</span> <span class="hljs-keyword">in</span> flag1:<br>            <span class="hljs-built_in">print</span>(flag1)<br>            <span class="hljs-keyword">break</span><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;å‘¨æœ«æ‰“äº†ä¸€ä¸‹ ACTFï¼Œé¢˜ç›®è´¨é‡å¾ˆé«˜ã€‚æ€»å…± 6 é“é¢˜ç›®åšäº† 3
é“ï¼Œæœ‰ä¸€é“å¡ç€ç­‰åç»­å¤ç°ã€‚æœ€è¿‘å¤ªç´¯äº†ï¼Œå‘¨æœ«æ¯”èµ›ï¼Œå‘¨å†…å¤ç°ã€‚ã€‚ã€‚ğŸ­ğŸ­
æˆ‘å•Šï¼Œæ‰“ CTF æ‰“çš„ï¼&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;mdh&quot;&gt;MDH&lt;/h2&gt;
&lt;bl</summary>
      
    
    
    
    <category term="CTF" scheme="https://sch01ar.github.io/categories/CTF/"/>
    
    
  </entry>
  
  <entry>
    <title>2023N1CTF</title>
    <link href="https://sch01ar.github.io/2023/10/23/N1CTF2023/"/>
    <id>https://sch01ar.github.io/2023/10/23/N1CTF2023/</id>
    <published>2023-10-23T12:05:45.000Z</published>
    <updated>2023-10-30T02:44:11.760Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å‘¨æœ«å’Œå‰å¤§ä¸œå¤§çš„å¥½å“¥å“¥ä»¬æ‰“äº† n1ï¼Œæœ€åæ‹¿äº† rank7ï¼Œè¢« webğŸ‘´ å’Œ pwnğŸ‘´å¸¦é£</p></blockquote><blockquote><p>DJB æˆ˜é˜Ÿ wp:https://mp.weixin.qq.com/s/N03QtNsMvpux42xIAXxvrA</p></blockquote><h2 id="e2wrmup">e2W@rmup</h2><p>ECDSA æ¤­åœ†æ›²çº¿ç­¾åï¼Œä¹‹å‰æ²¡ç”¨è¿‡<code>ecdsa</code>åº“ï¼Œç»“æœå‘ç° då°±æ˜¯ç§é’¥ï¼Œæ‹†åˆ†ä¸€ä¸‹é«˜ä½ä½ï¼ŒäºŒå…ƒ coppersmithæ¢­ä¸€ä¸‹ï¼Œä¸­é—´å¯èƒ½è¦è¡¥ä¸€ä½ï¼Œè¡¥äº† 0 ä¹‹åå°±å¯ä»¥äº†ã€‚</p><p>åé¢çœ‹å¸ˆå‚…ä»¬åšå®¢è¿˜å¯ä»¥ç”¨æ ¼åšï¼Œå­¦åˆ°äº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> itertools<br><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">small_roots</span>(<span class="hljs-params">f, bounds, m=<span class="hljs-number">1</span>, d=<span class="hljs-literal">None</span></span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> d:<br>        d = f.degree()<br>    R = f.base_ring()<br>    N = R.cardinality()<br><br>    f /= f.coefficients().pop(<span class="hljs-number">0</span>)<br>    f = f.change_ring(ZZ)<br><br>    G = <span class="hljs-type">Sequence</span>([], f.parent())<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m + <span class="hljs-number">1</span>):<br>        base = N ^ (m - i) * f ^ i<br>        <span class="hljs-keyword">for</span> shifts <span class="hljs-keyword">in</span> itertools.product(<span class="hljs-built_in">range</span>(d), repeat=f.nvariables()):<br>            g = base * prod(<span class="hljs-built_in">map</span>(power, f.variables(), shifts))<br>            G.append(g)<br><br>    B, monomials = G.coefficient_matrix()<br>    monomials = vector(monomials)<br><br>    factors = [monomial(*bounds) <span class="hljs-keyword">for</span> monomial <span class="hljs-keyword">in</span> monomials]<br>    <span class="hljs-keyword">for</span> i, factor <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(factors):<br>        B.rescale_col(i, factor)<br><br>    B = B.dense_matrix().LLL()<br><br>    B = B.change_ring(QQ)<br>    <span class="hljs-keyword">for</span> i, factor <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(factors):<br>        B.rescale_col(i, <span class="hljs-number">1</span> / factor)<br><br>    H = <span class="hljs-type">Sequence</span>([], f.parent().change_ring(QQ))<br>    <span class="hljs-keyword">for</span> h <span class="hljs-keyword">in</span> <span class="hljs-built_in">filter</span>(<span class="hljs-literal">None</span>, B * monomials):<br>        H.append(h)<br>        I = H.ideal()<br>        <span class="hljs-keyword">if</span> I.dimension() == -<span class="hljs-number">1</span>:<br>            H.pop()<br>        <span class="hljs-keyword">elif</span> I.dimension() == <span class="hljs-number">0</span>:<br>            roots = []<br>            <span class="hljs-keyword">for</span> root <span class="hljs-keyword">in</span> I.variety(ring=ZZ):<br>                root = <span class="hljs-built_in">tuple</span>(R(root[var]) <span class="hljs-keyword">for</span> var <span class="hljs-keyword">in</span> f.variables())<br>                roots.append(root)<br>            <span class="hljs-keyword">return</span> roots<br><br>    <span class="hljs-keyword">return</span> []<br><br>msg = <span class="hljs-string">b&#x27;welcome to n1ctf2023!&#x27;</span><br>msg_hash = bytes_to_long(hashlib.sha256(msg).digest())<br><br>s = <span class="hljs-number">98064531907276862129345013436610988187051831712632166876574510656675679745081</span><br>r = <span class="hljs-number">9821122129422509893435671316433203251343263825232865092134497361752993786340</span><br><br>p = <span class="hljs-number">115792089210356248762697446949407573529996955224135760342422259061068512044369</span><br>leak = <span class="hljs-built_in">int</span>(<span class="hljs-string">&quot;10000111001100100010110100100000000100101000111011000001001011010100001010010000101001100011011010100000010010011011100010111001&quot;</span>, <span class="hljs-number">2</span>)<br>P.&lt;low,small&gt; = PolynomialRing(Zmod(p))<br><br>f = r*((small*(<span class="hljs-number">2</span>^<span class="hljs-number">128</span>))+low)+msg_hash-(leak&lt;&lt;<span class="hljs-number">128</span>)*s-small*s<br>roots = small_roots(f, [<span class="hljs-number">2</span>^<span class="hljs-number">129</span>, <span class="hljs-number">2</span>^<span class="hljs-number">130</span>], m=<span class="hljs-number">3</span>, d=<span class="hljs-number">4</span>)<br><span class="hljs-built_in">print</span>(roots)<br><br>low = <span class="hljs-number">109657576978117277727118025094273115603</span><br>high = <span class="hljs-number">222660286808164019769040839717358598716</span><br><br>d = <span class="hljs-built_in">bin</span>(high)[<span class="hljs-number">2</span>:]+<span class="hljs-string">&#x27;0&#x27;</span>+<span class="hljs-built_in">bin</span>(low)[<span class="hljs-number">2</span>:]<br>d = <span class="hljs-built_in">int</span>(d, <span class="hljs-number">2</span>)<br><span class="hljs-built_in">print</span>(d.bit_length())<br>aes = AES.new(long_to_bytes(d), mode=AES.MODE_ECB)<br>cipher = <span class="hljs-string">b&#x27;\xf3#\xff\x17\xdf\xbb\xc0\xc6v\x1bg\xc7\x8a6\xf2\xdf~\x12\xd8]\xc5\x02Ot\x99\x9f\xf7\xf3\x98\xbc\x045\x08\xfb\xce1@e\xbcg[I\xd1\xbf\xf8\xea\n-&#x27;</span><br>flag = aes.decrypt(cipher)<br><span class="hljs-built_in">print</span>(flag)<br><span class="hljs-comment"># b&#x27;n1ctf&#123;Wow!__You_bre4k_my_s1gn_chal1enge!!___&#125;\x03\x03\x03&#x27;</span><br><br></code></pre></td></tr></table></figure><h2 id="e2d1pèµ›åå¤ç°">e2d1p[èµ›åå¤ç°]</h2><p>å‚è€ƒæ–‡ç« ï¼š</p><p><ahref="">https://tl2cents.github.io/2023/10/23/2023-N1CTF-Crypto-Writeups/</a></p><p>https://github.com/Nu1LCTF/n1ctf-2023/tree/main/crypto/e2D1p</p><p>é¢˜ç›®</p><blockquote><p>Based on N1CTF 2022 â€œezdlpâ€. Easy dlp too, try again : ).</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> os<br>FLAG = os.environ.get(<span class="hljs-string">&#x27;FLAG&#x27;</span>, <span class="hljs-string">b&#x27;n1ctf&#123;XXXXFAKE_FLAGXXXX&#125;&#x27;</span>)<br><span class="hljs-keyword">assert</span> FLAG[:<span class="hljs-number">6</span>] == <span class="hljs-string">b&#x27;n1ctf&#123;&#x27;</span> <span class="hljs-keyword">and</span> FLAG[-<span class="hljs-number">1</span>:] == <span class="hljs-string">b&#x27;&#125;&#x27;</span><br>FLAG = FLAG[<span class="hljs-number">6</span>:-<span class="hljs-number">1</span>]<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">keygen</span>(<span class="hljs-params">nbits</span>):<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        q = getPrime(nbits)<br>        <span class="hljs-keyword">if</span> isPrime(<span class="hljs-number">2</span>*q+<span class="hljs-number">1</span>):<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">pow</span>(<span class="hljs-number">0x10001</span>, q, <span class="hljs-number">2</span>*q+<span class="hljs-number">1</span>) == <span class="hljs-number">1</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>*q+<span class="hljs-number">1</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt</span>(<span class="hljs-params">key, message, mask</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">pow</span>(<span class="hljs-number">0x10001</span>, message^mask, key)<br><br><br>p = keygen(<span class="hljs-number">512</span>)<br>flag = bytes_to_long(FLAG)<br>messages = [getRandomNBitInteger(flag.bit_length()) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">200</span>)]<br>enc = [encrypt(p, message, flag) <span class="hljs-keyword">for</span> message <span class="hljs-keyword">in</span> messages]<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;message = <span class="hljs-subst">&#123;messages&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;enc = <span class="hljs-subst">&#123;enc&#125;</span>&#x27;</span>)<br></code></pre></td></tr></table></figure><h3 id="x01-æ¢å¤æ¨¡æ•°-p">0x01 æ¢å¤æ¨¡æ•° p</h3><p>ç»™äº† 200 ç»„ mã€c æ»¡è¶³ç­‰å¼<spanclass="math inline">\(65537^{m_iâŠ•mask}=c_i (mod p)\)</span></p><p>å¼‚æˆ–è¿ç®—åœ¨æŒ‡æ•°ä¸Šï¼Œæ²¡æœ‰ä»€ä¹ˆè¿ç®—æ€§è´¨ã€‚ä½†å¼‚æˆ–çš„æœ¬è´¨è¿˜æ˜¯æŒ‰ä½å¼‚æˆ–ï¼Œä»¥ä¸‹ç”¨m[i]è¡¨ç¤º m çš„ç¬¬ i ä½ï¼Œå¯¹äºä¸€ç»„ m å’Œ c è€Œè¨€</p><p><span class="math display">\[m\oplus mask = mask+\sum\limits_{j=0}\limits^{158}(m[j]\cdot2^i\cdot(-1)^{s[i]})\]</span></p><p>è¿™æ ·è½¬æ¢åå³å¯æŠŠåº•æ•°çœ‹ä½œ<spanclass="math inline">\(c_i=65537^{mask}\)</span>ï¼Œä¸‹ä¸€æ­¥çš„ç›®çš„å°±æ˜¯æ‰¾åˆ°æŸä¸ªå‘é‡<spanclass="math inline">\(e_i\)</span>ä½¿å¾—<spanclass="math inline">\(c_i^{e_i}â‰¡0\;mod\;p\)</span>ï¼Œè¿™æ ·å³å¯æ¢å¤å‡ºæ¨¡æ•°<spanclass="math inline">\(gcd(e_i,e_j)=p\)</span></p><p>æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„<span class="math inline">\(e_i\)</span>éœ€è¦<spanclass="math inline">\(m_i\)</span>ï¼Œæ„é€ å¦‚ä¸‹æ ¼ï¼š</p><p><span class="math inline">\(m_{i,j}=m_{i,j}*2^{256}\)</span></p><p><span class="math display">\[\begin{bmatrix}m_{0,0} &amp; m_{0,1} &amp; \ldots &amp; m_{0,158} &amp; 1 &amp; 0 &amp;\ldots &amp;0\\m_{1,0} &amp; m_{1,1} &amp; \ldots &amp; m_{1,158} &amp; 0 &amp; 1&amp;\ldots &amp;0\\\vdots &amp; \vdots &amp; \ddots &amp; \vdots &amp; \vdots &amp; \vdots&amp; \ddots &amp; \vdots\\m_{199,0} &amp; m_{199,1} &amp; \ldots &amp; m_{199,158} &amp; 0&amp;0&amp; \ldots &amp;1\\\end{bmatrix}\]</span></p><p>åˆ©ç”¨<code>LLL</code>ç®—æ³•å¾—åˆ°çš„<spanclass="math inline">\(e_i\)</span>æ»¡è¶³<spanclass="math inline">\(\sum\limits_{i=1}\limits^{200}e_i=0\)</span>ï¼Œé‚£ä¹ˆä¹Ÿå°±æ»¡è¶³<spanclass="math inline">\(\sum\limits_{i=1}\limits^{200}e_i\cdotm_i=\vec{0}\)</span></p><h3 id="x02-æ±‚è§£-mask">0x02 æ±‚è§£ mask</h3><p>x=mask</p><p><span class="math display">\[65537^{\sum2^i\cdot(x_i\oplus m_i)}=c(mod \;p)\]</span></p><p>å˜æ¢æˆå¦‚ä¸‹å½¢å¼</p><p><spanclass="math display">\[(65537)^{\sum\limits_{\{i|m_i=0\}}2^i\cdotx_i+\sum\limits_{\{j|m_j=1\}}2^j\cdot(1-x_j)}=c\;(mod \;p)\]</span></p><p><spanclass="math display">\[(65537)^{\sum\limits_{\{i|m_i=0\}}2^i\cdotx_i+\sum\limits_{\{j|m_j=1\}}2^j\cdot(-x_j)}=c\cdot65537^{-\sum\limits_{\{j|m_j=1\}}2^j} (mod \;p)\]</span></p><p>æ ¹æ®ä¸Šå¼ä¸­<span class="math inline">\(m_i\)</span>ä¸º 0 æˆ– 1çš„æƒ…å†µæ„é€ å¯¹åº”<span class="math inline">\(x_i\)</span>çš„ç³»æ•°çŸ©é˜µ<spanclass="math inline">\(A\)</span>ï¼Œç³»æ•°åªä¸º 1 æˆ–-1</p><p>è®¡ç®—å‘é‡<span class="math inline">\(u\cdot A=(1,0,\cdots,0)\;(mod\;q)\)</span>ï¼ˆæ¨¡ q æ˜¯ä¿è¯é˜¶ä¸ºç´ æ•°ï¼Œä½¿å¾—å‘é‡æœ‰è§£ï¼‰</p><p>å½“<span class="math inline">\(mask_i=0\)</span>æ—¶ï¼Œä¾¿å¯æŒ‰ä¸‹å¼é€ä½æ¢å¤mask</p><p><spanclass="math display">\[\prod\limits_{i=1}\limits^{200}c_i^{u_i}=65537^0=1(mod\;p)\]</span><span class="math display">\[c_i=c_i\cdot65537^{-\sum\limits_{\{j|m_j=1\}}2^j}(mod\;p)\]</span></p><h3 id="exp">exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> tqdm <span class="hljs-keyword">import</span> tqdm<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> ast <span class="hljs-keyword">import</span> literal_eval<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><br>lines = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;./output.txt&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>).readlines()<br>message = literal_eval(lines[<span class="hljs-number">0</span>].strip())<br>enc = literal_eval(lines[<span class="hljs-number">1</span>].strip())<br><br><br>m_l = <span class="hljs-number">159</span><br>dim = <span class="hljs-number">200</span><br>L = matrix(ZZ, dim, dim+m_l+<span class="hljs-number">1</span>)<br>g = <span class="hljs-number">2</span> ^ <span class="hljs-number">512</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(dim):<br>    L[i, i] = <span class="hljs-number">1</span><br>    L[i, dim+m_l] = g<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(dim):<br>    line = <span class="hljs-built_in">bin</span>(message[i])[<span class="hljs-number">2</span>:].rjust(m_l, <span class="hljs-string">&#x27;0&#x27;</span>)<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(line)):<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">int</span>(line[j]):<br>            L[i, dim+j] = g<br>        <span class="hljs-keyword">else</span>:<br>            L[i, dim+j] = <span class="hljs-number">0</span><br><br><br>basis = L.LLL()[:<span class="hljs-number">40</span>]<br>p = []<br><span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> basis:<br>    g1 = <span class="hljs-number">1</span><br>    g2 = <span class="hljs-number">1</span><br>    vec = item[:dim]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(vec)):<br>        <span class="hljs-keyword">if</span> vec[i] &gt;= <span class="hljs-number">0</span>:<br>            g1 *= <span class="hljs-built_in">pow</span>(enc[i], vec[i])<br>        <span class="hljs-keyword">else</span>:<br>            g2 *= <span class="hljs-built_in">pow</span>(enc[i], -vec[i])<br>    p.append(g1-g2)<br><br>p = <span class="hljs-built_in">list</span>(factor(reduce(GCD, p)))[-<span class="hljs-number">1</span>][<span class="hljs-number">0</span>]<br>q = (p-<span class="hljs-number">1</span>)//<span class="hljs-number">2</span><br>A = matrix(Zmod(q), dim, m_l)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(dim):<br>    line = <span class="hljs-built_in">bin</span>(message[i])[<span class="hljs-number">2</span>:].rjust(m_l, <span class="hljs-string">&#x27;0&#x27;</span>)<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(line)):<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">int</span>(line[j]):<br>            A[i, j] = -<span class="hljs-number">1</span><br>            enc[i] = enc[i]*inverse_mod(<span class="hljs-built_in">pow</span>(<span class="hljs-number">0x10001</span>, <span class="hljs-number">2</span> ^ (m_l-<span class="hljs-number">1</span>-j), p), p) % p<br>        <span class="hljs-keyword">else</span>:<br>            A[i, j] = <span class="hljs-number">1</span><br><br>m = <span class="hljs-string">&#x27;&#x27;</span><br><br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> tqdm(<span class="hljs-built_in">range</span>(m_l)):<br>    v = vector(Zmod(q), [<span class="hljs-number">0</span>]*_+[<span class="hljs-number">1</span>]+[<span class="hljs-number">0</span>]*(m_l-<span class="hljs-number">1</span>-_))<br>    u = A.solve_left(v)<br>    sign = <span class="hljs-number">1</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(u)):<br>        <span class="hljs-keyword">if</span> u[i] &gt;= <span class="hljs-number">0</span>:<br>            sign = sign*<span class="hljs-built_in">pow</span>(enc[i], <span class="hljs-built_in">int</span>(u[i]), p) % p<br>        <span class="hljs-keyword">else</span>:<br>            sign = sign*inverse_mod(<span class="hljs-built_in">pow</span>(enc[i], -<span class="hljs-built_in">int</span>(u[i]), p), p) % p<br>    <span class="hljs-keyword">if</span> sign != <span class="hljs-number">1</span>:<br>        m += <span class="hljs-string">&#x27;1&#x27;</span><br>    <span class="hljs-keyword">else</span>:<br>        m += <span class="hljs-string">&#x27;0&#x27;</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">bytes</span>.fromhex(<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">int</span>(m, <span class="hljs-number">2</span>))[<span class="hljs-number">2</span>:]))<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;å‘¨æœ«å’Œå‰å¤§ä¸œå¤§çš„å¥½å“¥å“¥ä»¬æ‰“äº† n1ï¼Œæœ€åæ‹¿äº† rank7ï¼Œè¢« webğŸ‘´ å’Œ pwnğŸ‘´
å¸¦é£&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;DJB æˆ˜é˜Ÿ wp:https://mp.weixin.qq.com/s/N03Qt</summary>
      
    
    
    
    <category term="CTF" scheme="https://sch01ar.github.io/categories/CTF/"/>
    
    
  </entry>
  
  <entry>
    <title>LCG</title>
    <link href="https://sch01ar.github.io/2023/06/19/LCG/"/>
    <id>https://sch01ar.github.io/2023/06/19/LCG/</id>
    <published>2023-06-19T03:05:45.000Z</published>
    <updated>2023-10-24T02:36:43.275Z</updated>
    
    <content type="html"><![CDATA[<h2 id="lcg">LCG</h2><p>çº¿æ€§åŒä½™ï¼ˆLCGï¼‰æ˜¯äº§ç”Ÿä¼ªéšæœºæ•°çš„æ–¹æ³•ã€‚</p><h2 id="åŸºæœ¬å½¢å¼">åŸºæœ¬å½¢å¼ï¼š</h2><p><span class="math display">\[X_{n+1}=(aX_n+b)\;mod\;m\]</span></p><h2 id="åŸºæœ¬å…¬å¼">åŸºæœ¬å…¬å¼</h2><h3 id="å…¬å¼ä¸€">å…¬å¼ä¸€</h3><p><strong>æ±‚é€’å½’æ•°ç»„å…ƒç´ </strong></p><p><spanclass="math display">\[X_n=a^{-1}(X_{n+1}-b)\;mod\;m\]</span></p><h3 id="å…¬å¼äºŒ">å…¬å¼äºŒ</h3><p><strong>æ±‚å‚æ•° a</strong> åˆ©ç”¨ä¸¤ä¸ªé€’å½’å¼æ¶ˆå» b å¾—åˆ° a</p><p><spanclass="math display">\[a=(X_{n+2}-X_{n+1})(X_{n+1}-X_n)^{-1}\]</span></p><h3 id="å…¬å¼ä¸‰">å…¬å¼ä¸‰</h3><p><strong>æ±‚å‚æ•° b</strong> <spanclass="math display">\[b=(X_{n+1}-aX_{n})\;mod\;m\]</span></p><h3 id="å…¬å¼å››">å…¬å¼å››</h3><p><strong>æ±‚å‚æ•° m</strong></p><p><span class="math display">\[t_n=X_{n+1}-X_n\]</span> <spanclass="math display">\[t_n=(aX_n+b)-(aX_{n-1}+b)\;mod\;m\]</span> <spanclass="math display">\[t_{n+1}t_{n-1}-t_nt_n=0\;mod\;m\]</span> <spanclass="math display">\[T_n=t_{n+1}t_{n-1}-t_nt_næ˜¯ m çš„å€æ•°\]</span><span class="math display">\[m=gcd(T_n,T_{n-1})\]</span></p><h2 id="ç›¸å…³æ±‚è§£ä»£ç ">ç›¸å…³æ±‚è§£ä»£ç </h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> *<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">crack_unknown_increment</span>(<span class="hljs-params">states, modulus, multiplier</span>):  <span class="hljs-comment"># æ±‚å¢é‡</span><br><br>    increment = (states[<span class="hljs-number">1</span>] - states[<span class="hljs-number">0</span>]*multiplier) % modulus<br><br>    <span class="hljs-keyword">return</span> modulus, multiplier, increment<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">crack_unknown_multiplier</span>(<span class="hljs-params">states, modulus</span>):  <span class="hljs-comment"># æ±‚ä¹˜æ•°</span><br><br>    multiplier = (states[<span class="hljs-number">2</span>] - states[<span class="hljs-number">1</span>]) * \<br>        inverse(states[<span class="hljs-number">1</span>] - states[<span class="hljs-number">0</span>], modulus) % modulus<br><br>    <span class="hljs-keyword">return</span> crack_unknown_increment(states, modulus, multiplier)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">crack_unknown_modulus</span>(<span class="hljs-params">states</span>):  <span class="hljs-comment"># æ±‚æ¨¡æ•°</span><br><br>    diffs = [s1 - s0 <span class="hljs-keyword">for</span> s0, s1 <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(states, states[<span class="hljs-number">1</span>:])]<br><br>    zeroes = [t2*t0 - t1*t1 <span class="hljs-keyword">for</span> t0, t1, t2 <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(diffs, diffs[<span class="hljs-number">1</span>:], diffs[<span class="hljs-number">2</span>:])]<br><br>    modulus = <span class="hljs-built_in">abs</span>(reduce(GCD, zeroes))<br><br>    <span class="hljs-keyword">return</span> crack_unknown_multiplier(states, modulus)<br><br><br><span class="hljs-built_in">print</span>(crack_unknown_modulus([<span class="hljs-number">2818206783446335158</span>, <span class="hljs-number">3026581076925130250</span>,<br>      <span class="hljs-number">136214319011561377</span>, <span class="hljs-number">359019108775045580</span>, <span class="hljs-number">2386075359657550866</span>, <span class="hljs-number">1705259547463444505</span>]))<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;lcg&quot;&gt;LCG&lt;/h2&gt;
&lt;p&gt;çº¿æ€§åŒä½™ï¼ˆLCGï¼‰æ˜¯äº§ç”Ÿä¼ªéšæœºæ•°çš„æ–¹æ³•ã€‚&lt;/p&gt;
&lt;h2 id=&quot;åŸºæœ¬å½¢å¼&quot;&gt;åŸºæœ¬å½¢å¼ï¼š&lt;/h2&gt;
&lt;p&gt;&lt;span class=&quot;math display&quot;&gt;\[
X_{n+1}=(aX_n+b)\;mod\;m
\]&lt;/spa</summary>
      
    
    
    
    <category term="CTF" scheme="https://sch01ar.github.io/categories/CTF/"/>
    
    
  </entry>
  
  <entry>
    <title>D^3CTF</title>
    <link href="https://sch01ar.github.io/2023/05/07/d3ctf2023/"/>
    <id>https://sch01ar.github.io/2023/05/07/d3ctf2023/</id>
    <published>2023-05-07T06:05:45.000Z</published>
    <updated>2023-05-10T12:22:25.734Z</updated>
    
    <content type="html"><![CDATA[<h1 id="d3noisy">d3noisy</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;out.txt&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    n=<span class="hljs-built_in">int</span>(f.readline()[<span class="hljs-number">4</span>:])<br>    p=<span class="hljs-built_in">eval</span>(f.readline()[<span class="hljs-number">4</span>:])<br>    s=<span class="hljs-built_in">eval</span>(f.readline()[<span class="hljs-number">4</span>:])<br>    c=<span class="hljs-built_in">eval</span>(f.readline()[<span class="hljs-number">4</span>:])<br><br>P0=<span class="hljs-number">1</span><br>L=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> p:<br>    P0=P0*i<br><span class="hljs-built_in">print</span>(P0)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">15</span>):<br>    t=inverse(P0//p[i],p[i])<br>    L.append(t*(P0//p[i]))<br><br>B=getPrime(<span class="hljs-number">3211</span>)<br>M=matrix(ZZ,<span class="hljs-number">15</span>*<span class="hljs-number">15</span>+<span class="hljs-number">1</span>,<span class="hljs-number">15</span>*<span class="hljs-number">15</span>+<span class="hljs-number">1</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">15</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">15</span>):<br>        t=i*<span class="hljs-number">15</span>+j<br>        M[t+<span class="hljs-number">1</span>,t+<span class="hljs-number">1</span>]=B<br>        M[t+<span class="hljs-number">1</span>,<span class="hljs-number">0</span>]=s[i][j]*L[i]<br>M[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>]=P0<br>x=M.LLL()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;LLL done&quot;</span>)<br>d=<span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">15</span>):<br>    d =(d ^^ <span class="hljs-built_in">int</span>(x[i][<span class="hljs-number">0</span>]))<br>d = gmpy2.next_prime(<span class="hljs-built_in">int</span>(d))<br><span class="hljs-built_in">print</span>(d)<br><span class="hljs-built_in">print</span>(long_to_bytes(<span class="hljs-built_in">pow</span>(c,d,n)))<br><span class="hljs-comment"># antd3ctf&#123;0c85f77e-bfee-da57-78f2-e961ffd4ca45&#125;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;d3noisy&quot;&gt;d3noisy&lt;/h1&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class</summary>
      
    
    
    
    <category term="CTF" scheme="https://sch01ar.github.io/categories/CTF/"/>
    
    
  </entry>
  
  <entry>
    <title>RSA(æŒç»­æ›´æ–°ğŸ«¡)</title>
    <link href="https://sch01ar.github.io/2023/04/20/RSA/"/>
    <id>https://sch01ar.github.io/2023/04/20/RSA/</id>
    <published>2023-04-20T13:05:45.000Z</published>
    <updated>2023-11-03T02:27:06.700Z</updated>
    
    <content type="html"><![CDATA[<h1 id="åŸºæœ¬åŸç†">åŸºæœ¬åŸç†</h1><p>RSA ä¸­åŠ ã€è§£å¯†ï¼š</p><p>åŠ å¯†<span class="math inline">\(c = m^e\quad mod\quad n\)</span></p><p>è§£å¯†<span class="math inline">\(m = c^d\quad mod\quad n\)</span></p><p>æ¥ä¸‹æ¥è¯æ˜ä¸€ä¸‹è§£å¯†è¿‡ç¨‹ï¼Œå…ˆå¼•å…¥æ¬§æ‹‰å®šç†ã€‚</p><h2 id="æ¬§æ‹‰å®šç†">æ¬§æ‹‰å®šç†</h2><p>å¯¹äºäº’ä¸ºè´¨æ•°çš„ mã€n ä¸¤ä¸ªæ•°ï¼Œæœ‰<span class="math inline">\(m^{\phi(n)}= 1\quad mod\quad n\)</span>ï¼Œå…¶ä¸­<spanclass="math inline">\(\phi(n)\)</span>è¡¨ç¤ºå°äº n çš„è´¨æ•°çš„ä¸ªæ•°ã€‚</p><h2 id="è§£å¯†åŸç†">è§£å¯†åŸç†</h2><p>é€šè¿‡<span class="math inline">\(c = m^e\quad mod\quadn\)</span>ä¸æ¬§æ‹‰å®šç†<span class="math inline">\(m^{\phi(n)} = 1\quadmod\quad n\)</span>ï¼Œæˆ‘ä»¬ä¾¿å¯è¿›è¡Œæ¨å¯¼ã€‚</p><p>å¯¹æ¬§æ‹‰å®šç†è¿›è¡Œå˜å½¢ï¼Œå¾—åˆ°<span class="math inline">\(m^{k\phi(n)+1} =m\quad mod\quad n\)</span></p><p>å› ä¸ºæˆ‘ä»¬å·²ç»çŸ¥é“<span class="math inline">\(c = m^e\quad mod\quadn\)</span>ï¼Œæ‰€ä»¥å¯»æ‰¾ä¸€ä¸ª dï¼Œä½¿å¾—<span class="math inline">\(ed =k\phi(n)+1\)</span>,åˆ™å¯ä»¥å¾—åˆ°<span class="math inline">\(m^{ed}=m\quadmod \quad n\)</span></p><p>åˆ™å¾—åˆ°äº†<span class="math inline">\(c^d =m\quad mod\quadn\)</span></p><h1 id="å…±æ¨¡æ”»å‡»">å…±æ¨¡æ”»å‡»</h1><p>æ‰€è°“å…±æ¨¡ï¼Œå°±æ˜¯ n ç›¸åŒï¼Œä¼šå¯¹åº”å¤šç»„ cï¼Œeã€‚</p><p>ä¾‹ï¼šç»™å®š nã€c1ã€c2ã€e1ã€e2</p><p>m = c<sub>1</sub><sup>e1</sup> mod n</p><p>m = c<sub>2</sub><sup>e2</sup> mod n</p><h2 id="æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•">æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•</h2><p>ç»™å®šä¸¤ä¸ªæ•´æ•° aã€bï¼Œå¿…å®šå­˜åœ¨ xã€yï¼Œä½¿å¾— gcd(a,b)=ax+by</p><p>è¿ç”¨è¯¥ç®—æ³•æ¨å¯¼è¿‡ç¨‹</p><p>m = m % n</p><p>m = m<sup>s1e1+s2e2</sup> % n</p><p>m = (m<sup>e1s1</sup> * m<sup>e2s2</sup>)% n</p><p>m = (m<sup>e1s1</sup> % n) * (m<sup>e2s2</sup> % n) % n</p><p>m = (c1<sup>s1</sup> % n) * (c2<sup>s2</sup> % n) % n</p><h2 id="exp">EXP</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> long_to_bytes<br>c1=<span class="hljs-number">22322035275663237041646893770451933509324701913484303338076210603542612758956262869640822486470121149424485571361007421293675516338822195280313794991136048140918842471219840263536338886250492682739436410013436651161720725855484866690084788721349555662019879081501113222996123305533009325964377798892703161521852805956811219563883312896330156298621674684353919547558127920925706842808914762199011054955816534977675267395009575347820387073483928425066536361482774892370969520740304287456555508933372782327506569010772537497541764311429052216291198932092617792645253901478910801592878203564861118912045464959832566051361</span><br>n=<span class="hljs-number">22708078815885011462462049064339185898712439277226831073457888403129378547350292420267016551819052430779004755846649044001024141485283286483130702616057274698473611149508798869706347501931583117632710700787228016480127677393649929530416598686027354216422565934459015161927613607902831542857977859612596282353679327773303727004407262197231586324599181983572622404590354084541788062262164510140605868122410388090174420147752408554129789760902300898046273909007852818474030770699647647363015102118956737673941354217692696044969695308506436573142565573487583507037356944848039864382339216266670673567488871508925311154801</span><br>e1=<span class="hljs-number">11187289</span><br>c2=<span class="hljs-number">18702010045187015556548691642394982835669262147230212731309938675226458555210425972429418449273410535387985931036711854265623905066805665751803269106880746769003478900791099590239513925449748814075904017471585572848473556490565450062664706449128415834787961947266259789785962922238701134079720414228414066193071495304612341052987455615930023536823801499269773357186087452747500840640419365011554421183037505653461286732740983702740822671148045619497667184586123657285604061875653909567822328914065337797733444640351518775487649819978262363617265797982843179630888729407238496650987720428708217115257989007867331698397</span><br>e2=<span class="hljs-number">9647291</span><br><br>r,s1,s2=gmpy2.gcdext(e1,e2)<br>m=(<span class="hljs-built_in">pow</span>(c1,s1,n) * <span class="hljs-built_in">pow</span>(c2,s2,n)) %n<br><span class="hljs-built_in">print</span>(long_to_bytes(m))<br><span class="hljs-comment">#flag&#123;49d91077a1abcb14f1a9d546c80be9ef&#125;</span><br></code></pre></td></tr></table></figure><h1 id="wieners-attack">Wiener's Attack</h1><p>é€‚ç”¨äºå·²çŸ¥ Nã€eï¼Œä¸” e è¿‡å¤§æˆ–è¿‡å°ã€‚</p><p>Wiener è¡¨ç¤ºå¦‚æœ<spanclass="math inline">\(d&lt;\frac{1}{3}n^{\frac{1}{4}}\)</span>,é‚£ä¹ˆä¸€ç§åŸºäº<strong>è¿åˆ†æ•°</strong>çš„æ”»å‡»å°±å¯å±åŠRSA å®‰å…¨ã€‚</p><p>é‚£ä¹ˆä»€ä¹ˆæ˜¯è¿åˆ†æ•°ä»¥åŠå¦‚ä½•åˆ©ç”¨å‘¢ï¼Ÿ</p><h2 id="è¿åˆ†æ•°">è¿åˆ†æ•°</h2><p>å½“ <span class="math inline">\(a_0, a_1, a_2, \dots, a_n\)</span>éƒ½æ˜¯æ­£æ•´æ•°æ—¶ï¼Œä¸€ä¸ªè¿åˆ†æ•°å¯ä»¥è¡¨ç¤ºä¸ºï¼š <spanclass="math display">\[x\;=\;a_0 + \cfrac{1}{a_1 + \cfrac{1}{a_2 +\cfrac{1}{\ddots + \cfrac{1}{a_n}}}}\]</span></p><p>ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥æ±‚è§£<span class="math inline">\(\pi\)</span>çš„è¿‘ä¼¼å€¼<span class="math display">\[\pi = 3 + \cfrac{1}{7 + \cfrac{1^2}{15 +\cfrac{2^2}{1 + \cfrac{3^2}{1 + \cfrac{4^2}{2 + \cdots}}}}}\]</span>å…¶ä¸­æ¯ä¸€é¡¹å¯ä»¥ç”¨å¦‚ä¸‹å…¬å¼è®¡ç®—ï¼š</p><p><span class="math display">\[a_k = \begin{cases}a_0, &amp; k=0 \\\lfloor b_k \rfloor, &amp; k &gt; 0\end{cases}\\\]</span></p><p><span class="math display">\[b_k = \begin{cases}a_0, &amp; k=0 \\\dfrac{1}{b_{k-1} - \lfloor b_{k-1} \rfloor}, &amp; k &gt; 0\end{cases}\]</span></p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<span class="math inline">\(a_0 =3\)</span>ï¼Œå¹¶ä¸”æŒ‰ç…§ä¸Šè¿°å…¬å¼é€’å½’è®¡ç®— <spanclass="math inline">\(a_k\)</span> å’Œ <spanclass="math inline">\(b_k\)</span>ç›´åˆ°è¾¾åˆ°ä¸€å®šç²¾åº¦ä¸ºæ­¢ï¼Œå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªè¿‘ä¼¼å€¼ <spanclass="math inline">\(\pi \approx 3.14159265\)</span>ã€‚</p><p>è‡³æ­¤ä¹Ÿå°±æ˜ç™½äº†è¿åˆ†æ•°çš„ä½œç”¨ï¼Œå¸¸ç”¨äºæ— ç†æ•°çš„é€¼è¿‘ã€‚</p><p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥é€¼è¿‘ä¸€ä¸ªä»»æ„æ•°ï¼Œå¾—åˆ°æœ€æ¥è¿‘ç²¾ç¡®å€¼çš„è¿‘ä¼¼å€¼ã€‚</p><h2 id="legendres-theorem">Legendre's theorem</h2><p><span class="math display">\[\left | \frac{e}{N}-\frac{k}{d} \right|\leq \frac{1}{2d^2}\]</span> å½“æ»¡è¶³è¿™ä¸€ç‚¹æ—¶ï¼Œ<spanclass="math inline">\(\frac{k}{d}\)</span>å°±æ˜¯<spanclass="math inline">\(\frac{e}{N}\)</span>çš„è¿åˆ†æ•°æ”¶æ•›ã€‚</p><h2 id="æ”»å‡»-rsa-åŸç†">æ”»å‡» RSA åŸç†</h2><p><span class="math display">\[\phi(n)=(p-1)(q-1)\]</span></p><p><span class="math display">\[\because p,qå¾ˆå¤§,\therefore \phi(n)\approx N\]</span> <span class="math display">\[ed - 1=k\phi(n)\]</span>åŒé™¤ <span class="math inline">\(d\phi(n)\)</span> å¾— <spanclass="math display">\[\frac{e}{\phi(n)}-\frac{k}{d}=\frac{1}{d\phi(n)}\]</span><span class="math display">\[\therefore\frac{e}{N}-\frac{k}{d}=\frac{1}{d\phi(n)}\]</span></p><p>åˆ°è¿™é‡Œå‘ç°ï¼Œç­‰å¼å³è¾¹çš„<spanclass="math inline">\(\frac{1}{d\phi(n)}\)</span>å¾ˆå°ï¼Œå› æ­¤<spanclass="math inline">\(\frac{k}{d}\)</span>å°±æ˜¯ä¸€ä¸ªå¯¹äºå·²çŸ¥é‡<spanclass="math inline">\(\frac{e}{N}\)</span>çš„ä¸€ä¸ªè¿åˆ†æ•°é€¼è¿‘ã€‚</p><p>å› æ­¤å¯ä»¥é€šè¿‡å°†<spanclass="math inline">\(\frac{e}{N}\)</span>çš„è¿åˆ†æ•°å±•å¼€ï¼Œä¾æ¬¡è®¡ç®—æ¯ä¸€ä¸ªæ¸è¿›åˆ†æ•°ã€‚Wienerè¯æ˜äº†å¯ä»¥ç²¾å‡†è¦†ç›–<span class="math inline">\(\frac{k}{d}\)</span>ã€‚</p><h2 id="exp-1">exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">transform</span>(<span class="hljs-params">x,y</span>):       <span class="hljs-comment">#ä½¿ç”¨è¾—è½¬ç›¸å¤„å°†åˆ†æ•° x/y è½¬ä¸ºè¿åˆ†æ•°çš„å½¢å¼</span><br>    res=[]<br>    <span class="hljs-keyword">while</span> y:<br>        res.append(x//y)<br>        x,y=y,x%y<br>    <span class="hljs-keyword">return</span> res<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">continued_fraction</span>(<span class="hljs-params">sub_res</span>):<br>    numerator,denominator=<span class="hljs-number">1</span>,<span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> sub_res[::-<span class="hljs-number">1</span>]:      <span class="hljs-comment">#ä»sublistçš„åé¢å¾€å‰å¾ªç¯</span><br>        denominator,numerator=numerator,i*numerator+denominator<br>    <span class="hljs-keyword">return</span> denominator,numerator   <span class="hljs-comment">#å¾—åˆ°æ¸è¿›åˆ†æ•°çš„åˆ†æ¯å’Œåˆ†å­ï¼Œå¹¶è¿”å›</span><br><br><br><span class="hljs-comment">#æ±‚è§£æ¯ä¸ªæ¸è¿›åˆ†æ•°</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sub_fraction</span>(<span class="hljs-params">x,y</span>):<br>    res=transform(x,y)<br>    res=<span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(continued_fraction,(res[<span class="hljs-number">0</span>:i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-built_in">len</span>(res)))))  <span class="hljs-comment">#å°†è¿åˆ†æ•°çš„ç»“æœé€ä¸€æˆªå–ä»¥æ±‚æ¸è¿›åˆ†æ•°</span><br>    <span class="hljs-keyword">return</span> res<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_pq</span>(<span class="hljs-params">a,b,c</span>):      <span class="hljs-comment">#ç”±p+qå’Œpqçš„å€¼é€šè¿‡ç»´è¾¾å®šç†æ¥æ±‚è§£på’Œq</span><br>    par=gmpy2.isqrt(b*b-<span class="hljs-number">4</span>*a*c)   <span class="hljs-comment">#ç”±ä¸Šè¿°å¯å¾—ï¼Œå¼€æ ¹å·ä¸€å®šæ˜¯æ•´æ•°ï¼Œå› ä¸ºæœ‰è§£</span><br>    x1,x2=(-b+par)//(<span class="hljs-number">2</span>*a),(-b-par)//(<span class="hljs-number">2</span>*a)<br>    <span class="hljs-keyword">return</span> x1,x2<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">wienerAttack</span>(<span class="hljs-params">e,n</span>):<br>    <span class="hljs-keyword">for</span> (d,k) <span class="hljs-keyword">in</span> sub_fraction(e,n):  <span class="hljs-comment">#ç”¨ä¸€ä¸ªforå¾ªç¯æ¥æ³¨æ„è¯•æ¢e/nçš„è¿ç»­å‡½æ•°çš„æ¸è¿›åˆ†æ•°ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„æ¸è¿›åˆ†æ•°</span><br>        <span class="hljs-keyword">if</span> k==<span class="hljs-number">0</span>:                     <span class="hljs-comment">#å¯èƒ½ä¼šå‡ºç°è¿åˆ†æ•°çš„ç¬¬ä¸€ä¸ªä¸º0çš„æƒ…å†µï¼Œæ’é™¤</span><br>            <span class="hljs-keyword">continue</span><br>        <span class="hljs-keyword">if</span> (e*d-<span class="hljs-number">1</span>)%k!=<span class="hljs-number">0</span>:             <span class="hljs-comment">#ed=1 (mod Ï†(n)) å› æ­¤å¦‚æœæ‰¾åˆ°äº†dçš„è¯ï¼Œ(ed-1)ä¼šæ•´é™¤Ï†(n),ä¹Ÿå°±æ˜¯å­˜åœ¨kä½¿å¾—(e*d-1)//k=Ï†(n)</span><br>            <span class="hljs-keyword">continue</span><br><br>        phi=(e*d-<span class="hljs-number">1</span>)//k               <span class="hljs-comment">#è¿™ä¸ªç»“æœå°±æ˜¯ Ï†(n)</span><br>        px,qy=get_pq(<span class="hljs-number">1</span>,n-phi+<span class="hljs-number">1</span>,n)<br>        <span class="hljs-keyword">if</span> px*qy==n:<br>            p,q=<span class="hljs-built_in">abs</span>(<span class="hljs-built_in">int</span>(px)),<span class="hljs-built_in">abs</span>(<span class="hljs-built_in">int</span>(qy))     <span class="hljs-comment">#å¯èƒ½ä¼šå¾—åˆ°ä¸¤ä¸ªè´Ÿæ•°ï¼Œè´Ÿè´Ÿå¾—æ­£æœªå°ä¸ä¼šå‡ºç°</span><br>            d=gmpy2.invert(e,(p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>))     <span class="hljs-comment">#æ±‚ed=1 (mod  Ï†(n))çš„ç»“æœï¼Œä¹Ÿå°±æ˜¯eå…³äº Ï†(n)çš„ä¹˜æ³•é€†å…ƒd</span><br>            <span class="hljs-keyword">return</span> d<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è¯¥æ–¹æ³•ä¸é€‚ç”¨&quot;</span>)<br><br><br>e = <span class="hljs-number">14058695417015334071588010346586749790539913287499707802938898719199384604316115908373997739604466972535533733290829894940306314501336291780396644520926473</span><br>n = <span class="hljs-number">33608051123287760315508423639768587307044110783252538766412788814888567164438282747809126528707329215122915093543085008547092423658991866313471837522758159</span><br>d=wienerAttack(e,n)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;d=&quot;</span>,d)<br><br></code></pre></td></tr></table></figure><h1 id="extending-wieners-attack">Extending Wiener's Attack</h1><p>æ‰©å±•ç»´çº³æ”»å‡»æ˜¯ä¸ºäº†æ‰©å±•åˆ°<spanclass="math inline">\(n\)</span>ä¸ªåŠ å¯†æŒ‡æ•°<spanclass="math inline">\(e_i\)</span>,ä¸”<spanclass="math inline">\(d_i\)</span>éƒ½è¾ƒå°çš„æƒ…å†µã€‚ ç”±<spanclass="math inline">\(e*d-k*\lambda(N)=1\)</span>å¾—</p><p><span class="math display">\[d_ige_i-k_iN=g+k_is\]</span></p><p>è®°ä¸ºç»´çº³ç­‰å¼<span class="math inline">\(W_i\)</span>ã€‚</p><p>åˆ©ç”¨ Guo çš„æ–¹æ³•å¯å¾—åˆ°å…³ç³»å¼: <spanclass="math display">\[k_id_je_j-k_jd_ie_i=k_i-k_j\]</span></p><p>è®°ä¸ºéƒ­ç­‰å¼<spanclass="math inline">\(G_{i,j}\)</span>ã€‚æ³¨æ„åˆ°ä¸¤ç§ç­‰å¼çš„å³ä¾§éƒ½éå¸¸å°ã€‚</p><p>å‚è€ƒè®ºæ–‡å’Œ wikiä¸­çš„åšæ³•ï¼Œåç»­çš„æ€è·¯æ˜¯ä½¿ç”¨è¿™ä¸¤ä¸ªå¼å­çš„ä¸åŒå…³ç³»å»æ„é€ æ ¼ï¼Œè¿›è€Œæ ¼åŸºçº¦åŒ–æ±‚å¾—<spanclass="math inline">\(\phi(N)\)</span>æ¥å®ç°<spanclass="math inline">\(N\)</span>çš„åˆ†è§£ã€‚</p><h2 id="ä¸¤ä¸ªå°è§£å¯†æŒ‡æ•°">ä¸¤ä¸ªå°è§£å¯†æŒ‡æ•°</h2><h2 id="ä¸‰ä¸ªå°è§£å¯†æŒ‡æ•°">ä¸‰ä¸ªå°è§£å¯†æŒ‡æ•°</h2><h1 id="ä½åŠ å¯†æŒ‡æ•°æ”»å‡»-e3">ä½åŠ å¯†æŒ‡æ•°æ”»å‡» e=3</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">dec</span>(<span class="hljs-params">c, e, n</span>):<br>    k = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        mm = c + n*k<br>        result, flag = gmpy2.iroot(mm, e)<br>        <span class="hljs-keyword">if</span> <span class="hljs-literal">True</span> == flag:<br>            <span class="hljs-keyword">return</span> result<br>        k += <span class="hljs-number">1</span><br>n= <span class="hljs-number">14067473525623615859223663589118945198091192669401088734569589535726733244095067264729942915265175903139441309376381225701454902095234966599914234681888481774607095853830772571665038109641511499155604914228117882196188074964226780922239011682486198651997912713999544628177959592818928976240251790858062449396082494272361535640237914373270152455829541596341184902017633404494979208958080467979235974182507427501682492000572071306960595992848840147393057648929439822116261337091431441205378542080755128597543738922210525692259529009107645032171097155449558362749512243918901171631681472217935131865121871798425854707759</span><br>e= <span class="hljs-number">3</span><br>c= <span class="hljs-number">2217344750798294937344050117513831761010547351781457575945714176628679412650463329423466955026804439931765627111856888102133234836914006818023839994342283023142702993182665344445325734299047409223354338948863171846780674244925724334091153701697864918695050507247415283070309</span><br><br>m=dec(c,e,n)<br><span class="hljs-built_in">print</span>(long_to_bytes(m))<br><br></code></pre></td></tr></table></figure><h1 id="ä½åŠ å¯†æŒ‡æ•°å¹¿æ’­æ”»å‡»">ä½åŠ å¯†æŒ‡æ•°å¹¿æ’­æ”»å‡»</h1><p>ç‰¹ç‚¹æ˜¯ e å°ï¼Œæœ‰å¤šç»„ nï¼Œå¯¹åº”äº†å¤šç»„ c</p><p>m<sup>e</sup> = c1 mod n1</p><p>m<sup>e</sup> = c2 mod n2</p><p>m<sup>e</sup> = c3 mod n3</p><h2 id="ä¸­å›½å‰©ä½™å®šç†crt">ä¸­å›½å‰©ä½™å®šç†(CRT)</h2><p>å®šç†å†…å®¹å¦‚ä¸‹</p><p>é’ˆå¯¹ä¸Šè¿°æ–¹ç¨‹ç»„ï¼Œè‹¥ n1ã€n2ã€n3 äº’è´¨ï¼Œå¯¹äºä»»æ„çš„c1ã€c2ã€c3ï¼Œæ–¹ç¨‹ç»„éƒ½æœ‰è§£ mã€‚</p><p>ä½¿ç”¨æ¡ä»¶æ˜¯ m^e &lt; n1ã€n2ã€n3ã€‚é€šè§£æ¨å¯¼å¦‚ä¸‹ï¼š</p><p>è®¾<span class="math inline">\(N=n_1 \times n_2 \times n_3, N_1=N/n_1,N_2=N/n_2, N_3=N/n_3\)</span></p><p>è®¾<span class="math inline">\(t_i=N_i^{-1}\)</span>,è¿™é‡Œè¡¨ç¤º<spanclass="math inline">\(t_i\)</span>æ˜¯<spanclass="math inline">\(N_i\)</span>åœ¨æ¨¡<spanclass="math inline">\(n_i\)</span>çš„é€†å…ƒã€‚</p><p>æœ‰äº†ä»¥ä¸Šå‡ ä¸ªæ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç»™å‡ºé€šè§£å½¢å¼ï¼š</p><p><spanclass="math display">\[m=c_1t_1N_1+c_2t_2N_2+c_3t_3N_3+kN=kN+\sum_{i=1}^3c_it_iN_i\]</span></p><p>åœ¨æ¨¡ N åï¼Œåªå‰©å”¯ä¸€è§£<spanclass="math inline">\(m=\sum_{i=1}^3c_it_iN_i\)</span></p><h2 id="exp-2">EXP</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">from</span> sympy.ntheory.modular <span class="hljs-keyword">import</span> crt<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> long_to_bytes<br>e = <span class="hljs-number">3</span><br>n1 = <span class="hljs-string">&#x27;331310324212000030020214312244232222400142410423413104441140203003243002104333214202031202212403400220031202142322434104143104244241214204444443323000244130122022422310201104411044030113302323014101331214303223312402430402404413033243132101010422240133122211400434023222214231402403403200012221023341333340042343122302113410210110221233241303024431330001303404020104442443120130000334110042432010203401440404010003442001223042211442001413004&#x27;</span><br>c1 = <span class="hljs-string">&#x27;310020004234033304244200421414413320341301002123030311202340222410301423440312412440240244110200112141140201224032402232131204213012303204422003300004011434102141321223311243242010014140422411342304322201241112402132203101131221223004022003120002110230023341143201404311340311134230140231412201333333142402423134333211302102413111111424430032440123340034044314223400401224111323000242234420441240411021023100222003123214343030122032301042243&#x27;</span><br><br>n2 = <span class="hljs-string">&#x27;302240000040421410144422133334143140011011044322223144412002220243001141141114123223331331304421113021231204322233120121444434210041232214144413244434424302311222143224402302432102242132244032010020113224011121043232143221203424243134044314022212024343100042342002432331144300214212414033414120004344211330224020301223033334324244031204240122301242232011303211220044222411134403012132420311110302442344021122101224411230002203344140143044114&#x27;</span><br>c2 = <span class="hljs-string">&#x27;112200203404013430330214124004404423210041321043000303233141423344144222343401042200334033203124030011440014210112103234440312134032123400444344144233020130110134042102220302002413321102022414130443041144240310121020100310104334204234412411424420321211112232031121330310333414423433343322024400121200333330432223421433344122023012440013041401423202210124024431040013414313121123433424113113414422043330422002314144111134142044333404112240344&#x27;</span><br><br>n3 = <span class="hljs-string">&#x27;332200324410041111434222123043121331442103233332422341041340412034230003314420311333101344231212130200312041044324431141033004333110021013020140020011222012300020041342040004002220210223122111314112124333211132230332124022423141214031303144444134403024420111423244424030030003340213032121303213343020401304243330001314023030121034113334404440421242240113103203013341231330004332040302440011324004130324034323430143102401440130242321424020323&#x27;</span><br>c3 = <span class="hljs-string">&#x27;10013444120141130322433204124002242224332334011124210012440241402342100410331131441303242011002101323040403311120421304422222200324402244243322422444414043342130111111330022213203030324422101133032212042042243101434342203204121042113212104212423330331134311311114143200011240002111312122234340003403312040401043021433112031334324322123304112340014030132021432101130211241134422413442312013042141212003102211300321404043012124332013240431242&#x27;</span><br>c1=<span class="hljs-built_in">int</span>(c1,<span class="hljs-number">5</span>)<br>n1=<span class="hljs-built_in">int</span>(n1,<span class="hljs-number">5</span>)<br>c2=<span class="hljs-built_in">int</span>(c2,<span class="hljs-number">5</span>)<br>n2=<span class="hljs-built_in">int</span>(n2,<span class="hljs-number">5</span>)<br>c3=<span class="hljs-built_in">int</span>(c3,<span class="hljs-number">5</span>)<br>n3=<span class="hljs-built_in">int</span>(n3,<span class="hljs-number">5</span>)<br>e=<span class="hljs-number">3</span><br>n=[n1,n2,n3]<br>c=[c1,c2,c3]<br>resultant,mod= crt(n, c)<br><span class="hljs-comment"># æœ‰ç°æˆçš„åº“å‡½æ•°å¯ä»¥è°ƒç”¨</span><br><span class="hljs-built_in">print</span>(gmpy2.iroot(resultant, e))<br>m=<span class="hljs-number">259362307225540148883586283191025214233097658309244310540770399135748418469298031742173624766441014006294782333</span><br><span class="hljs-built_in">print</span>(long_to_bytes(m))<br><span class="hljs-comment">#noxCTF&#123;D4mn_y0u_h4s74d_wh47_4_b100dy_b4s74rd!&#125;</span><br></code></pre></td></tr></table></figure><h1 id="dpdq-ç›¸å…³">dpã€dq ç›¸å…³</h1><h2 id="ç»™å®š-dpdq-ç±»å‹">ç»™å®š dpã€dq ç±»å‹</h2><p>dp â‰¡ d mod (p-1)</p><p>dq â‰¡ d mod (q-1)</p><p>m â‰¡ c<sup>d</sup> mod n</p><p>m = c<sup>d</sup> + k * n</p><p>m = c<sup>d</sup> +k _ p _ q</p><p>å¯¹ä¸Šå¼ä¸¤ç«¯åŒæ—¶å¯¹ pã€q åˆ†åˆ«å–ä½™ï¼Œå¾—ï¼šï¼ˆä¸­å›½å‰©ä½™å®šç†ï¼‰</p><p>m1 â‰¡ c<sup>d</sup> mod p</p><p>m2 â‰¡ c<sup>d</sup> mod q</p><p>åŒç†ï¼Œå¯å¾—åˆ° c<sup>d</sup> = m1 +k * p</p><p>ä»£å…¥åˆ° m2 â‰¡ c<sup>d</sup> mod q ä¸­ï¼š</p><p>m2 â‰¡ (m1 + k * p)mod q ï¼Œä¸¤ç«¯å‡å» m1 å¾—</p><p>m2 - m1 â‰¡ k * p mod q ï¼Œä¸¤ç«¯ä¹˜ p çš„é€†å…ƒå¾—</p><p>(m2 - m1)p<sup>-1</sup> â‰¡ k mod q</p><p>å°† k ä»£å…¥åˆ° c<sup>d</sup> = m1 +k * p ä¸­å¾—ï¼š</p><p>c<sup>d</sup> = m1 + ((m2 - m1)p<sup>-1</sup> mod q) * p</p><p>m=c<sup>d</sup> mod n</p><p>å¾—åˆ°</p><p>m â‰¡ (((m2 - m1) _ p<sup>-1</sup> mod q) _ p + m1) mod n</p><p>æ¥ä¸‹æ¥å°±æ˜¯æ±‚è§£ m1ï¼Œm2</p><p>m1 â‰¡ c<sup>dp+k(p-1)</sup> mod p</p><p>m2 â‰¡ c<sup>dq+k(q-1)</sup> mod q</p><p>æ ¹æ®è´¹é©¬å°å®šç†</p><p>è‹¥ p æ˜¯ç´ æ•°ï¼Œåˆ™ a<sup>(p-1)</sup> â‰¡ 1 mod p</p><p>å› æ­¤ m1 â‰¡ c<sup>dp</sup> mod pï¼Œm2 â‰¡ c<sup>dq</sup> mod q</p><p>æœ€ç»ˆå¯æ±‚å¾— m</p><h3 id="exp-3">EXP</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> long_to_bytes<br>p = <span class="hljs-number">8637633767257008567099653486541091171320491509433615447539162437911244175885667806398411790524083553445158113502227745206205327690939504032994699902053229</span><br>q = <span class="hljs-number">12640674973996472769176047937170883420927050821480010581593137135372473880595613737337630629752577346147039284030082593490776630572584959954205336880228469</span><br>dp = <span class="hljs-number">6500795702216834621109042351193261530650043841056252930930949663358625016881832840728066026150264693076109354874099841380454881716097778307268116910582929</span><br>dq = <span class="hljs-number">783472263673553449019532580386470672380574033551303889137911760438881683674556098098256795673512201963002175438762767516968043599582527539160811120550041</span><br>c = <span class="hljs-number">24722305403887382073567316467649080662631552905960229399079107995602154418176056335800638887527614164073530437657085079676157350205351945222989351316076486573599576041978339872265925062764318536089007310270278526159678937431903862892400747915525118983959970607934142974736675784325993445942031372107342103852</span><br>m1=<span class="hljs-built_in">pow</span>(c,dp,p)<br>m2=<span class="hljs-built_in">pow</span>(c,dq,q)<br>n=p*q<br>p0=gmpy2.invert(p,q)<br>m=(((m2-m1)*p0 % q)* p +m1)%n<br><span class="hljs-built_in">print</span>(long_to_bytes(m))<br><span class="hljs-comment">#noxCTF&#123;W31c0m3_70_Ch1n470wn&#125;</span><br></code></pre></td></tr></table></figure><h2 id="åªç»™å®š-dp">åªç»™å®š dp</h2><p>dp â‰¡ d mod (p-1)</p><p>ed â‰¡ 1 mod (p-1) * (q-1)</p><p>ed = 1 + k2(p-1)(q-1)</p><p>å¯¹ 1 å¼ä¸¤ç«¯åŒä¹˜ eï¼Œå¾—</p><p>e * dp â‰¡ ed mod (p-1)</p><p>e * dp = k1(p-1) + ed</p><p>ä»£å…¥ ed å¾—</p><p>e * dp = k1(p-1) + 1 + k2(p-1)(q-1)</p><p>ç”±äºä¸¤ä¸ªæœªçŸ¥æ•°ç•¥æ˜¾éº»çƒ¦ï¼Œå‘ç°å…¬å› å­(p-1)ï¼Œç­‰å¼ä¸¤è¾¹åŒæ—¶å–ä½™p-1ï¼Œå³å¯æ¶ˆæ‰ n</p><p>e * dp â‰¡ 1 mod (p-1)</p><p>e * dp =k(p-1) + 1</p><p>å¾—åˆ°è¿™ä¸ªå¼å­åï¼Œå…¶å®çœŸæ­£æ„ä¹‰ä¸Šçš„æœªçŸ¥æ•°åªæœ‰æˆ‘ä»¬è¦æ±‚çš„pï¼Œä½†æ˜¯è¿˜å­˜åœ¨ä¸€ä¸ª kã€‚</p><p>é’ˆå¯¹ kï¼Œæˆ‘ä»¬åˆ¤æ–­ä¸€ä¸‹ä»–çš„èŒƒå›´ï¼Œçœ‹çœ‹èƒ½å¦é‡‡ç”¨çˆ†ç ´çš„æ–¹å¼ã€‚</p><p>k = (e * dp - 1)/(p-1)</p><p>å› ä¸º dp &lt; p-1</p><p>æ‰€ä»¥ k &lt; e</p><p>é€šè¿‡éå† k ç„¶åæ‰¾åˆ°(e * dp - 1)å¯ä»¥æ•´é™¤ k çš„æƒ…å†µå³å¯ã€‚</p><p>(è·‘äº†ä¸€ä¸‹å‘ç°é™åˆ¶æ¡ä»¶è¿˜ä¸å¤Ÿ)</p><p>å› æ­¤å†åŠ ä¸€ä¸ª n èƒ½å¦æ•´é™¤ p å³å¯ã€‚</p><h3 id="exp-4">EXP</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> long_to_bytes<br>e = <span class="hljs-number">65537</span><br>n = <span class="hljs-number">248254007851526241177721526698901802985832766176221609612258877371620580060433101538328030305219918697643619814200930679612109885533801335348445023751670478437073055544724280684733298051599167660303645183146161497485358633681492129668802402065797789905550489547645118787266601929429724133167768465309665906113</span><br>dp = <span class="hljs-number">905074498052346904643025132879518330691925174573054004621877253318682675055421970943552016695528560364834446303196939207056642927148093290374440210503657</span><br>c = <span class="hljs-number">140423670976252696807533673586209400575664282100684119784203527124521188996403826597436883766041879067494280957410201958935737360380801845453829293997433414188838725751796261702622028587211560353362847191060306578510511380965162133472698713063592621028959167072781482562673683090590521214218071160287665180751</span><br><span class="hljs-comment"># p = 13468634736343473907717969603434376212206335187555458742257940406618189481177835992217885676243155145465521141546915941147336786447889325606555333350540003</span><br><span class="hljs-comment"># q = 18432009829596386103558375461387837845170621179295293289126504231317130550979989727125205467379713835047300158256398009229511746203459540859429194971855371</span><br><span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,e):<br>    <span class="hljs-keyword">if</span> (e*dp-<span class="hljs-number">1</span>)%k == <span class="hljs-number">0</span>:<br>        p=(e*dp-<span class="hljs-number">1</span>)//k + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> n%p == <span class="hljs-number">0</span>:<br>            <span class="hljs-built_in">print</span>(p)<br>            <span class="hljs-keyword">break</span><br>q=n//p<br>phi= (p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)<br>d= gmpy2.invert(e,phi)<br>m=<span class="hljs-built_in">pow</span>(c,d,n)<br><span class="hljs-built_in">print</span>(long_to_bytes(m))<br><span class="hljs-comment">#flag&#123;wow_leaking_dp_breaks_rsa?_98924743502&#125;</span><br></code></pre></td></tr></table></figure><h1 id="dlp">DLP</h1><h2 id="magichitcon2021">magic(hitcon2021)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> *<br>magic=<span class="hljs-string">b&#x27;e0204eeaf14d72ab90e1f7ac69559dd182&#x27;</span><br>LEN = <span class="hljs-number">17</span><br>magic = os.urandom(LEN)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Magic:&quot;</span>, magic.<span class="hljs-built_in">hex</span>())<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Coud you use it to do encryption as hash?&#x27;</span>)<br><br>magic_num = bytes_to_long(magic)<br><span class="hljs-keyword">try</span>:<br>    N = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;N:&gt;&#x27;</span>))<br>    e = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;E:&gt;&#x27;</span>))<br>    data = long_to_bytes(<span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;data:&gt;&#x27;</span>), <span class="hljs-number">16</span>))<br>    <span class="hljs-keyword">if</span> N &gt;&gt; (<span class="hljs-number">248</span>) == magic_num:<br>        data2 = sha384(data).digest()<br>        num1 = bytes_to_long(data)<br>        num2 = bytes_to_long(data2)<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">pow</span>(num1, e, N) == num2:<br>            <span class="hljs-built_in">print</span>(os.getenv(<span class="hljs-string">&#x27;FLAG&#x27;</span>))<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;try harder!!!&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;try harder!&#x27;</span>)<br><span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>   <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;invalid&#x27;</span>)<br></code></pre></td></tr></table></figure><h3 id="exp-5">EXP</h3><h1 id="rabin">rabin</h1><p>é€‚ç”¨äº RSA ä¸­ e=2 çš„æƒ…å†µ</p><h2 id="pqpqseccon2022">pqpq(seccon2022)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> Crypto.Random <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> flag <span class="hljs-keyword">import</span> flag<br><br>p = getPrime(<span class="hljs-number">512</span>)<br>q = getPrime(<span class="hljs-number">512</span>)<br>r = getPrime(<span class="hljs-number">512</span>)<br>n = p * q * r<br>e = <span class="hljs-number">2</span> * <span class="hljs-number">65537</span><br><br><span class="hljs-keyword">assert</span> n.bit_length() // <span class="hljs-number">8</span> - <span class="hljs-built_in">len</span>(flag) &gt; <span class="hljs-number">0</span><br>padding = get_random_bytes(n.bit_length() // <span class="hljs-number">8</span> - <span class="hljs-built_in">len</span>(flag))<br>m = bytes_to_long(padding + flag)<br><br><span class="hljs-keyword">assert</span> m &lt; n<br><br>c1p = <span class="hljs-built_in">pow</span>(p, e, n)<br>c1q = <span class="hljs-built_in">pow</span>(q, e, n)<br>cm = <span class="hljs-built_in">pow</span>(m, e, n)<br>c1 = (c1p - c1q) % n<br>c2 = <span class="hljs-built_in">pow</span>(p - q, e, n)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;e = <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;n = <span class="hljs-subst">&#123;n&#125;</span>&quot;</span>)<br><span class="hljs-comment"># p^e - q^e mod n</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;c1 = <span class="hljs-subst">&#123;c1&#125;</span>&quot;</span>)<br><span class="hljs-comment"># (p-q)^e mod n</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;c2 = <span class="hljs-subst">&#123;c2&#125;</span>&quot;</span>)<br><span class="hljs-comment"># m^e mod n</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;cm = <span class="hljs-subst">&#123;cm&#125;</span>&quot;</span>)<br><span class="hljs-comment"># e = 131074</span><br><span class="hljs-comment"># n = 587926815910957928506680558951380405698765957736660571041732511939308424899531125274073420353104933723578377320050609109973567093301465914201779673281463229043539776071848986139657349676692718889679333084650490543298408820393827884588301690661795023628407437321580294262453190086595632660415087049509707898690300735866307908684649384093580089579066927072306239235691848372795522705863097316041992762430583002647242874432616919707048872023450089003861892443175057</span><br><span class="hljs-comment"># c1 = 92883677608593259107779614675340187389627152895287502713709168556367680044547229499881430201334665342299031232736527233576918819872441595012586353493994687554993850861284698771856524058389658082754805340430113793873484033099148690745409478343585721548477862484321261504696340989152768048722100452380071775092776100545951118812510485258151625980480449364841902275382168289834835592610827304151460005023283820809211181376463308232832041617730995269229706500778999</span><br><span class="hljs-comment"># c2 = 46236476834113109832988500718245623668321130659753618396968458085371710919173095425312826538494027621684566936459628333712619089451210986870323342712049966508077935506288610960911880157875515961210931283604254773154117519276154872411593688579702575956948337592659599321668773003355325067112181265438366718228446448254354388848428310614023369655106639341893255469632846938342940907002778575355566044700049191772800859575284398246115317686284789740336401764665472</span><br><span class="hljs-comment"># cm = 357982930129036534232652210898740711702843117900101310390536835935714799577440705618646343456679847613022604725158389766496649223820165598357113877892553200702943562674928769780834623569501835458020870291541041964954580145140283927441757571859062193670500697241155641475887438532923910772758985332976303801843564388289302751743334888885607686066607804176327367188812325636165858751339661015759861175537925741744142766298156196248822715533235458083173713289585866</span><br><br><br></code></pre></td></tr></table></figure><h3 id="å¤§è‡´æ€è·¯">å¤§è‡´æ€è·¯</h3><p>æ ¹æ®é¢˜ç›®ï¼Œå¯å…ˆé€šè¿‡è®¡ç®— c1ã€c2 è¡¨è¾¾å¼ï¼Œåˆå¹¶æ‰¾å‡ºå…¬å› å­ï¼Œå³å¯æ±‚å‡ºpã€qï¼Œä»è€Œ r ä¹Ÿå¯æ±‚å¾—ã€‚ å‘ç° e=65537 * 2ï¼Œå› æ­¤æ˜¯æ— é€†å…ƒå­˜åœ¨çš„ï¼Œç´¢æ€§å°±å°† eæ‹†åˆ†ä¸º 65537 ä¸ 2ï¼Œe2=2 æ—¶ä¾¿å¯é€šè¿‡ Rabin ç®—æ³•è§£å¯†ã€‚</p><h3 id="æ±‚-pqr">æ±‚ pã€qã€r</h3><p><span class="math inline">\(c2 = (p - q)^e \mod n \\\)</span>å·¦å³åŒä¹˜ r <span class="math inline">\(c2 * r = rp^e + rq^e + X*pqr =rp^e + rq^e \mod n\\\)</span> <span class="math inline">\(c2 = p^e + q^e\mod n\\\)</span> åŒç†å¾—åˆ°<span class="math inline">\(c1 = p^e - q^e\mod n \\\)</span> ä»è€Œæ±‚å¾— pã€q <spanclass="math inline">\(p=gcd(c1+c2,n)\\\)</span></p><p><span class="math inline">\(q=gcd(c1-c2,n)\\\)</span></p><h3 id="æ±‚è§£-m2">æ±‚è§£ m^2</h3><p><span class="math inline">\(\phi(n)=(p-1)*(q-1)*(r-1)\\\)</span> é€šè¿‡e1(e/2)å’Œ<span class="math inline">\(\phi(n)\)</span>æ±‚å‡º dï¼Œå¾—åˆ°<spanclass="math inline">\(cm^d=m^{2*e1*d}=m^2 \mod n\)</span></p><h3 id="rabin-è§£å¯†">Rabin è§£å¯†</h3><p>æ¥ä¸‹æ¥å°±æ˜¯ä¼ ç»Ÿ Rabin è§£å¯†ï¼Œæ‰¾äº†ä¸¤ç§è„šæœ¬ï¼Œexpä¸­çš„<code>sqrtPrime(n,p)</code>å’Œ<code>Tonelli_Shanks(n,p)</code>ä»»é€‰å…¶ä¸€å³å¯ï¼Œéƒ½æ˜¯åŸºäºäºŒæ¬¡å‰©ä½™å®šç†æ‰€å®ç°çš„è§£å¯†ç®—æ³•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">from</span> itertools <span class="hljs-keyword">import</span> product<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sqrtPrime</span>(<span class="hljs-params">n, p</span>):<br>    q = p - <span class="hljs-number">1</span><br>    m = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> q &amp; <span class="hljs-number">1</span> == <span class="hljs-number">0</span>:<br>        q &gt;&gt;= <span class="hljs-number">1</span><br>        m += <span class="hljs-number">1</span><br><br>    z = <span class="hljs-number">1</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-built_in">pow</span>(z, (p - <span class="hljs-number">1</span>) &gt;&gt; <span class="hljs-number">1</span>, p) == <span class="hljs-number">1</span>:<br>        z = random.randint(<span class="hljs-number">1</span>, p - <span class="hljs-number">1</span>)<br><br>    c = <span class="hljs-built_in">pow</span>(z, q, p)<br>    t = <span class="hljs-built_in">pow</span>(n, q, p)<br>    r = <span class="hljs-built_in">pow</span>(n, (q + <span class="hljs-number">1</span>) &gt;&gt; <span class="hljs-number">1</span>, p)<br>    <span class="hljs-keyword">if</span> t == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>    m -= <span class="hljs-number">2</span><br>    <span class="hljs-keyword">while</span> t != <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">while</span> <span class="hljs-built_in">pow</span>(t, <span class="hljs-number">2</span>**m, p) == <span class="hljs-number">1</span>:<br>            c = c * c % p<br>            m -= <span class="hljs-number">1</span><br>        r = r * c % p<br>        c = c * c % p<br>        t = t * c % p<br>        m -= <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> r<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">Legendre</span>(<span class="hljs-params">n,p</span>): <span class="hljs-comment"># è¿™é‡Œç”¨å‹’è®©å¾·ç¬¦å·æ¥è¡¨ç¤ºåˆ¤æ–­äºŒæ¬¡ï¼ˆéï¼‰å‰©ä½™çš„è¿‡ç¨‹</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">pow</span>(n,(p - <span class="hljs-number">1</span>) // <span class="hljs-number">2</span>,p)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">Tonelli_Shanks</span>(<span class="hljs-params">n,p</span>):<br>    <span class="hljs-keyword">assert</span> Legendre(n,p) == <span class="hljs-number">1</span><br>    <span class="hljs-keyword">if</span> p % <span class="hljs-number">4</span> == <span class="hljs-number">3</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;1&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">pow</span>(n,(p + <span class="hljs-number">1</span>) // <span class="hljs-number">4</span>,p)<br>    q = p - <span class="hljs-number">1</span><br>    s = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> q % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>:<br>        q = q // <span class="hljs-number">2</span><br>        s += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">for</span> z <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>,p):<br>        <span class="hljs-keyword">if</span> Legendre(z,p) == p - <span class="hljs-number">1</span>:<br>            c = <span class="hljs-built_in">pow</span>(z,q,p)<br>            <span class="hljs-keyword">break</span><br>    r = <span class="hljs-built_in">pow</span>(n,(q + <span class="hljs-number">1</span>) // <span class="hljs-number">2</span>,p)<br>    t = <span class="hljs-built_in">pow</span>(n,q,p)<br>    m = s<br>    <span class="hljs-keyword">if</span> t % p == <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">return</span> r<br>    <span class="hljs-keyword">else</span>:<br>        i = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">while</span> t % p != <span class="hljs-number">1</span>: <span class="hljs-comment"># å¤–å±‚å¾ªç¯çš„åˆ¤æ–­æ¡ä»¶</span><br>            temp = <span class="hljs-built_in">pow</span>(t,<span class="hljs-number">2</span>**(i+<span class="hljs-number">1</span>),p) <span class="hljs-comment"># è¿™é‡Œå†™ä½œi+1æ˜¯ä¸ºäº†ç¡®ä¿ä¹‹åå†…å±‚å¾ªç¯ç”¨åˆ°iå€¼æ˜¯ä¸è¿™é‡Œçš„i+1çš„å€¼æ˜¯ç›¸ç­‰çš„</span><br>            i += <span class="hljs-number">1</span><br>            <span class="hljs-keyword">if</span> temp % p == <span class="hljs-number">1</span>: <span class="hljs-comment"># å†…å±‚å¾ªç¯çš„åˆ¤æ–­æ¡ä»¶</span><br>                b = <span class="hljs-built_in">pow</span>(c,<span class="hljs-number">2</span>**(m - i - <span class="hljs-number">1</span>),p)<br>                r = r * b % p<br>                c = b * b % p<br>                t = t * c % p<br>                m = i<br>                i = <span class="hljs-number">0</span> <span class="hljs-comment"># æ³¨æ„æ¯æ¬¡å†…å±‚å¾ªç¯ç»“æŸåiå€¼è¦æ›´æ–°ä¸º0</span><br>        <span class="hljs-keyword">return</span> r<br><br>e = <span class="hljs-number">131074</span><br>e = <span class="hljs-number">65537</span>*<span class="hljs-number">2</span><br>n = <span class="hljs-number">587926815910957928506680558951380405698765957736660571041732511939308424899531125274073420353104933723578377320050609109973567093301465914201779673281463229043539776071848986139657349676692718889679333084650490543298408820393827884588301690661795023628407437321580294262453190086595632660415087049509707898690300735866307908684649384093580089579066927072306239235691848372795522705863097316041992762430583002647242874432616919707048872023450089003861892443175057</span><br>c1 = <span class="hljs-number">92883677608593259107779614675340187389627152895287502713709168556367680044547229499881430201334665342299031232736527233576918819872441595012586353493994687554993850861284698771856524058389658082754805340430113793873484033099148690745409478343585721548477862484321261504696340989152768048722100452380071775092776100545951118812510485258151625980480449364841902275382168289834835592610827304151460005023283820809211181376463308232832041617730995269229706500778999</span><br>c2 = <span class="hljs-number">46236476834113109832988500718245623668321130659753618396968458085371710919173095425312826538494027621684566936459628333712619089451210986870323342712049966508077935506288610960911880157875515961210931283604254773154117519276154872411593688579702575956948337592659599321668773003355325067112181265438366718228446448254354388848428310614023369655106639341893255469632846938342940907002778575355566044700049191772800859575284398246115317686284789740336401764665472</span><br>cm = <span class="hljs-number">357982930129036534232652210898740711702843117900101310390536835935714799577440705618646343456679847613022604725158389766496649223820165598357113877892553200702943562674928769780834623569501835458020870291541041964954580145140283927441757571859062193670500697241155641475887438532923910772758985332976303801843564388289302751743334888885607686066607804176327367188812325636165858751339661015759861175537925741744142766298156196248822715533235458083173713289585866</span><br>p = GCD(c1+c2,n)<br>q = GCD(c1-c2,n)<br>r = n//(p*q)<br>phi=(p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)*(r-<span class="hljs-number">1</span>)<br>d0=gmpy2.invert(<span class="hljs-number">65537</span>,phi)<br>m2=<span class="hljs-built_in">pow</span>(cm,d0,n)<br>cp=m2%p<br>cq=m2%q<br>cr=m2%r<br>mp=sqrtPrime(cp,p)<br>mq=sqrtPrime(cq,q)<br>mr=sqrtPrime(cr,r)<br><br>mp=Tonelli_Shanks(cp,p)<br>mq=Tonelli_Shanks(cq,q)<br>mr=Tonelli_Shanks(cr,r)<br><br><span class="hljs-keyword">for</span> mp1,mq1,mr1 <span class="hljs-keyword">in</span> product([mp,p-mp],[mq,q-mq],[mr,r-mr]):<br>    x=[mp1,mq1,mr1]<br>    y=[p,q,r]<br>    <span class="hljs-built_in">print</span>(long_to_bytes(crt(y,x)[<span class="hljs-number">0</span>]))<br><br><span class="hljs-comment">#SECCON&#123;being_able_to_s0lve_this_1s_great!&#125;</span><br></code></pre></td></tr></table></figure><h1 id="e-ä¸-phi-ä¸äº’ç´ ">e ä¸ phi ä¸äº’ç´ </h1><h2 id="gcdp-1e1-gcdq-1e1">GCD(p-1,e)!=1 GCD(q-1,e)!=1</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> libnum<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> itertools<br>n = <span class="hljs-number">3326716005321175474866311915397401254111950808705576293932345690533263108414883877530294339294274914837424580618375346509555627578734883357652996005817766370804842161603027636393776079113035745495508839749006773483720698066943577445977551268093247748313691392265332970992500440422951173889419377779135952537088733</span><br>c = <span class="hljs-number">2709336316075650177079376244796188132561250459751152184677022745551914544884517324887652368450635995644019212878543745475885906864265559139379903049221765159852922264140740839538366147411533242116915892792672736321879694956051586399594206293685750573633107354109784921229088063124404073840557026747056910514218246</span><br>p = <span class="hljs-number">11104262127139631006017377403513327506789883414594983803879501935187577746510780983414313264114974863256190649020310407750155332724309172387489473534782137699</span><br>q=n//p<br>e=<span class="hljs-number">196608</span><br>enc=c<br>N=p*q<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_oneroot</span>(<span class="hljs-params">p, e</span>):<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        Zp = Zmod(p)<br>        g = Zp.random_element()<br>        g = g^((p-<span class="hljs-number">1</span>) // e)<br>        <span class="hljs-keyword">for</span> mult <span class="hljs-keyword">in</span> divisors(e):<br>            <span class="hljs-keyword">if</span> (mult != e):<br>                g2 = g^mult<br>                <span class="hljs-keyword">if</span> (g2 == <span class="hljs-number">1</span>):<br>                    <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> g<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params">p, c, e</span>):<br>    w = gcd(e, p-<span class="hljs-number">1</span>)<br>    e1, p1 = e // w, (p-<span class="hljs-number">1</span>) // w<br>    d = inverse_mod(e1, p1)<br>    c1 = <span class="hljs-built_in">pow</span>(c, d, p)<br>    g, a, b = xgcd(p1, w)<br>    g = get_oneroot(p, w)<br>    m = <span class="hljs-built_in">pow</span>(c1, b, p)<br>    <span class="hljs-keyword">return</span> [ZZ(m * g^i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(w)]<br><br>mp_list = decrypt(p, enc, e)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Find root p OK&#x27;</span>)<br>mq_list = decrypt(q, enc, e)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Find root q OK&#x27;</span>)<br><span class="hljs-keyword">for</span> mp, mq <span class="hljs-keyword">in</span> itertools.product(mp_list, mq_list):<br>    m = crt([mp, mq], [p, q])<br>    msg = long_to_bytes(<span class="hljs-built_in">int</span>(m))<br>    <span class="hljs-keyword">if</span> (<span class="hljs-string">b&#x27;flag&#x27;</span> <span class="hljs-keyword">in</span> msg):<br>        <span class="hljs-built_in">print</span>(msg)<br></code></pre></td></tr></table></figure><h2 id="mgcd-n">m^GCD &lt; n</h2><p>æ±‚å‡º<span class="math inline">\(d*t\)</span>åï¼Œå¯¹<spanclass="math inline">\(m\)</span>å¼€<spanclass="math inline">\(t\)</span>æ¬¡æ–¹æ ¹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> random<br>flag=<span class="hljs-string">b&#x27;flag&#123;dsajhkdhsajkdh&#125;&#x27;</span><br>m=bytes_to_long(flag)<br><span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>    e = random.getrandbits(<span class="hljs-number">128</span>)<br>    p=getPrime(<span class="hljs-number">1024</span>)<br>    q=getPrime(<span class="hljs-number">1024</span>)<br>    n=p*q<br>    phi_n=(p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)<br>    t=gmpy2.gcd(e,phi_n)<br>    <span class="hljs-keyword">if</span>  gmpy2.invert(e // t, phi_n) <span class="hljs-keyword">and</span> t!=<span class="hljs-number">1</span> <span class="hljs-keyword">and</span> m^t &lt; n:<br>        <span class="hljs-keyword">break</span><br>c=<span class="hljs-built_in">pow</span>(m,e,n)<br><br><span class="hljs-comment"># decrypt</span><br>phi=(p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)<br>t=GCD(e,phi)<br>n=p*q<br>d=gmpy2.invert(e//t,phi)<br>m0=<span class="hljs-built_in">pow</span>(c,d,n)<br>m=gmpy2.iroot(m0,t)<br><span class="hljs-built_in">print</span>(long_to_bytes(m[<span class="hljs-number">0</span>]))<br><br></code></pre></td></tr></table></figure><h2 id="mgcd-n-1">m^GCD &gt; n</h2><p><span class="math display">\[t=GCD(e,phi)\]</span> <spanclass="math display">\[d=inverse(e//t,phi)\]</span> <spanclass="math display">\[c=pow(c,d,n)\]</span> ä½¿ç”¨ CRT è¿›è¡Œæœ‰é™åŸŸå¼€æ ¹<span class="math display">\[x^t\;=c\;mod\;p\]</span> <spanclass="math display">\[x^t\;=c\;mod\;q\]</span></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>(<span class="hljs-params">p, q, e, c</span>):<br>    R.&lt; x &gt; = Zmod(p)[]<br>    f = x ^ e - c<br>    f = f.monic()<br>    res1 = f.roots()<br><br>    R.&lt; x &gt; = Zmod(q)[]<br>    f = x ^ e - c<br>    f = f.monic()<br>    res2 = f.roots()<br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> res1:<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> res2:<br>            m = CRT(<span class="hljs-built_in">int</span>(i[<span class="hljs-number">0</span>]), <span class="hljs-built_in">int</span>(j[<span class="hljs-number">0</span>]), p, q)<br>            flag = long_to_bytes(m)<br>            <span class="hljs-keyword">if</span> <span class="hljs-string">b&#x27;flag&#x27;</span> <span class="hljs-keyword">in</span> flag:<br>                <span class="hljs-built_in">print</span>(flag)<br>                <span class="hljs-built_in">print</span>(bytes_to_long(flag))<br><br></code></pre></td></tr></table></figure><h2 id="amm">AMM</h2><p>é€‚ç”¨äº<span class="math inline">\(e\)</span>å¯æ•´é™¤<spanclass="math inline">\(\phi\)</span>çš„æƒ…å†µ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#Sage</span><br><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-comment"># About 3 seconds to run</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">AMM</span>(<span class="hljs-params">o, r, q</span>):<br>    start = time.time()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\n----------------------------------------------------------------------------------&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Start to run Adleman-Manders-Miller Root Extraction Method&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Try to find one &#123;:#x&#125;th root of &#123;&#125; modulo &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(r, o, q))<br>    g = GF(q)<br>    o = g(o)<br>    p = g(random.randint(<span class="hljs-number">1</span>, q))<br>    <span class="hljs-keyword">while</span> p ^ ((q-<span class="hljs-number">1</span>) // r) == <span class="hljs-number">1</span>:<br>        p = g(random.randint(<span class="hljs-number">1</span>, q))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[+] Find p:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(p))<br>    t = <span class="hljs-number">0</span><br>    s = q - <span class="hljs-number">1</span><br>    <span class="hljs-keyword">while</span> s % r == <span class="hljs-number">0</span>:<br>        t += <span class="hljs-number">1</span><br>        s = s // r<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[+] Find s:&#123;&#125;, t:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(s, t))<br>    k = <span class="hljs-number">1</span><br>    <span class="hljs-keyword">while</span> (k * s + <span class="hljs-number">1</span>) % r != <span class="hljs-number">0</span>:<br>        k += <span class="hljs-number">1</span><br>    alp = (k * s + <span class="hljs-number">1</span>) // r<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[+] Find alp:&#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(alp))<br>    a = p ^ (r**(t-<span class="hljs-number">1</span>) * s)<br>    b = o ^ (r*alp - <span class="hljs-number">1</span>)<br>    c = p ^ s<br>    h = <span class="hljs-number">1</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, t):<br>        d = b ^ (r^(t-<span class="hljs-number">1</span>-i))<br>        <span class="hljs-keyword">if</span> d == <span class="hljs-number">1</span>:<br>            j = <span class="hljs-number">0</span><br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[+] Calculating DLP...&#x27;</span>)<br>            j = - discrete_log(a, d)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[+] Finish DLP...&#x27;</span>)<br>        b = b * (c^r)^j<br>        h = h * c^j<br>        c = c ^ r<br>    result = o^alp * h<br>    end = time.time()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Finished in &#123;&#125; seconds.&quot;</span>.<span class="hljs-built_in">format</span>(end - start))<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Find one solution: &#123;&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(result))<br>    <span class="hljs-keyword">return</span> result<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">findAllPRoot</span>(<span class="hljs-params">p, e</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Start to find all the Primitive &#123;:#x&#125;th root of 1 modulo &#123;&#125;.&quot;</span>.<span class="hljs-built_in">format</span>(e, p))<br>    start = time.time()<br>    proot = <span class="hljs-built_in">set</span>()<br>    <span class="hljs-keyword">while</span> <span class="hljs-built_in">len</span>(proot) &lt; e:<br>        proot.add(<span class="hljs-built_in">pow</span>(random.randint(<span class="hljs-number">2</span>, p-<span class="hljs-number">1</span>), (p-<span class="hljs-number">1</span>)//e, p))<br>    end = time.time()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Finished in &#123;&#125; seconds.&quot;</span>.<span class="hljs-built_in">format</span>(end - start))<br>    <span class="hljs-keyword">return</span> proot<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">findAllSolutions</span>(<span class="hljs-params">mp, proot, cp, p</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Start to find all the &#123;:#x&#125;th root of &#123;&#125; modulo &#123;&#125;.&quot;</span>.<span class="hljs-built_in">format</span>(e, cp, p))<br>    start = time.time()<br>    all_mp = <span class="hljs-built_in">set</span>()<br>    <span class="hljs-keyword">for</span> root <span class="hljs-keyword">in</span> proot:<br>        mp2 = mp * root % p<br>        <span class="hljs-keyword">assert</span>(<span class="hljs-built_in">pow</span>(mp2, e, p) == cp)<br>        all_mp.add(mp2)<br>    end = time.time()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Finished in &#123;&#125; seconds.&quot;</span>.<span class="hljs-built_in">format</span>(end - start))<br>    <span class="hljs-keyword">return</span> all_mp<br><br><br>e = <span class="hljs-number">0x1337</span><br>p = <span class="hljs-number">199138677823743837339927520157607820029746574557746549094921488292877226509198315016018919385259781238148402833316033634968163276198999279327827901879426429664674358844084491830543271625147280950273934405879341438429171453002453838897458102128836690385604150324972907981960626767679153125735677417397078196059</span><br>q = <span class="hljs-number">112213695905472142415221444515326532320352429478341683352811183503269676555434601229013679319423878238944956830244386653674413411658696751173844443394608246716053086226910581400528167848306119179879115809778793093611381764939789057524575349501163689452810148280625226541609383166347879832134495444706697124741</span><br>n = p * q<br>c=<span class="hljs-number">10562302690541901187975815594605242014385201583329309191736952454310803387032252007244962585846519762051885640856082157060593829013572592812958261432327975138581784360302599265408134332094134880789013207382277849503344042487389850373487656200657856862096900860792273206447552132458430989534820256156021128891296387414689693952047302604774923411425863612316726417214819110981605912408620996068520823370069362751149060142640529571400977787330956486849449005402750224992048562898004309319577192693315658275912449198365737965570035264841782399978307388920681068646219895287752359564029778568376881425070363592696751183359</span><br><br>cp = c % p<br>cq = c % q<br>mp = AMM(cp, e, p)<br>mq = AMM(cq, e, q)<br>p_proot = findAllPRoot(p, e)<br>q_proot = findAllPRoot(q, e)<br>mps = findAllSolutions(mp, p_proot, cp, p)<br>mqs = findAllSolutions(mq, q_proot, cq, q)<br><span class="hljs-built_in">print</span>(mps, mqs)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">check</span>(<span class="hljs-params">m</span>):<br>    h = m.<span class="hljs-built_in">hex</span>()<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(h) &amp; <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">bytes</span>.fromhex(h).startswith(<span class="hljs-string">b&#x27;flag&#x27;</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-built_in">bytes</span>.fromhex(h))<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><br><span class="hljs-comment"># About 16 mins to run 0x1337^2 == 24196561 times CRT</span><br>start = time.time()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Start CRT...&#x27;</span>)<br><span class="hljs-keyword">for</span> mpp <span class="hljs-keyword">in</span> mps:<br>    <span class="hljs-keyword">for</span> mqq <span class="hljs-keyword">in</span> mqs:<br>        solution = CRT_list([<span class="hljs-built_in">int</span>(mpp), <span class="hljs-built_in">int</span>(mqq)], [p, q])<br>        <span class="hljs-keyword">if</span> check(solution):<br>            <span class="hljs-built_in">print</span>(solution)<br>    <span class="hljs-built_in">print</span>(time.time() - start)<br><br>end = time.time()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Finished in &#123;&#125; seconds.&quot;</span>.<span class="hljs-built_in">format</span>(end - start))<br><br></code></pre></td></tr></table></figure><h1 id="å·²çŸ¥-pq-å’Œ-pq">å·²çŸ¥ p^q å’Œ p*q</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_pq</span>(<span class="hljs-params">n, x</span>):<br>    a = [<span class="hljs-number">0</span>]<br>    b = [<span class="hljs-number">0</span>]<br>    maskx = <span class="hljs-number">1</span><br>    maskn = <span class="hljs-number">2</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1024</span>):<br>        xbit = (x &amp; maskx) &gt;&gt; i<br>        nbit = n % maskn<br>        t_a = []<br>        t_b = []<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(a)):<br>            <span class="hljs-keyword">for</span> aa <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>):<br>                <span class="hljs-keyword">for</span> bb <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>):<br>                    <span class="hljs-keyword">if</span> aa ^ bb == xbit:<br>                        tmp2 = n % maskn<br>                        tmp1 = (aa * maskn // <span class="hljs-number">2</span> + a[j]) * (bb * maskn // <span class="hljs-number">2</span> + b[j]) % maskn<br>                        <span class="hljs-keyword">if</span> tmp1 == tmp2:<br>                            t_a.append(aa * maskn // <span class="hljs-number">2</span> + a[j])<br>                            t_b.append(bb * maskn // <span class="hljs-number">2</span> + b[j])<br>        maskx *= <span class="hljs-number">2</span><br>        maskn *= <span class="hljs-number">2</span><br>        a = t_a<br>        b = t_b<br>    <span class="hljs-keyword">for</span> a1, b1 <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(a, b):<br>        <span class="hljs-keyword">if</span> a1 * b1 == n1:<br>            <span class="hljs-keyword">return</span> a1, b1<br></code></pre></td></tr></table></figure><h1 id="æ˜æ–‡ç›¸å…³æ”»å‡»">æ˜æ–‡ç›¸å…³æ”»å‡»</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">assert</span> flag == <span class="hljs-string">b&quot;dasctf&#123;&quot;</span> + secret + <span class="hljs-string">b&quot;&#125;&quot;</span><br><span class="hljs-built_in">print</span>(rsaencrypt(bytes_to_long(secret)))<br><span class="hljs-built_in">print</span>(rsaencrypt(bytes_to_long(flag)))<br></code></pre></td></tr></table></figure><p>é€‚ç”¨äº</p><p>$$ C_1=M^e ; mod; n \</p><p>C_2=(aM+b)^e ; mod ; n $$</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">related_message_attack</span>(<span class="hljs-params">c1, c2, diff, e, n</span>):<br>    PRx.&lt;x&gt; = PolynomialRing(Zmod(n))<br>    g1 = x^e - c1<br>    g2 = (x*<span class="hljs-number">256</span>+diff)^e - c2<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">gcd</span>(<span class="hljs-params">g1, g2</span>):<br>        <span class="hljs-keyword">while</span> g2:<br>            g1, g2 = g2, g1 % g2<br>        <span class="hljs-keyword">return</span> g1.monic()<br><br>    <span class="hljs-keyword">return</span> -gcd(g1, g2)[<span class="hljs-number">0</span>]<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>,<span class="hljs-number">200</span>):<br>    sl = i*<span class="hljs-number">8</span><br>    diff = bytes_to_long(<span class="hljs-string">b&quot;dasctf&#123;&quot;</span>)*<span class="hljs-number">2</span>^(sl+<span class="hljs-number">8</span>) + bytes_to_long(<span class="hljs-string">b&quot;&#125;&quot;</span>)<br>    <span class="hljs-comment">#print(long_to_bytes(diff))</span><br>    v = related_message_attack(C1, C2, diff, e, n)<br>    v = long_to_bytes(<span class="hljs-built_in">int</span>(v))<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">all</span>(<span class="hljs-number">0x20</span>&lt;=k&lt;=<span class="hljs-number">0x7f</span> <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> v):<br>        <span class="hljs-built_in">print</span>(v)<br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;åŸºæœ¬åŸç†&quot;&gt;åŸºæœ¬åŸç†&lt;/h1&gt;
&lt;p&gt;RSA ä¸­åŠ ã€è§£å¯†ï¼š&lt;/p&gt;
&lt;p&gt;åŠ å¯†&lt;span class=&quot;math inline&quot;&gt;\(c = m^e\quad mod\quad n\)&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;è§£å¯†&lt;span class=&quot;math inlin</summary>
      
    
    
    
    <category term="CTF" scheme="https://sch01ar.github.io/categories/CTF/"/>
    
    
  </entry>
  
  <entry>
    <title>ECC(æŒç»­æ›´æ–°ğŸ¥±)</title>
    <link href="https://sch01ar.github.io/2023/04/19/ECC/"/>
    <id>https://sch01ar.github.io/2023/04/19/ECC/</id>
    <published>2023-04-19T06:05:45.000Z</published>
    <updated>2023-05-01T14:49:32.679Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ecc">ECC</h1><p>æ¤­åœ†æ›²çº¿å¯†ç å­¦(Elliptic CurveCryptography)ï¼Œæ˜¯ä¸€ç§åŸºäºæ¤­åœ†æ›²çº¿æ•°å­¦çš„å…¬é’¥å¯†ç ã€‚</p><p>åŸºäº ECCçš„ä¸‰å¤§é—®é¢˜ï¼š<strong>å¯†é’¥äº¤æ¢</strong>ã€<strong>æ•°å­—ç­¾å</strong>ã€<strong>ç¦»æ•£å¯¹æ•°</strong></p><h2 id="æ¤­åœ†æ›²çº¿">æ¤­åœ†æ›²çº¿</h2><p>æ¤­åœ†æ›²çº¿å®šä¹‰å¼ï¼š<spanclass="math inline">\(y^2\;=x^3+ax+b\)</span>ï¼Œï¼ˆç»´å°”æ–¯ç‰¹æ‹‰æ–¯æ ‡å‡†å½¢å¼ï¼‰</p><p>æ›²çº¿çš„ä¸€èˆ¬å½¢å¼ï¼š<spanclass="math inline">\(y^2+a_1xy+a_3y\;=x^3+a_2x^2+a_4x+a_6\)</span></p><p>åˆ¤åˆ«å¼<spanclass="math inline">\(\Delta=-16(4a^3+27b^2)\;mod\;p=0\)</span></p><h3 id="æ›²çº¿æ€§è´¨">æ›²çº¿æ€§è´¨</h3><p>æ¤­åœ†æ›²çº¿ä¸Šçš„å›°éš¾é—®é¢˜:<spanclass="math inline">\(Q=nP\)</span>ï¼Œç»™å®šæ¤­åœ†æ›²çº¿ä¸Š<spanclass="math inline">\(Pã€Q\)</span>ä¸¤ç‚¹ï¼Œæ±‚<spanclass="math inline">\(n\)</span>ååˆ†å›°éš¾</p><h4 id="point-addition-ç‚¹åŠ æ³•">point addition ç‚¹åŠ æ³•</h4><p>æ²¿æ›²çº¿çš„ P + Qä¸¤ç‚¹ç”»ä¸€æ¡é€šè¿‡ä¸¤ç‚¹çš„ç›´çº¿ã€‚ç°åœ¨ç»§ç»­è¿™æ¡çº¿ï¼Œç›´åˆ°å®ƒç¬¬ä¸‰æ¬¡ä¸ä½ çš„æ›²çº¿ç›¸äº¤ã€‚æœ€ååœ¨è¯¥ç‚¹æ²¿y è½´çš„æ–¹å‘å–åå°„ã€‚ <spanclass="math inline">\(P+Q+R&#39;=0,R=P+Q,R&#39;(x,-y)=R(x,y)\)</span><img src="/img/ECClines.png" /></p><h4 id="æœ‰é™åŸŸ">æœ‰é™åŸŸ</h4><p>å®šä¹‰åœ¨æœ‰é™åŸŸ<span class="math inline">\(F_p\)</span>ä¸Šï¼Œé›¶å…ƒæ˜¯<spanclass="math inline">\(O\)</span></p><p><strong>ç‚¹çš„é˜¶:</strong>å¯¹äºæ¤­åœ†æ›²çº¿ä¸Šä¸€ç‚¹<spanclass="math inline">\(P\)</span>ï¼Œè‹¥å­˜åœ¨ä¸€ä¸ªæœ€å°çš„æ­£æ•´æ•°<spanclass="math inline">\(n\)</span>ï¼Œä½¿å¾—<spanclass="math inline">\(nP=O\)</span>ï¼Œåˆ™ç§°<spanclass="math inline">\(n\)</span>æ˜¯ç‚¹<spanclass="math inline">\(P\)</span>çš„é˜¶ã€‚</p><p><strong>æ¤­åœ†æ›²çº¿çš„é˜¶:</strong>æ¯ä¸ªåœ¨æœ‰é™åŸŸä¸Šçš„æ¤­åœ†æ›²çº¿éƒ½ç”±æœ‰é™ä¸ªç‚¹ç»„æˆï¼Œæœ‰å¤šå°‘ä¸ªç‚¹æ¤­åœ†æ›²çº¿çš„é˜¶å°±æ˜¯å¤šå°‘ã€‚</p><h3 id="sage-ç¯å¢ƒ">Sage ç¯å¢ƒ</h3><p>åœ¨çº¿ç¯å¢ƒ<a href="https://sagecell.sagemath.org/"class="uri">https://sagecell.sagemath.org/</a></p><p>æœ¬åœ°ç¯å¢ƒ<ahref="https://doc.sagemath.org/html/en/installation/index.html"class="uri">https://doc.sagemath.org/html/en/installation/index.html</a>(æ¨èåœ¨ Linux ç¯å¢ƒæ­å»º)</p><p>åŸºæœ¬è¯­æ³•<a href="https://www.osgeo.cn/sagemath/tutorial/index.html"class="uri">https://www.osgeo.cn/sagemath/tutorial/index.html</a></p><h4 id="ç®€å•è¿ç®—">ç®€å•è¿ç®—</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">a = <span class="hljs-number">497</span><br>b = <span class="hljs-number">1768</span><br>p = <span class="hljs-number">9739</span><br>E = EllipticCurve(GF(p), [a, b])<br>Q = E(<span class="hljs-number">1539</span>, <span class="hljs-number">4742</span>)<br>R = E(<span class="hljs-number">4403</span>,<span class="hljs-number">5202</span>)<br>P = E(<span class="hljs-number">2339</span>, <span class="hljs-number">2213</span>)<br><span class="hljs-built_in">print</span>(P+Q)<br><span class="hljs-built_in">print</span>(<span class="hljs-number">4</span>*R)<br></code></pre></td></tr></table></figure><h2 id="ecdhå¯†é’¥äº¤æ¢">ECDHï¼ˆå¯†é’¥äº¤æ¢ï¼‰</h2><p>ECDH æ˜¯æ¤­åœ†æ›²çº¿è¿ªè²-èµ«å°”æ›¼ç§˜é’¥äº¤æ¢ï¼ˆElliptic Curve Diffieâ€“Hellman keyExchangeï¼‰ï¼Œä¸»è¦æ˜¯ç”¨æ¥åœ¨ä¸€ä¸ªä¸å®‰å…¨çš„é€šé“ä¸­å»ºç«‹èµ·å®‰å…¨çš„å…±æœ‰åŠ å¯†èµ„æ–™ï¼Œä¸€èˆ¬æ¥è¯´äº¤æ¢çš„éƒ½æ˜¯ç§é’¥ã€‚</p><h3 id="ç®—æ³•äº¤æ¢è¿‡ç¨‹">ç®—æ³•äº¤æ¢è¿‡ç¨‹</h3><p><strong>å…¬æœ‰å‚æ•°</strong>ï¼š<spanclass="math inline">\(p,g\)</span></p><p><strong>Alice ç§é’¥</strong>ï¼šå¤§æ•´æ•°<spanclass="math inline">\(a\)</span></p><p><strong>ç”Ÿæˆ Alice å…¬é’¥</strong>ï¼š<spanclass="math inline">\(A=g^a\;\mod\;p\)</span></p><p>Alice å°†<span class="math inline">\(A,p,g\)</span>ä¼ é€’ç»™ Bob</p><p><strong>Bob ç§é’¥</strong>ï¼šå¤§æ•´æ•°<spanclass="math inline">\(b\)</span></p><p><strong>ç”Ÿæˆ Bob å…¬é’¥</strong>ï¼š<spanclass="math inline">\(B=g^b\;\mod\;p\)</span></p><p><strong>Bob è®¡ç®—å…¬å…±å¯†é’¥</strong>ï¼š<spanclass="math inline">\(K=A^b\;\mod\;p\)</span></p><p>Bob å°†<span class="math inline">\(B,p,g\)</span>ä¼ é€’ç»™ Alice<strong>Alice è®¡ç®—å…¬å…±å¯†é’¥</strong>ï¼š<spanclass="math inline">\(K=B^a\;\mod\;p\)</span></p><p>äº¤æ¢å®Œæˆï¼ŒäºŒè€…åå•†å‡º<code>K</code>å…¬å…±å¯†é’¥ï¼Œå¹¶ä¸”æœªåœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æš´éœ²Kã€‚</p><h3id="an_der_schonen_elliptische_kurve">An_der_schonen_Elliptische_Kurve</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> FLAG, ECDH_KEY_EXCHANGE<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> md5<br><br><span class="hljs-keyword">import</span> binascii<br><br>iv = urandom(<span class="hljs-number">16</span>)<br><br><br>a = <span class="hljs-number">14489</span><br>b = <span class="hljs-number">10289</span><br>p = <span class="hljs-number">7486573182795736771889604737751889118967735916352298289975055815020934891723453392369540853603360270847848895677903334441530052977221688450741083448029661</span><br><br>F = GF(p)<br>E = EllipticCurve(F, [a, b])<br><br>G = E.random_point()<br><br>my_private_key = random_prime(<span class="hljs-number">2</span>^<span class="hljs-number">256</span>)<br><br>shared, sender_public_key = ECDH_KEY_EXCHANGE(G, my_private_key)<br><br>key = md5(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>(shared.xy()[<span class="hljs-number">0</span>])).encode()).digest()<br><br>cipher = AES.new(key, AES.MODE_CBC, iv)<br>ciphretext = cipher.encrypt(FLAG)<br><br><span class="hljs-built_in">print</span>(a)<br><span class="hljs-built_in">print</span>(b)<br><span class="hljs-built_in">print</span>(p)<br><span class="hljs-built_in">print</span>(sender_public_key)<br><span class="hljs-built_in">print</span>(my_private_key)<br><span class="hljs-built_in">print</span>(ciphretext.<span class="hljs-built_in">hex</span>())<br><span class="hljs-built_in">print</span>(iv.<span class="hljs-built_in">hex</span>())<br></code></pre></td></tr></table></figure><h3 id="exp">exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># sage</span><br>a=<span class="hljs-number">14489</span><br>b=<span class="hljs-number">10289</span><br>p=<span class="hljs-number">7486573182795736771889604737751889118967735916352298289975055815020934891723453392369540853603360270847848895677903334441530052977221688450741083448029661</span><br>F=GF(p)<br>E=EllipticCurve(F,[a,b])<br>sender_public_key=E([<span class="hljs-number">1285788649714386836892440333012889444698233333809489364474616947934542770724999997145538088456652601147045234490019282952264340541239682982255115303711207</span>,<span class="hljs-number">1081635450946385063319483423983665253792071829707039194609541132041775615770167048603029155228167113450196436786905820356216200242445665942628721193713459</span>])<br>my_private_key=<span class="hljs-number">2549545681219766023689977461986014915946503806253877534915175093306317852773</span><br>cipher=<span class="hljs-string">&quot;2f65ff4a97e0e05c06eab06b58ea38a3d5b6d2a65ea4907bc46493b30081a211d7cffc872a23dbd565ef307f9492bb23&quot;</span><br>iv=<span class="hljs-string">&quot;d151c04c645c3e2a8d3f1ae44589ef20&quot;</span><br>iv=<span class="hljs-built_in">bytes</span>.fromhex(iv)<br>c=<span class="hljs-built_in">bytes</span>.fromhex(cipher)<br><br>F = GF(p)<br>E = EllipticCurve(F, [a, b])<br><br>shared=sender_public_key*my_private_key<br><br>key = md5(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>(shared.xy()[<span class="hljs-number">0</span>])).encode()).digest()<br><br>cipher = AES.new(key, AES.MODE_CBC, iv)<br>m=cipher.decrypt(c)<br><span class="hljs-built_in">print</span>(m)<br></code></pre></td></tr></table></figure><h2 id="ecdsaæ•°å­—ç­¾å">ECDSAï¼ˆæ•°å­—ç­¾åï¼‰</h2><p>åŸºäºæ¤­åœ†æ›²çº¿çš„ DSA</p><h3 id="åœºæ™¯">åœºæ™¯</h3><p>Alice æƒ³è¦ä½¿ç”¨å¥¹çš„ç§é’¥<spanclass="math inline">\(d_A\)</span>æ¥ç­¾åï¼ŒBob æƒ³ç”¨ Alice çš„å…¬é’¥ <spanclass="math inline">\(H_A\)</span>è¦éªŒè¯ç­¾å<spanclass="math inline">\(H_A=d_AG\)</span>ã€‚ åªæœ‰ Aliceæ‰èƒ½æä¾›æ­£ç¡®çš„ç­¾åï¼Œè€Œæ¯ä¸ªäººéƒ½å¯ä»¥éªŒè¯ç­¾åã€‚</p><h3 id="ç­¾å">ç­¾å</h3><p>1.é€‰å®šä¸€æ¡æ¤­åœ†æ›²çº¿<span class="math inline">\(E_p(a,b)\)</span>ã€‚</p><p>2.é€‰å–ä¸€ä¸ªéšæœºæ•°<spanclass="math inline">\(k,1&lt;k&lt;n-1\)</span>ï¼Œ<spanclass="math inline">\(n\)</span>ä¸ºæ¤­åœ†æ›²çº¿çš„é˜¶ã€‚</p><p>3.é€‰å–æ¤­åœ†æ›²çº¿çš„åŸºç‚¹<span class="math inline">\(G(a,b)\)</span>,è®¡ç®—<span class="math inline">\(K=k * G(a,b)\)</span>ï¼Œä»¤<spanclass="math inline">\(r=K[0]\mod n\)</span>ï¼Œå³ r æ˜¯ K ç‚¹çš„æ¨ªåæ ‡ï¼ˆè‹¥ rä¸º 0ï¼Œé‡æ–°é€‰ k è¿›è¡Œè®¡ç®—ï¼‰ã€‚</p><p>4.è®¡ç®—æ˜æ–‡ M çš„å“ˆå¸Œï¼Œä»¤<spanclass="math inline">\(e=hash(M)\)</span>ï¼Œè®¡ç®—<spanclass="math inline">\(s=k^{-1}(z+rd_A)\mod n\)</span>ã€‚</p><p>5.ç»™å‡ºç­¾å<span class="math inline">\((r,s)\)</span></p><h3 id="éªŒè¯">éªŒè¯</h3><p>1.è®¡ç®— <span class="math inline">\(u_1=s^{-1}z\mod n\)</span></p><p>2.è®¡ç®— <span class="math inline">\(u_2=s^{-1}r\mod n\)</span></p><p>3.è®¡ç®—ç‚¹<span class="math inline">\(P=u_1G+u_2H_A\)</span></p><p>å½“<span class="math inline">\(r=x_P\modn\)</span>æ—¶ï¼Œç­¾åéªŒè¯æˆåŠŸã€‚</p><h3 id="dsa-lcg">DSA-LCG</h3><p><ahref="https://cseweb.ucsd.edu/~mihir/papers/dss-lcg.pdf">è¯•è¯•è¿™ä¸ª</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha384, sha256<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> inverse<br><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> k,privkey,flag<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sign</span>(<span class="hljs-params">msg, privkey,k,order</span>):<br>    e = <span class="hljs-built_in">int</span>(sha384(msg).hexdigest(), <span class="hljs-number">16</span>)<br>    K = k*G<br>    r = <span class="hljs-built_in">int</span>(K[<span class="hljs-number">0</span>])<br>    k_ = inverse(k, order)<br>    s = k_ * (e + privkey * r) % order<br>    <span class="hljs-keyword">return</span> r, s<br><br>q = <span class="hljs-number">0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff</span><br>a = -<span class="hljs-number">3</span><br>b = <span class="hljs-number">0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef</span><br>M = <span class="hljs-number">8368031831458217786350512159882992957012870179737136526893923006288695827959478962195704930743648877201823593529339381563729143350454126812624495126388843</span><br>x = <span class="hljs-number">0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7</span><br>y = <span class="hljs-number">0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f</span><br>E = EllipticCurve(GF(q), [<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,a, b])<br>G = E([x,y])<br>msg1=<span class="hljs-string">b&#x27;hello&#x27;</span><br>r1,s1=sign(msg1,privkey,k,q)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;r1 =&quot;</span>,r1)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;s1 =&quot;</span>,s1)<br>k2=(a*k+b) % M<br>msg2=<span class="hljs-string">b&#x27;world&#x27;</span><br>r2,s2=sign(msg2,privkey,k2,q)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;r2 =&quot;</span>,r2)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;s2 =&quot;</span>,s2)<br>key = sha256(<span class="hljs-built_in">str</span>(privkey).encode()).digest()<br>aes = AES.new(key, AES.MODE_ECB)<br>ct = base64.b64encode(aes.encrypt(pad(flag, <span class="hljs-number">16</span>))).decode()<br><br><span class="hljs-comment"># r1 = 34007466611771601516061414360911609922088882193344157567527189819210008217689485940426747623610209785764754548617752</span><br><span class="hljs-comment"># s1 = 371900949338744788274672150932790711380367554085093925552194085487875492160150324907657343202698707270323127656622</span><br><span class="hljs-comment"># r2 = 38135753943982836042572890793143465851493833988864701898930580343563479696256688655279135669457443358334628248476702</span><br><span class="hljs-comment"># s2 = 31206970698882787218208833552853920421221998187963884172949797755468379329952479963343252649210115334349094354726288</span><br><span class="hljs-comment"># ct = &quot;1Emwfale6VRBTlkcNZA3wiiNXrOqeifOC53/jXc+gT9Dv9r5I/q0EJKAgkt/sArW&quot;</span><br><br></code></pre></td></tr></table></figure><h2 id="ecdlpç¦»æ•£å¯¹æ•°">ECDLPï¼ˆç¦»æ•£å¯¹æ•°ï¼‰</h2><p>ç»™å®šæ¤­åœ†æ›²çº¿ Eï¼Œå·²çŸ¥ Pã€Q ä»¥åŠ<spanclass="math inline">\(Q=kP\)</span>ï¼Œæ±‚ kã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">E = EllipticCurve(GF(p), [a, b])<br>Q = E(x1,y1)<br>P = E(x2,y2)<br>k=P.discrete_log(Q)<br></code></pre></td></tr></table></figure><h3 id="ph-å…‰æ»‘é˜¶åˆ†è§£">PH å…‰æ»‘é˜¶åˆ†è§£</h3><h4 id="crypto-sign-in-1vnctf2023">crypto-sign-in-1(VNCTF2023)</h4><p>ä¸€é“ ECDLPé¢˜ç›®ï¼Œå½“æ—¶æƒ³åˆ°ä½¿ç”¨<code>Pohlig-Hellman</code>ç®—æ³•ï¼Œä½†æ˜¯ä¸€ç›´æ²¡èƒ½æ‰¾åˆ°åˆé€‚çš„Aã€B æ¥ç¡®å®š G çš„é˜¶ nï¼Œèµ›åçœ‹å¤§ä½¬ wpï¼Œæœç„¶æ˜¯ç”¨ pwntools è¿œç¨‹å¤šè¯•å‡ ç»„y1ã€y2ï¼Œæ‰¾åˆ°å…‰æ»‘çš„é˜¶ï¼Œä»è€Œè§£å¯†æˆåŠŸã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">from</span> sympy.ntheory.residue_ntheory <span class="hljs-keyword">import</span> nthroot_mod<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> randrange,choice<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> flag<br><br><span class="hljs-keyword">import</span> socketserver<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> signal<br><span class="hljs-keyword">import</span> string<br><br>table = string.ascii_letters+string.digits<br><br>nbit = <span class="hljs-number">128</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">pad</span>(<span class="hljs-params">m,lenth</span>):<br>    <span class="hljs-keyword">return</span> m + <span class="hljs-built_in">bytes</span>([i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(lenth-<span class="hljs-built_in">int</span>(<span class="hljs-built_in">len</span>(m)%lenth))])<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Task</span>(socketserver.BaseRequestHandler):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_recvall</span>(<span class="hljs-params">self</span>):<br>        BUFF_SIZE = <span class="hljs-number">2048</span><br>        data = <span class="hljs-string">b&#x27;&#x27;</span><br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            part = self.request.recv(BUFF_SIZE)<br>            data += part<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(part) &lt; BUFF_SIZE:<br>                <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">return</span> data.strip()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">send</span>(<span class="hljs-params">self, msg, newline=<span class="hljs-literal">True</span></span>):<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-keyword">if</span> newline:<br>                msg += <span class="hljs-string">b&#x27;\n&#x27;</span><br>            self.request.sendall(msg)<br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-keyword">pass</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">recv</span>(<span class="hljs-params">self, prompt=<span class="hljs-string">b&#x27;&#x27;</span></span>):<br>        self.send(prompt, newline=<span class="hljs-literal">False</span>)<br>        <span class="hljs-keyword">return</span> self._recvall()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">proof_of_work</span>(<span class="hljs-params">self</span>):<br>        proof = (<span class="hljs-string">&#x27;&#x27;</span>.join([choice(table)<span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">20</span>)])).encode()<br>        sha = sha256(proof).hexdigest().encode()<br>        self.send(<span class="hljs-string">b&quot;[+] sha256(XXXX+&quot;</span> + proof[<span class="hljs-number">4</span>:] + <span class="hljs-string">b&quot;) == &quot;</span> + sha )<br>        XXXX = self.recv(prompt = <span class="hljs-string">b&#x27;[+] Plz Tell Me XXXX :&#x27;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(XXXX) != <span class="hljs-number">4</span> <span class="hljs-keyword">or</span> sha256(XXXX + proof[<span class="hljs-number">4</span>:]).hexdigest().encode() != sha:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">handle</span>(<span class="hljs-params">self</span>):<br>        proof = self.proof_of_work()<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> proof:<br>            self.request.close()<br>        <span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>            qa = randrange(<span class="hljs-number">0</span>,<span class="hljs-number">2</span>**<span class="hljs-number">31</span>) * <span class="hljs-number">2</span><br>            qb = getPrime(nbit - <span class="hljs-number">32</span>)<br>            <span class="hljs-keyword">if</span> isPrime(qa * qb + <span class="hljs-number">1</span>):<br>                q = qa * qb + <span class="hljs-number">1</span><br>                <span class="hljs-keyword">break</span><br><br>        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(<span class="hljs-string">b&#x27;vnctf2023&#x27;</span>) - <span class="hljs-number">8</span>):<br>            self.send(<span class="hljs-string">b&quot;Send 2 `y&#x27; elements to me:  &quot;</span>)<br>            ans = self.recv()<br>            <span class="hljs-keyword">try</span>:<br>                y1, y2 = [<span class="hljs-built_in">int</span>(_) % q <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> ans.split(<span class="hljs-string">b&#x27;,&#x27;</span>)]<br>            <span class="hljs-keyword">except</span>:<br>                self.send(<span class="hljs-string">b&quot;Your parameters are not valid! Bye!!&quot;</span>)<br>                <span class="hljs-keyword">break</span><br><br>            AA = (y1**<span class="hljs-number">2</span> - y2**<span class="hljs-number">2</span> - <span class="hljs-number">2022</span>**<span class="hljs-number">3</span> + <span class="hljs-number">2023</span>**<span class="hljs-number">3</span>) * inverse(-<span class="hljs-number">1</span>, q) % q<br>            BB = (y1**<span class="hljs-number">2</span> - <span class="hljs-number">2022</span>**<span class="hljs-number">3</span> - AA * <span class="hljs-number">2022</span>) % q<br><br>            <span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">P,Q</span>):<br>                <span class="hljs-keyword">if</span> P[<span class="hljs-number">0</span>] != Q[<span class="hljs-number">0</span>] <span class="hljs-keyword">and</span> P[<span class="hljs-number">1</span>] != Q[<span class="hljs-number">1</span>]:<br>                    t = ((Q[<span class="hljs-number">1</span>]-P[<span class="hljs-number">1</span>]) * inverse(Q[<span class="hljs-number">0</span>]-P[<span class="hljs-number">0</span>],q)) %q<br>                <span class="hljs-keyword">else</span>:<br>                    t = ((<span class="hljs-number">3</span>*P[<span class="hljs-number">0</span>]*P[<span class="hljs-number">0</span>]+AA)*inverse(<span class="hljs-number">2</span>*P[<span class="hljs-number">1</span>],q))%q<br>                x3 = t*t - P[<span class="hljs-number">0</span>] - Q[<span class="hljs-number">0</span>]<br>                y3 = t*(P[<span class="hljs-number">0</span>] - x3) - P[<span class="hljs-number">1</span>]<br>                <span class="hljs-keyword">return</span> (x3%q, y3%q)<br><br>            <span class="hljs-keyword">def</span> <span class="hljs-title function_">mul</span>(<span class="hljs-params">t, A, B=<span class="hljs-number">0</span></span>):<br>                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> t: <span class="hljs-keyword">return</span> B<br>                <span class="hljs-keyword">return</span> mul(t//<span class="hljs-number">2</span>, add(A,A), B <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> t&amp;<span class="hljs-number">1</span> <span class="hljs-keyword">else</span> add(B,A) <span class="hljs-keyword">if</span> B <span class="hljs-keyword">else</span> A)<br><br>            <span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>                Gx = randrange(<span class="hljs-number">0</span>,q - <span class="hljs-number">1</span>)<br>                <span class="hljs-keyword">try</span>:<br>                    Gy = <span class="hljs-built_in">int</span>(nthroot_mod((Gx**<span class="hljs-number">3</span> + AA * Gx + BB) % q,<span class="hljs-number">2</span>,q))<br>                    <span class="hljs-keyword">assert</span> (<span class="hljs-built_in">pow</span>(Gy,<span class="hljs-number">2</span>,q) == (Gx**<span class="hljs-number">3</span> + AA * Gx + BB) % q)<br>                    <span class="hljs-keyword">break</span><br>                <span class="hljs-keyword">except</span>:<br>                    <span class="hljs-keyword">continue</span><br><br>            G = (Gx,Gy)<br>            m = randrange(<span class="hljs-number">0</span>,q-<span class="hljs-number">1</span>)<br>            C = mul(m,G)<br>            aes = AES.new(m.to_bytes(<span class="hljs-number">16</span>, <span class="hljs-string">&#x27;big&#x27;</span>), AES.MODE_CBC, <span class="hljs-built_in">bytes</span>(<span class="hljs-number">16</span>))<br>            enc_flag = aes.encrypt(pad(flag,<span class="hljs-number">16</span>))<br><br>            self.send(<span class="hljs-string">b&#x27;The parameters and encrypted flag are:&#x27;</span>)<br>            self.send(<span class="hljs-string">b&#x27;q = &#x27;</span> + <span class="hljs-built_in">str</span>(q).encode())<br>            self.send(<span class="hljs-string">b&#x27;G = (&#x27;</span>+ <span class="hljs-built_in">str</span>(Gx).encode() + <span class="hljs-string">b&#x27;,&#x27;</span> + <span class="hljs-built_in">str</span>(Gy).encode() + <span class="hljs-string">b&#x27;)&#x27;</span>)<br>            self.send(<span class="hljs-string">b&#x27;m * G = (&#x27;</span>+ <span class="hljs-built_in">str</span>(C[<span class="hljs-number">0</span>]).encode() + <span class="hljs-string">b&#x27;,&#x27;</span> + <span class="hljs-built_in">str</span>(C[<span class="hljs-number">1</span>]).encode() + <span class="hljs-string">b&#x27;)&#x27;</span>)<br>            self.send(<span class="hljs-string">b&#x27;encrypt flag = &#x27;</span> + enc_flag.<span class="hljs-built_in">hex</span>().encode())<br>        self.request.close()<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadedServer</span>(socketserver.ThreadingMixIn, socketserver.TCPServer):<br>    <span class="hljs-keyword">pass</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ForkedServer</span>(socketserver.ForkingMixIn, socketserver.TCPServer):<br>    <span class="hljs-keyword">pass</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    HOST, PORT = <span class="hljs-string">&#x27;0.0.0.0&#x27;</span>, <span class="hljs-number">10001</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;HOST:POST &quot;</span> + HOST+<span class="hljs-string">&quot;:&quot;</span> + <span class="hljs-built_in">str</span>(PORT))<br>    server = ForkedServer((HOST, PORT), Task)<br>    server.allow_reuse_address = <span class="hljs-literal">True</span><br>    server.serve_forever()<br><br></code></pre></td></tr></table></figure><h4 id="exp-1">EXP</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#sage</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> itertools <span class="hljs-keyword">import</span> product<br><span class="hljs-keyword">import</span> string<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha256<br><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> getrandbits<br><span class="hljs-keyword">from</span> ast <span class="hljs-keyword">import</span> literal_eval<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><br>table = string.ascii_letters+string.digits<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">set_connect_proof</span>():<br>    io=remote(<span class="hljs-string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="hljs-string">&#x27;25385&#x27;</span>)<br>    io.recvuntil(<span class="hljs-string">b&quot;sha256(XXXX+&quot;</span>)<br>    alphabet = string.ascii_letters + string.digits<br>    lattar_part=io.recv(<span class="hljs-number">16</span>).decode(<span class="hljs-string">&#x27;utf8&#x27;</span>)<br>    io.recvuntil(<span class="hljs-string">b&#x27;== &#x27;</span>)<br>    h=io.recvline().strip().decode(<span class="hljs-string">&#x27;utf8&#x27;</span>)<br>    <span class="hljs-comment"># print(h)</span><br>    io.recvuntil(<span class="hljs-string">b&#x27;[+] Plz Tell Me XXXX :&#x27;</span>)<br>    bruteforce=[ <span class="hljs-string">&#x27;&#x27;</span>.join(prefix)+lattar_part  <span class="hljs-keyword">for</span> prefix <span class="hljs-keyword">in</span> product(alphabet,repeat=<span class="hljs-number">4</span>)]<br>    <span class="hljs-keyword">for</span> proof <span class="hljs-keyword">in</span> bruteforce:<br>        <span class="hljs-keyword">if</span> sha256(proof.encode()).hexdigest()==h:<br>            io.sendline(proof.encode()[:<span class="hljs-number">4</span>])<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;proof done&quot;</span>)<br>            <span class="hljs-keyword">return</span> io<br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    io = set_connect_proof()<br>    io.recvuntil(<span class="hljs-string">b&quot;Send 2 `y&#x27; elements to me:  &quot;</span>)<br>    y1,y2 = getrandbits(<span class="hljs-number">128</span>),getrandbits(<span class="hljs-number">128</span>)<br>    io.sendline(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(y1)&#125;</span>,<span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(y2)&#125;</span>&#x27;</span>.encode())<br>    q = <span class="hljs-built_in">int</span>(io.recvline_contains(<span class="hljs-string">b&#x27;q = &#x27;</span>).decode().strip()[<span class="hljs-number">4</span>:])<br>    G = literal_eval(io.recvline_contains(<span class="hljs-string">b&quot;G = &quot;</span>).decode().strip()[<span class="hljs-number">4</span>:])<br>    mG = literal_eval(io.recvline_contains(<span class="hljs-string">b&quot;m * G = &quot;</span>).decode().strip()[<span class="hljs-number">8</span>:])<br>    encflag = io.recvline_contains(<span class="hljs-string">b&#x27;encrypt flag = &#x27;</span>).decode().strip()[<span class="hljs-built_in">len</span>(<span class="hljs-string">b&#x27;encrypt flag = &#x27;</span>):]<br>    AA = (y1**<span class="hljs-number">2</span> - y2**<span class="hljs-number">2</span> - <span class="hljs-number">2022</span>**<span class="hljs-number">3</span> + <span class="hljs-number">2023</span>**<span class="hljs-number">3</span>) * inverse(-<span class="hljs-number">1</span>, q) % q<br>    BB = (y1**<span class="hljs-number">2</span> - <span class="hljs-number">2022</span>**<span class="hljs-number">3</span> - AA * <span class="hljs-number">2022</span>) % q<br>    E = EllipticCurve(GF(q), [AA, BB])<br>    g_order = E(G).order()<br>    order_ls = factor(g_order)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] G order <span class="hljs-subst">&#123;order_ls&#125;</span>&quot;</span>)<br>    sub_group_order = <span class="hljs-number">1</span><br>    <span class="hljs-keyword">for</span> p,e <span class="hljs-keyword">in</span> order_ls:<br>        <span class="hljs-keyword">if</span> p.nbits() &lt;= <span class="hljs-number">42</span>:<br>            sub_group_order*= (p^e)<br>    expon = g_order//sub_group_order<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] <span class="hljs-subst">&#123;sub_group_order.nbits() = &#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">if</span> sub_group_order.nbits() &lt; <span class="hljs-number">120</span>:<br>        io.close()<br>        <span class="hljs-keyword">continue</span><br>    mm = discrete_log(expon*E(mG),expon*E(G),<span class="hljs-built_in">ord</span> = sub_group_order,operation = <span class="hljs-string">&quot;+&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;[+] subgroup dlp (m mod <span class="hljs-subst">&#123;sub_group_order&#125;</span>) = &quot;</span>, mm)<br>    io.close()<br>    <span class="hljs-keyword">break</span><br><br>aes = AES.new(<span class="hljs-built_in">int</span>(mm).to_bytes(<span class="hljs-number">16</span>, <span class="hljs-string">&#x27;big&#x27;</span>), AES.MODE_CBC, <span class="hljs-built_in">bytes</span>(<span class="hljs-number">16</span>))<br>flag = aes.decrypt(<span class="hljs-built_in">bytes</span>.fromhex(encflag))<br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure><h3 id="singular-attack">Singular Attack</h3><p>åˆ©ç”¨æ›²çº¿ä¸Šçš„å¥‡å¼‚ç‚¹è¿›è¡Œæ”»å‡»ï¼Œå¥‡ç‚¹å°±æ˜¯è¯¥ç‚¹å¯¼æ•°ä¸å­˜åœ¨ï¼Œæˆ–è€…å¯¼æ•°ä¸º 0ä½†ä¸æ˜¯æå€¼ç‚¹ã€‚ è‹¥æ¤­åœ†æ›²çº¿çš„åˆ¤åˆ«å¼<spanclass="math inline">\(\Delta=-16(4a^3+27b^2)\;mod\;p=0\)</span>ï¼Œè¯´æ˜è¯¥æ›²çº¿æœ‰å¥‡ç‚¹ã€‚</p><h4 id="rwctf2023-ä½“éªŒèµ›">RWCTF2023 ä½“éªŒèµ›</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">if</span> u == w:<br>    m = (<span class="hljs-number">3</span>*u*w + <span class="hljs-number">4</span>*u + <span class="hljs-number">1</span>) * i(v+x)<br></code></pre></td></tr></table></figure><p>æ ¹æ®é¢˜ç›®ï¼Œå¯å¾—åˆ°æ›²çº¿å…³äº x çš„å¯¼æ•°ï¼Œ<spanclass="math inline">\(3x^2+4x+1\)</span>ï¼Œæ‰€ä»¥å¯å¾—åˆ°æ–¹ç¨‹ä¸º<spanclass="math inline">\(y^2=x^3+2x^2+x+C\)</span></p><p>é¢˜ç›®å·²çŸ¥ç‚¹(4,10)åœ¨æ›²çº¿ä¸Šï¼Œä»£å…¥å¾—åˆ° 100 = 64 + 32 + 4 + Cï¼Œå³ C =0ï¼Œæ‰€ä»¥æ–¹ç¨‹ç¡®å®š<span class="math inline">\(y^2=x^3+2x^2+x\)</span></p><p>æ–¹ç¨‹å·¦å³æ±‚å¯¼å¾—åˆ°<span class="math inline">\(2y\frac{dy}{dx}=3x^2+4x+1\)</span>ï¼Œæ‰€ä»¥å½“ y=0 æ—¶å¯¼æ•°ä¸å­˜åœ¨ï¼Œå†æŠŠ y=0ä»£å…¥æ–¹ç¨‹ï¼Œæ±‚å¾— x=-1ï¼Œæ‰€ä»¥æ‰¾åˆ°è¯¥æ›²çº¿çš„å¥‡ç‚¹ä¸º(-1,0)ã€‚</p><p>ä¸‹ä¸€æ­¥æˆ‘ä»¬æŠŠæ›²çº¿å¹³ç§»ï¼Œä½¿å¾—æ›²çº¿ä»¥(0,0)ä¸ºå¥‡ç‚¹ï¼Œå¾—åˆ°<code>y^2 = x^3 + 193387944202565886198256260591909756040*x^2</code>ï¼Œæ”¹å†™ä¸º<code>y^2 = (x + 193387944202565886198256260591909756040) * x^2</code></p><p>å› ä¸º<code>193387944202565886198256260591909756040 = pow(89654903351345918131227153390056628523,2,p)</code>æˆ‘ä»¬å°±å¯æŠŠ Pã€Q ç‚¹æ˜ å°„åˆ°ä¹˜æ³•ç¾¤ä¸Šï¼Œä»è€Œè¿›è¡Œç®€å•çš„å¯¹æ•°è®¡ç®—ã€‚</p><p>æ˜ å°„æ³•åˆ™å¦‚ä¸‹: <spanclass="math display">\[(x,y)\rightarrow\frac{y+tx}{y-tx}\]</span></p><h4 id="exp-2">EXP</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python">p=<span class="hljs-number">193387944202565886198256260591909756041</span><br>P.&lt;x&gt; = GF(p)[]<br>f = x^<span class="hljs-number">3</span> + <span class="hljs-number">2</span>*x^<span class="hljs-number">2</span> + x<br>P = (<span class="hljs-number">4</span>, <span class="hljs-number">10</span>)<br>Q = (<span class="hljs-number">65639504587209705872811542111125696405</span>, <span class="hljs-number">125330437930804525313353306745824609665</span>)<br><span class="hljs-built_in">print</span>(f)<br>f_ = f.subs(x=x-<span class="hljs-number">1</span>)<br><span class="hljs-built_in">print</span>(f_)<br><span class="hljs-built_in">print</span> (f_.factor())<br>P_ = (P[<span class="hljs-number">0</span>] +<span class="hljs-number">1</span>, P[<span class="hljs-number">1</span>])<br>Q_ = (Q[<span class="hljs-number">0</span>] +<span class="hljs-number">1</span>, Q[<span class="hljs-number">1</span>])<br><br>t = GF(p)(<span class="hljs-number">193387944202565886198256260591909756040</span>).square_root()<br>u = (P_[<span class="hljs-number">1</span>] + t*P_[<span class="hljs-number">0</span>])/(P_[<span class="hljs-number">1</span>] - t*P_[<span class="hljs-number">0</span>]) % p<br>v = (Q_[<span class="hljs-number">1</span>] + t*Q_[<span class="hljs-number">0</span>])/(Q_[<span class="hljs-number">1</span>] - t*Q_[<span class="hljs-number">0</span>]) % p<br><span class="hljs-built_in">print</span> (v.log(u))<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ecc&quot;&gt;ECC&lt;/h1&gt;
&lt;p&gt;æ¤­åœ†æ›²çº¿å¯†ç å­¦(Elliptic Curve
Cryptography)ï¼Œæ˜¯ä¸€ç§åŸºäºæ¤­åœ†æ›²çº¿æ•°å­¦çš„å…¬é’¥å¯†ç ã€‚&lt;/p&gt;
&lt;p&gt;åŸºäº ECC
çš„ä¸‰å¤§é—®é¢˜ï¼š&lt;strong&gt;å¯†é’¥äº¤æ¢&lt;/strong&gt;ã€&lt;strong&gt;æ•°å­—ç­¾å&lt;/stro</summary>
      
    
    
    
    <category term="CTF" scheme="https://sch01ar.github.io/categories/CTF/"/>
    
    
  </entry>
  
  <entry>
    <title>Euler&#39;s Factoring to RSA</title>
    <link href="https://sch01ar.github.io/2023/04/18/Euler/"/>
    <id>https://sch01ar.github.io/2023/04/18/Euler/</id>
    <published>2023-04-18T06:05:45.000Z</published>
    <updated>2023-04-18T10:39:11.334Z</updated>
    
    <content type="html"><![CDATA[<h1 id="eulers-factoring-to-rsa">Euler's Factoring to RSA</h1><h2 id="outline">Outline</h2><p>å¯¹äº RSA ä¸­<spanclass="math inline">\(N=(ma^2+nb^2)(mc^2+nd^2)\)</span>çš„æƒ…å†µè¿›è¡Œåˆ†æä»¥åŠå®‰å…¨æ€§è¯„æµ‹ã€‚</p><h2 id="eulers-factorization-method">Euler's factorization method</h2><p>æ¬§æ‹‰å› å¼åˆ†è§£æ³•æ˜¯é€šè¿‡ä¸¤ç§æ–¹å¼å°†æ•°å­—å†™æˆä¸¤ä¸ªå¹³æ–¹å’Œæ¥åˆ†è§£æ•°å­—çš„æ–¹æ³•ï¼Œå¯¹äºä¸€ä¸ªåˆæ•°<spanclass="math inline">\(N\)</span>æ¥è¯´ï¼Œè‹¥<spanclass="math inline">\(N=a^2+b^2\)</span>ï¼Œåˆ™å¯ä»¥å°†<spanclass="math inline">\(N\)</span>è¿›è¡Œå› å¼åˆ†è§£ï¼Œä¾‹å¦‚<spanclass="math inline">\(1000009=1000^2+3^2=972^2+235^2=293\cdot3413\)</span></p><h2 id="theoretical-basis">Theoretical basis</h2><p><strong>Brahmagupta-Fibonacci æ’ç­‰å¼</strong> <spanclass="math display">\[(a^2+b^2)(c^2+d^2)=(ac-bd)^2+(ad+bc)^2=(ac+bd)^2+(ad-bc)^2\]</span></p><h2 id="proof">Proof</h2><p><img src="/img/Euler.jpg" /></p><p><span class="math display">\[a-c=kl\]</span> <spanclass="math display">\[d-b=km\]</span> <spanclass="math display">\[a+c=hm\]</span> <spanclass="math display">\[d+b=hl\]</span> è¿ç”¨<strong>Brahmagupta-Fibonacciæ’ç­‰å¼</strong> <spanclass="math display">\[(k^2+h^2)(l^2+m^2)=(kl+hm)^2+(km-hl)^2=((a-c)+(a+c))^2+((d-b)-(d+b))^2=4a^2+4b^2=4n\]</span>æ‰€ä»¥å¾—åˆ° <spanclass="math display">\[n=((\frac{k}{2})^2+(\frac{h}{2})^2)(l^2+m^2)\]</span>åç»­æ±‚è§£å¦‚ä¸‹ï¼š <spanclass="math display">\[khl^2+khm^2=(a-c)(d+b)+(a+c)(d-b)\]</span> <spanclass="math display">\[kh(l^2+m^2)=2ad-2bc\]</span> <spanclass="math display">\[l^2+m^2=GCD(ad-bc,n)\]</span></p><h2 id="generally">Generally</h2><p>å¯¹äºæ›´ä¸€èˆ¬çš„<span class="math inline">\(N\)</span>æ¥è¯´ï¼Œå¦‚æœ<spanclass="math inline">\(N=ma^2+nb^2=mc^2+nd^2\)</span>çš„æƒ…å†µåº”ç”¨<strong>æ¬§æ‹‰åˆ†è§£</strong>æ˜¯å¦å¯ä»¥è¿›è¡Œï¼Ÿå½“ç„¶æ˜¯å¯ä»¥çš„ï¼Œä½†å¯æƒœæ¬§æ‹‰åœ¨ 1891 å¹´å¤±å»äº†ç”Ÿå‘½ï¼Œæ²¡èƒ½ç»§ç»­è¿›è¡Œä»–çš„ç ”ç©¶ã€‚åä¸–Lucas å’Œ Mathews å…ˆåå¯¹è¿™æ ·çš„æƒ…å†µè¿›è¡Œäº†åˆ†ææ¨å¯¼ï¼Œè¯æ˜äº†<spanclass="math inline">\(N\)</span>æ˜¯å¯åˆ†è§£çš„ã€‚</p><h2 id="my-proof">My proof</h2><p>å¯¹äº<span class="math inline">\(a,b,c,d,m,n\in\mathbb{Z}^+,å¹¶ä¸”gcd(ma,nb)=gcd(mc,nd)=1\)</span> <spanclass="math display">\[N=ma^2+nb^2=mc^2+nd^2\]</span> <spanclass="math display">\[N=\frac{1}{2}[m(a^2+c^2)+n(b^2+d^2)]\]</span></p><p><spanclass="math display">\[N(d^2-b^2)=\frac{1}{2}(ma^2d^2+mc^2d^2+nb^2d^2+nd^4-ma^2b^2-mc^2b^2-nb^4-nb^2d^2)\]</span><span class="math display">\[\because n(d^2-b^2)=m(a^2-c^2)\]</span></p><p><span class="math display">\[\thereforeN=\frac{1}{2}[ma^2d^2-mb^2c^2+mc^2d^2-ma^2b^2+m(a^2-c^2)(d^2+b^2)]\]</span><span class="math display">\[N=m(ad+bc)(ad-bc)\]</span>æˆ‘ä»¬è¿˜éœ€è¦å¦å¤–ä¸€ä¸ªç­‰å¼ï¼Œè¿ç”¨<strong>Brahmagupta-Fibonacciæ’ç­‰å¼</strong>å¾—åˆ° <spanclass="math display">\[N^2=(ma^2+nb^2)(mc^2+nd^2)\]</span> <spanclass="math display">\[N^2=(mac-nbd)^2+mn(ad+bc)^2\]</span> å› ä¸º<spanclass="math inline">\(gcd(m,N)=1\)</span>,ç”±æ­¤å¾—åˆ° <spanclass="math display">\[N=gcd(N,ad-bc)*\frac{N}{gcd(N,ad-bc)}\]</span></p><h2 id="apply-to-rsa">Apply to RSA</h2><p>åœ¨ RSA ä¼ ç»ŸåŠ å¯†ä¸­æˆ‘ä»¬çŸ¥é“ï¼Œ<spanclass="math inline">\(N\)</span>çš„é€‰å–å°¤ä¸ºé‡è¦ï¼Œå¦‚æœé€‰å–çš„<spanclass="math inline">\(N\)</span>æ˜“äºåˆ†è§£ï¼Œé‚£ä¹ˆæ˜æ–‡å°†ä¸å†å®‰å…¨ã€‚ å¯¹äº<spanclass="math inline">\(N=(ma^2+nb^2)(mc^2+nd^2)\)</span>ï¼Œå³<spanclass="math inline">\(p=ma^2+nb^2,q=mc^2+nd^2\)</span></p><p>é’ˆå¯¹è¿™ç§çœ‹ä¼¼æ•°å­—å¾ˆå¤§çš„<spanclass="math inline">\(N\)</span>,ä¸‹é¢è¿›è¡Œä¸€äº›å®é™…çš„ä»£ç ç”Ÿæˆä¸æ”»å‡»ã€‚</p><h3 id="pq_generate">Pã€Q_generate</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">genprime</span>(<span class="hljs-params">m,n</span>):<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        x = random.getrandbits(<span class="hljs-number">150</span>)<br>        y = random.getrandbits(<span class="hljs-number">150</span>)<br>        p = m*x ** <span class="hljs-number">2</span> +  n*y ** <span class="hljs-number">2</span><br>        <span class="hljs-keyword">if</span> isPrime(p) :<br>            <span class="hljs-keyword">return</span> p, x, y<br></code></pre></td></tr></table></figure><h3 id="abcd_generate">abcd_generate</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    m = getPrime(<span class="hljs-number">212</span>)<br>    n = getPrime(<span class="hljs-number">212</span>)<br>    p, xp, yp = genprime(m,n)<br>    q, xq, yq = genprime(m,n)<br>    N = p * q<br>    a = <span class="hljs-built_in">abs</span>(m*xp * xq - n * yp * yq)<br>    b = <span class="hljs-built_in">abs</span>(xp * yq + xq * yp)<br>    <span class="hljs-keyword">assert</span> N == a ** <span class="hljs-number">2</span> + m*n * b ** <span class="hljs-number">2</span><br>    c = <span class="hljs-built_in">abs</span>(m*xp * xq + n * yp * yq)<br>    d = <span class="hljs-built_in">abs</span>(xp * yq - xq * yp)<br>    <span class="hljs-keyword">assert</span> N == c ** <span class="hljs-number">2</span> + m*n * d ** <span class="hljs-number">2</span><br>    <span class="hljs-keyword">if</span> a.bit_length() &lt;= <span class="hljs-number">512</span> <span class="hljs-keyword">and</span> b.bit_length() &lt;= <span class="hljs-number">300</span> <span class="hljs-keyword">and</span> c.bit_length() &lt;= <span class="hljs-number">512</span> <span class="hljs-keyword">and</span> d.bit_length() &lt;= <span class="hljs-number">300</span>:<br>        <span class="hljs-keyword">break</span><br><br></code></pre></td></tr></table></figure><h3 id="encrypt">Encrypt</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">flag = <span class="hljs-string">b&quot;you_have_already_understood_this&quot;</span><br>N = p*q<br>e=<span class="hljs-number">65537</span><br>msg = bytes_to_long(flag)<br>Cipher = <span class="hljs-built_in">pow</span>(msg,e,N)<br></code></pre></td></tr></table></figure><h3 id="attack">Attack</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">p=GCD(a*d-b*c,N)<br>q=N//p<br>d=gmpy2.invert(e,(p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>))<br>msg=long_to_bytes(<span class="hljs-built_in">pow</span>(Cipher,d,N))<br><span class="hljs-built_in">print</span>(msg)<br><span class="hljs-comment"># b&#x27;you_have_already_understood_this&#x27;</span><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;eulers-factoring-to-rsa&quot;&gt;Euler&#39;s Factoring to RSA&lt;/h1&gt;
&lt;h2 id=&quot;outline&quot;&gt;Outline&lt;/h2&gt;
&lt;p&gt;å¯¹äº RSA ä¸­&lt;span
class=&quot;math inline&quot;&gt;\(N=(ma^2+</summary>
      
    
    
    
    <category term="CTF" scheme="https://sch01ar.github.io/categories/CTF/"/>
    
    
  </entry>
  
  <entry>
    <title>NSSCTF Round11</title>
    <link href="https://sch01ar.github.io/2023/04/08/NSSCTFRound11/"/>
    <id>https://sch01ar.github.io/2023/04/08/NSSCTFRound11/</id>
    <published>2023-04-08T13:05:45.000Z</published>
    <updated>2023-04-11T11:55:17.610Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€å rank æ’ç¬¬ 4ï¼Œå·®ä¸€é“ AKï¼Œå¯æƒœã€‚</p><h1 id="ez_enc">ez_enc</h1><p>é¢˜ç›®æè¿°è¯´äº†ä¸æ˜¯åŸ¹æ ¹åŠ å¯†ï¼Œæ‰€ä»¥è€ƒè™‘ AB ä¸ºäºŒè¿›åˆ¶æƒ…å†µï¼Œ192 ä½æ•°åˆ¤æ–­ï¼Œ8ä½ä¸ºä¸€ç»„ï¼Œç®€å•å†™ä¸ªè„šæœ¬è·‘å°±è¡Œã€‚<code>NSSCTF&#123;mS4gT1Kv9L8NjPzx&#125;</code></p><h1 id="mymessage2">MyMessage(2ğŸ©¸)</h1><h2 id="é¢˜ç›®">é¢˜ç›®</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> os<br><br>flag = os.getenv(<span class="hljs-string">&#x27;FLAG&#x27;</span>)<br><br>e = <span class="hljs-number">127</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sign</span>():<br>    msg = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;Input messageï¼š&quot;</span>)<br>    p = getPrime(<span class="hljs-number">512</span>)<br>    q = getPrime(<span class="hljs-number">512</span>)<br>    n = p*q<br>    c = <span class="hljs-built_in">pow</span>(bytes_to_long((msg + flag).encode()), e, n)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;n: <span class="hljs-subst">&#123;n&#125;</span>&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Token: <span class="hljs-subst">&#123;<span class="hljs-built_in">hex</span>(c)&#125;</span>&quot;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        sign()<br><br>main()<br></code></pre></td></tr></table></figure><h2 id="é¢˜è§£">é¢˜è§£</h2><p>åˆ†æä¸€ä¸‹å‘ç°æ˜¯ CRTï¼Œe æ˜¯ 127ï¼Œä¸ç®—å¾ˆå¤§ï¼Œpwntools è¿œç¨‹è¿ä¸€ä¸‹å°±å‡ºäº†ï¼Œç”¨127 ç»„ nã€c å°±èƒ½å‡ºã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">from</span> sympy.ntheory.modular <span class="hljs-keyword">import</span> crt<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> long_to_bytes<br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>r=remote(<span class="hljs-string">&quot;node1.anna.nssctf.cn&quot;</span>,<span class="hljs-string">&#x27;28993&#x27;</span>)<br>r.recv()<br>n=[]<br>c=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">127</span>):<br>    r.send(<span class="hljs-string">b&#x27;\n&#x27;</span>)<br><br>    n0=<span class="hljs-built_in">int</span>(r.recvline()[<span class="hljs-number">3</span>:])<br>    n.append(n0)<br>    c0=<span class="hljs-built_in">int</span>(r.recvline()[<span class="hljs-number">7</span>:],<span class="hljs-number">16</span>)<br>    c.append(c0)<br>    r.recv()<br>    <span class="hljs-built_in">print</span>(i)<br><br>e=<span class="hljs-number">127</span><br>resultant,mod= crt(n, c)<br><span class="hljs-built_in">print</span>(gmpy2.iroot(resultant, e))<br><span class="hljs-built_in">print</span>(long_to_bytes(<span class="hljs-number">2806865643354785603324943800380811808524058654491089619946085108629974212427336755928938684569729653368445</span>))<br><br></code></pre></td></tr></table></figure><h1 id="mygame3">MyGame(3ğŸ©¸)</h1><h2 id="é¢˜ç›®-1">é¢˜ç›®</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">import</span> string<br><br>flag = os.getenv(<span class="hljs-string">&#x27;FLAG&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">menu</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&#x27;&#x27;=---menu---=</span><br><span class="hljs-string">1. Guess</span><br><span class="hljs-string">2. Encrypt</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span>)<br><br>p = getPrime(<span class="hljs-number">512</span>)<br>q = getPrime(<span class="hljs-number">512</span>)<br>n = p*q<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">randommsg</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>.join(random.choices(string.ascii_lowercase+string.digits, k=<span class="hljs-number">30</span>))<br><br>mymsg = randommsg()<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">guess</span>():<br>    <span class="hljs-keyword">global</span> mymsg<br>    msg = <span class="hljs-built_in">input</span>()<br><br>    <span class="hljs-keyword">if</span> msg == mymsg:<br>        <span class="hljs-built_in">print</span>(flag)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(mymsg)<br>        mymsg = randommsg()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt</span>():<br>    e = random.getrandbits(<span class="hljs-number">8</span>)<br>    c = <span class="hljs-built_in">pow</span>(bytes_to_long(mymsg.encode()), e, n)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;Cipher_<span class="hljs-subst">&#123;e&#125;</span>: <span class="hljs-subst">&#123;c&#125;</span>&#x27;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;n: <span class="hljs-subst">&#123;n&#125;</span>&#x27;</span>)<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        opt = <span class="hljs-built_in">int</span>(<span class="hljs-built_in">input</span>())<br><br>        <span class="hljs-keyword">if</span> opt == <span class="hljs-number">1</span>:<br>            guess()<br>        <span class="hljs-keyword">elif</span> opt == <span class="hljs-number">2</span>:<br>            encrypt()<br><br>main()<br></code></pre></td></tr></table></figure><h2 id="é¢˜è§£-1">é¢˜è§£</h2><p>ä»”ç»†è¯»ä»£ç ï¼Œå‘ç°æ˜¯å…±æ¨¡æ”»å‡»ï¼Œæ‰¾ä¸¤ç»„ cã€e å³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> long_to_bytes<br>c1=<span class="hljs-number">20432531576155215888154008856470023176716331725918571318249616529204088736445989550189654688043730733020564485947864747196975750100435327664656429806649525534120919148246123023379811466301511729993913961801030758822865877036889575149918981442195476030813460030620757387049663845188034750154180593983566582520</span><br>e1=<span class="hljs-number">27</span><br>c2=<span class="hljs-number">49343226468934676124103999715864898108289119770186347123043696311071406231664645680952259061776732950065396078048353154283241280855775618011869819311337805185923169181212309315036973967627008736733179896379120366510464553630612190775773048857991437285631208686684892260979310870861832511307571472115286628517</span><br>e2=<span class="hljs-number">20</span><br><br>n=<span class="hljs-number">120132192877694910217679507021165646332695827464809117195210649277384674795669034856718931569263574670286802451973300796012519337781757661938081109028300520380652830599013093103694871345527473374707911919217651889156901714534844579748040213772147486709217128429189246896619833922990939367369152675847389673607</span><br><br>r,s1,s2=gmpy2.gcdext(e1,e2)<br>m=(<span class="hljs-built_in">pow</span>(c1,s1,n) * <span class="hljs-built_in">pow</span>(c2,s2,n)) %n<br><span class="hljs-built_in">print</span>(long_to_bytes(m))<br><br></code></pre></td></tr></table></figure><h1 id="ez_signin3">ez_signin(3ğŸ©¸)</h1><h2 id="é¢˜ç›®-2">é¢˜ç›®</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> flag<br><br>p = getPrime(<span class="hljs-number">512</span>)<br>q = getPrime(<span class="hljs-number">512</span>)<br><span class="hljs-keyword">assert</span> p &gt; q<br>n = p*q<br>e = <span class="hljs-number">65536</span><br>m = bytes_to_long(flag)<br>num1 = (<span class="hljs-built_in">pow</span>(p,e,n)-<span class="hljs-built_in">pow</span>(q,e,n)) % n<br>num2 = <span class="hljs-built_in">pow</span>(p-q,e,n)<br>c = <span class="hljs-built_in">pow</span>(m,e,n)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;num1=&quot;</span>,num1)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;num2=&quot;</span>,num2)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;n=&quot;</span>,n)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;c=&quot;</span>,c)<br></code></pre></td></tr></table></figure><h2 id="é¢˜è§£-2">é¢˜è§£</h2><p>ä» num1 å’Œ num2å…¥æ‰‹è¿›è¡Œæ¨å¯¼ï¼Œè¿™ç§ç±»ä¼¼æ¨å¯¼åœ¨<code>seccon</code>ä¸­çš„<code>pqpq</code>ä¹Ÿé‡åˆ°è¿‡ï¼Œé‡åˆ°p å’Œ q å’Œä¸å·®çš„æ¬¡æ–¹æ—¶è¦å–„äºå±•å¼€ã€‚ <span class="math display">\[num1=p^e- q^e \; mod \;n\]</span> <span class="math display">\[num2=(p-q)^e \;mod \;n=p^e + q^e \;mod\;n\]</span> <spanclass="math display">\[num1-num2=2q^e \;mod\;n\]</span> ä¸ n æ±‚ gcdå³å¯å¾—åˆ° qã€‚åç»­åˆå‘ç°<code>gcd(e,phi)=4</code>æˆ‘ç›´æ¥ç”¨<code>phi//4</code>å°±å‡ºäº†ï¼Œä½†çœ‹åˆ«çš„å¸ˆå‚…é¢˜è§£æ˜¯ä½¿ç”¨äº† 16 æ¬¡rabinã€‚<ahref="https://www.cnblogs.com/App1eTree#/c/subject/p/nssctf_Round11.html">App1e_Tree</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> gmpy2<br>e=<span class="hljs-number">65536</span><br><br>num1= <span class="hljs-number">77257223159958079981390137355142080015023010733827990250504328622199243866334208454700846525239387121424870112593354883264915110401096320266418705582162604997618363889158629900108704858615247007992567853124974343579594813658250285927213124866151010168331988825030114602867745638435653619050902109851045530048</span><br>num2= <span class="hljs-number">8670006639226140401848502013409874417778806171787684181700490726088123676562019413771703217181880276367622310216897452417434923879832976569809207272273038152452280440576111149210141624539176252808510923727718037881253248639329799746808602221142415191253040793180318625834835539461350068653267738595818142033</span><br>n= <span class="hljs-number">139312918646958911643614106477250346542938203733216645101706250934506039430465265284553776989331472694107269641055499427941102923536860105801322441769366401061519774361630724222802972762597316259472094210197432833307534335146157789503227756546698356309143161714893413713163015318965716763931005983883676146349</span><br>c= <span class="hljs-number">117425520472164947185011060551908800156070555958546948883959815215678093994397105451763661641181472902919466937760258731806408698523865490809605237116064587181672662857632969568595375221472415619173606876351479605389472618536640276793037520925913907146004116095678083180079715242304920764573160813391671768563</span><br>q=GCD(n,num1-num2)<br>p=n//q<br>phi=(p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)<br><span class="hljs-built_in">print</span>(GCD(phi,e))<br>d=gmpy2.invert(e,phi//<span class="hljs-number">4</span>)<br><span class="hljs-built_in">print</span>(long_to_bytes(<span class="hljs-built_in">pow</span>(c,d,n)))<br><br></code></pre></td></tr></table></figure><h1 id="ntr4">NTR(4â„ï¸)</h1><h2 id="é¢˜ç›®-3">é¢˜ç›®</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">from</span> flag <span class="hljs-keyword">import</span> flag<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">init</span>():<br>    p = getPrime(<span class="hljs-number">2048</span>)<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        x = getRandomNBitInteger(<span class="hljs-number">1024</span>)<br>        y = getPrime(<span class="hljs-number">768</span>)<br>        z = gmpy2.invert(x, p) * y % p<br>        <span class="hljs-keyword">return</span> (p, x, y, z)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt</span>(<span class="hljs-params">cipher, p, z</span>):<br>    message = bytes_to_long(cipher)<br>    r = getRandomNBitInteger(<span class="hljs-number">1024</span>)<br>    c = (r * z + message) % p<br>    <span class="hljs-keyword">return</span> c<br><br>p, x, y, z = init()<br>c = encrypt(flag, p, z)<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;cipher.txt&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    f.write(<span class="hljs-string">&quot;binz = &quot;</span> + <span class="hljs-built_in">str</span>(<span class="hljs-built_in">bin</span>(z)) + <span class="hljs-string">&quot;\n&quot;</span>)<br>    f.write(<span class="hljs-string">&quot;binp = &quot;</span> + <span class="hljs-built_in">str</span>(<span class="hljs-built_in">bin</span>(p)) + <span class="hljs-string">&quot;\n&quot;</span>)<br>    f.write(<span class="hljs-string">&quot;binc = &quot;</span> + <span class="hljs-built_in">str</span>(<span class="hljs-built_in">bin</span>(c)) + <span class="hljs-string">&quot;\n&quot;</span>)<br></code></pre></td></tr></table></figure><h2 id="é¢˜è§£-3">é¢˜è§£</h2><p>åŸºç¡€ NTRU æ ¼å¯†ç ï¼Œå…·ä½“æ¨å¯¼å¯çœ‹å‰å‡ ç¯‡åšå®¢ DUTCTF çš„ ez_RSA</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br>z=<span class="hljs-number">0b10101100101100011011110010110100101000101001111100110011110110010001000011100001001001111000111110000010010010111110001011111100111101010111001100100111100100111001011011110010100010100010110111101101011101111111110010000000010110011010011110000011000001111110001110111111001100001100101001010101100011100001101001101011011101110001000111001010111111110000010111100111011010011001111100111111101000010111111011010100110111000001011000001111010100000000101010110000100000111000000010001101110001101000111001010111111101100111110000011001110100011100011101000101111010111000111100010001101001101100000111010110100000001101100010001000011111100111110001010000010110110110010001110010100000000101111101100010000111011011101111110100001000011001101001110110011110000110011100010010011010011001110100010110001011110100100101110101001000011100100100000001001011010011001110001000111101101110110010011110000010110000110111000111100010101100010100100101101100000111100001010000101010111001000111111000111100111011111110011001000000110000000110111101000010111001100111100010010100010001111011100110110111101111001010101110001000001110101110101100101001101100100101011010000011111111110111101001100001000111010000111110000001010100100101111010110001000111010100011110100000000100100001101001000101100111001110010010011110010000101101010011101000110000001101010010011000010110111101001011010011010000001010110001100100000001111001100000000100100100010010101011110100001010010110001101001111000100100110001011111000101110011100110010111001110100010000111001110101000101110101110110100100110110111000100110011111110011100111100111100011001101010011110000101000100110010000000000111101111000001100000100110010100100111001011011011100100011110001010001111011111011000010010011101110000011101101110001111100011100101011001000101110010110011100110000100101010001010111011001000011001101000011111100010001111001100001111100011001010111010010110001110110111111010011010111011010000110110100100011010111000110011010010001100011011010100111011101011000010110000110001010</span><br>p=<span class="hljs-number">0b10111111010111000101011100010100001001011110111101011011010110110000010011111101110011100111001101110111010101000001111111111000101100111000110010000110101001110100000000011100001111101000101110010101110011110101100011111111110000110001101101110100100111100101101100110001001101110010010100010011100011111000001000001100001110000011010000111001000000111010000001001101101100110111001111110000111000110001011111000010011101110010101011100110011000111100111100000001100101011001000110001111000010011111110010101010111001111000111011011110110100011011010110000011100101100100010001011011111100100011001101011110100100000011011110110110011111000110001000010010001111001111100101000101101011011110111010111101110000011100000100010001010100000011000110001011001000101011101011101011111010010010110101000111111110011010100000010001000011111100100110001000010011111000111010100111000101100011100111110100111000101011010101010101111111010011101001110011101101001100100010100000110011101111100000011101010001010001011000101011001111010000000000010100001101010010011011000000010000111010000001000111101001001000011000011100101100011010100111010010111110110100011101100000000110001011101110100100011011110101010010010001101100001011000001101010110110101110100110110011110011110011100001000000011101000000010011101001001001111111001010100111111110101000110011010110001101011101011111100100001011001111100010001100011011010100111100111000100010000011100100001010111100001100011001010001111001001001110011100100010111000001110001000110101110011100100000101000100010011011011001011010010101111001110101000011001111000101111011011101001101001111100111001111011100110100100011000010010100000110001010110000100111110101001111100100101001101101000100001001011011011000101100111101100011110011011101001010110101001100100100010010100011111000010110101010101011110100011000011000001111001100000110010110101110100101100010100010001001101000110110111101110100000001001001000010010001101101001011000101111101011110001101010101110111111101101100101110011011010000100110111011</span><br>c=<span class="hljs-number">0b1100000111101010011111101100110110001100001111110010001011011110011111000011111010010111110100010001110000101100101010100010001001011110001100000101100111010010001001000011010110100100100100101010001100011010111111010101011010111000010010111101110101001010110000101101010010011100000100010110011011010001111101000111000100101011011011101100001011100101001101100000010100001100010111010110101001100110101000000101110111111001011000011100100101110010000000110010111100001000111110111011111011011111100101011000110000000011001101010111001101010100011000011100001000010000001100011100110110000010111100101011110010110011100000111001010000101010001000001101101100010000101100111111100110010100001011110101111001000101111111010100100110011011001101101000010000111110010100100100111100110100110011011000011101110010111011111110100110011010110100010101000011111001111000100001000011011000010000001010011111001111010000000110111011000110001100110010101000101110110101000001101001000001011000110011011011010111011011101100101011101010110101111100010101000010100001010011101010101001100000010000000001111111100100100011011110001001010010110001000101111011101010101100001011111101100101000100010100010100000001111101000111110101111111100001011111001010101001011000011011100001011100010100111100100110101111011001011001011100001011111110100001111011101001000001110110011101111101011000010110011111011001100011000111010101111000101001100010010001101110111011111101110111110001000111111001111010101110100111001001001000100111111111111100010100111110110001111010011001111010001000010110000000101100001000111010101010100000111110111110011010001100001101111010111110010010011001111001100111010010011010010101100111011100001011110111100001000101101000111001000001011000010111010101011110011100001010001100110011101011000000110001010011110010100011100000101111000110110110000001011010110010000001001111100001010010010001101111011010111000100001011111010111001000000011101001001111001011101010100001100010101001011010110111011010010100100100101011111100110111110111</span><br>h=z<br><br>M = Matrix([[<span class="hljs-number">1</span>, h], [<span class="hljs-number">0</span>, p]])<br>fg = M.LLL()[<span class="hljs-number">0</span>]<br>f, g = <span class="hljs-built_in">abs</span>(fg[<span class="hljs-number">0</span>]), <span class="hljs-built_in">abs</span>(fg[<span class="hljs-number">1</span>])<br>a = f * c % p<br>E = a * gmpy2.invert(f, g)%g<br><span class="hljs-built_in">print</span>(f.bit_length())<br><span class="hljs-built_in">print</span>(long_to_bytes(E))<br></code></pre></td></tr></table></figure><h1 id="ez_facæœªå‡º">ez_fac(æœªå‡º)</h1><h2 id="é¢˜ç›®-4">é¢˜ç›®</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> flag,a0,a1,b0,b1<br><br>p = getPrime(<span class="hljs-number">512</span>)<br>q = getPrime(<span class="hljs-number">512</span>)<br>e = getPrime(<span class="hljs-number">128</span>)<br>n = p*q<br><span class="hljs-keyword">assert</span> <span class="hljs-built_in">pow</span>(a0,<span class="hljs-number">2</span>) + e * <span class="hljs-built_in">pow</span>(b0,<span class="hljs-number">2</span>) == n<br><span class="hljs-keyword">assert</span> <span class="hljs-built_in">pow</span>(a1,<span class="hljs-number">2</span>) + e * <span class="hljs-built_in">pow</span>(b1,<span class="hljs-number">2</span>) == n<br>m = bytes_to_long(flag)<br>c = <span class="hljs-built_in">pow</span>(m,e,n)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;c=&quot;</span>,c)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;n=&quot;</span>,n)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;a0=&quot;</span>,a0)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;a1=&quot;</span>,a1)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;b0=&quot;</span>,b0)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;b1=&quot;</span>,b1)<br></code></pre></td></tr></table></figure><h2 id="é¢˜è§£-4">é¢˜è§£</h2><p>èµ›åè‡ªå·±æ¨äº†ä¸€ä¸‹ï¼Œæ¬§æ‹‰å…¬å¼åˆ†è§£ <img src="/img/Euler.jpg" /> å› æ­¤æœ‰<span class="math display">\[a-c=kl\]</span> <spanclass="math display">\[d-b=km\]</span> <spanclass="math display">\[a+c=hm\]</span> <spanclass="math display">\[d+b=hl\]</span>æ¨åˆ°è¿™æ­¥ä¹‹åï¼Œè¿ç”¨<code>Brahmagupta-Fibonacci</code>æ’ç­‰å¼ï¼Œå¾—åˆ° <spanclass="math display">\[n=((\frac{k}{2})^2+(\frac{h}{2})^2)(l^2+m^2)\]</span></p><p><spanclass="math display">\[khl^2+khm^2=(a-c)(d+b)+(a+c)(d-b)\]</span> <spanclass="math display">\[kh(l^2+m^2)=2ad-2bc\]</span> <spanclass="math display">\[l^2+m^2=GCD(ad-bc,n)\]</span>æ‰€ä»¥å¯¹åº”åˆ°æœ¬é¢˜å½“ä¸­ï¼Œ<code>p=GCD((a0*b1-a1*b0),n)</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> gmpy2<br><br>c= <span class="hljs-number">59318036714789752844006238692725062195097217062554867007780992204804450969142204391316045272560233388274742342095873063037352032862624199553582149985170237070779964129236530514163078045059943014170914727745788332060644178009630719416607144479458704906477608582501903047686165816474471957589874497851401996299</span><br>n= <span class="hljs-number">137668242641076635664648797843242668120238355343016879645699934379078238840410583671764334209483740737808707460147728851168032552228765759429988090828780489149204937220494635170377998778905602318559649339660536303852604291303891241968251882157710174648060585737047441793290567655691681568937436184102493026497</span><br>a0= <span class="hljs-number">11733211096757640611023179466137568647194748846209714362630723124944554158026265927220172817593295793460531810586641675319307669405413132181412592532359680</span><br>a1= <span class="hljs-number">11733211096757640611023178103076370448537803344455852236399317962314322115993820094669322043912570063235179770967045735659217853855020241135449964093477392</span><br>b0= <span class="hljs-number">16952448082892650701908860033061048276853071047612576981620233993855951344312992860690440851309510652705695741073983670611</span><br>b1= <span class="hljs-number">307989142448102248940629255335003301679438459116674689074678317519163453142223887826928430255723118986268767245966808235987</span><br>e=(n-<span class="hljs-built_in">pow</span>(a0,<span class="hljs-number">2</span>))//<span class="hljs-built_in">pow</span>(b0,<span class="hljs-number">2</span>)<br><span class="hljs-keyword">assert</span> <span class="hljs-built_in">pow</span>(a0,<span class="hljs-number">2</span>) + e * <span class="hljs-built_in">pow</span>(b0,<span class="hljs-number">2</span>) == n<br>p=GCD((a0*b1-a1*b0),n)<br>q=n//p<br>phi=(p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)<br>d=gmpy2.invert(e,phi)<br><span class="hljs-built_in">print</span>(long_to_bytes(<span class="hljs-built_in">pow</span>(c,d,n)))<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;æœ€å rank æ’ç¬¬ 4ï¼Œå·®ä¸€é“ AKï¼Œå¯æƒœã€‚&lt;/p&gt;
&lt;h1 id=&quot;ez_enc&quot;&gt;ez_enc&lt;/h1&gt;
&lt;p&gt;é¢˜ç›®æè¿°è¯´äº†ä¸æ˜¯åŸ¹æ ¹åŠ å¯†ï¼Œæ‰€ä»¥è€ƒè™‘ AB ä¸ºäºŒè¿›åˆ¶æƒ…å†µï¼Œ192 ä½æ•°åˆ¤æ–­ï¼Œ8
ä½ä¸ºä¸€ç»„ï¼Œç®€å•å†™ä¸ªè„šæœ¬è·‘å°±è¡Œã€‚&lt;code&gt;NSSCTF&amp;#123;mS4gT1</summary>
      
    
    
    
    <category term="CTF" scheme="https://sch01ar.github.io/categories/CTF/"/>
    
    
  </entry>
  
  <entry>
    <title>NKCTF2023</title>
    <link href="https://sch01ar.github.io/2023/04/04/2023NKCTF/"/>
    <id>https://sch01ar.github.io/2023/04/04/2023NKCTF/</id>
    <published>2023-04-04T02:05:45.000Z</published>
    <updated>2023-04-27T01:01:03.377Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ•°å­—ä¸­å›½-babysecret">æ•°å­—ä¸­å›½ Babysecret</h1><p>é¢˜ç›®</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> secrets <span class="hljs-keyword">import</span> flag<br><span class="hljs-keyword">assert</span> <span class="hljs-built_in">len</span>(flag) == <span class="hljs-number">38</span><br>t = <span class="hljs-number">30</span><br>p = getPrime(<span class="hljs-number">512</span>)<br>x = getPrime(<span class="hljs-number">512</span>)<br><span class="hljs-keyword">while</span> x &gt; p:<br>    x = getPrime(<span class="hljs-number">512</span>)<br>rs = []<br>cs = []<br>ss = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(t):<br>    r = getPrime(<span class="hljs-number">512</span>)<br>    s = getPrime(<span class="hljs-number">400</span>)<br>    c = (r * x + s) % p<br>    rs.append(r)<br>    cs.append(c)<br>    ss.append(s)<br><br>enc = <span class="hljs-built_in">pow</span>(x,flag,p)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;p = <span class="hljs-subst">&#123;p&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;rs = <span class="hljs-subst">&#123;rs&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;cs = <span class="hljs-subst">&#123;cs&#125;</span>&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;enc = <span class="hljs-subst">&#123;enc&#125;</span>&#x27;</span>)<br><br><span class="hljs-comment"># p = 6897108443075981744484758716081045417854227543713106404294789655180105457499042179717447342593790180943415014044830872925165163457476209819356694244840079</span><br><span class="hljs-comment"># rs = [12844634549263053228759749264403637022740290008286987401585068952741935277415527678380021212624846722242500708422759563558995936977274580301379494195702461, 12251634003683452916928102291170339939586644029776192301741341674585154859358419625191986830852794085541953563738986709807899575511700135958334229151930861, 7051370666077542197248638013011793824477073777322219545882367881807130066168444134964571398112151848834032654978368255218649720738040945429837692857031957, 9773046862351952930368505593284546267554571295872377323111558071278701231472975791962979256551519533723988556870551885073742407630481198192389750289392107, 8883776497660138308720006912582738672888752344326928153810910221453595077711284302041512529457450211602787210761461172326429880594024187025419873043435877, 12056735137145460036580841038332100311160368843873164649606343042416896898793233249873902218683966283969721460087390120622254758027779960740926123005377571, 8819958747150954554494406068232243249186433676383469322817152210037563032056202909377825740775383087605647374150477096718956454225946093710691864988563109, 12246023449098354751049599873213988024512286270964608502444597112110163392131757813461977030270733012385926751192637938686124570227538910606279104888073013, 11308837998867241929817950595621831002334468993828126438599805989088017326675963100044309448653090403889186401929445861220402556074702741108929442867300279, 9184622887414209361516593101129556569811888214607556630094969763910426953786020755838094184972397480276666170685926425137063559394969166216392939257091541, 12896400069515890897430087815982545671830645201023665112429779640768899091287291452408369445919464144390726200808875066389240126909811239597092893733457339, 11227025698697471809912850435140886785315702278826761054472525227951791647003561270585720797267604996360933395122286757099101227901032364782594523739698877, 8162123490656317490361880020667919072708091053716891870691544217490126444997503404094174246087938828993696335191488583306443577208796794274099282013427247, 13366989889442670291461262313757977600095962057470863475519088648267301129719953368943419562144276679400967122727554764013132918505564677243979978807323041, 9920857455945408588203972193444437533164351309299040911469275059092031755811492460585653948481522995557801781838215407648572999358456612525812067538372579, 7139402473546047825312503780125417567716958846513076797328672521987900978293260385267945187604725349720103672258987935569856239987227455748213833342843243, 13108142660294572752252393081421368493392921884487755391460006730258159004638343897340537616297811742032405724656497443006056456690449881719305597286675631, 13276762958403786077380090195631980415297280849950287990717193547481553124160398455403123819234755237450529090601858784999113026218918277529515287668651121, 12463094640052886550696551772104539361264529587569204472038955376345085195998921095774583176899949596998985033050547755235409943131811058035802010421860899, 11307743131694864808301935844724645695851330736969875190167422024500753079857478680029193758960169072890576310607053767920339034290416580654771095674487943, 10053742503547378455068966704402695956702795408343604912294923217443553169726438945982031485796964462946592530592946335569560364464958066521486506177193131, 9703695763451799125258961776229325510814289358679213305418559381901496449849584244211834872313767844996255556721041007654625153809128987422992102292472533, 8148189465927721940294369879439913703690047528695196368949823197675716174991296513758196009346701553643721225250628151384047219921709201619262393792138023, 9114150910964237818418367840207724528917302406836157928223872622442928604249864486858755737149640683259834299165900696585038569188627682022002709058902291, 12273514376180781903469287345188404399033432117915094289694407562166649079228640510678711431664410226301556172582177240184695103942141430877677144285616059, 8355005721684425514882933910286584148305344580589623112959517428993968438533866906223777778058096962333203237111245328436600994120168924143849685728268811, 8957883838807471492147480816683526636019698464133185237668243268667169800811696770484487123560197988448434475112352005768286417529319182162245840523697001, 12168542584724814356632409768687396920143300559579648963851924568387314914334359305942685551210180448419674060219496395116081866784918059237133414041227833, 12285935007930825571672128346804313607196190465690759870758278705086034778808662886056460827935986285259185071514490942831585313190946386878622608868345563, 7719913817859572377164973343651155934060296607908537845256755472465025202751239980758950094865067751407889569369974011139801401586939119147773466111699913]</span><br><span class="hljs-comment"># cs = [3911325901261770731066343727353093385607196883601022244426857460074338420692610012414571623512152485474248169220030587839849722757773859682519433853455847, 4198555117325325874584019691418573071733167640213933749582347442518997588452211673143722179281773602455507001395983681009769848414007206268682184816168744, 4422173666634983234895098798813962037875417568235708524339826709271381748884936178371767574064794177416615710120223914725873239836121654705208614576413533, 3540260422555697887869627546208164711550015909378340105077652177481959576550678379723450981807556863572610759824660630418670546203733170058626755080797998, 6451498467498935201092514865627931677091078787997097414208430992183264950579022373372254486595458117887305393317663712337699331503725124287017134808484874, 3439629581963524351810430910737336124616316641656190641248434504621774235943514617301857917041111617104850245148746427180069743940612560718213177903427306, 4279468191481832212496939242093486044278976937965085475567008228061184947513156012369586970486543083130565628906296600553024574099481246534878242920637212, 4102135455518061133919027670571325279976222647984452353051395864554309521223498761823084717077102213648612826513661629599971609555235760152049549057234342, 329051927890365028889097463563711966673066795688728876214731188783168691555262156515161429328581094087585127929869064685419149676592073496155898360311360, 1674347209896897571502352451063188834938904430329951752111921115230349947823188121972980025563878887201507629419811736910690965020923751424101521816057970, 4779084317811375050159574994746297486592271247137823471375199626788956576998627181220489952507937768042501203098391966702297812537463211799837921684467541, 5240331815784322792144549873873658636726233093228415489098002982220769676718681132737794994708716389174162820721646744776624413735318240597745363490427584, 2689716894922604875455207695253665212853470308341743040957367957727155614199743562225147359614514189877983156892749669804800163252617480446565479990148021, 449708769594599088851244243076921016853502252396793496349534051273454215985560340288452398756880916680293627457774430655982228613348249480600180821975835, 1584603978331289335352997151059666773277943458357161051278658090420067023680231414255557805410288144092653121568766136372728095300982743309696347031121424, 4874260053151700374809337053763032489184725334196495160358275038586824027920238733886703163018450814805937363825223459277373073591021082276610135118976834, 3524374131362906900545297291947110177298862564718451821839794960169356082042548386553363480921097452902723033854749443288682983558847052843293666815425196, 6544123591499569232021913370293570477776709315008783531720886545784773471486769240711262562401683145937715612435213816372680189321141928790509490282629891, 4873861166228118967099569086478548167127431415017791678812419676791754466935832034870862000658789609084166891933970013849850146718379819943737269970654866, 4100817874436703071716655163972145036104985973164830547825929590871920825981241934633977227547934514142660786061291026657802357404024236287955309372489516, 343238276681348130286495167739162902430650061145485619903964358840996341335935043000395056684771452815629410388891486531126938900311458948803147120186532, 2683710724350412998770392318832434885304538325033159937379489319924346689197445720734209841902612235485016866254994045969716413020197296428323832404151182, 5909464641105704179999104311562416363090166762341644691188169716182958971270396007422581429813172933930581475771306034495224054972725230757675444731953480, 105593489999747649490909471306354863316673821363863362258853043970534652401274789197677558215188249074837829003335733211890211648501689656345824858507373, 4992379366542645691375959247465888889778118153982142100956809440855745659745235576280578316185469306620017845690312554043770651058126536040173113949524396, 6533456398244789907636779407045515567135195474284185379689518387558345997627435421582437390053234675991361808532278264077968540197407743744279106871716267, 5169360398767270275853790242315213671633880428212603766301308853363063092609582572957561138022806887895634140899640025570759919257615537375706008159680239, 203310740924699994885931266978520636166917734618272844754878785050509801614513144739164450834936178065792112797202959106365282699245578309060905297742706, 3143563289239398127009575193211845399079310618985464994769603542400451633289266080869317336163844517539211542909055869608349639432145332113320465388067087, 4016252180207572047405081190649590978593306403200098541033213590567723751195926093369984531729148621419589009515870336049849542537363832071754623330736088]</span><br><span class="hljs-comment"># enc = 1315637864146686255246675143589215932218700984880749264689270214639479160648747323586062096067740047809798944996253169402675772469028914904598116394230426</span><br><br></code></pre></td></tr></table></figure><p><spanclass="math inline">\(enc=pow(x,flag,p)\)</span>,ç¦»æ•£å¯¹æ•°é—®é¢˜ï¼Œpæ˜¯å…‰æ»‘çš„ï¼Œåç»­å¯é€šè¿‡ PH æ±‚è§£ï¼Œä½† x æœªçŸ¥</p><p><span class="math inline">\(c=(rx+s)\;mod\;p\)</span>,c å’Œ r æ˜¯ 30ä½çš„å‘é‡ï¼Œé€šè¿‡ LWE æ±‚è§£ x å³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">from</span> sage.modules.free_module_integer <span class="hljs-keyword">import</span> IntegerLattice<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> hashlib<br>row = <span class="hljs-number">30</span><br>column = <span class="hljs-number">1</span><br>p = <span class="hljs-number">6897108443075981744484758716081045417854227543713106404294789655180105457499042179717447342593790180943415014044830872925165163457476209819356694244840079</span><br>rs = [<span class="hljs-number">12844634549263053228759749264403637022740290008286987401585068952741935277415527678380021212624846722242500708422759563558995936977274580301379494195702461</span>, <span class="hljs-number">12251634003683452916928102291170339939586644029776192301741341674585154859358419625191986830852794085541953563738986709807899575511700135958334229151930861</span>, <span class="hljs-number">7051370666077542197248638013011793824477073777322219545882367881807130066168444134964571398112151848834032654978368255218649720738040945429837692857031957</span>, <span class="hljs-number">9773046862351952930368505593284546267554571295872377323111558071278701231472975791962979256551519533723988556870551885073742407630481198192389750289392107</span>, <span class="hljs-number">8883776497660138308720006912582738672888752344326928153810910221453595077711284302041512529457450211602787210761461172326429880594024187025419873043435877</span>, <span class="hljs-number">12056735137145460036580841038332100311160368843873164649606343042416896898793233249873902218683966283969721460087390120622254758027779960740926123005377571</span>, <span class="hljs-number">8819958747150954554494406068232243249186433676383469322817152210037563032056202909377825740775383087605647374150477096718956454225946093710691864988563109</span>, <span class="hljs-number">12246023449098354751049599873213988024512286270964608502444597112110163392131757813461977030270733012385926751192637938686124570227538910606279104888073013</span>, <span class="hljs-number">11308837998867241929817950595621831002334468993828126438599805989088017326675963100044309448653090403889186401929445861220402556074702741108929442867300279</span>, <span class="hljs-number">9184622887414209361516593101129556569811888214607556630094969763910426953786020755838094184972397480276666170685926425137063559394969166216392939257091541</span>, <span class="hljs-number">12896400069515890897430087815982545671830645201023665112429779640768899091287291452408369445919464144390726200808875066389240126909811239597092893733457339</span>, <span class="hljs-number">11227025698697471809912850435140886785315702278826761054472525227951791647003561270585720797267604996360933395122286757099101227901032364782594523739698877</span>, <span class="hljs-number">8162123490656317490361880020667919072708091053716891870691544217490126444997503404094174246087938828993696335191488583306443577208796794274099282013427247</span>, <span class="hljs-number">13366989889442670291461262313757977600095962057470863475519088648267301129719953368943419562144276679400967122727554764013132918505564677243979978807323041</span>, <span class="hljs-number">9920857455945408588203972193444437533164351309299040911469275059092031755811492460585653948481522995557801781838215407648572999358456612525812067538372579</span>, <span class="hljs-number">7139402473546047825312503780125417567716958846513076797328672521987900978293260385267945187604725349720103672258987935569856239987227455748213833342843243</span>, <span class="hljs-number">13108142660294572752252393081421368493392921884487755391460006730258159004638343897340537616297811742032405724656497443006056456690449881719305597286675631</span>, <span class="hljs-number">13276762958403786077380090195631980415297280849950287990717193547481553124160398455403123819234755237450529090601858784999113026218918277529515287668651121</span>, <span class="hljs-number">12463094640052886550696551772104539361264529587569204472038955376345085195998921095774583176899949596998985033050547755235409943131811058035802010421860899</span>, <span class="hljs-number">11307743131694864808301935844724645695851330736969875190167422024500753079857478680029193758960169072890576310607053767920339034290416580654771095674487943</span>, <span class="hljs-number">10053742503547378455068966704402695956702795408343604912294923217443553169726438945982031485796964462946592530592946335569560364464958066521486506177193131</span>, <span class="hljs-number">9703695763451799125258961776229325510814289358679213305418559381901496449849584244211834872313767844996255556721041007654625153809128987422992102292472533</span>, <span class="hljs-number">8148189465927721940294369879439913703690047528695196368949823197675716174991296513758196009346701553643721225250628151384047219921709201619262393792138023</span>, <span class="hljs-number">9114150910964237818418367840207724528917302406836157928223872622442928604249864486858755737149640683259834299165900696585038569188627682022002709058902291</span>, <span class="hljs-number">12273514376180781903469287345188404399033432117915094289694407562166649079228640510678711431664410226301556172582177240184695103942141430877677144285616059</span>, <span class="hljs-number">8355005721684425514882933910286584148305344580589623112959517428993968438533866906223777778058096962333203237111245328436600994120168924143849685728268811</span>, <span class="hljs-number">8957883838807471492147480816683526636019698464133185237668243268667169800811696770484487123560197988448434475112352005768286417529319182162245840523697001</span>, <span class="hljs-number">12168542584724814356632409768687396920143300559579648963851924568387314914334359305942685551210180448419674060219496395116081866784918059237133414041227833</span>, <span class="hljs-number">12285935007930825571672128346804313607196190465690759870758278705086034778808662886056460827935986285259185071514490942831585313190946386878622608868345563</span>, <span class="hljs-number">7719913817859572377164973343651155934060296607908537845256755472465025202751239980758950094865067751407889569369974011139801401586939119147773466111699913</span>]<br>cs = [<span class="hljs-number">3911325901261770731066343727353093385607196883601022244426857460074338420692610012414571623512152485474248169220030587839849722757773859682519433853455847</span>, <span class="hljs-number">4198555117325325874584019691418573071733167640213933749582347442518997588452211673143722179281773602455507001395983681009769848414007206268682184816168744</span>, <span class="hljs-number">4422173666634983234895098798813962037875417568235708524339826709271381748884936178371767574064794177416615710120223914725873239836121654705208614576413533</span>, <span class="hljs-number">3540260422555697887869627546208164711550015909378340105077652177481959576550678379723450981807556863572610759824660630418670546203733170058626755080797998</span>, <span class="hljs-number">6451498467498935201092514865627931677091078787997097414208430992183264950579022373372254486595458117887305393317663712337699331503725124287017134808484874</span>, <span class="hljs-number">3439629581963524351810430910737336124616316641656190641248434504621774235943514617301857917041111617104850245148746427180069743940612560718213177903427306</span>, <span class="hljs-number">4279468191481832212496939242093486044278976937965085475567008228061184947513156012369586970486543083130565628906296600553024574099481246534878242920637212</span>, <span class="hljs-number">4102135455518061133919027670571325279976222647984452353051395864554309521223498761823084717077102213648612826513661629599971609555235760152049549057234342</span>, <span class="hljs-number">329051927890365028889097463563711966673066795688728876214731188783168691555262156515161429328581094087585127929869064685419149676592073496155898360311360</span>, <span class="hljs-number">1674347209896897571502352451063188834938904430329951752111921115230349947823188121972980025563878887201507629419811736910690965020923751424101521816057970</span>, <span class="hljs-number">4779084317811375050159574994746297486592271247137823471375199626788956576998627181220489952507937768042501203098391966702297812537463211799837921684467541</span>, <span class="hljs-number">5240331815784322792144549873873658636726233093228415489098002982220769676718681132737794994708716389174162820721646744776624413735318240597745363490427584</span>, <span class="hljs-number">2689716894922604875455207695253665212853470308341743040957367957727155614199743562225147359614514189877983156892749669804800163252617480446565479990148021</span>, <span class="hljs-number">449708769594599088851244243076921016853502252396793496349534051273454215985560340288452398756880916680293627457774430655982228613348249480600180821975835</span>, <span class="hljs-number">1584603978331289335352997151059666773277943458357161051278658090420067023680231414255557805410288144092653121568766136372728095300982743309696347031121424</span>, <span class="hljs-number">4874260053151700374809337053763032489184725334196495160358275038586824027920238733886703163018450814805937363825223459277373073591021082276610135118976834</span>, <span class="hljs-number">3524374131362906900545297291947110177298862564718451821839794960169356082042548386553363480921097452902723033854749443288682983558847052843293666815425196</span>, <span class="hljs-number">6544123591499569232021913370293570477776709315008783531720886545784773471486769240711262562401683145937715612435213816372680189321141928790509490282629891</span>, <span class="hljs-number">4873861166228118967099569086478548167127431415017791678812419676791754466935832034870862000658789609084166891933970013849850146718379819943737269970654866</span>, <span class="hljs-number">4100817874436703071716655163972145036104985973164830547825929590871920825981241934633977227547934514142660786061291026657802357404024236287955309372489516</span>, <span class="hljs-number">343238276681348130286495167739162902430650061145485619903964358840996341335935043000395056684771452815629410388891486531126938900311458948803147120186532</span>, <span class="hljs-number">2683710724350412998770392318832434885304538325033159937379489319924346689197445720734209841902612235485016866254994045969716413020197296428323832404151182</span>, <span class="hljs-number">5909464641105704179999104311562416363090166762341644691188169716182958971270396007422581429813172933930581475771306034495224054972725230757675444731953480</span>, <span class="hljs-number">105593489999747649490909471306354863316673821363863362258853043970534652401274789197677558215188249074837829003335733211890211648501689656345824858507373</span>, <span class="hljs-number">4992379366542645691375959247465888889778118153982142100956809440855745659745235576280578316185469306620017845690312554043770651058126536040173113949524396</span>, <span class="hljs-number">6533456398244789907636779407045515567135195474284185379689518387558345997627435421582437390053234675991361808532278264077968540197407743744279106871716267</span>, <span class="hljs-number">5169360398767270275853790242315213671633880428212603766301308853363063092609582572957561138022806887895634140899640025570759919257615537375706008159680239</span>, <span class="hljs-number">203310740924699994885931266978520636166917734618272844754878785050509801614513144739164450834936178065792112797202959106365282699245578309060905297742706</span>, <span class="hljs-number">3143563289239398127009575193211845399079310618985464994769603542400451633289266080869317336163844517539211542909055869608349639432145332113320465388067087</span>, <span class="hljs-number">4016252180207572047405081190649590978593306403200098541033213590567723751195926093369984531729148621419589009515870336049849542537363832071754623330736088</span>]<br>enc = <span class="hljs-number">1315637864146686255246675143589215932218700984880749264689270214639479160648747323586062096067740047809798944996253169402675772469028914904598116394230426</span><br>ss=[<span class="hljs-number">1444695997149492190325503358748907180896428744501435959012446197804471238996228693169795874437240656170107638535797004901</span>, <span class="hljs-number">1710106002173551002425444054140394178956124023376657957303230765508377089074717746465653815466763654648249527857825569029</span>, <span class="hljs-number">2055313300434754785614061534661234769322543457763273072311107482412288908659564309179643251560799446038081677516598963457</span>, <span class="hljs-number">2529893752644237783483797815212946495982855556933204694011832676840091910035653685416019963608166318536749345810876453771</span>, <span class="hljs-number">2529138628117798443470937234045077945473928204906198619005287365776711527156367496383631463561676109741862230251586143377</span>, <span class="hljs-number">2262110335813452474430699656412885234503426852605393691899881796634211611052330735315181940758828054398894455017113733227</span>, <span class="hljs-number">2121889637450522029350552877626679809458662297228865521642554573119772081854990312156453774280770474194162502389497160327</span>, <span class="hljs-number">2529142548180563996394639773713532833480273727306125086719935756161917184911736806616267916075735106590544780324467585621</span>, <span class="hljs-number">1305329295536404276170448056500700469825272137020946460143963140200353157377196505556280067991447170875038122866415550101</span>, <span class="hljs-number">1552852098086060808737139123645915631099187828325664479373402352780546739207516108015428990851489119938061929818491926611</span>, <span class="hljs-number">1791104999803661806603955436215385390826508049741363470424060526111730352962999232609779584743853648363257676913487057757</span>, <span class="hljs-number">1899442479566327507595284152198923816070020299280413329026247522765072323119884753949208875377108001657197781777679291871</span>, <span class="hljs-number">1453541167592343188338822229691660044736912312708428492831729087255748263545506909467533920598337452593734393704376978807</span>, <span class="hljs-number">1839970255647517988033776502403781838348352314214922889121617450060735210741294955388142534936822274443404021805803333703</span>, <span class="hljs-number">1912160881436961130805854105580691921433605240682869508192604979038043884642959974735162453664737011078276186132003267537</span>, <span class="hljs-number">2543565462805293682479626661848772865479251641709980622442153819428251437133653745822570184749929330644293218076375940297</span>, <span class="hljs-number">2483083156651635774502843350477278413827965814754343098791424022880695703529884053363101276861390834327295178464586090169</span>, <span class="hljs-number">2003169101542395781256109850378099343661620656525906226012777618825679882882750121108967747380040440812305500025030472703</span>, <span class="hljs-number">1495306582962644344763635303973344887376634002664321023099433581011613385215984473933899539552759121449556619118213926953</span>, <span class="hljs-number">1475475640507405435263556560927151140961838107291429033550823738085598452588645697451453622811307836240178487270066202731</span>, <span class="hljs-number">1585296258758653869729779396633477768935787077644413518874111953612262499991020378795132976171831363612740565577673589949</span>, <span class="hljs-number">1751870981277054153889475362865184270808672777814739187606382420502953249942908536146994775691865449715881103437411562697</span>, <span class="hljs-number">2229385019858443633247567841668512226312552028112872103049568509800432132563139223600501334488455486995847787457023057543</span>, <span class="hljs-number">2509522757833822636876029295601980862244548996153272433687613093337042904569711801805004013230589715380175225102878772429</span>, <span class="hljs-number">1378538686540733061307578409608662896663843431656273949667551098986968433993734090533525999772678987014720821134447883279</span>, <span class="hljs-number">1615745464810222578868113006917238415594773977456189037245148298498578637163332628299020222221658719347173123797381998597</span>, <span class="hljs-number">2064151464294100789516756482456818746190321203565732371731029967136921201410297069827915522687620140104021460523804416353</span>, <span class="hljs-number">1711545496198775131056637405659683132417828376528113270088200929297233962942202546621239829931304134031695960814215807973</span>, <span class="hljs-number">1455761879282217336477189039622363054351048993520687962567785409775020556422692091664440576775863933336882803763246548923</span>, <span class="hljs-number">1880891423536411979565374334582143474888275578342367502429189125513290153271930355071969557105539679922217905887177950249</span>]<br><br>prime=p<br>ma=rs<br>res = cs<br><br>W = matrix(ZZ, ma)<br>cc = vector(ZZ, res)<br><span class="hljs-comment">#LWEæ±‚è§£x</span><br><span class="hljs-comment"># Babai&#x27;s Nearest Plane algorithm</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">Babai_closest_vector</span>(<span class="hljs-params">M, G, target</span>):<br>    small = target<br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">reversed</span>(<span class="hljs-built_in">range</span>(M.nrows())):<br>            c = ((small * G[i]) / (G[i] * G[i])).<span class="hljs-built_in">round</span>()<br>            small -=  M[i] * c<br>    <span class="hljs-keyword">return</span> target - small<br><br>A1 = matrix.identity(column)<br>Ap = matrix.identity(row) * prime<br>B = block_matrix([[Ap], [W]])<br>lattice = IntegerLattice(B, lll_reduce=<span class="hljs-literal">True</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;LLL done&quot;</span>)<br>gram = lattice.reduced_basis.gram_schmidt()[<span class="hljs-number">0</span>]<br>target = vector(ZZ, res)<br>re = Babai_closest_vector(lattice.reduced_basis, gram, target)<br><span class="hljs-comment"># print(&quot;Closest Vector: &#123;&#125;&quot;.format(re))</span><br><br>R = IntegerModRing(prime)<br>M = Matrix(R, ma)<br>M = M.transpose()<br><br>ingredients = M.solve_right(re)<br><br><span class="hljs-comment">#æ±‚å‡ºxååˆ©ç”¨PHç®—æ³•å¯¹flagè¿›è¡Œè¿˜åŸï¼Œå› ä¸ºå‘ç°p-1å¯ä»¥åˆ†è§£ï¼Œpæ˜¯å…‰æ»‘é˜¶</span><br><span class="hljs-comment"># x=6789891305297779556556571922812978922375073901749764215969003309869718878076269545304055843125301553103531252334876560433405451108895206969904268456786139</span><br>x=<span class="hljs-built_in">int</span>(ingredients[<span class="hljs-number">0</span>])<br><span class="hljs-built_in">print</span>(x)<br>m=x<br>c=enc<br>n=p<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">r</span>(<span class="hljs-params">h, g, N, p, qi</span>):<br>    Zp = Zmod(p)<br>    h = <span class="hljs-built_in">pow</span>(h, N//qi, p)<br>    g = <span class="hljs-built_in">pow</span>(g, N//qi, p)<br>    ri = discrete_log(Zp(h), Zp(g))<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(ri)<br>m=x<br>c=enc<br>n=p<br><br>tmp_list=[<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">193</span>,<span class="hljs-number">877</span>,<span class="hljs-number">2663</span>,<span class="hljs-number">662056037</span>,<span class="hljs-number">812430763</span>,<span class="hljs-number">814584769</span>,<span class="hljs-number">830092927</span>,<span class="hljs-number">849943517</span>,<span class="hljs-number">969016409</span>,<span class="hljs-number">1000954193</span>,<span class="hljs-number">1022090869</span>,<span class="hljs-number">1048277339</span>]<br><br>r_list = []<br><span class="hljs-keyword">for</span> qi <span class="hljs-keyword">in</span> tmp_list:<br>    tmp = r(c,m,n-<span class="hljs-number">1</span>,n,qi)<br>    <span class="hljs-built_in">print</span>(tmp)<br>    r_list.append(tmp)<br>x = crt(r_list, tmp_list)<br><br>module = <span class="hljs-number">1</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> tmp_list:<br>    module *= i<br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">int</span>(x).bit_length()&gt;<span class="hljs-number">304</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;fail&#x27;</span>)<br>        <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">int</span>(<span class="hljs-built_in">pow</span>(m, x, n))==c:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;x =&#x27;</span>, x)<br>        <span class="hljs-built_in">print</span>(long_to_bytes(x))<br>        <span class="hljs-keyword">break</span><br>    x += module<br><span class="hljs-comment">#b&#x27;flag&#123;70b1b709ce431682addb581596320007&#125;&#x27;</span><br><br></code></pre></td></tr></table></figure><h1 id="nkctf2023">NKCTF2023</h1><h2 id="babyrsa">babyRSA</h2><p>é¢˜ç›®</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python">nbit = <span class="hljs-number">512</span><br>flag=<span class="hljs-string">&#x27;****************************&#x27;</span><br><br>p=getPrime(nbit)<br>q=getPrime(nbit)<br>e=<span class="hljs-number">65537</span><br>n=p*q<br>m= bytes_to_long(<span class="hljs-built_in">bytes</span>(flag.encode()))<br>P = <span class="hljs-built_in">pow</span>(m,p,n)<br>Q = <span class="hljs-built_in">pow</span>(m,q,n)<br>N=P*Q<br>phi_N=(P-<span class="hljs-number">1</span>)*(Q-<span class="hljs-number">1</span>)<br>d=inverse(e,phi_N)<br>dP=d%(P-<span class="hljs-number">1</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;n = &#x27;</span>,n)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;N = &#x27;</span>,N)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;dP = &#x27;</span>,dP)<br><br><br>n =  <span class="hljs-number">114101396033690088275999670914803472451228154227614098210572767821433470213124900655723605426526569384342101959232900145334500170690603208327913698128445002527020347955300595384752458477749198178791196660625870659540794807018881780680683388008090434114437818447523471527878292741702348454486217652394664664641</span><br>N =  <span class="hljs-number">1159977299277711167607914893426674454199208605107323826176606074354449015203832606569051328721360397610665453513201486235549374869954501563523028914285006850687275382822302821825953121223999268058107278346499657597050468069712686559045712946025472616754027552629008516489090871415609098178522863027127254404804829735621706042266140637592206366042515190385496909533329383212542170504864473944657824502882014292528444918055958758310544435120502872883857209880723535754528096143707324179005292445100655695427777453144657819474805882956064292780031599790769618615908501966912635232746588639924772530057835864082951499028</span><br>dP =  <span class="hljs-number">33967356791272818610254738927769774016289590226681637441101504040121743937150259930712897925893431093938385216227201268238374281750681609796883676743311872905933219290266120756315613501614208779063819499785817502677885240656957036398336462000771885589364702443157120609506628895933862241269347200444629283263</span><br><br></code></pre></td></tr></table></figure><h3 id="é¢˜ç›®åˆ†æ">é¢˜ç›®åˆ†æ</h3><p>é¢˜ç›®ååŠéƒ¨åˆ†æ˜¯ dp æ³„éœ²ï¼Œé€šè¿‡ Nã€eã€dP å¯æ±‚å‡º Pã€Q</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,e):<br>    <span class="hljs-keyword">if</span> (e*dP-<span class="hljs-number">1</span>)%k == <span class="hljs-number">0</span>:<br>        P=(e*dP-<span class="hljs-number">1</span>)//k + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> N%P == <span class="hljs-number">0</span>:<br>            <span class="hljs-built_in">print</span>(P)<br>            <span class="hljs-keyword">break</span><br>Q=N//P<br></code></pre></td></tr></table></figure><h4 id="æ³•ä¸€">æ³•ä¸€</h4><p>ä¹‹åè¦é€šè¿‡<span class="math inline">\(P = m^p\;mod\;n\)</span>ä¸<spanclass="math inline">\(Q=m^q\; mod \;n\)</span>æ¥æ±‚è§£mï¼Œä¸‹é¢è¿›è¡Œä¸€äº›æ•°å­¦æ¨å¯¼</p><p><span class="math display">\[c_1^q=m^{pq}\;mod\;n\]</span> <spanclass="math display">\[c_1^{pq}=c_2^{p^2}\;mod\;n\]</span> <spanclass="math display">\[c_1^{pq}=c_2^{p^2}\;mod\;p\]</span></p><p>æ ¹æ®è´¹é©¬å°å®šç†è½¬æ¢å¯å¾—</p><p><span class="math display">\[c_1^n=c_2^p\;mod\;p\]</span> <spanclass="math display">\[gcd(c_1^n-c_2,n)\;=\;p\]</span></p><p>æ±‚å‡º p å’Œ q åï¼Œä½¿ç”¨ crt å³å¯æ±‚å¾— m</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">c1=(<span class="hljs-built_in">pow</span>(P,n,n)-Q)%n<br>p=GCD(c1,n)<br>q=n//p<br>mp=P%p<br>mq=Q%q<br>m=CRT([mp,mq],[p,q])<br><span class="hljs-built_in">print</span>(long_to_bytes(m))<br><span class="hljs-comment"># NKCTF&#123;Th1S_a_babyRSA_y0u_are_tql!!!&#125;</span><br></code></pre></td></tr></table></figure><h4 id="æ³•äºŒ">æ³•äºŒ</h4><p>é€šè¿‡æ¨å¯¼å°†åŸå¼è½¬æ¢ä¸º</p><p><span class="math display">\[PQ=(k_1p+m)(k_2q+m)\]</span> <spanclass="math display">\[m(P+Q)=2m^2+(k_1p+k_2q)m\]</span> <spanclass="math display">\[PQ-m(P+Q)+m^2=k_1k_2n\]</span> <spanclass="math display">\[PQ-m(c_1+c_2)+m^2=0\;mod\;n\]</span></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">PR.&lt;m&gt; = PolynomialRing(Zmod(n))<br>f = P*Q-m^<span class="hljs-number">2</span>-m*(P-m+Q-m)<br>f = f.monic()<br>m = f.small_roots(X=<span class="hljs-number">2</span>^<span class="hljs-number">400</span>, beta=<span class="hljs-number">0.4</span>)<br><span class="hljs-built_in">print</span>(long_to_bytes(<span class="hljs-built_in">int</span>(m[<span class="hljs-number">0</span>])))<br></code></pre></td></tr></table></figure><h2 id="ezrsa">ezRSA</h2><p>å·²çŸ¥ phi åˆ†è§£ n,åç»­åŒ babyRSA</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> math <span class="hljs-keyword">import</span> gcd<br><span class="hljs-keyword">from</span> math <span class="hljs-keyword">import</span> isqrt<br><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> randrange<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">factorize_multi_prime</span>(<span class="hljs-params">N, phi</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    Recovers the prime factors from a modulus if Euler&#x27;s totient is known.</span><br><span class="hljs-string">    This method works for a modulus consisting of any number of primes, but is considerably be slower than factorize.</span><br><span class="hljs-string">    More information: Hinek M. J., Low M. K., Teske E., &quot;On Some Attacks on Multi-prime RSA&quot; (Section 3)</span><br><span class="hljs-string">    :param N: the modulus</span><br><span class="hljs-string">    :param phi: Euler&#x27;s totient, the order of the multiplicative group modulo N</span><br><span class="hljs-string">    :return: a tuple containing the prime factors</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    prime_factors = <span class="hljs-built_in">set</span>()<br>    factors = [N]<br>    <span class="hljs-keyword">while</span> <span class="hljs-built_in">len</span>(factors) &gt; <span class="hljs-number">0</span>:<br>        <span class="hljs-comment"># Element to factorize.</span><br>        N = factors[<span class="hljs-number">0</span>]<br><br>        w = randrange(<span class="hljs-number">2</span>, N - <span class="hljs-number">1</span>)<br>        i = <span class="hljs-number">1</span><br>        <span class="hljs-keyword">while</span> phi % (<span class="hljs-number">2</span> ** i) == <span class="hljs-number">0</span>:<br>            sqrt_1 = <span class="hljs-built_in">pow</span>(w, phi // (<span class="hljs-number">2</span> ** i), N)<br>            <span class="hljs-keyword">if</span> sqrt_1 &gt; <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> sqrt_1 != N - <span class="hljs-number">1</span>:<br>                <span class="hljs-comment"># We can remove the element to factorize now, because we have a factorization.</span><br>                factors = factors[<span class="hljs-number">1</span>:]<br><br>                p = gcd(N, sqrt_1 + <span class="hljs-number">1</span>)<br>                q = N // p<br><br>                <span class="hljs-keyword">if</span> is_prime(p):<br>                    prime_factors.add(p)<br>                <span class="hljs-keyword">elif</span> p &gt; <span class="hljs-number">1</span>:<br>                    factors.append(p)<br><br>                <span class="hljs-keyword">if</span> is_prime(q):<br>                    prime_factors.add(q)<br>                <span class="hljs-keyword">elif</span> q &gt; <span class="hljs-number">1</span>:<br>                    factors.append(q)<br><br>                <span class="hljs-comment"># Continue in the outer loop</span><br>                <span class="hljs-keyword">break</span><br><br>            i += <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">tuple</span>(prime_factors)<br>e=<span class="hljs-number">65537</span><br>n = <span class="hljs-number">8836130216343708623415307573630337110573363595188748983290313549413242332143945452914800845282478216810685733227137911630239808895196748125078747600505626165666334675100147790578546682128517668100858766784733351894480181877144793496927464058323582165412552970999921215333509253052644024478417393146000490808639363681195799826541558906527985336104761974023394438549055804234997654701266967731137282297623426318212701157416397999108259257077847307874122736921265599854976855949680133804464839768470200425669609996841568545945133611190979810786943246285103031363790663362165522662820344917056587244701635831061853354597</span><br>phi = <span class="hljs-number">8836130216343708623415307573630337110573363595188748983290313549413242332143945452914800845282478216810685733227137911630239808895196748125078747600505622503351461565956106005118029537938273153581675065762015952483687057805462728186901563990429998916382820576211887477098611684072561849314986341226981300596338314989867731725668312057134075244816223120038573374383949718714549930261073576391501671722900294331289082826058292599838631513746370889828026039555245672195833927609280773258978856664434349221972568651378808050580665443131001632395175205804045958846124475183825589672204752895252723130454951830966138888560</span><br>a=factorize_multi_prime(n,phi)<br></code></pre></td></tr></table></figure><h2 id="ez_math">ez_math</h2><p>é¢˜ç›®</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> getPrime, bytes_to_long<br><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> BITS, hints, flag<br><br>p = getPrime(BITS)<br>q = getPrime(BITS)<br>n = p * q<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;n = <span class="hljs-subst">&#123;n&#125;</span>&#x27;</span>)<br><br>e = <span class="hljs-number">0x10001</span><br>c = <span class="hljs-built_in">pow</span>(bytes_to_long(flag), e, n)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;c = <span class="hljs-subst">&#123;c&#125;</span>&#x27;</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Give you some boring pows:&#x27;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(hints)):<br>    <span class="hljs-built_in">print</span>(hints[i])<br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">n = 369520637995317866367336688225182965061898803879373674073832046072914710171302486913303917853881549637806426191970292829598855375370563396182543413674021955181862907847280705741114636854238746612618069619482248639049407507041667720977392421249242597197448360531895206645794505182208390084734779667749657408715621</span><br><span class="hljs-string">c = 324131338592233305486487416176106472248153652884280898177125443926549710357763331715045582842045967830200123100144721322509500306940560917086108978796500145618443920020112366546853892387011738997522207752873944151628204886591075864677988865335625452099668804529484866900390927644093597772065285222172136374562043</span><br><span class="hljs-string">Give you some boring pows:</span><br><span class="hljs-string">pow(6, 42762902032363446334121451790132830028099011269558028556333775251728898854654431095595000922138958455510196735338223430882428451914478079186797153527810555787441234842366353864053114538165236037883914332840687123514412294276743506313011532002136735343280737244020115917460801848337792582496228600926958548903290, n) = 4</span><br><span class="hljs-string">pow(6, 141997416965295486849546892322458652502850390670128808480582247784728456230996812361056958004801816363393016360646922983916999235770803618904474553309200419301820603229504955218189709387942156848904968053547462302189568831762401075340100029630332409419313772378068180267756675141584884876543484516408660699471038, n) = 9</span><br><span class="hljs-string">pow(6, 163378867981477210016607618217525067516899896304907822758749135410592905658324027908854458465871295591148114728316034699358213461728042658497873130073105697195541220650688132150216266657024774867846925219967805863946774978900772828496605795631400777090954141000078238226487076065753781167791598816872139973922682, n) = 3</span><br><span class="hljs-string">pow(5, 101651508435846472131121026992982127175369332865677196032272241712711171024515826370577416844824734811581351106736224929238579734879671732717639124571916168742336862493284572465162318403582113621582374924091725060981390318743531229548188092491836655143124663368239422819562367919547196053790207486164506763679128, n) = 4</span><br><span class="hljs-string">pow(8, 7202269322818255506843028035725052687541091567764933235328308385449791332345247877549905289072216053144576876979686287212194040101112899704499548530779540409356827298148385589812450437990490353926475147376495772639210184768544932563432306664067058309318707174880146258394471096033723193568453520897758319446472, n) = 3</span><br><span class="hljs-string">pow(6, 64144353048545169501182177685199245042148516904337042834500662877593348281981646643392501383208437683265295103007335146323642677871717118780195730291715833681161852263549530796079671807247854056825871499261030685271618441415115259469517298003205103014921105866030173876191202772506688873744342901390437823354935, n) = 8</span><br><span class="hljs-string">pow(6, 21381451016181723167060725895066415014049505634779014278166887625864449427327215547797500461069479227755098367669111715441214225957239039593398576763905277893720617421183176932026557269082618018941957166420343561757206147138371753156505766001068367671640368622010057958730400924168896291248114300463479274451645, n) = 2</span><br><span class="hljs-string">pow(4, 21606807968454766520529084107175158062623274703294799705984925156349373997035743632649715867216648159433730630939058861636582120303338699113498645592338621228070481894445156769437351313971471061779425442129487317917630554305634797690296919992201174927956121524640438775183413288101169580705360562693274958339416, n) = 9</span><br><span class="hljs-string">pow(2, 21606807968454766520529084107175158062623274703294799705984925156349373997035743632649715867216648159433730630939058861636582120303338699113498645592338621228070481894445156769437351313971471061779425442129487317917630554305634797690296919992201174927956121524640438775183413288101169580705360562693274958339417, n) = 6</span><br><span class="hljs-string">pow(4, 10803403984227383260264542053587579031311637351647399852992462578174686998517871816324857933608324079716865315469529430818291060151669349556749322796169310614035240947222578384718675656985735530889712721064743658958815277152817398845148459996100587463978060762320219387591706644050584790352680281346637479169708, n) = 3</span><br><span class="hljs-string">pow(9, 3293982057350410278459882519024200329089724149803879577174733206141551016681048848343176690789446255513117465644006032807116613436995145441651711865811812905401261777042165657533800465011922458688696664211216129846590488003282750224539553623014598025837108471148806368738631086225250952573439068109703953523338, n) = 4</span><br><span class="hljs-string">pow(2, 43213615936909533041058168214350316125246549406589599411969850312698747994071487265299431734433296318867461261878117723273164240606677398226997291184677242456140963788890313538874702627942942123558850884258974635835261108611269595380593839984402349855912243049280877550366826576202339161410721125386549916678832, n) = 9</span><br><span class="hljs-string">pow(7, 156359509651684605051402965560382969488421316701585527115005130492947292379802933549188085059602557600903593831240316597311439285149968787780538126741092612405335349622445040578126369183536683733294143156965518222696624206221060030916594302284630706642066420353822195108928341123726471513256217857861184609387726, n) = 9</span><br><span class="hljs-string">pow(7, 170559914324671769117535654836487226009685359320636182075960576764702323732727088502920021993271666209903403463612731506055433486417625242935904916789051793747298593847158174830184596554822038310041512771676833824200302666130102306284852931958549925702330464987955245647072909056824574486147965487598401928881026, n) = 3</span><br><span class="hljs-string">pow(8, 123173545998439288789112229408394321687299601293124558024610682024304903390434162304434639284627183212602142063990097609866285125123521132060847804558007316726174558714580872721495215950738261924525921590925432950469320750692763054435407707754979429841729673081392197456811651326615118306026475411557079498916218, n) = 4</span><br><span class="hljs-string">pow(2, 21606807968454766520529084107175158062623274703294799705984925156349373997035743632649715867216648159433730630939058861636582120303338699113498645592338621228070481894445156769437351313971471061779425442129487317917630554305634797690296919992201174927956121524640438775183413288101169580705360562693274958339416, n) = 3</span><br><span class="hljs-string">pow(3, 6587964114700820556919765038048400658179448299607759154349466412283102033362097696686353381578892511026234931288012065614233226873990290883303423731623625810802523554084331315067600930023844917377393328422432259693180976006565500449079107246029196051674216942297612737477262172450501905146878136219407907046676, n) = 4</span><br><span class="hljs-string">pow(7, 146900004342901005519726059203387905743111231159623333298786259340649199259667124880775175860427705602975071010583553281005991812801779033020769274211420710213704563866848310994325033574484679477677016014418321661821714582236428708141287327064859146436371562752616380650770729341741997594308364878898526065859626, n) = 4</span><br><span class="hljs-string">pow(5, 172192380036714150788905270808196199818277334366508682218739812159577144024191963252552116624193235000074634457087111471641800814071769221933018962135503876997163938949365614056098717522475180216291316295788774044033481065993544994610614082708563841846852650913646728169671510827052772868386414581035580266356334, n) = 3</span><br><span class="hljs-string">pow(8, 68789042322037899901399142739922213531190892214327212247633649397602243027562329029767224931385807659445647908974735092145336602662873465734923450809783198772444106655438821950560058413359621316189435942839212247873870560114926459781136160541556773230183543715576244986800296759341282346581691226676298068904581, n) = 6</span><br><span class="hljs-string">pow(5, 159624441075769368394142197503800917105605266793330527400563601282696932962732683048452274321445695181246055818189076528484173940458256745774766217433996778905066039826859919029954611118842967545793750205189398662362981005947945407568116603784658538931110792205205160154125544664182868277733116044735541284338342, n) = 9</span><br><span class="hljs-string">pow(8, 14404538645636511013686056071450105375082183135529866470656616770899582664690495755099810578144432106289153753959372574424388080202225799408999097061559080818713654596296771179624900875980980707852950294752991545278420369537089865126864613328134116618637414349760292516788942192067446387136907041795516638892944, n) = 9</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br></code></pre></td></tr></table></figure><p>æ ¹æ®ä¸€ä¸ª hint å¾—åˆ° <spanclass="math display">\[8^x\;mod\;n=4\]</span> <spanclass="math display">\[2^{3x-2}=1\;mod\;n\]</span>ç”±è´¹é©¬å°å®šç†å¾—ï¼Œ3x-2=phi</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> gmpy2<br>n = <span class="hljs-number">369520637995317866367336688225182965061898803879373674073832046072914710171302486913303917853881549637806426191970292829598855375370563396182543413674021955181862907847280705741114636854238746612618069619482248639049407507041667720977392421249242597197448360531895206645794505182208390084734779667749657408715621</span><br>c = <span class="hljs-number">324131338592233305486487416176106472248153652884280898177125443926549710357763331715045582842045967830200123100144721322509500306940560917086108978796500145618443920020112366546853892387011738997522207752873944151628204886591075864677988865335625452099668804529484866900390927644093597772065285222172136374562043</span><br>e=<span class="hljs-number">65537</span><br>x=<span class="hljs-number">123173545998439288789112229408394321687299601293124558024610682024304903390434162304434639284627183212602142063990097609866285125123521132060847804558007316726174558714580872721495215950738261924525921590925432950469320750692763054435407707754979429841729673081392197456811651326615118306026475411557079498916218</span><br>phi=<span class="hljs-number">3</span>*x-<span class="hljs-number">2</span><br><span class="hljs-built_in">print</span>(long_to_bytes(<span class="hljs-built_in">pow</span>(c,gmpy2.invert(e,phi),n)))<br><span class="hljs-comment"># b&#x27;NKCTF&#123;d15cr373_L0g_15_R3DuC710n_f0R_f4C70r1nG&#125;&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="ez_polynomial">ez_polynomial</h2><p>é¢˜ç›®</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#sage</span><br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br>flag = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">bytearray</span>(<span class="hljs-string">&#x27;&#x27;</span>))<br>p = getPrime(<span class="hljs-number">16</span>)<br>R.&lt;y&gt; = PolynomialRing(GF(p))<br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    P1 = R.random_element(degree=(ZZ.random_element(<span class="hljs-built_in">len</span>(flag), <span class="hljs-number">2</span>*<span class="hljs-built_in">len</span>(flag))))<br>    Q1 = R.random_element(degree=(ZZ.random_element(<span class="hljs-built_in">len</span>(flag), <span class="hljs-number">2</span>*<span class="hljs-built_in">len</span>(flag))))<br>    <span class="hljs-keyword">if</span> P1.is_irreducible() <span class="hljs-keyword">and</span> Q1.is_irreducible():<br>        P = P1<br>        Q = Q1<br>        <span class="hljs-keyword">break</span><br>e = <span class="hljs-number">65537</span><br>N = P*Q<br>S.&lt;x&gt; = R.quotient(N)<br>c = S(flag) ^ e<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;P:&quot;</span> + <span class="hljs-built_in">str</span>(p) + <span class="hljs-string">&quot;\n&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;N:&quot;</span> + <span class="hljs-built_in">str</span>(N) + <span class="hljs-string">&quot;\n&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;C:&quot;</span> + <span class="hljs-built_in">str</span>(c))<br><br><span class="hljs-comment">#P:40031</span><br><span class="hljs-comment">#N:24096*y^93 + 38785*y^92 + 17489*y^91 + 9067*y^90 + 1034*y^89 + 6534*y^88 + 35818*y^87 + 22046*y^86 + 12887*y^85 + 445*y^84 + 26322*y^83 + 37045*y^82 + 4486*y^81 + 3503*y^80 + 1184*y^79 + 38471*y^78 + 8012*y^77 + 36561*y^76 + 19429*y^75 + 35227*y^74 + 10813*y^73 + 26341*y^72 + 29474*y^71 + 2059*y^70 + 16068*y^69 + 31597*y^68 + 14685*y^67 + 9266*y^66 + 31019*y^65 + 6171*y^64 + 385*y^63 + 28986*y^62 + 9912*y^61 + 10632*y^60 + 33741*y^59 + 12634*y^58 + 21179*y^57 + 35548*y^56 + 17894*y^55 + 7152*y^54 + 9440*y^53 + 4004*y^52 + 2600*y^51 + 12281*y^50 + 22*y^49 + 17314*y^48 + 32694*y^47 + 7693*y^46 + 6567*y^45 + 19897*y^44 + 27329*y^43 + 8799*y^42 + 36348*y^41 + 33963*y^40 + 23730*y^39 + 27685*y^38 + 29037*y^37 + 14622*y^36 + 29608*y^35 + 39588*y^34 + 23294*y^33 + 757*y^32 + 20140*y^31 + 19511*y^30 + 1469*y^29 + 3898*y^28 + 6630*y^27 + 19610*y^26 + 11631*y^25 + 7188*y^24 + 11683*y^23 + 35611*y^22 + 37286*y^21 + 32139*y^20 + 20296*y^19 + 36426*y^18 + 25340*y^17 + 36204*y^16 + 37787*y^15 + 31256*y^14 + 505*y^13 + 27508*y^12 + 20885*y^11 + 32037*y^10 + 31236*y^9 + 7929*y^8 + 27195*y^7 + 28980*y^6 + 11863*y^5 + 16025*y^4 + 16389*y^3 + 570*y^2 + 36547*y + 10451</span><br><span class="hljs-comment">#C:3552*x^92 + 6082*x^91 + 25295*x^90 + 35988*x^89 + 26052*x^88 + 16987*x^87 + 12854*x^86 + 25117*x^85 + 25800*x^84 + 30297*x^83 + 5589*x^82 + 23233*x^81 + 14449*x^80 + 4712*x^79 + 35719*x^78 + 1696*x^77 + 35653*x^76 + 13995*x^75 + 13715*x^74 + 4578*x^73 + 37366*x^72 + 25260*x^71 + 28865*x^70 + 36120*x^69 + 7047*x^68 + 10497*x^67 + 19160*x^66 + 17939*x^65 + 14850*x^64 + 6705*x^63 + 17805*x^62 + 30083*x^61 + 2400*x^60 + 10685*x^59 + 15272*x^58 + 2225*x^57 + 13194*x^56 + 14251*x^55 + 31016*x^54 + 10189*x^53 + 35040*x^52 + 7042*x^51 + 29206*x^50 + 39363*x^49 + 32608*x^48 + 38614*x^47 + 5528*x^46 + 20119*x^45 + 13439*x^44 + 25468*x^43 + 30056*x^42 + 19720*x^41 + 21808*x^40 + 3712*x^39 + 25243*x^38 + 10606*x^37 + 16247*x^36 + 36106*x^35 + 17287*x^34 + 36276*x^33 + 1407*x^32 + 28839*x^31 + 8459*x^30 + 38863*x^29 + 435*x^28 + 913*x^27 + 36619*x^26 + 15572*x^25 + 9363*x^24 + 36837*x^23 + 17925*x^22 + 38567*x^21 + 38709*x^20 + 13582*x^19 + 35038*x^18 + 31121*x^17 + 8933*x^16 + 1666*x^15 + 21940*x^14 + 25585*x^13 + 840*x^12 + 21938*x^11 + 20143*x^10 + 28507*x^9 + 5947*x^8 + 20289*x^7 + 32196*x^6 + 924*x^5 + 370*x^4 + 14849*x^3 + 10780*x^2 + 14035*x + 15327</span><br></code></pre></td></tr></table></figure><h3 id="é¢˜è§£">é¢˜è§£</h3><p>å¤šé¡¹å¼ RSAï¼Œç»™å®š nã€eã€c</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2<br>p=<span class="hljs-number">40031</span><br>P.&lt;y&gt;=PolynomialRing(Zmod(p))<br>x=y<br>N=<span class="hljs-number">24096</span>*y^<span class="hljs-number">93</span> + <span class="hljs-number">38785</span>*y^<span class="hljs-number">92</span> + <span class="hljs-number">17489</span>*y^<span class="hljs-number">91</span> + <span class="hljs-number">9067</span>*y^<span class="hljs-number">90</span> + <span class="hljs-number">1034</span>*y^<span class="hljs-number">89</span> + <span class="hljs-number">6534</span>*y^<span class="hljs-number">88</span> + <span class="hljs-number">35818</span>*y^<span class="hljs-number">87</span> + <span class="hljs-number">22046</span>*y^<span class="hljs-number">86</span> + <span class="hljs-number">12887</span>*y^<span class="hljs-number">85</span> + <span class="hljs-number">445</span>*y^<span class="hljs-number">84</span> + <span class="hljs-number">26322</span>*y^<span class="hljs-number">83</span> + <span class="hljs-number">37045</span>*y^<span class="hljs-number">82</span> + <span class="hljs-number">4486</span>*y^<span class="hljs-number">81</span> + <span class="hljs-number">3503</span>*y^<span class="hljs-number">80</span> + <span class="hljs-number">1184</span>*y^<span class="hljs-number">79</span> + <span class="hljs-number">38471</span>*y^<span class="hljs-number">78</span> + <span class="hljs-number">8012</span>*y^<span class="hljs-number">77</span> + <span class="hljs-number">36561</span>*y^<span class="hljs-number">76</span> + <span class="hljs-number">19429</span>*y^<span class="hljs-number">75</span> + <span class="hljs-number">35227</span>*y^<span class="hljs-number">74</span> + <span class="hljs-number">10813</span>*y^<span class="hljs-number">73</span> + <span class="hljs-number">26341</span>*y^<span class="hljs-number">72</span> + <span class="hljs-number">29474</span>*y^<span class="hljs-number">71</span> + <span class="hljs-number">2059</span>*y^<span class="hljs-number">70</span> + <span class="hljs-number">16068</span>*y^<span class="hljs-number">69</span> + <span class="hljs-number">31597</span>*y^<span class="hljs-number">68</span> + <span class="hljs-number">14685</span>*y^<span class="hljs-number">67</span> + <span class="hljs-number">9266</span>*y^<span class="hljs-number">66</span> + <span class="hljs-number">31019</span>*y^<span class="hljs-number">65</span> + <span class="hljs-number">6171</span>*y^<span class="hljs-number">64</span> + <span class="hljs-number">385</span>*y^<span class="hljs-number">63</span> + <span class="hljs-number">28986</span>*y^<span class="hljs-number">62</span> + <span class="hljs-number">9912</span>*y^<span class="hljs-number">61</span> + <span class="hljs-number">10632</span>*y^<span class="hljs-number">60</span> + <span class="hljs-number">33741</span>*y^<span class="hljs-number">59</span> + <span class="hljs-number">12634</span>*y^<span class="hljs-number">58</span> + <span class="hljs-number">21179</span>*y^<span class="hljs-number">57</span> + <span class="hljs-number">35548</span>*y^<span class="hljs-number">56</span> + <span class="hljs-number">17894</span>*y^<span class="hljs-number">55</span> + <span class="hljs-number">7152</span>*y^<span class="hljs-number">54</span> + <span class="hljs-number">9440</span>*y^<span class="hljs-number">53</span> + <span class="hljs-number">4004</span>*y^<span class="hljs-number">52</span> + <span class="hljs-number">2600</span>*y^<span class="hljs-number">51</span> + <span class="hljs-number">12281</span>*y^<span class="hljs-number">50</span> + <span class="hljs-number">22</span>*y^<span class="hljs-number">49</span> + <span class="hljs-number">17314</span>*y^<span class="hljs-number">48</span> + <span class="hljs-number">32694</span>*y^<span class="hljs-number">47</span> + <span class="hljs-number">7693</span>*y^<span class="hljs-number">46</span> + <span class="hljs-number">6567</span>*y^<span class="hljs-number">45</span> + <span class="hljs-number">19897</span>*y^<span class="hljs-number">44</span> + <span class="hljs-number">27329</span>*y^<span class="hljs-number">43</span> + <span class="hljs-number">8799</span>*y^<span class="hljs-number">42</span> + <span class="hljs-number">36348</span>*y^<span class="hljs-number">41</span> + <span class="hljs-number">33963</span>*y^<span class="hljs-number">40</span> + <span class="hljs-number">23730</span>*y^<span class="hljs-number">39</span> + <span class="hljs-number">27685</span>*y^<span class="hljs-number">38</span> + <span class="hljs-number">29037</span>*y^<span class="hljs-number">37</span> + <span class="hljs-number">14622</span>*y^<span class="hljs-number">36</span> + <span class="hljs-number">29608</span>*y^<span class="hljs-number">35</span> + <span class="hljs-number">39588</span>*y^<span class="hljs-number">34</span> + <span class="hljs-number">23294</span>*y^<span class="hljs-number">33</span> + <span class="hljs-number">757</span>*y^<span class="hljs-number">32</span> + <span class="hljs-number">20140</span>*y^<span class="hljs-number">31</span> + <span class="hljs-number">19511</span>*y^<span class="hljs-number">30</span> + <span class="hljs-number">1469</span>*y^<span class="hljs-number">29</span> + <span class="hljs-number">3898</span>*y^<span class="hljs-number">28</span> + <span class="hljs-number">6630</span>*y^<span class="hljs-number">27</span> + <span class="hljs-number">19610</span>*y^<span class="hljs-number">26</span> + <span class="hljs-number">11631</span>*y^<span class="hljs-number">25</span> + <span class="hljs-number">7188</span>*y^<span class="hljs-number">24</span> + <span class="hljs-number">11683</span>*y^<span class="hljs-number">23</span> + <span class="hljs-number">35611</span>*y^<span class="hljs-number">22</span> + <span class="hljs-number">37286</span>*y^<span class="hljs-number">21</span> + <span class="hljs-number">32139</span>*y^<span class="hljs-number">20</span> + <span class="hljs-number">20296</span>*y^<span class="hljs-number">19</span> + <span class="hljs-number">36426</span>*y^<span class="hljs-number">18</span> + <span class="hljs-number">25340</span>*y^<span class="hljs-number">17</span> + <span class="hljs-number">36204</span>*y^<span class="hljs-number">16</span> + <span class="hljs-number">37787</span>*y^<span class="hljs-number">15</span> + <span class="hljs-number">31256</span>*y^<span class="hljs-number">14</span> + <span class="hljs-number">505</span>*y^<span class="hljs-number">13</span> + <span class="hljs-number">27508</span>*y^<span class="hljs-number">12</span> + <span class="hljs-number">20885</span>*y^<span class="hljs-number">11</span> + <span class="hljs-number">32037</span>*y^<span class="hljs-number">10</span> + <span class="hljs-number">31236</span>*y^<span class="hljs-number">9</span> + <span class="hljs-number">7929</span>*y^<span class="hljs-number">8</span> + <span class="hljs-number">27195</span>*y^<span class="hljs-number">7</span> + <span class="hljs-number">28980</span>*y^<span class="hljs-number">6</span> + <span class="hljs-number">11863</span>*y^<span class="hljs-number">5</span> + <span class="hljs-number">16025</span>*y^<span class="hljs-number">4</span> + <span class="hljs-number">16389</span>*y^<span class="hljs-number">3</span> + <span class="hljs-number">570</span>*y^<span class="hljs-number">2</span> + <span class="hljs-number">36547</span>*y + <span class="hljs-number">10451</span><br>C=<span class="hljs-number">3552</span>*x^<span class="hljs-number">92</span> + <span class="hljs-number">6082</span>*x^<span class="hljs-number">91</span> + <span class="hljs-number">25295</span>*x^<span class="hljs-number">90</span> + <span class="hljs-number">35988</span>*x^<span class="hljs-number">89</span> + <span class="hljs-number">26052</span>*x^<span class="hljs-number">88</span> + <span class="hljs-number">16987</span>*x^<span class="hljs-number">87</span> + <span class="hljs-number">12854</span>*x^<span class="hljs-number">86</span> + <span class="hljs-number">25117</span>*x^<span class="hljs-number">85</span> + <span class="hljs-number">25800</span>*x^<span class="hljs-number">84</span> + <span class="hljs-number">30297</span>*x^<span class="hljs-number">83</span> + <span class="hljs-number">5589</span>*x^<span class="hljs-number">82</span> + <span class="hljs-number">23233</span>*x^<span class="hljs-number">81</span> + <span class="hljs-number">14449</span>*x^<span class="hljs-number">80</span> + <span class="hljs-number">4712</span>*x^<span class="hljs-number">79</span> + <span class="hljs-number">35719</span>*x^<span class="hljs-number">78</span> + <span class="hljs-number">1696</span>*x^<span class="hljs-number">77</span> + <span class="hljs-number">35653</span>*x^<span class="hljs-number">76</span> + <span class="hljs-number">13995</span>*x^<span class="hljs-number">75</span> + <span class="hljs-number">13715</span>*x^<span class="hljs-number">74</span> + <span class="hljs-number">4578</span>*x^<span class="hljs-number">73</span> + <span class="hljs-number">37366</span>*x^<span class="hljs-number">72</span> + <span class="hljs-number">25260</span>*x^<span class="hljs-number">71</span> + <span class="hljs-number">28865</span>*x^<span class="hljs-number">70</span> + <span class="hljs-number">36120</span>*x^<span class="hljs-number">69</span> + <span class="hljs-number">7047</span>*x^<span class="hljs-number">68</span> + <span class="hljs-number">10497</span>*x^<span class="hljs-number">67</span> + <span class="hljs-number">19160</span>*x^<span class="hljs-number">66</span> + <span class="hljs-number">17939</span>*x^<span class="hljs-number">65</span> + <span class="hljs-number">14850</span>*x^<span class="hljs-number">64</span> + <span class="hljs-number">6705</span>*x^<span class="hljs-number">63</span> + <span class="hljs-number">17805</span>*x^<span class="hljs-number">62</span> + <span class="hljs-number">30083</span>*x^<span class="hljs-number">61</span> + <span class="hljs-number">2400</span>*x^<span class="hljs-number">60</span> + <span class="hljs-number">10685</span>*x^<span class="hljs-number">59</span> + <span class="hljs-number">15272</span>*x^<span class="hljs-number">58</span> + <span class="hljs-number">2225</span>*x^<span class="hljs-number">57</span> + <span class="hljs-number">13194</span>*x^<span class="hljs-number">56</span> + <span class="hljs-number">14251</span>*x^<span class="hljs-number">55</span> + <span class="hljs-number">31016</span>*x^<span class="hljs-number">54</span> + <span class="hljs-number">10189</span>*x^<span class="hljs-number">53</span> + <span class="hljs-number">35040</span>*x^<span class="hljs-number">52</span> + <span class="hljs-number">7042</span>*x^<span class="hljs-number">51</span> + <span class="hljs-number">29206</span>*x^<span class="hljs-number">50</span> + <span class="hljs-number">39363</span>*x^<span class="hljs-number">49</span> + <span class="hljs-number">32608</span>*x^<span class="hljs-number">48</span> + <span class="hljs-number">38614</span>*x^<span class="hljs-number">47</span> + <span class="hljs-number">5528</span>*x^<span class="hljs-number">46</span> + <span class="hljs-number">20119</span>*x^<span class="hljs-number">45</span> + <span class="hljs-number">13439</span>*x^<span class="hljs-number">44</span> + <span class="hljs-number">25468</span>*x^<span class="hljs-number">43</span> + <span class="hljs-number">30056</span>*x^<span class="hljs-number">42</span> + <span class="hljs-number">19720</span>*x^<span class="hljs-number">41</span> + <span class="hljs-number">21808</span>*x^<span class="hljs-number">40</span> + <span class="hljs-number">3712</span>*x^<span class="hljs-number">39</span> + <span class="hljs-number">25243</span>*x^<span class="hljs-number">38</span> + <span class="hljs-number">10606</span>*x^<span class="hljs-number">37</span> + <span class="hljs-number">16247</span>*x^<span class="hljs-number">36</span> + <span class="hljs-number">36106</span>*x^<span class="hljs-number">35</span> + <span class="hljs-number">17287</span>*x^<span class="hljs-number">34</span> + <span class="hljs-number">36276</span>*x^<span class="hljs-number">33</span> + <span class="hljs-number">1407</span>*x^<span class="hljs-number">32</span> + <span class="hljs-number">28839</span>*x^<span class="hljs-number">31</span> + <span class="hljs-number">8459</span>*x^<span class="hljs-number">30</span> + <span class="hljs-number">38863</span>*x^<span class="hljs-number">29</span> + <span class="hljs-number">435</span>*x^<span class="hljs-number">28</span> + <span class="hljs-number">913</span>*x^<span class="hljs-number">27</span> + <span class="hljs-number">36619</span>*x^<span class="hljs-number">26</span> + <span class="hljs-number">15572</span>*x^<span class="hljs-number">25</span> + <span class="hljs-number">9363</span>*x^<span class="hljs-number">24</span> + <span class="hljs-number">36837</span>*x^<span class="hljs-number">23</span> + <span class="hljs-number">17925</span>*x^<span class="hljs-number">22</span> + <span class="hljs-number">38567</span>*x^<span class="hljs-number">21</span> + <span class="hljs-number">38709</span>*x^<span class="hljs-number">20</span> + <span class="hljs-number">13582</span>*x^<span class="hljs-number">19</span> + <span class="hljs-number">35038</span>*x^<span class="hljs-number">18</span> + <span class="hljs-number">31121</span>*x^<span class="hljs-number">17</span> + <span class="hljs-number">8933</span>*x^<span class="hljs-number">16</span> + <span class="hljs-number">1666</span>*x^<span class="hljs-number">15</span> + <span class="hljs-number">21940</span>*x^<span class="hljs-number">14</span> + <span class="hljs-number">25585</span>*x^<span class="hljs-number">13</span> + <span class="hljs-number">840</span>*x^<span class="hljs-number">12</span> + <span class="hljs-number">21938</span>*x^<span class="hljs-number">11</span> + <span class="hljs-number">20143</span>*x^<span class="hljs-number">10</span> + <span class="hljs-number">28507</span>*x^<span class="hljs-number">9</span> + <span class="hljs-number">5947</span>*x^<span class="hljs-number">8</span> + <span class="hljs-number">20289</span>*x^<span class="hljs-number">7</span> + <span class="hljs-number">32196</span>*x^<span class="hljs-number">6</span> + <span class="hljs-number">924</span>*x^<span class="hljs-number">5</span> + <span class="hljs-number">370</span>*x^<span class="hljs-number">4</span> + <span class="hljs-number">14849</span>*x^<span class="hljs-number">3</span> + <span class="hljs-number">10780</span>*x^<span class="hljs-number">2</span> + <span class="hljs-number">14035</span>*x + <span class="hljs-number">15327</span><br>e=<span class="hljs-number">65537</span><br><br>q1=N.factor()[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]<br>q2=N.factor()[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>]<br>phi = (p**q1.degree() - <span class="hljs-number">1</span>) * (p**q2.degree() - <span class="hljs-number">1</span>)<br><span class="hljs-keyword">assert</span> gcd(e, phi) == <span class="hljs-number">1</span><br>d = gmpy2.invert(e, phi)<br><br>m=<span class="hljs-built_in">pow</span>(C,d,N)<br><span class="hljs-built_in">print</span>(m)<br>flag = <span class="hljs-string">&#x27;&#x27;</span>.join([<span class="hljs-built_in">chr</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> m])<br><span class="hljs-built_in">print</span>(flag)<br><span class="hljs-comment"># NKCTF&#123;We_HaV3_n0th1ng_But_dr3amS&#125;</span><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;æ•°å­—ä¸­å›½-babysecret&quot;&gt;æ•°å­—ä¸­å›½ Babysecret&lt;/h1&gt;
&lt;p&gt;é¢˜ç›®&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;lin</summary>
      
    
    
    
    <category term="CTF" scheme="https://sch01ar.github.io/categories/CTF/"/>
    
    
  </entry>
  
  <entry>
    <title>DUTCTF2023</title>
    <link href="https://sch01ar.github.io/2023/03/28/DUTCTF2023/"/>
    <id>https://sch01ar.github.io/2023/03/28/DUTCTF2023/</id>
    <published>2023-03-28T02:05:45.000Z</published>
    <updated>2023-03-28T09:29:06.114Z</updated>
    
    <content type="html"><![CDATA[<h1 id="dutctf2023wp">DUTCTF2023wp</h1><h2 id="å†™åœ¨å‰é¢">å†™åœ¨å‰é¢</h2><p>ä»”ç»†ä¸€æƒ³è‡ªå·±å­¦ CTF ä¹Ÿä¸€å¹´äº†ï¼Œçºªå¿µä¸€ä¸‹æœ€åä¸€æ¬¡å‚åŠ æ ¡èµ›ğŸ¥¹ï¼Œæ˜å¹´å¯å°±æ˜¯å‡ºé¢˜äººäº†ğŸ¤“ã€‚ä½†æ˜¯æ„Ÿè§‰ä¸€å¹´ä»¥æ¥è’åºŸäº†å¾ˆå¤šæ—¶é—´ï¼Œåœ¨å¾ˆå¤šæ–¹é¢å¯¹é¢˜ç›®ä¸ç†Ÿæ‚‰ï¼Œæ€»è·‘åï¼Œç”šè‡³æ˜¯è‡ªå·±å¤ç°è¿‡çš„ä¸€äº›æ–¹æ³•éƒ½æ²¡æ„è¯†åˆ°ï¼ˆhintå¤ªåˆ°ä½äº† ğŸ˜­ï¼‰ã€‚</p><h2 id="crypto">Crypto</h2><p>ç¬¬ä¸€æ¬¡ akï¼Œå¥½çˆ½ ğŸ˜­</p><h3 id="è€æ»šäº”">*è€æ»šäº”</h3><p>ç™¾åº¦æœé¾™è¯­ï¼Œè€å¿ƒå¯¹ç€æ‰¾å°±å‡ºäº†<code>DUTCTF&#123;YOU_ARE_A_REAL_DRAGONBORN&#125;</code></p><h3 id="ç¥å¥‡çš„çŸ­ä¿¡">*ç¥å¥‡çš„çŸ­ä¿¡</h3><p>è¯ºåŸºäºšæ‰‹æœºï¼Œ9é”®ï¼Œç¬¬ä¸€ä½ä»£è¡¨å“ªä¸ªé”®ï¼Œç¬¬äºŒä¸ªä»£è¡¨ç¬¬å‡ ä¸ªå­—æ¯ï¼Œ<code>DUTCTF&#123;SCREW&#125;</code></p><h3 id="éšæœºæ•°çš„åŠ›é‡">éšæœºæ•°çš„åŠ›é‡</h3><p>å¯å…ˆäº†è§£ä¸€ä¸‹ MT19937 ä¼ªéšæœºæ•°åŸç†ï¼Œç„¶åçœ‹ä¸€ä¸‹<ahref="https://blog.csdn.net/qq_42557115/article/details/128228201?spm=1001.2014.3001.5506">ç ´è§£æ–¹æ³•</a>ï¼Œå¯¹äºæ¢…æ£®æ—‹è½¬ç®—æ³•ä¹‹å‰<ahref="https://sch01ar.github.io/2022/10/16/2021ByteCTF-easyxor/">åšå®¢</a>ä¹Ÿè¯¦ç»†æ¨å¯¼è¿‡ã€‚è¿™é‡Œé’ˆå¯¹é¢˜ç›®åˆ†æä¸€ä¸‹ï¼Œé¦–å…ˆban æ‰äº† 32ä½çš„é¢„æµ‹æ–¹æ³•ï¼Œé€šè¿‡äº†è§£åˆ°ï¼Œ<code>randcrack</code>åº“å®é™…ä¸Šæ˜¯é€šè¿‡æ”¶å–ç‰¹å®šä½æ•°æ¥å®ç°é¢„æµ‹ï¼Œä¾‹å¦‚32 ä½æ•°ï¼Œå°±éœ€è¦ 624 ä¸ªï¼Œé‚£ä¹ˆå¦‚æœä½¿ç”¨ 64 ä½æ•°ï¼Œåº”è¯¥å°±éœ€è¦ 312ä¸ªã€‚åç»­åªè¦å¯¹æ”¶å–çš„æ•°å­—è¿›è¡Œä¸€ä¸‹å¤„ç†ï¼Œè½¬æˆ 624 ä¸ª 32 ä½æ•°å³å¯ã€‚è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªç–‘é—®å°±æ˜¯ï¼Œæœ€å¤§çš„ 64 ä½æ•°æ˜¯<spanclass="math inline">\(2^{64}-1\)</span>ï¼Œä½†æ˜¯å¦‚æœä¼ <spanclass="math inline">\(name=2^{64}-1\)</span>å°±æ— æ³•é¢„æµ‹ï¼Œè€Œæ”¹æˆå…¶ä½™ç•¥å°ä¸€ç‚¹çš„64 ä½æ•°å³å¯ã€‚</p><h4 id="exp">exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> randcrack <span class="hljs-keyword">import</span> RandCrack<br>r=remote(<span class="hljs-string">&quot;210.30.97.133&quot;</span>,<span class="hljs-string">&#x27;28032&#x27;</span>)<br>r.recvuntil(<span class="hljs-string">b&#x27;:&#x27;</span>)<br>name=<span class="hljs-number">2</span>**<span class="hljs-number">64</span>-<span class="hljs-number">2</span><br>name=long_to_bytes(name)<br><span class="hljs-built_in">print</span>(name)<br>r.send(name)<br>r.recv()<br>count=<span class="hljs-number">0</span><br>file = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;random.txt&quot;</span>,<span class="hljs-string">&quot;w&quot;</span>)<br><span class="hljs-keyword">while</span> count&lt;<span class="hljs-number">312</span>:<br>    r.send(<span class="hljs-string">b&#x27;1&#x27;</span>)<br>    r.recvuntil(<span class="hljs-string">b&#x27;:&#x27;</span>)<br>    num=<span class="hljs-built_in">int</span>(r.recvuntil(<span class="hljs-string">b&#x27;\n&#x27;</span>)[:-<span class="hljs-number">1</span>])<br>    count+=<span class="hljs-number">1</span><br>    file.write(<span class="hljs-built_in">str</span>(num)+<span class="hljs-string">&quot;\n&quot;</span>)<br>file.close()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;finish&quot;</span>)<br><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">r&#x27;random.txt&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    l = f.readlines()<br>l = [<span class="hljs-built_in">int</span>(i.strip()) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> l]<br>t = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(l)):<br>    t.append(l[i] &amp; (<span class="hljs-number">2</span> ** <span class="hljs-number">32</span> - <span class="hljs-number">1</span>))<br>    t.append(l[i] &gt;&gt; <span class="hljs-number">32</span>)<br><br>rc = RandCrack()<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(t))<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> t:<br>    rc.submit(i)<br>guess=rc.predict_getrandbits(<span class="hljs-number">64</span>)<br>r.send(<span class="hljs-built_in">str</span>(guess).encode())<br><span class="hljs-built_in">print</span>(r.recvline())<br><span class="hljs-comment"># DUTCTF&#123;61cdf3eb-e4d9-4613-b533-ff4f7fb6c80a&#125;</span><br></code></pre></td></tr></table></figure><h3 id="shamir">shamir</h3><p>ç›´æ¥æ‰¾è„šæœ¬è·‘ï¼Œå…·ä½“å¦‚ä½•æ¢å¤ a0 ç³»æ•°å°±ä¸ç»†è¯´äº†ã€‚ä¹‹å‰ hitcon æœ‰ä¸ªä¹Ÿæ˜¯shamir çš„é¢˜ï¼Œä¹ŸæŒºæœ‰æ„æ€çš„ã€‚<ahref="https://sch01ar.github.io/2022/11/28/hitcon2022-BabySSS/">babysss</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br>P = PolynomialRing(GF(p), <span class="hljs-string">&#x27;x&#x27;</span>)<br>ret = P(<span class="hljs-number">0</span>)<br><span class="hljs-keyword">for</span> x, y <span class="hljs-keyword">in</span> shares:<br>    r = P(<span class="hljs-number">1</span>) * y<br>    <span class="hljs-keyword">for</span> xx, yy <span class="hljs-keyword">in</span> shares:<br>        <span class="hljs-keyword">if</span> x != xx:<br>            r = r * P((<span class="hljs-number">0</span> - xx) / (x - xx))<br>    ret = ret + r<br><span class="hljs-built_in">print</span>(ret)<br><br>P = PolynomialRing(GF(p), <span class="hljs-string">&#x27;x&#x27;</span>)<br>ret = P(<span class="hljs-number">0</span>)<br><span class="hljs-keyword">for</span> x, y <span class="hljs-keyword">in</span> shares:<br>    r = P(<span class="hljs-number">1</span>) * y<br>    <span class="hljs-keyword">for</span> xx, yy <span class="hljs-keyword">in</span> shares:<br>        <span class="hljs-keyword">if</span> x != xx:<br>            r = r * P(<span class="hljs-string">&#x27;(x - %d) / (%d - %d)&#x27;</span> % (xx, x, xx))<br>    ret = ret + r<br><br><span class="hljs-built_in">print</span>(long_to_bytes(<span class="hljs-built_in">int</span>(ret[<span class="hljs-number">0</span>])))<br><span class="hljs-comment"># b&#x27;DUTCTF&#123;23935a6d-a94d-4905-845a-aec9c8646e4d&#125;&#x27;</span><br></code></pre></td></tr></table></figure><h3 id="ecc1">ECC1</h3><p>å‘ç°æ˜¯ ECDSA ç±»å‹ï¼Œäºæ˜¯ç°å­¦ã€‚ã€‚ã€‚ä¸‹é¢å†™ä¸€ä¸‹ ECDSAçš„ç­¾åä¸éªŒè¯è¿‡ç¨‹ã€‚</p><h4 id="åœºæ™¯">åœºæ™¯</h4><p>Alice æƒ³è¦ä½¿ç”¨å¥¹çš„ç§é’¥<spanclass="math inline">\(d_A\)</span>æ¥ç­¾åï¼ŒBob æƒ³ç”¨ Alice çš„å…¬é’¥ <spanclass="math inline">\(H_A\)</span>è¦éªŒè¯ç­¾å<spanclass="math inline">\(H_A=d_AG\)</span>ã€‚ åªæœ‰ Aliceæ‰èƒ½æä¾›æ­£ç¡®çš„ç­¾åï¼Œè€Œæ¯ä¸ªäººéƒ½å¯ä»¥éªŒè¯ç­¾åã€‚</p><h4 id="ç­¾å">ç­¾å</h4><p>1.é€‰å®šä¸€æ¡æ¤­åœ†æ›²çº¿<span class="math inline">\(E_p(a,b)\)</span>ã€‚</p><p>2.é€‰å–ä¸€ä¸ªéšæœºæ•°<spanclass="math inline">\(k,1&lt;k&lt;n-1\)</span>ï¼Œ<spanclass="math inline">\(n\)</span>ä¸ºæ¤­åœ†æ›²çº¿çš„é˜¶ã€‚</p><p>3.é€‰å–æ¤­åœ†æ›²çº¿çš„åŸºç‚¹<span class="math inline">\(G(a,b)\)</span>,è®¡ç®—<span class="math inline">\(K=k * G(a,b)\)</span>ï¼Œä»¤<spanclass="math inline">\(r=K[0]\mod n\)</span>ï¼Œå³ r æ˜¯ K ç‚¹çš„æ¨ªåæ ‡ï¼ˆè‹¥ rä¸º 0ï¼Œé‡æ–°é€‰ k è¿›è¡Œè®¡ç®—ï¼‰ã€‚</p><p>4.è®¡ç®—æ˜æ–‡ M çš„å“ˆå¸Œï¼Œä»¤<spanclass="math inline">\(e=hash(M)\)</span>ï¼Œè®¡ç®—<spanclass="math inline">\(s=k^{-1}(z+rd_A)\mod n\)</span>ã€‚</p><p>5.ç»™å‡ºç­¾å<span class="math inline">\((r,s)\)</span></p><h4 id="éªŒè¯">éªŒè¯</h4><p>1.è®¡ç®— <span class="math inline">\(u_1=s^{-1}z\mod n\)</span></p><p>2.è®¡ç®— <span class="math inline">\(u_2=s^{-1}r\mod n\)</span></p><p>3.è®¡ç®—ç‚¹<span class="math inline">\(P=u_1G+u_2H_A\)</span></p><p>å½“<span class="math inline">\(r=x_P\modn\)</span>æ—¶ï¼Œç­¾åéªŒè¯æˆåŠŸã€‚</p><h4 id="è§£é¢˜è¿‡ç¨‹">è§£é¢˜è¿‡ç¨‹</h4><p>é€šè¿‡å¯¹é¢˜ç›®çš„åˆæ­¥é˜…è¯»ï¼Œå‘ç°å…³é”®æ˜¯æ±‚å‡ºç§é’¥<code>d=privkey</code>ï¼Œè€Œæƒ³è¦æ±‚å‡º<spanclass="math inline">\(d\)</span>å°±è¦æ±‚å‡º<spanclass="math inline">\(k\)</span>ï¼Œè™½ç„¶<spanclass="math inline">\(k\)</span>æ˜¯ä»¥éšæœºæ•°çš„å½¢å¼å‡ºç°ï¼Œä½†å‘ç°æœ¬é¢˜ä¸­æ¯æ¬¡ç­¾åè¿‡ç¨‹çš„ kå¹¶ä¸æ˜¯å®Œå…¨éšæœºï¼Œè€Œæ˜¯çº¿æ€§ä¼ªéšæœº<span class="math inline">\(k = (a * k +b)\mod n\)</span>ã€‚è¿™é‡Œæˆ‘å¾ˆæƒ³æŠŠ<spanclass="math inline">\(k\)</span>æ±‚å‡ºæ¥ï¼Œç„¶åå†å»æ±‚ç§é’¥<spanclass="math inline">\(d\)</span>ã€‚æ‰€ä»¥æœ‰æ²¡æœ‰ä¸€ç§å¯èƒ½ï¼Œä¸ç”¨æ±‚<spanclass="math inline">\(k\)</span>ï¼Œå¦‚æœæŠŠ<spanclass="math inline">\(k\)</span>æ¶ˆæ‰ï¼Œæ–¹ç¨‹é‡Œåªå‰©ä¸€ä¸ªæœªçŸ¥æ•°<spanclass="math inline">\(d\)</span>ï¼Œå³å¯ã€‚ç»†å¿ƒä¸€ç‚¹è¿›è¡Œæ•°å­¦æ¨å¯¼ï¼Œå°±ä¼šå‘ç°ç­”æ¡ˆã€‚<span class="math display">\[k_1s_1=e+r_1d\mod n\]</span> <spanclass="math display">\[k_2s_2=e+r_2d\mod n\]</span> <spanclass="math display">\[k_2=ak_1+b\mod n\]</span> <spanclass="math display">\[k_2=ak_1+b+xn\]</span> <spanclass="math display">\[s_1s_2k_2=s_1s_2ak_1+s_1s_2b+s_1s_2xn\]</span><span class="math display">\[s_1(e+r_2d)=s_2a(e+r_1d)+s_1s_2b \modn\]</span> <spanclass="math display">\[d=(s_1r_2-s_2ar_1)^{-1}(s_2ae-s_1e+s_1s_2b)\modn\]</span></p><p>è¿™é‡Œä¸¤æ¬¡çš„ä½¿ç”¨çš„<spanclass="math inline">\(e\)</span>ä¸€æ ·ï¼Œæ˜¯å› ä¸ºä¼ çš„æ˜æ–‡ä¸€æ ·ï¼Œ<spanclass="math inline">\(n\)</span>å¯¹åº”çš„æ˜¯é¢˜ç›®é‡Œç»™çš„<spanclass="math inline">\(order\)</span>ã€‚è¿™é‡Œè¿˜æƒ³è¯´ä¸€ä¸‹è‡ªå·±å› ä¸ºä¸ç»†è‡´èµ°è¿‡çš„å¼¯è·¯ï¼Œé¢˜ç›®é‡Œé€šè¿‡<spanclass="math inline">\(p\)</span>å®šä¹‰çš„æ›²çº¿ï¼Œæ‰€ä»¥è¯¯ä»¥ä¸º<spanclass="math inline">\(curve.order\)</span>æ˜¯<spanclass="math inline">\(p\)</span>ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´å‰ä¸¤ä¸ªå¼å­å’Œç¬¬ä¸‰ä¸ªç®—å¼çš„æ¨¡æ•°ä¸åŒã€‚æœ‰è¶£çš„æ˜¯ï¼Œæ‰¾åˆ°äº†ä¸€ç¯‡è®ºæ–‡å’Œæ–‡ç« è¿›è¡Œäº†å®ç°ã€‚<a href="https://cseweb.ucsd.edu/~mihir/papers/dss-lcg.pdf">è®ºæ–‡</a>ä½†å…¶å®<spanclass="math inline">\(curve.order=order\)</span>æ‰€ä»¥ä¸Šè¿°æ‰€æœ‰éƒ½æ˜¯åœ¨æ¨¡<spanclass="math inline">\(orderçš„æ¡ä»¶ä¸‹\)</span>ï¼Œæ‰€ä»¥è¿›è¡Œä¸€ä¸‹æ¨å¯¼å°±å‡ºäº†ã€‚</p><h4 id="exp-1">exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha384, sha256<br><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> randint<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">from</span> Crypto.Util.Padding <span class="hljs-keyword">import</span> pad<br><span class="hljs-keyword">import</span> base64<br>r1=<span class="hljs-number">3279878223466283028618950233302638071226405889025719666069973709805626015547691183378582347284741486262757601498554</span><br>s1=<span class="hljs-number">17384499590667625694725422408289434727888355224304513038330377593191514147527427495591599008735913255202229321517643</span><br>r2=<span class="hljs-number">35791573017068929691265773591779771913506228775796561985255300322790112181066670265127516180574601131688667017030763</span><br>s2=<span class="hljs-number">10828760915074235995526547174613537265169576586247069263719047150071416454765113291660131007073071569964390274403778</span><br>order = <span class="hljs-number">0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973</span><br>a = -<span class="hljs-number">3</span><br>b = <span class="hljs-number">0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef</span><br><br>m=<span class="hljs-string">b&#x27;12&#x27;</span><br>e= <span class="hljs-built_in">int</span>(sha384(m).hexdigest(), <span class="hljs-number">16</span>)<br><br>d=((s2*a*e-s1*e+s1*s2*b)*gmpy2.invert(s1*r2-s2*a*r1,order))%order<br><br>privkey=d<br>ct=<span class="hljs-string">&quot;Iq2XtaYU4TrhdPN6Icyy4r5FQQRn4u/QY7Rv/GTMeo8mNESW7UMcHO969aP28owj&quot;</span><br>key = sha256(<span class="hljs-built_in">str</span>(privkey).encode()).digest()<br>aes = AES.new(key, AES.MODE_ECB)<br>flag = aes.decrypt(base64.b64decode(ct))<br><span class="hljs-built_in">print</span>(flag)<br><span class="hljs-comment"># b&#x27;DUTCTF&#123;03c77266-981a-49c7-985c-427dea8c3018&#125;\n\x03\x03\x03&#x27;</span><br></code></pre></td></tr></table></figure><h3 id="ecc2">ECC2</h3><p>hint:äºŒå…ƒ copper çœ‹åˆ° hint ç¬é—´çŸ¥é“æ€ä¹ˆåšäº†ï¼Œå‰æ®µæ—¶é—´åˆšå­¦äº†ä¸€ä¸‹å¤šå…ƒcopperï¼Œæ„Ÿæ…¨ä¸€ä¸‹è¿˜æ˜¯è¿ç”¨ä¸ç†Ÿç»ƒï¼Œæ²¡æœ‰ä¸€çœ¼å‘ç°ã€‚</p><h4 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h4><p>åŒæ ·æ˜¯ ECDSAï¼Œç›¸æ¯”äºä¸Šé¢˜æ¥è¯´ï¼Œk æ˜¯éšæœºçš„ï¼Œä½†æ˜¯æ¯æ¬¡ç­¾åçš„æ—¶å€™ä¼šæ³„éœ² kçš„é«˜ä½ã€‚æ­¤é¢˜å¦å¤–ä¸€ä¸ªå…³é”®æ˜¯ï¼Œ<spanclass="math inline">\(r\)</span>æ˜¯ç”±ç§é’¥<spanclass="math inline">\(d\)</span>ç”Ÿæˆçš„ï¼Œæ‰€ä»¥ä¸ç®¡ä¼ ä»€ä¹ˆæ˜æ–‡ï¼Œæ‰€å¾—åˆ°çš„<spanclass="math inline">\(r\)</span>æ˜¯ä¸€æ ·çš„ï¼Œåˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ ä¸€ä¸ªäºŒå…ƒæ–¹ç¨‹ã€‚<span class="math display">\[s_1k_1=z_1+dr \mod n\]</span> <spanclass="math display">\[s_2k_2=z_2+dr \mod n\]</span> <spanclass="math display">\[k=kh+kl\]</span> <spanclass="math display">\[s_1(k_1h+k_1l)-z_1=s_2(k_2h+k_2l)-z_2 \modn\]</span> <spanclass="math display">\[f(k_1l,k_2l)=s_1(k_1h+k_1l)-z_1-s_2(k_2h+k_2l)+z_2\]</span>éšåä½¿ç”¨å¤šå…ƒ copper è¿›è¡Œæ±‚è§£ã€‚å…·ä½“å¯çœ‹ä¸Šç¯‡åšå®¢ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> itertools<br><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">small_roots</span>(<span class="hljs-params">f, bounds, m=<span class="hljs-number">1</span>, d=<span class="hljs-literal">None</span></span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> d:<br>        d = f.degree()<br>    R = f.base_ring()<br>    N = R.cardinality()<br><br>    f /= f.coefficients().pop(<span class="hljs-number">0</span>)<br>    f = f.change_ring(ZZ)<br><br>    G = <span class="hljs-type">Sequence</span>([], f.parent())<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m + <span class="hljs-number">1</span>):<br>        base = N ^ (m - i) * f ^ i<br>        <span class="hljs-keyword">for</span> shifts <span class="hljs-keyword">in</span> itertools.product(<span class="hljs-built_in">range</span>(d), repeat=f.nvariables()):<br>            g = base * prod(<span class="hljs-built_in">map</span>(power, f.variables(), shifts))<br>            G.append(g)<br><br>    B, monomials = G.coefficient_matrix()<br>    monomials = vector(monomials)<br><br>    factors = [monomial(*bounds) <span class="hljs-keyword">for</span> monomial <span class="hljs-keyword">in</span> monomials]<br>    <span class="hljs-keyword">for</span> i, factor <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(factors):<br>        B.rescale_col(i, factor)<br><br>    B = B.dense_matrix().LLL()<br><br>    B = B.change_ring(QQ)<br>    <span class="hljs-keyword">for</span> i, factor <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(factors):<br>        B.rescale_col(i, <span class="hljs-number">1</span> / factor)<br><br>    H = <span class="hljs-type">Sequence</span>([], f.parent().change_ring(QQ))<br>    <span class="hljs-keyword">for</span> h <span class="hljs-keyword">in</span> <span class="hljs-built_in">filter</span>(<span class="hljs-literal">None</span>, B * monomials):<br>        H.append(h)<br>        I = H.ideal()<br>        <span class="hljs-keyword">if</span> I.dimension() == -<span class="hljs-number">1</span>:<br>            H.pop()<br>        <span class="hljs-keyword">elif</span> I.dimension() == <span class="hljs-number">0</span>:<br>            roots = []<br>            <span class="hljs-keyword">for</span> root <span class="hljs-keyword">in</span> I.variety(ring=ZZ):<br>                root = <span class="hljs-built_in">tuple</span>(R(root[var]) <span class="hljs-keyword">for</span> var <span class="hljs-keyword">in</span> f.variables())<br>                roots.append(root)<br>            <span class="hljs-keyword">return</span> roots<br><br>    <span class="hljs-keyword">return</span> []<br><br>p=<span class="hljs-number">0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973</span><br>z1=<span class="hljs-number">48635463943209834798109814161294753926839975257569795305637098542720658922315</span><br>s1=<span class="hljs-number">28960557153977955124105855928246892459194129539041010907864680412903817675556585052129118747753883286132889323816650</span><br>r1=<span class="hljs-number">10262329650789864528165246046678664604936098138502587549051188712903293032192883286179241289544424703403302125420513</span><br>kh1=<span class="hljs-number">30054462723734257949377771041701920514235184485792075736773676269952584122368</span><br><br>z2=<span class="hljs-number">96094161643976066833367867971426158458230048495430276217795328666133331159861</span><br>s2=<span class="hljs-number">32768223277193629352710157834142251230132284853883889815139295450898873765110205447982974111022207901310306828066654</span><br>kh2=<span class="hljs-number">72175458450676302934456504495778373001580390042980746283386923644015828008960</span><br>P.&lt;l1,l2&gt; = PolynomialRing(Zmod(p))<br>f = s1*(kh1+l1)-z1+z2-s2*(kh2+l2)<br>roots=small_roots(f,[<span class="hljs-number">2</span>^<span class="hljs-number">123</span>,<span class="hljs-number">2</span>^<span class="hljs-number">123</span>],m=<span class="hljs-number">4</span>,d=<span class="hljs-number">4</span>)<br><br>k1=kh1+roots[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]<br><span class="hljs-built_in">print</span>(k1)<br>d=(s1*k1-z1)*gmpy2.invert(r1,p) %p<br><span class="hljs-built_in">print</span>(d)<br><br></code></pre></td></tr></table></figure><h3 id="ez_rsa">ez_RSA</h3><p>hint 1:<ahref="https://www.ijcsi.org/papers/IJCSI-9-2-1-311-314.pdf">è®ºæ–‡</a></p><p>hint 2:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">_P = getPrime(<span class="hljs-number">512</span>)<br>_Q = getPrime(<span class="hljs-number">512</span>)<br>_E = getPrime(<span class="hljs-number">128</span>)<br></code></pre></td></tr></table></figure><h4 id="è§£é¢˜æ€è·¯-1">è§£é¢˜æ€è·¯</h4><p>é€šè¿‡è®ºæ–‡ï¼Œå‰åŠéƒ¨åˆ†ç™½ç»™ï¼ŒæŒ‰ç…§è®ºæ–‡é€ æ ¼ï¼Œå³å¯è§„çº¦å‡º<spanclass="math inline">\(_P\)</span>ã€‚ æ¥ä¸‹æ¥çš„é—®é¢˜å°±æ˜¯å¦‚ä½•æ±‚<spanclass="math inline">\(_E\)</span> <span class="math display">\[c=rh+m\mod p\]</span> <span class="math display">\[h=f^{-1}g \mod p\]</span>å°†ä¸€å¼å¸¦å…¥äºŒå¼ <span class="math display">\[c=r(f^{-1}g)+m \modp\]</span> <span class="math display">\[cf=rg+mf \mod p\]</span> å› ä¸º ræ˜¯ 1024 ä½ï¼Œg æ˜¯ 768 ä½ï¼Œf æ˜¯ 1024 ä½ï¼Œm æ˜¯ 128 ä½ï¼Œp æ˜¯ 2048 ä½ï¼Œæ‰€ä»¥<span class="math display">\[rg+mf \mod p=rg+mf\]</span> <spanclass="math display">\[cf \mod p=rg+mf\]</span> ä¸¤è¾¹åŒæ—¶å¯¹<spanclass="math inline">\(g\)</span>å–æ¨¡ï¼Œå³å¯æ¶ˆå»æœªçŸ¥æ•°<spanclass="math inline">\(r\)</span>ï¼Œå¾—åˆ° <spanclass="math display">\[m=(f*c \mod p)*f^{-1} \mod g\]</span></p><h4 id="exp-2">exp</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><br><br>N = [<span class="hljs-number">24488505552230772703898405057744092798020197662887100045928566607461798879415998969433911671592867423691193007893212171790448148496033832249754470467035859576039972852765027824033483902812925380301406741140813221150182954931965513380139064574526788102105668393014229432860117219535402978106934989998539012187109667064745849634399649647736413364618806713226228056106971513481416594701372170640645464293015870036724187258748076791656956875094445695553182473517994436554776090668857119474259698867998753960189992604478465847990459188823363076285013562416943842050784320042575258091833845135161380009815903587838764844701</span>, <span class="hljs-number">21942338208435084182385640211704681707801054068614769447992577290797559734360545040045515934790906815025864580810713391648536011436866691247019862082665443291278436035391244597094754164488282306715119916684441028200752060845757620891120126278315497677949907573669523197492597821720339218427123565023326747131520068041684678463047030113730829126604863370010551660281077018828022548643645226108297487424616446107497927195470395775786882432946367941603909313849788734757826143420030667354373800077810995031850751976273876305078673953634214542034076821701690757305733970718313282246021719246282428899044959387451493813721</span>, <span class="hljs-number">23497668455233023777086339110715316747963597549643382192342253292465976405928871970112373689839058903850148485020472785615984665835691940413204367982444656171214501783518611386935865837214185153287455312882873758597381603828243325547041133407750654379328638375958886679826484549746013150412316456105776249088635607093923492322952956766124054779608085768835524352691098655090967034048099181640575487096512809322011207592050807314037459121218823863349190706610153922549826130316241130228507499742267531513164868277365453995102439631325485240239658064278370772323955597197097645462559462696920075736717500412375072176467</span>, <span class="hljs-number">24602752336390525414690399431651054304570268658699514976379562458281671118195956305892712759109048179159883455858696847532969723511866788216663843505906403537667342180926673360088955074821393941870156428046985578754285100772721826939367053016610705219388473954106242835781778652607226825374256068393417345461655468867721352760378170127520095819323941371368236422448970366651248269187025683922130051664854342633071652748279316861774478515760339148013907026473066156906456471149913011825141372049833977982484234333570458678135686171332929999460166919896376717386857118613691507888393949301977627819777979592178896966623</span>, <span class="hljs-number">18953499185208189736030572848209776079906463657279533180726462147347299551041367061731767581264798291046925335336327748600462387056921448905471076513661226975709082926810559345546174299411679334921753473024289680372398629669189901701373013365576241051181536865537903618404021542712933154242921449622232452683929678888579145745315642541459705378712865701616368909067164933131032658834080355333776051792137130753989546439723368685913285626433094254606871447681788888268092549602747826573836417735293177348298419537651913321751942895245511550484631808345929882169885236619551016828298778897908525366562962685667912389997</span>, <span class="hljs-number">26058997074784206404795420975966370332956308684314157918342868748891408356160719486198464051733976893317939197082091977103538589213919661919071445422553112631329635223235217838410237178255375880503961177672498539855597740321555211143834639913980706595866117350864736716804583363460558182596815041999893879570562385793992073242663001875888252374638338786999498583269912809638941228890064879230976750529250265485928246165002061153079962922548580197649819298400367411220374463545622395097310522274479190791404838638086998257879095579646234740048206108128561416400963440017838636610491341835198236244222159900729586179917</span>, <span class="hljs-number">20129288490597244863994508524683286916543923374256909422701726115895380145135775471811451623704583730973416890276995662068307971557772661682030720361327963488534216410626882836351191572216702896255347307172468393873617456534444076131643183095198850704362841759392439604384236671314273401344802110069810756951497132798868529183844409689240676486910668076940982100512452093237882154916463456686838284295430539114311525041035893514486445447797574059480052756975515999613849122461978469862438350168200833428502345669466715840072957576654100577765563579448919948971960189182499058054213819157835509700663218459190524786481</span>, <span class="hljs-number">25772226888628216378889012105665796465806282302724456587869873910973423334812434127373733072599928022616753628676669330475503814215217145564188824369324420571202597054472716155179526532355187639821238629970447579319002750207485409261447903974934743921421644358692562332522542087034591326117205324672579857803562028718153429724027759486210144857662620406921986137992325725929734137942692560079628569267164743942853035640478323806095958927790086262013882385080985080476481526342090748836288133196655325636773255199453976910823102554721967925125346896277653138394770159352125883696418264884829676269343523006494765489493</span>, <span class="hljs-number">28180917678264096364213130554312518769321694756137354982942466799600070334989648086800577578199737775401103316802639534494851192425673873971245152762518574367704605203711578476934662035721848792226778740807648983742493303616228706844886115523257289936262329494196476301758716578131772761063410479805704963231509036888772912085068364409900628643478825960092268089737383336074494922924828657292311276635453573546156537729462748165148899289836500996916977979364330535388109166791384761518107152445520068189599143970118706438070727813977600299673995541318641712212956428068655583090081599129833822672148472274657395494311</span>, <span class="hljs-number">24096520981594733135540041445045293573841960767599910205052334165000928248824939510537161616790497646941116274229120870236655788506537976075387985908332620383393482411221069123523398118152293411915859727395926627459816089411701261045912226055104998834013378345004735522524517047738956815571358744380828133660488637141981661993087692525146337627421105058036188111847939723347406549254328070707781083013868559585263821261988100254326668273025331949480627178076069223680391626817412433551120273746233452706538363782378142581856137151539947066350167731639115192474458725211790700741814914076862192417315078235105797677087</span>]<br>e = [<span class="hljs-number">14990816743505654628622165338185393514788304851681933876648378016378133833004552588239572072513331166211546424386679543805403883223923897158291656742820659945559107645757683415181516223375888892537454654274671604670730747216886153077537316948532577370868893079392334339867710645123984583810773407647889550347449753485123831550537129872419324613572762662943117457398292227733753412373200584443331215704089181076331725835197653425535473266783470265927502335277809501441179341787793626320140280547900249747914540629687582748709954430668955769537357213201938032236484707582662514737019038265736833188979186130912521585863</span>, <span class="hljs-number">13980763827627068753802142437506147756961327147120384846585792065753477874831749262150192356232427534646403824833533108774540560060637613211774874146149413276494249299817871570564680188453788941137026336224153892313514846782554574856039742426326880334039809963027869250565380677631559930557470002669597495218354140744423266568608599391371104543521898824208746495592540223292285013253969918044073047052609539584913355840849256854717119937629706258126113370733925178495605830457126093047938416483351881694926018583377081560677662700573997147306413923358544678275002331286891558769920350415867546838176106256496063304591</span>, <span class="hljs-number">14780579063990891009355254665451991842503160008305503704320535457678300669711337036613671205753152064334928698447349080369975612980241221790534610771459317421130389318122536272425617948089698175341164528907013863717279614308846442304043798865582825561326523712699604113706443659794242165306104800524140375312705427738731082746546483455937494834598516633798602613773983973082013405488005834441952593810114149056842051193479897318422863626404580404473988124447913889995503058357464905293074956766641790136082627384940112558905750637675896060873962861100183982056080416496196938621664845449511253953693501170360085128903</span>, <span class="hljs-number">16711214191457281887756669342902780733937448803879374453283083153045867559930627177819085640533933761065820583745596344138637603092032409736562935244419493366400643159102093212367352079844413274114447848612728357893278528717959336656627368619208606671105396151558788997816807664937857266355753831602315622410363783260969617861338922264348857939060068689390352416811884902181820721198554329654234974727685100909871157125199506067300247610609375498829939581959252431781213219581899029244337677995603856416381628617372391009770342970567780661612096558829742694823690274654577788829371605600329173594776863959477520982103</span>, <span class="hljs-number">18594117439975066482790234032790248484174823520961644528083330915871018572967431566501699139228578176001011256220804587663135499149059407383901633734350030924262764120967872313971006208598335484653360543538290425602814914998281169215776238281191659744867774608489555339417931965559389905685260689276642846548237827078605788634420231309087514322505420366400886676286045230690585373663959941903912684043605972772430437021974723246305737570908098822722309519738296040046616628592027960453261069541838924103183139583780034839530714165332756110278585636399031079295623434558699098474195076126900986950380911451241239011623</span>, <span class="hljs-number">19559194708926966384760572911017873704390901879016615709461235634857479293981826218552827124678431912373841237544670086117088143163449428902590870488332804443126943800454719812933352578428975217906573009588458046733219592409163112257629384965561668227155289274870789279692570923323341070702638493390067659325308762774741975186341363197445143155212450927975486461028431348416961669886795040925540481784741277337652763782276077736249466953316651582151597935395446083479237519148263818662252163299112568786641111937462894974201544836218414635476953190320368111973284227681772063712004605784879340270632621230933987836403</span>, <span class="hljs-number">5824897109429461861038559948506819313355946138347155891819686064252333158962143819073087399430296860592162523314581575301694562287944866650117694395235555843552189332034264692080727548447621159473572891967606750661558342895087758387175261905746359083324985663989695094130538863365332293493187900142223849133010181832891103712795299278734353222329578233927239011173519663168582557337156776620015916288674042041517496559833923719141125286924436626406982998776488087846464518298748666520211469343659082499491328257233064132961965360640582912978294198510457897250297734712016272553820127075579291175789492076788909484903</span>, <span class="hljs-number">20093930684870093704403628731447520798260787667650361930073915794127380334852577783044260869395685576326078666945720832081037254077260101666695730827561930288288626012593987518548527306424423460475649408280260551546890648986667166140359311359169025356693571920643668500080642858683961398169608007993750190342851289303457474260980188486985907096713430933611341247919058812281901199513792393764217087020138671598226265365230063697174126442928938906561077393855304164795051437164668523033528227661541499372034727485518105697908307910643724070408695313764548498315363035914104961938999577929197200252814942475110976180871</span>, <span class="hljs-number">13869037204167094886192017467762072572783689922376209408114704992930196660451733740128770089390429756385424487822227154417591526218831614700313009517560442765341004656007062383066045588028985918307953894476640133705870038747226187376945281065288052642888278440278584213451675290377535235274143342509678251099489519546607275875817452579354452528872170870264159683907581449035523356408903151369434094661409904630205371744727229020444462773195914556915394012165505241756167908324547409015797008797997989972788159358702567092724994056441270029746996952711879409266397452428164494981358551995284408128900801847197898197703</span>, <span class="hljs-number">16428914441257851380586127106058764321964408189162357989041855273182059205104249998708456730725826756916884625752948925439260021807286451208792938938383227370712775700520945386124870496736574155128284017251496087747219850551258429445192925803640362009834613809916245072076167924064602020863892399904864291654032814159981274305358311150518930746678429624443100376055916453000181475668378167017592583982166064823738703442241236483326956657714675862739661758651886000087664689028808007926485550765412244122793538316265219584816933243708850098752213795555147857155308284006310944783836011777029728050734557927695090450463</span>]<br>h = <span class="hljs-number">17057560302480534379234311167711354032439973325482676122782839023838935814408613403284668375931576462858905421541683065236603421317254300086508655626651873266040666001440382609416143327328595694650892654181322169131419137499521806171136667190680286550054757614439176120722968245637537762536027151112462471175128228332115872386914009028917282712969864162014534349894097630435981616397927996659304774192119923204194457170407620951605854984132096323757248091094843032025335275329879498464954795905069479922445973408638012299137799439137333602346053104379692214857680138658746271359584207903024337671041791120368370062433</span><br>p = <span class="hljs-number">23179145952004786572757983799234920430633779535677420935312084200876619976669209523097965011942953301009181896712798356246795541216866485028100154585670368454638903095414689361363165856795506643767180784134469175448265110332780161626935638201727064861000660550974538859215360585812084437914540257823591140036538883159605868368631634046489596162666365138195416471349119538264390305637634631928131927917205635961354890675410476331906772088716752701051345455548022086136550213407689965095213596763864324407875037568058288772731307077778493908925797859779443512010698291195779124551476846827399730849219310626324177039013</span><br>c = <span class="hljs-number">15328778973393120290854691400883441405718565831853248832402785901824594060217263898505045095423915117607252735027062529235271181273369158106663012261516839968695274180392897131714116184427167484636074174222379080262947055141246928560805523812182030937490501937675882728123658706241797231583047415776685427205848679710458819937970889433693918217229443853850611378434132748815873718734347796950384002864988580300986131985895380275684001917985319042538513477446695790524025775222264595925792957208966818239868486709939779314546467392281422991680454815958889806132331710070011646205598326181711484973483426663596859525513</span><br>ct = <span class="hljs-number">92211459133895146158316008050625159602789832393085884570037939094818571988249290759248366005098334922507923902443804233324386547155962452204674766600765935956870916648760769384276856753284267120760668354671997896119514989451662121408491558308921051289732075282614190244970934960030795710538169872218350493341</span><br><span class="hljs-comment"># æ±‚E</span><br>M = Matrix([[<span class="hljs-number">1</span>, h], [<span class="hljs-number">0</span>, p]])<br>fg = M.LLL()[<span class="hljs-number">0</span>]<br>f, g = <span class="hljs-built_in">abs</span>(fg[<span class="hljs-number">0</span>]), <span class="hljs-built_in">abs</span>(fg[<span class="hljs-number">1</span>])<br>a = f * c % p<br>E = a * gmpy2.invert(f, g)%g<br><span class="hljs-built_in">print</span>(E.bit_length())<br><span class="hljs-comment"># æ±‚P</span><br>t=<span class="hljs-number">10</span><br>B=Matrix(ZZ,t+<span class="hljs-number">1</span>,t+<span class="hljs-number">1</span>)<br>M=gmpy2.iroot(<span class="hljs-built_in">int</span>(N[t-<span class="hljs-number">1</span>]),<span class="hljs-built_in">int</span>(<span class="hljs-number">2</span>))[<span class="hljs-number">0</span>]<br>B[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>]=M<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,t+<span class="hljs-number">1</span>):<br>    B[i,i]=-N[i-<span class="hljs-number">1</span>]<br>    B[<span class="hljs-number">0</span>,i]=e[i-<span class="hljs-number">1</span>]<br>Blll=B.LLL()<br>P=<span class="hljs-built_in">int</span>(<span class="hljs-built_in">abs</span>(Blll[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]//M))<br><br>phi=P-<span class="hljs-number">1</span><br>D=gmpy2.invert(E,phi)<br><span class="hljs-built_in">print</span>(long_to_bytes((<span class="hljs-built_in">pow</span>(ct,D,P))))<br><span class="hljs-comment"># DUTCTF&#123;RsA_1s_rS@_aNd_1att1ce&#125;</span><br><br></code></pre></td></tr></table></figure><h2 id="misc">misc</h2><h3 id="ç­¾åˆ°">*ç­¾åˆ°</h3><p>b ç«™ 21 çº§ pwn ä¾‹ä¼šè¯„è®ºåŒº</p><h3 id="æˆ‘åœ¨å“ª">æˆ‘åœ¨å“ª</h3><p>æ”¾å¤§å›¾ç‰‡çœ‹åˆ°åå…«ä¸­ï¼Œæœç´¢ä¸´æ±Ÿåå…«ä¸­ï¼Œå‘ç°æ˜¯é‡åº†åå…«ä¸­ï¼Œåœ°å›¾ä¸Šæœä¸€ä¸‹é™„è¿‘åœ°é“ç«™ï¼ŒæŒ¨ç€æ¡¥çš„å°±æ˜¯ï¼Œæ›¾å®¶å²©ã€‚</p><h3 id="ä¸è¦æ›´æ–°">ä¸è¦æ›´æ–°</h3><p>æµé‡åˆ†æé¢˜ï¼Œwireshark é‡Œè¿‡æ»¤ä¸€ä¸‹ httpï¼Œæ‰¾åˆ° github ç½‘é¡µ <imgsrc="/img/web.png" /> æ ¹æ® hint æŸ¥çœ‹å†å²æäº¤è®°å½•ï¼Œå‘ç°å‡flagï¼Œå¯¹äºå¯†ç æ‰‹æ¥è¯´ä¸€çœ¼å‡¯æ’’ï¼Œç§»ä½ 13ã€‚ <img src="/img/kaisa.png" /></p><h2 id="web">web</h2><h3 id="trenja">*Trenja</h3><p>F12 æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œæœç´¢ flag å­—æ®µå³å¯ã€‚</p><h2 id="pwn">pwn</h2><h3 id="ä¸­é—´äºº">*ä¸­é—´äºº</h3><p>å¤ªå¥½ç©äº†ï¼ŒåŸç†æ˜¯æ±½è½¦æ»šåŠ¨ç ã€‚bob æ¥å¼€è½¦é—¨ï¼Œæˆªæ–­ï¼Œå¼€é—¨å¤±è´¥ã€‚bobå†å¼€è½¦é—¨ï¼Œæˆªæ–­ï¼Œå‘é€ç¬¬ä¸€æ¬¡æˆªæ–­ä¿¡å·ï¼Œbob å¼€é—¨æˆåŠŸã€‚bobç¦»å¼€ï¼Œæˆ‘ä»¬å‘é€ç¬¬äºŒæ¬¡æˆªæ–­çš„ä¿¡å·ï¼Œæ‰“å¼€è½¦é—¨ï¼</p><h2 id="reverse">reverse</h2><h3 id="è´ªåƒè›‡">*è´ªåƒè›‡</h3><p>æ‹–å…¥ IDAï¼Œalt+t æœç´¢ DUT å³å¯</p><h3 id="game">*GAME</h3><p>ä¸‹æ£‹èµ¢äº†å°±å‡ºäº†</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;dutctf2023wp&quot;&gt;DUTCTF2023wp&lt;/h1&gt;
&lt;h2 id=&quot;å†™åœ¨å‰é¢&quot;&gt;å†™åœ¨å‰é¢&lt;/h2&gt;
&lt;p&gt;ä»”ç»†ä¸€æƒ³è‡ªå·±å­¦ CTF ä¹Ÿä¸€å¹´äº†ï¼Œçºªå¿µä¸€ä¸‹æœ€åä¸€æ¬¡å‚åŠ æ ¡èµ›
ğŸ¥¹ï¼Œæ˜å¹´å¯å°±æ˜¯å‡ºé¢˜äººäº†
ğŸ¤“ã€‚ä½†æ˜¯æ„Ÿè§‰ä¸€å¹´ä»¥æ¥è’åºŸäº†å¾ˆå¤šæ—¶é—´ï¼Œåœ¨å¾ˆå¤šæ–¹é¢å¯¹é¢˜ç›®ä¸ç†Ÿæ‚‰</summary>
      
    
    
    
    <category term="CTF" scheme="https://sch01ar.github.io/categories/CTF/"/>
    
    
  </entry>
  
  <entry>
    <title>Coppersmithç›¸å…³æ”»å‡»</title>
    <link href="https://sch01ar.github.io/2023/03/07/Coppersmith%E6%94%BB%E5%87%BB/"/>
    <id>https://sch01ar.github.io/2023/03/07/Coppersmith%E6%94%BB%E5%87%BB/</id>
    <published>2023-03-07T02:05:45.000Z</published>
    <updated>2023-06-30T02:10:55.040Z</updated>
    
    <content type="html"><![CDATA[<h1 id="åŸç†">åŸç†</h1><p>Coppersmith å®šç†æ˜¯åœ¨ä¸€ä¸ª e é˜¶æ¨¡ n çš„å¤šé¡¹å¼<spanclass="math inline">\(f(x)\)</span>ä¸­ï¼Œè‹¥æœ‰æ ¹å°äº<spanclass="math inline">\(n^{\frac{1}{e}}\)</span>ï¼Œåˆ™å¯ä»¥ç”¨ O(logn)çš„ç®—æ³•æ±‚å‡ºæ ¹ã€‚</p><p>ç›´æ¥æ±‚è§£<spanclass="math inline">\(f(x)\)</span>çš„æ ¹å¯èƒ½æ¯”è¾ƒå›°éš¾ï¼Œåœ¨æ­¤åˆ©ç”¨<code>LLL</code>ç®—æ³•æ±‚å¾—å¤šé¡¹å¼<spanclass="math inline">\(g(x)\)</span>ï¼Œæ±‚å¾—çš„å¤šé¡¹å¼ä¸<spanclass="math inline">\(f(x)\)</span>å…·æœ‰ç›¸åŒçš„æ ¹<spanclass="math inline">\(x_0\)</span>ï¼Œ<spanclass="math inline">\(g(x)\)</span>å…·æœ‰æ›´å°çš„ç³»æ•°ï¼Œä¸”å®šä¹‰åŸŸä¸ºæ•´æ•°åŸŸã€‚</p><p>æœ¬è´¨æ€æƒ³å°±æ˜¯æŠŠæœ‰é™åŸŸä¸Šçš„æ–¹ç¨‹è½¬åŒ–åˆ°æ•´æ•°åŸŸã€‚</p><h1 id="ç†è®ºåŸºç¡€">ç†è®ºåŸºç¡€</h1><p><span class="math display">\[f(x,y) = \sum_{i=0}^{d}\sum_{j=0}^{e}a_{i,j}x^iy^j\]</span></p><h2 id="howgrave-graham">Howgrave-Graham</h2><p><img src="/img/Howgrave.png" /> éœ€è¦æ„é€ ä¸€ä¸ªç³»æ•°æ›´å°çš„å¤šé¡¹å¼ï¼Œ<spanclass="math inline">\(||g(x)||\)</span>ä»£è¡¨èŒƒæ•°ï¼Œå³æœ€å¤§çš„ç³»æ•°ã€‚æ„é€ æ–¹æ³•å¦‚ä¸‹<img src="/img/æ„é€ æ–¹æ³•.png" /></p><h2 id="lll-ç®—æ³•">LLL ç®—æ³•</h2><p>æ ¼åŸºçº¦åŒ–ç®—æ³•ï¼Œé€šè¿‡å¯¹æ„é€ å‡ºçš„æ ¼ï¼Œä»è€Œçº¦åŒ–äº§ç”Ÿç¬¦åˆçº¦æŸçš„å¤šé¡¹å¼ã€‚ <imgsrc="/img/LLL.png" /></p><h2 id="p-é«˜ä½æ”»å‡»">p é«˜ä½æ”»å‡»</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> gmpy2<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> flag <span class="hljs-keyword">import</span> flag<br><br>m=bytes_to_long(flag)<br>n = <span class="hljs-number">25348605574630284342864323710011622959543974652863854537355760576386763162531478272446867731299572532294812374775121121761898206639041068156270466457595336452690367719842145233764550634280981441631262047763246059814963741143303914063537003244814908763379320576260885158458898112416692583017869283284022878603506583499699525249773663841642694427307104140944360804367072787670581252816486834658346431010523135392357008103555699542414687172408709153334263858639251735462278292703380745537045458408951791720967957274781161667526873251066303708008043058246747534357368350540174588670636827470901518225473676343782182718627</span><br>e = <span class="hljs-number">65537</span><br><br>high_p = p&gt;&gt;<span class="hljs-number">462</span><br>c=<span class="hljs-built_in">pow</span>(m,e,n)<br><br><span class="hljs-built_in">print</span>(high_p)<br><span class="hljs-built_in">print</span>(c)<br><br><span class="hljs-comment">#c = 2838585968727601235811102000208810377763570403442263788723014651093563843294336508586280687833863346617299165812054489406097873361940320732653656106836742334351707641172590772691775696065643337783752853707871271348294775407491819788305857447836923575366699374649494685209530440846553788854498950165868767060103944397665695513568787251626526985821169261973233666633938348865538364532419767347878581021598781082997830762785442482278387265054844200419966175619215512361010529309496176507520460375493466772893213031156341155066854128910227539653777680017545678773463877481232404008355330164324877400343396249494527269803</span><br><span class="hljs-comment">#high_p = 14719840533805965441436310401180369285271789871612468412671201109363519708733266615333097147637913934699335461421648585440665652199846830713164628016025539243988107497052</span><br><br></code></pre></td></tr></table></figure><h3 id="exp">exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sage.<span class="hljs-built_in">all</span> <span class="hljs-keyword">import</span> *<br>n = <span class="hljs-number">13139369168613206469808493070119137888363636548621629780897948879328793540933675072448361493321304924953815474270401406259487525517560528123707016104942485164559271692275987380567766009184969340122208041180122234792566147648471202470677782205185423853314467362074540818483729953544353584322270414479260852672948012862257167187569701381652931473637503302338392147780573148724508117699531886205586281824118899931516823621049590863613262210219765105389989391065557707559113268724368695051264276619633555407916385088611885715568165460641318205321508100969473959719364829756492542217470309748646183210141490634293731384313</span><br>p4=<span class="hljs-number">0xce2f93251a3a97404a11c1fe88cf15c7aaf26ffd508ff006933bff2e9ea0c6197a98f1188f03b74b16d564e958a84c877fc0e21faf00f0ae42f26bde226ebf7c9732f17d860b81d139799832d510b91001967fc33ff2d9fbd4c4767fa2438e48</span><br>e = <span class="hljs-number">0x10001</span><br>pbits = <span class="hljs-number">1024</span><br>kbits = pbits - p4.nbits()<br><span class="hljs-built_in">print</span>(p4.nbits())<br>p4 = p4 &lt;&lt; kbits<br>PR.&lt;x&gt; = PolynomialRing(Zmod(n))<br>f = x + p4<br>roots = f.small_roots(X=<span class="hljs-number">2</span>^kbits, beta=<span class="hljs-number">0.4</span>)<br><span class="hljs-keyword">if</span> roots:<br>    p = p4+<span class="hljs-built_in">int</span>(roots[<span class="hljs-number">0</span>])<br>    <span class="hljs-built_in">print</span> (<span class="hljs-string">&quot;n: &quot;</span>, n)<br>    <span class="hljs-built_in">print</span> (<span class="hljs-string">&quot;p: &quot;</span>, p)<br>    <span class="hljs-built_in">print</span> (<span class="hljs-string">&quot;q: &quot;</span>, n/p)<br></code></pre></td></tr></table></figure><h2 id="p-é«˜ä½éƒ¨åˆ†æ³„éœ²">p é«˜ä½éƒ¨åˆ†æ³„éœ²</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sage.<span class="hljs-built_in">all</span> <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br>n = <span class="hljs-number">25348605574630284342864323710011622959543974652863854537355760576386763162531478272446867731299572532294812374775121121761898206639041068156270466457595336452690367719842145233764550634280981441631262047763246059814963741143303914063537003244814908763379320576260885158458898112416692583017869283284022878603506583499699525249773663841642694427307104140944360804367072787670581252816486834658346431010523135392357008103555699542414687172408709153334263858639251735462278292703380745537045458408951791720967957274781161667526873251066303708008043058246747534357368350540174588670636827470901518225473676343782182718627</span><br>p4 =<span class="hljs-number">0x3e67e7cacd2584224fb2026b40afbcc4281bd59f72f7801239d95c61c48ded7649924f794592fce806e032f16c2f4a90466905fc30037317074a6424d8bf078e959a1ed2d8e5c000</span><br>e = <span class="hljs-number">0x10001</span><br>pbits = <span class="hljs-number">1024</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,<span class="hljs-number">4096</span>):<br>    p4=<span class="hljs-number">0x3e67e7cacd2584224fb2026b40afbcc4281bd59f72f7801239d95c61c48ded7649924f794592fce806e032f16c2f4a90466905fc30037317074a6424d8bf078e959a1ed2d8e5c000</span><br>    p4=p4+<span class="hljs-built_in">int</span>(<span class="hljs-built_in">hex</span>(i),<span class="hljs-number">16</span>)<br>    kbits = pbits - p4.nbits()<br>    p4 = p4 &lt;&lt; kbits<br>    PR.&lt;x&gt; = PolynomialRing(Zmod(n))<br>    f = x + p4<br>    f = f.monic()<br>    roots = f.small_roots(X=<span class="hljs-number">2</span>^kbits, beta=<span class="hljs-number">0.4</span>)<br>    <span class="hljs-keyword">if</span> roots:<br>        p = p4+<span class="hljs-built_in">int</span>(roots[<span class="hljs-number">0</span>])<br>        <span class="hljs-built_in">print</span>( <span class="hljs-string">&quot;n: &quot;</span>, n)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;p: &quot;</span>, p)<br>        <span class="hljs-built_in">print</span> (<span class="hljs-string">&quot;q: &quot;</span>, n//p)<br>        <span class="hljs-keyword">break</span><br>phi = (p - <span class="hljs-number">1</span>) * (q - <span class="hljs-number">1</span>)<br>d = gmpy2.invert(e, phi)<br><span class="hljs-built_in">print</span>(long_to_bytes(<span class="hljs-built_in">pow</span>(c, d, n)))<br></code></pre></td></tr></table></figure><h2 id="q-ä½ä½å’Œ-p-é«˜ä½">q ä½ä½å’Œ p é«˜ä½</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> gmpy2<br><br>p_high = <span class="hljs-number">1514296530850131082973956029074258536069144071110652176122006763622293335057110441067910479</span><br>q_low = <span class="hljs-number">40812438243894343296354573724131194431453023461572200856406939246297219541329623</span><br>n = <span class="hljs-number">21815431662065695412834116602474344081782093119269423403335882867255834302242945742413692949886248581138784199165404321893594820375775454774521554409598568793217997859258282700084148322905405227238617443766062207618899209593375881728671746850745598576485323702483634599597393910908142659231071532803602701147251570567032402848145462183405098097523810358199597631612616833723150146418889589492395974359466777040500971885443881359700735149623177757865032984744576285054725506299888069904106805731600019058631951255795316571242969336763938805465676269140733371287244624066632153110685509892188900004952700111937292221969</span><br>enc = <span class="hljs-number">19073695285772829730103928222962723784199491145730661021332365516942301513989932980896145664842527253998170902799883262567366661277268801440634319694884564820420852947935710798269700777126717746701065483129644585829522353341718916661536894041337878440111845645200627940640539279744348235772441988748977191513786620459922039153862250137904894008551515928486867493608757307981955335488977402307933930592035163126858060189156114410872337004784951228340994743202032248681976932591575016798640429231399974090325134545852080425047146251781339862753527319093938929691759486362536986249207187765947926921267520150073408188188</span><br>e = <span class="hljs-number">65537</span><br>mod = <span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>,<span class="hljs-number">265</span>)<br>p0 = n * inverse_mod(q_low,mod) % mod<br>PR.&lt;x&gt; = PolynomialRing(Zmod(n))<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>**<span class="hljs-number">5</span>):<br>    f = p_high * (<span class="hljs-number">2</span>^<span class="hljs-number">724</span>) + p0 + (x * <span class="hljs-number">32</span> + i) * mod<br>    f = f.monic()<br>    out_p = f.small_roots(<span class="hljs-number">2</span>^<span class="hljs-number">454</span>,<span class="hljs-number">0.4</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(out_p) != <span class="hljs-number">0</span>:<br>        <span class="hljs-built_in">print</span>(out_p[<span class="hljs-number">0</span>])<br>        <span class="hljs-keyword">break</span><br>p = out_p[<span class="hljs-number">0</span>] * <span class="hljs-number">32</span> + i * mod + p_high * (<span class="hljs-number">2</span>^<span class="hljs-number">724</span>) + p0<br><span class="hljs-comment"># print(p)</span><br>p = <span class="hljs-number">133637329398256221348922087205912367118213472434713498908220867690672019569057789598459580146410501473689139466275052698529257254973211963162087316149628000798221014338373126500646873612341158676084318494058522014519669302359038980726479317742766438142835169562422371156257894374341629012755597863752154328407</span><br><span class="hljs-keyword">assert</span> n % p == <span class="hljs-number">0</span><br>q = n // p<br>fai_n = (p-<span class="hljs-number">1</span>) * (q-<span class="hljs-number">1</span>)<br>d = inverse_mod(e,fai_n)<br>m = <span class="hljs-built_in">pow</span>(enc,d,n)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">bytes</span>.decode(long_to_bytes(m)))<br></code></pre></td></tr></table></figure><h2 id="dp-é«˜ä½æ”»å‡»">dp é«˜ä½æ”»å‡»</h2><p>ç»™å®š<spanclass="math inline">\(e,n,c,dp_0,k,\;dp_0=dp&gt;&gt;k\)</span></p><p><span class="math display">\[edp\equiv ed\equiv 1\;mod\;(p-1)\\edp=k(p-1)+1\\edp+k-1=kp\\edp+k-1 \equiv 0\; mod\; p\\\because dp&lt; p-1\\\because edp=k(p-1)+1\\\therefore e&gt;k\\\therefore e(dp_0 &lt;&lt; k+x)+k-1 \equiv 0\;mod\;p\]</span></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> gmpy2<br><br>p = getStrongPrime(<span class="hljs-number">512</span>)<br>q = getStrongPrime(<span class="hljs-number">512</span>)<br>n = p * q<br>phi = (p - <span class="hljs-number">1</span>) * (q - <span class="hljs-number">1</span>)<br>e = <span class="hljs-number">7621</span><br>d = gmpy2.invert(e, phi)<br><br>flag = <span class="hljs-string">b&quot;flag&#123;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#125;&quot;</span><br>c = <span class="hljs-built_in">pow</span>(bytes_to_long(flag), e, n)<br><br>dp = d % (p - <span class="hljs-number">1</span>)<br><span class="hljs-built_in">print</span>(dp &gt;&gt; <span class="hljs-number">200</span>)<br><span class="hljs-built_in">print</span>(c, e, n)<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">c = 46735962204857190520476434898881001530665718155698898882603422023484998388668858692912250418134186095459060506275961050676051693220280588047233628259880712415593039977585805890920089318643002597837000049626154900908543384761210358835843974072960080857150727010985827690190496793207012355214605393036388807616</span><br><span class="hljs-string">e = 7621</span><br><span class="hljs-string">n = 140376049134934822153964243403031201922239588054133319056483413311963385321279682186354948441840374124640187894619689719746347334298621083485494086361152915457458004998419817456902929318697902819798254427945343361548635794308362823239150919240307072688623000747781103375481834571274423004856276841225675241863</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br></code></pre></td></tr></table></figure><h3 id="exp-1">EXP</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sage.<span class="hljs-built_in">all</span> <span class="hljs-keyword">import</span> *<br><br>n = <span class="hljs-number">140376049134934822153964243403031201922239588054133319056483413311963385321279682186354948441840374124640187894619689719746347334298621083485494086361152915457458004998419817456902929318697902819798254427945343361548635794308362823239150919240307072688623000747781103375481834571274423004856276841225675241863</span><br>e = <span class="hljs-number">7621</span><br>c = <span class="hljs-number">46735962204857190520476434898881001530665718155698898882603422023484998388668858692912250418134186095459060506275961050676051693220280588047233628259880712415593039977585805890920089318643002597837000049626154900908543384761210358835843974072960080857150727010985827690190496793207012355214605393036388807616</span><br>s = <span class="hljs-number">1153696846823715458342658568392537778171840014923745253759529432977932183322553944430236879985</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">coppersmith</span>(<span class="hljs-params">bits, k</span>):<br>    F.&lt;x&gt; = PolynomialRing(Zmod(n))<br>    invE = inverse_mod(e, n)<br>    f = (s &lt;&lt; bits) + x + (k - <span class="hljs-number">1</span>) * invE<br>    x0 = f.small_roots(X=<span class="hljs-number">2</span> ** bits, beta=<span class="hljs-number">0.44</span>, epsilon=<span class="hljs-number">1</span>/<span class="hljs-number">32</span>)<br>    <span class="hljs-keyword">return</span> x0<br><br><span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, e):<br>    bits = <span class="hljs-number">200</span><br>    x0 = coppersmith(bits,k)<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(x0) != <span class="hljs-number">0</span>:<br>        x = Integer(x0[<span class="hljs-number">0</span>])<br>        dp = x + (s &lt;&lt; bits)<br>        p = (e*dp - <span class="hljs-number">1</span>) // k+<span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> p != -<span class="hljs-number">1</span>:<br>            q = n // p<br>            <span class="hljs-keyword">assert</span> n == p * q<br>            phi = (p-<span class="hljs-number">1</span>)*(q-<span class="hljs-number">1</span>)<br>            d = inverse_mod(e,phi)<br>            m=<span class="hljs-built_in">pow</span>(c,d,n)<br><br></code></pre></td></tr></table></figure><h2 id="å¤šå…ƒ-coppersmith">å¤šå…ƒ coppersmith</h2><p><ahref="https://lordriot.live/2021/01/06/Way-to-CopperSmith/">åŸç†å­¦ä¹ </a><ahref="https://www.researchgate.net/publication221010552_New_attacks_on_RSA_with_small_secret_CRT-exponents">è®ºæ–‡å­¦ä¹ 1</a>ã€ <a href="https://eprint.iacr.org/2010/146.pdf">è®ºæ–‡å­¦ä¹  2</a> <ahref="https://phot0n.com/2022/04/30/MRCTF2022/">è„šæœ¬æ¥æº</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> itertools<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">small_roots</span>(<span class="hljs-params">f, bounds, m=<span class="hljs-number">1</span>, d=<span class="hljs-literal">None</span></span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> d:<br>        d = f.degree()<br><br>    R = f.base_ring()<br>    N = R.cardinality() <span class="hljs-comment">#å–å¾—æ¨¡æ•°</span><br><br><br><br>    f /= f.coefficients().pop(<span class="hljs-number">0</span>) <span class="hljs-comment">#æœ€é«˜æ¬¡é¡¹ç³»æ•°åŒ–ä¸º0ï¼Œcoefficientsæ˜¯å¤šé¡¹å¼çš„é™æ¬¡å¹‚æ’åˆ—ç³»æ•°</span><br>    f = f.change_ring(ZZ)<br><br>    G = <span class="hljs-type">Sequence</span>([], f.parent())<br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m + <span class="hljs-number">1</span>):<br>        base = N ^ (m - i) * f ^ i <span class="hljs-comment">#æ”¶é›†åŸºå¤šé¡¹å¼</span><br><br>        <span class="hljs-keyword">for</span> shifts <span class="hljs-keyword">in</span> itertools.product(<span class="hljs-built_in">range</span>(d), repeat=f.nvariables()):<br>            g = base * prod(<span class="hljs-built_in">map</span>(power, f.variables(), shifts))<br>            G.append(g)<br>    <span class="hljs-built_in">print</span>(G)<br>    B, monomials = G.coefficient_matrix()<br>    monomials = vector(monomials)<br><br>    factors = [monomial(*bounds) <span class="hljs-keyword">for</span> monomial <span class="hljs-keyword">in</span> monomials]<br>    <span class="hljs-keyword">for</span> i, factor <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(factors):<br>        B.rescale_col(i, factor)<br><br>    B = B.dense_matrix().LLL()<br><br>    B = B.change_ring(QQ)<br>    <span class="hljs-keyword">for</span> i, factor <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(factors):<br>        B.rescale_col(i, <span class="hljs-number">1</span> / factor)<br><br>    H = <span class="hljs-type">Sequence</span>([], f.parent().change_ring(QQ))<br>    <span class="hljs-keyword">for</span> h <span class="hljs-keyword">in</span> <span class="hljs-built_in">filter</span>(<span class="hljs-literal">None</span>, B * monomials):<br>        H.append(h)<br>        I = H.ideal()<br>        <span class="hljs-keyword">if</span> I.dimension() == -<span class="hljs-number">1</span>:<br>            H.pop()<br>        <span class="hljs-keyword">elif</span> I.dimension() == <span class="hljs-number">0</span>:<br>            roots = []<br>            <span class="hljs-keyword">for</span> root <span class="hljs-keyword">in</span> I.variety(ring=ZZ):<br>                root = <span class="hljs-built_in">tuple</span>(R(root[var]) <span class="hljs-keyword">for</span> var <span class="hljs-keyword">in</span> f.variables())<br>                roots.append(root)<br>            <span class="hljs-keyword">return</span> roots<br>    <span class="hljs-keyword">return</span> []<br></code></pre></td></tr></table></figure><p>å…·ä½“å‚æ•°è¯´æ˜ï¼Œä¾‹å¦‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">PR.&lt;r,s,t&gt; = PolynomialRing(Zmod(prime))<br>f = r*(s^<span class="hljs-number">2</span>+<span class="hljs-number">2</span>*s)-t<br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;åŸç†&quot;&gt;åŸç†&lt;/h1&gt;
&lt;p&gt;Coppersmith å®šç†æ˜¯åœ¨ä¸€ä¸ª e é˜¶æ¨¡ n çš„å¤šé¡¹å¼&lt;span
class=&quot;math inline&quot;&gt;\(f(x)\)&lt;/span&gt;ä¸­ï¼Œè‹¥æœ‰æ ¹å°äº&lt;span
class=&quot;math inline&quot;&gt;\(n^{\frac{1}</summary>
      
    
    
    
    <category term="CTF" scheme="https://sch01ar.github.io/categories/CTF/"/>
    
    
  </entry>
  
  <entry>
    <title>DLPä¸­å¸¸ç”¨ç®—æ³•</title>
    <link href="https://sch01ar.github.io/2023/02/24/DLP%E4%B8%AD%E5%B8%B8%E7%94%A8%E7%AE%97%E6%B3%95/"/>
    <id>https://sch01ar.github.io/2023/02/24/DLP%E4%B8%AD%E5%B8%B8%E7%94%A8%E7%AE%97%E6%B3%95/</id>
    <published>2023-02-24T10:05:45.000Z</published>
    <updated>2023-03-04T06:03:05.157Z</updated>
    
    <content type="html"><![CDATA[<h1 id="pohlig-hellman-ç®—æ³•å…‰æ»‘é˜¶">Pohlig-Hellman ç®—æ³•ï¼ˆå…‰æ»‘é˜¶ï¼‰</h1><p>ç»™å®š a,b,pï¼Œp æ˜¯ç´ æ•°ï¼Œæ±‚ xï¼Œ<span class="math inline">\(a^x \equiv b(mod\;p)\)</span> åœ¨æ¨¡ p ä¸‹ï¼Œè®¾è¯¥ç¾¤çš„ç”Ÿæˆå…ƒä¸º gï¼Œåˆ™æœ‰</p><p><span class="math display">\[a \equiv g^{a1} (mod\;p) \newlineb \equiv g^{b1} (mod\;p)\]</span></p><p>è”ç«‹æ¡ä»¶æœ‰</p><p><span class="math display">\[g^{a1x} \equiv g^{b1} (mod\;p)\]</span></p><p>ç”±æ¬§æ‹‰å®šç†å¾—<spanclass="math inline">\(\phi(p)\;=\;p-1\)</span>ï¼Œåˆ™æœ‰<spanclass="math inline">\(a1x\;=b1\;(mod\;(p-1))\)</span></p><p>1.å°† p-1 åˆ†è§£ï¼Œå³ <spanclass="math inline">\(p-1=p_1^{k_1}p_2^{k_2}\cdotsp_m^{k_m}\)</span></p><p>2.å°† x è¡¨ç¤ºæˆ<span class="math inline">\(p_i\)</span> è¿›åˆ¶, åˆ—å‡ºæ–¹ç¨‹<span class="math display">\[x\;=p_i^0a_0 +p_i^1a_1+...+p_i^{k_i-1}a*{k_i-1}\]</span></p><p>3.ä»¤ r=1ï¼Œæ±‚<span class="math inline">\((a^x)^{\frac{p-1}{p_i^r}}\;\equiv b^{\frac{p-1}{p_i^r}}(mod\; p)\)</span></p><p>4.å°† 2 ä¸­çš„å…¬å¼ä»£å…¥åˆ° 3ï¼Œå±•å¼€å¾—åˆ° <spanclass="math display">\[a^{a0*\frac{p-1}{p_i}}* a^{(p-1)a1} *a^{(p-1)p_ia_2}...a^{(p-1)p_i^{k_i-2}a_{k_i-1}} \equivb^{\frac{p-1}{p_i}}(mod\;p)\]</span></p><p>5.ä»ç¬¬äºŒé¡¹å¼€å§‹ï¼Œåé¢æ¯é¡¹éƒ½æ˜¯ 1ï¼Œæ¬§æ‹‰å®šç†:<spanclass="math inline">\(a^{(p-1)} \equiv1(mod\;p)\)</span>ï¼ŒåŒ–ç®€å¾—åˆ°çš„å¼å­ä¸º <spanclass="math display">\[\newline a^{a0*\frac{p-1}{p_i}} \equivb^{\frac{p-1}{p_i}}(mod \;p)\newline\]</span> å› ä¸ºè¯¥æ–¹ç¨‹åªæœ‰ a0æœªçŸ¥ï¼Œæ‰€ä»¥å¯åœ¨[0,pi-1]èŒƒå›´å†…çˆ†ç ´å‡º a0</p><p>6.å†ä»¤ r = 2,3,4...kiï¼Œé‡å¤æ­¥éª¤ 3ï¼Œå³å¯æ±‚å‡ºæ‰€æœ‰çš„<spanclass="math inline">\(a_2,a_3....a_{k_i-1}\)</span>ï¼Œä»è€Œå¾—åˆ° m ä¸ªå…³äº xçš„æ–¹ç¨‹ï¼Œæœ€åä½¿ç”¨ CRT è¿›è¡Œæ±‚è§£å³å¯ã€‚</p><p>æ€»ç»“:å°† p-1 çš„ m ä¸ªè´¨å› å­ï¼Œåˆ†åˆ«æ±‚å‡ºå…¶æ–¹ç¨‹å†…çš„æ‰€æœ‰ç³»æ•° aï¼Œä»è€Œæ„é€ äº† mä¸ªå…³äº x çš„æ–¹ç¨‹ï¼Œæœ€ç»ˆåˆ©ç”¨ CRT æ±‚è§£ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;pohlig-hellman-ç®—æ³•å…‰æ»‘é˜¶&quot;&gt;Pohlig-Hellman ç®—æ³•ï¼ˆå…‰æ»‘é˜¶ï¼‰&lt;/h1&gt;
&lt;p&gt;ç»™å®š a,b,pï¼Œp æ˜¯ç´ æ•°ï¼Œæ±‚ xï¼Œ&lt;span class=&quot;math inline&quot;&gt;\(a^x \equiv b
(mod\;p)\)&lt;/span&gt; åœ¨</summary>
      
    
    
    
    <category term="CTF" scheme="https://sch01ar.github.io/categories/CTF/"/>
    
    
  </entry>
  
  <entry>
    <title>2022DASCTF_NOV-lllcccggg-wp</title>
    <link href="https://sch01ar.github.io/2022/11/30/2022DASCTF_NOV-lllcccgggwp/"/>
    <id>https://sch01ar.github.io/2022/11/30/2022DASCTF_NOV-lllcccgggwp/</id>
    <published>2022-11-30T02:05:45.000Z</published>
    <updated>2022-12-01T09:42:22.869Z</updated>
    
    <content type="html"><![CDATA[<h1 id="é¢˜ç›®æè¿°">é¢˜ç›®æè¿°</h1><p>å¦‚é¢˜ç›®åå­—ä¸€æ ·ï¼Œæœ‰å¥½å¤šä¸ªlcgï¼Œ<del>å½“æ—¶çœ‹æ™•äº†</del> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br>key=<span class="hljs-string">b&#x27;*************&#x27;</span><br>key=bytes_to_long(key)<br>key=<span class="hljs-built_in">bin</span>(key)[<span class="hljs-number">2</span>:]<br><br>n=getPrime(<span class="hljs-number">256</span>)<br>a=[getPrime(<span class="hljs-number">256</span>)]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-built_in">len</span>(key)):<br>    a.append(a[i-<span class="hljs-number">1</span>]*<span class="hljs-number">2</span>)<br>b=getPrime(<span class="hljs-number">256</span>)<br>m=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(key)):<br>    m.append((a[i]*b)%n)<br>s=<span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(key)):<br>    s+=m[i]*<span class="hljs-built_in">int</span>(key[i])<br><br><br>seed=s<br>a = getPrime(<span class="hljs-number">300</span>)<br>b = getPrime(<span class="hljs-number">300</span>)<br>n = getPrime(<span class="hljs-number">300</span>)<br>output = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>    seed = (a*seed+b)%n<br>    output.append(seed)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;output = &quot;</span>,output)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;m=&#x27;</span>,m)<br><br><br><br>state=<span class="hljs-built_in">int</span>(key,<span class="hljs-number">2</span>)<br>a=getPrime(<span class="hljs-number">256</span>)<br>b=getPrime(<span class="hljs-number">256</span>)<br>c=getPrime(<span class="hljs-number">256</span>)<br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>**<span class="hljs-number">10000</span>):<br>    state = (a * state + b) % c<br>flag=<span class="hljs-string">b&#x27;****************************************&#x27;</span><br>state_md5=hashlib.md5(<span class="hljs-built_in">str</span>(state).encode()).hexdigest()<br>xorflag=xor(flag,state_md5).<span class="hljs-built_in">hex</span>()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;a=&#x27;</span>,a)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;b=&#x27;</span>,b)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;c=&#x27;</span>,c)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;xorflag=&#x27;</span>,xorflag)<br></code></pre></td></tr></table></figure></p><h1 id="é¢˜ç›®åˆ†æ">é¢˜ç›®åˆ†æ</h1><p>1.<code>key</code>æ˜¯ä¸€ä¸ªèƒŒåŒ…é—®é¢˜ï¼Œå·²çŸ¥å…¬é’¥<code>m</code>ï¼Œå’Œçš„è¯ç›®å‰ä¸çŸ¥é“ã€‚</p><p>2.ä»¥1ä¸­çš„å’Œä¸º<code>seed</code>ï¼Œé€šè¿‡LCGäº§ç”Ÿäº†ä¸€ç»„åºåˆ—<code>output</code>ã€‚</p><p>è‡³æ­¤ï¼Œå·²ç»å¯ä»¥æ ¹æ®<code>output</code>æ¥æ±‚å‡ºLCGä¸­çš„aã€bã€nï¼Œä»è€Œæ±‚å‡º<code>seed</code>ï¼Œä»è€Œé€šè¿‡èƒŒåŒ…å¯æ±‚å¾—keyã€‚</p><p>3.ä»¥<code>key</code>ä¸ºseedï¼Œç§°ä½œ<code>state</code>ï¼Œå†è¿›è¡ŒLCGï¼Œ<code>state = (a * state + b) % c</code>ï¼Œå¹¶ä¸”aï¼Œbï¼Œcå·²çŸ¥ã€‚</p><p>ä½†æ˜¯æƒ³è¦ç›´æ¥æ­£å‘æ±‚è§£å‡ºæœ€åçš„stateï¼Œååˆ†å›°éš¾ï¼Œforå¾ªç¯äº†10^10000æ¬¡ï¼Œè¿™é‡Œæ¶‰åŠåˆ°äº†<strong>çŸ©é˜µå¿«é€Ÿå¹‚</strong>çš„ä½¿ç”¨ã€‚</p><p>é€šè¿‡æ„é€ çŸ©é˜µ <span class="math display">\[\mathbf{A} =\begin{bmatrix}state &amp; 1\end{bmatrix}\]</span> <span class="math display">\[\mathbf{C} =\begin{bmatrix}a &amp; 0\\b &amp; 1\\\end{bmatrix}\]</span> é€šè¿‡è®¡ç®—<spanclass="math inline">\(A*C^{10*10000}\)</span>å³å¯å¾—åˆ°çŸ©é˜µBï¼ŒB = [ state,1]</p><p>4.æ±‚å‡ºstateåè¿›è¡Œå¼‚æˆ–è§£å¯†å³å¯ã€‚</p><h1 id="exp">EXP</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> reduce<br><span class="hljs-keyword">from</span> math <span class="hljs-keyword">import</span> gcd<br><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> gmpy2<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">crack_unknown_modulus</span>(<span class="hljs-params">states</span>):<br>    diffs = [s1 - s0 <span class="hljs-keyword">for</span> s0, s1 <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(states, states[<span class="hljs-number">1</span>:])]<br>    zeroes = [t2*t0 - t1*t1 <span class="hljs-keyword">for</span> t0, t1, t2 <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(diffs, diffs[<span class="hljs-number">1</span>:], diffs[<span class="hljs-number">2</span>:])]<br>    modulus = <span class="hljs-built_in">abs</span>(reduce(gcd, zeroes))<br>    <span class="hljs-keyword">return</span> modulus<br><br>output = [<span class="hljs-number">75581294523880849612962675076574164955427439308298754836702542570856707873339581806556114</span>, <span class="hljs-number">85105032146983524265511965363979041936757881362506442483720291395014453678757599185295866</span>, <span class="hljs-number">1135521205967352800446368309480529634045225881261100886117662161359310082444102071893527191</span>, <span class="hljs-number">668602662320826002160475166323016971968419541611162501120982012317608523771962990634779874</span>, <span class="hljs-number">649673553234341629614052928960182629959348742983379959653724041939165898600067312959677865</span>, <span class="hljs-number">785853955591839090537858092210736716046894245185520583713505441606094906159642640920286905</span>, <span class="hljs-number">937799570303158165818350743257433287791556030352377438071495081189542968310256239806349207</span>, <span class="hljs-number">734514754865608924980327625447363286114899547828404532253101460271494241963897226149955073</span>, <span class="hljs-number">1106313725444442262780946046218124519471559148520571880678416934586056489046936771811070897</span>, <span class="hljs-number">8768152099561586039808874499029856564696410477579827751292882367683300035228537162519939</span>]<br>m= [<span class="hljs-number">72110328606337761986452574632319920368225905906258123752738204764660440229296</span>, <span class="hljs-number">54011682421724526639264309053337133761455956763651742732220904522794415369243</span>, <span class="hljs-number">17814390052498055944887777895371560547916058478438980691186304039062365649137</span>, <span class="hljs-number">35628780104996111889775555790743121095832116956877961382372608078124731298274</span>, <span class="hljs-number">71257560209992223779551111581486242191664233913755922764745216156249462596548</span>, <span class="hljs-number">52306145629033450225461382951669777408332612778647340756234927305972460103747</span>, <span class="hljs-number">14403316467115903117281925692036847841669370508430176739214349605418455118145</span>, <span class="hljs-number">28806632934231806234563851384073695683338741016860353478428699210836910236290</span>, <span class="hljs-number">57613265868463612469127702768147391366677482033720706956857398421673820472580</span>, <span class="hljs-number">25017556945976227604614565324992075758359109018576909140459291836821175855811</span>, <span class="hljs-number">50035113891952455209229130649984151516718218037153818280918583673642351711622</span>, <span class="hljs-number">9861252992953913084817421088665596058440581025443131788581662340758238333895</span>, <span class="hljs-number">19722505985907826169634842177331192116881162050886263577163324681516476667790</span>, <span class="hljs-number">39445011971815652339269684354662384233762324101772527154326649363032953335580</span>, <span class="hljs-number">78890023943631304678539368709324768467524648203545054308653298726065906671160</span>, <span class="hljs-number">67571073096311612023437897207346829960053441358225603844051092445605348252971</span>, <span class="hljs-number">44933171401672226713234954203390952945111027667586702914846679884684231416593</span>, <span class="hljs-number">89866342803344453426469908406781905890222055335173405829693359769368462833186</span>, <span class="hljs-number">89523710815737909519298976602261104805448255621482306886131214532210460577023</span>, <span class="hljs-number">88838446840524821704957112993219502635900656194100108999006924057894456064697</span>, <span class="hljs-number">87467918890098646076273385775136298296805457339335713224758343109262447040045</span>, <span class="hljs-number">84726862989246294818905931338969889618615059629806921676261181211998428990741</span>, <span class="hljs-number">79244751187541592304171022466637072262234264210749338579266857417470392892133</span>, <span class="hljs-number">68280527584132187274701204721971437549472673372634172385278209828414320694917</span>, <span class="hljs-number">46352080377313377215761569232640168123949491696403839997300914650302176300485</span>, <span class="hljs-number">2495185963675757097882298253977629272903128343943175221346324294077887511621</span>, <span class="hljs-number">4990371927351514195764596507955258545806256687886350442692648588155775023242</span>, <span class="hljs-number">9980743854703028391529193015910517091612513375772700885385297176311550046484</span>, <span class="hljs-number">19961487709406056783058386031821034183225026751545401770770594352623100092968</span>, <span class="hljs-number">39922975418812113566116772063642068366450053503090803541541188705246200185936</span>, <span class="hljs-number">79845950837624227132233544127284136732900107006181607083082377410492400371872</span>, <span class="hljs-number">69482926884297456930826248043265566490804358963498709392909249814458335654395</span>, <span class="hljs-number">48756878977643916528011655875228426006612862878132914012562994622390206219441</span>, <span class="hljs-number">7304783164336835722382471539154145038229870707401323251870484238253947349533</span>, <span class="hljs-number">14609566328673671444764943078308290076459741414802646503740968476507894699066</span>, <span class="hljs-number">29219132657347342889529886156616580152919482829605293007481936953015789398132</span>, <span class="hljs-number">58438265314694685779059772313233160305838965659210586014963873906031578796264</span>, <span class="hljs-number">26667555838438374224478704415163613636682076269556667256672242805536692503179</span>, <span class="hljs-number">53335111676876748448957408830327227273364152539113334513344485611073385006358</span>, <span class="hljs-number">16461248562802499564273977449351747571732450029362164253433466215620304923367</span>, <span class="hljs-number">32922497125604999128547954898703495143464900058724328506866932431240609846734</span>, <span class="hljs-number">65844994251209998257095909797406990286929800117448657013733864862481219693468</span>, <span class="hljs-number">41481013711468999180550979383511273598863745186032809254212224718435974297587</span>, <span class="hljs-number">82962027422937998361101958767022547197727490372065618508424449436871948595174</span>, <span class="hljs-number">75715080054924999388563077322742387420459125695266732243593393867217432100999</span>, <span class="hljs-number">61221185318899001443485314434182067865922396341668959713931282727908399112649</span>, <span class="hljs-number">32233395846847005553329788657061428756848937634473414654607060449290333135949</span>, <span class="hljs-number">64466791693694011106659577314122857513697875268946829309214120898580666271898</span>, <span class="hljs-number">38724608596437024879678314416943008052399895489029153845172736790634867454447</span>, <span class="hljs-number">77449217192874049759356628833886016104799790978058307690345473581269734908894</span>, <span class="hljs-number">64689459594797102185072417456469325234603726907252110607435442156013004728439</span>, <span class="hljs-number">39169944398643207036503994701635943494211598765639716441615379305499544367529</span>, <span class="hljs-number">78339888797286414073007989403271886988423197531279432883230758610999088735058</span>, <span class="hljs-number">66470802803621830812375138595241067001850540013694360993206012215471712380767</span>, <span class="hljs-number">42732630816292664291109436979179427028705224978524217213156519424416959672185</span>, <span class="hljs-number">85465261632585328582218873958358854057410449957048434426313038848833919344370</span>, <span class="hljs-number">80721548474219659830796907705415001139825044865232364079370572691141373599391</span>, <span class="hljs-number">71234122157488322327952975199527295304654234681600223385485640375756282109433</span>, <span class="hljs-number">52259269524025647322265110187751883634312614314335941997715775744986099129517</span>, <span class="hljs-number">14309564257100297310889380164201060293629373579807379222176046483445733169685</span>, <span class="hljs-number">28619128514200594621778760328402120587258747159614758444352092966891466339370</span>, <span class="hljs-number">57238257028401189243557520656804241174517494319229516888704185933782932678740</span>, <span class="hljs-number">24267539265851381153474201102305775374039133589594529004152866861039400268131</span>, <span class="hljs-number">48535078531702762306948402204611550748078267179189058008305733722078800536262</span>, <span class="hljs-number">6861182272454527280255964197920394521160679309513611243355962437631135983175</span>, <span class="hljs-number">13722364544909054560511928395840789042321358619027222486711924875262271966350</span>, <span class="hljs-number">27444729089818109121023856791681578084642717238054444973423849750524543932700</span>, <span class="hljs-number">54889458179636218242047713583363156169285434476108889946847699501049087865400</span>, <span class="hljs-number">19569941568321439150454586955423605363575013903353275120439893995571710641451</span>, <span class="hljs-number">39139883136642878300909173910847210727150027806706550240879787991143421282902</span>, <span class="hljs-number">78279766273285756601818347821694421454300055613413100481759575982286842565804</span>, <span class="hljs-number">66350557755620515869995855432086135933604256177961696190263646958047220042259</span>, <span class="hljs-number">42492140720290034406350870652869564892212657307058887607271788909567974995169</span>, <span class="hljs-number">84984281440580068812701741305739129784425314614117775214543577819135949990338</span>, <span class="hljs-number">79759588090209140291762642400175552593854774179371045655831650631745434891327</span>, <span class="hljs-number">69310201389467283249884444589048398212713693309877586538407796256964404693305</span>, <span class="hljs-number">48411427987983569166128048966794089450431531570890668303560087507402344297261</span>, <span class="hljs-number">6613881185016140998615257722285471925867208092916831833864670008278223505173</span>, <span class="hljs-number">13227762370032281997230515444570943851734416185833663667729340016556447010346</span>, <span class="hljs-number">26455524740064563994461030889141887703468832371667327335458680033112894020692</span>, <span class="hljs-number">52911049480129127988922061778283775406937664743334654670917360066225788041384</span>, <span class="hljs-number">15613124169307258644203283345264843838879474437804804568579215125925110993419</span>, <span class="hljs-number">31226248338614517288406566690529687677758948875609609137158430251850221986838</span>, <span class="hljs-number">62452496677229034576813133381059375355517897751219218274316860503700443973676</span>, <span class="hljs-number">34696018563507071819985426550816043736039940453573931775378216000874422858003</span>, <span class="hljs-number">69392037127014143639970853101632087472079880907147863550756432001748845716006</span>, <span class="hljs-number">48575099463077289946300865991961467969163906765431222328257358996971226342663</span>, <span class="hljs-number">6941224135203582558960891772620228963331958481997939883259212987415987595977</span>, <span class="hljs-number">13882448270407165117921783545240457926663916963995879766518425974831975191954</span>, <span class="hljs-number">27764896540814330235843567090480915853327833927991759533036851949663950383908</span>, <span class="hljs-number">55529793081628660471687134180961831706655667855983519066073703899327900767816</span>, <span class="hljs-number">20850611372306323609733428150620956438315480663102533358891902792129336446283</span>, <span class="hljs-number">41701222744612647219466856301241912876630961326205066717783805584258672892566</span>, <span class="hljs-number">83402445489225294438933712602483825753261922652410133435567611168517345785132</span>, <span class="hljs-number">76595916187499591544226584993664944531527990255955762097879717330508226480915</span>, <span class="hljs-number">62982857584048185754812329776027182088060125463047019422503929654489987872481</span>, <span class="hljs-number">35756740377145374175983819340751657201124395877229534071752354302453510655613</span>, <span class="hljs-number">71513480754290748351967638681503314402248791754459068143504708604907021311226</span>, <span class="hljs-number">52817986717630499370294437151703921829501728460053631513753912203287577533103</span>, <span class="hljs-number">15426998644310001406948034092105136684007601871242758254252319400048689976857</span>, <span class="hljs-number">30853997288620002813896068184210273368015203742485516508504638800097379953714</span>, <span class="hljs-number">61707994577240005627792136368420546736030407484971033017009277600194759907428</span>, <span class="hljs-number">33207014363529013921943432525538386497064959921077561260763050193863054725507</span>, <span class="hljs-number">66414028727058027843886865051076772994129919842155122521526100387726109451014</span>, <span class="hljs-number">42619082663165058354132889890850839013263984635445740269796695768925753812679</span>, <span class="hljs-number">85238165326330116708265779781701678026527969270891480539593391537851507625358</span>, <span class="hljs-number">80267355861709236082890719352100649078060083492918456305931278069176550161367</span>, <span class="hljs-number">70325736932467474832140598492898591181124311936972407838607051131826635233385</span>, <span class="hljs-number">50442499073983952330640356774494475387252768825080310903958597257126805377421</span>, <span class="hljs-number">10676023357016907327639873337686243799509682601296117034661689507727145665493</span>, <span class="hljs-number">21352046714033814655279746675372487599019365202592234069323379015454291330986</span>, <span class="hljs-number">42704093428067629310559493350744975198038730405184468138646758030908582661972</span>, <span class="hljs-number">85408186856135258621118986701489950396077460810368936277293516061817165323944</span>, <span class="hljs-number">80607398921319519908597133191677193817159066571873367781331527117107865558539</span>, <span class="hljs-number">71005823051688042483553426172051680659322278094882230789407549227689266027729</span>, <span class="hljs-number">51802671312425087633466012132800654343648701140899956805559593448852066966109</span>, <span class="hljs-number">13396367833899177933291184054298601712301547232935408837863681891177668842869</span>, <span class="hljs-number">26792735667798355866582368108597203424603094465870817675727363782355337685738</span>, <span class="hljs-number">53585471335596711733164736217194406849206188931741635351454727564710675371476</span>, <span class="hljs-number">16961967880242426132688632223086106723416522814618765929653950122894885653603</span>, <span class="hljs-number">33923935760484852265377264446172213446833045629237531859307900245789771307206</span>, <span class="hljs-number">67847871520969704530754528892344426893666091258475063718615800491579542614412</span>, <span class="hljs-number">45486768250988411727868217573386146812336327468085622663976095976632620139475</span>, <span class="hljs-number">764561711025826122095594935469586649676799887306740554696686946738775189601</span>, <span class="hljs-number">1529123422051652244191189870939173299353599774613481109393373893477550379202</span>, <span class="hljs-number">3058246844103304488382379741878346598707199549226962218786747786955100758404</span>, <span class="hljs-number">6116493688206608976764759483756693197414399098453924437573495573910201516808</span>, <span class="hljs-number">12232987376413217953529518967513386394828798196907848875146991147820403033616</span>, <span class="hljs-number">24465974752826435907059037935026772789657596393815697750293982295640806067232</span>, <span class="hljs-number">48931949505652871814118075870053545579315192787631395500587964591281612134464</span>, <span class="hljs-number">7654924220354746294595311528804384183634530526398286227920424176036759179579</span>, <span class="hljs-number">15309848440709492589190623057608768367269061052796572455840848352073518359158</span>, <span class="hljs-number">30619696881418985178381246115217536734538122105593144911681696704147036718316</span>, <span class="hljs-number">61239393762837970356762492230435073469076244211186289823363393408294073436632</span>, <span class="hljs-number">32269812734724943379884144249567439963156633373508074873471281810061681783915</span>, <span class="hljs-number">64539625469449886759768288499134879926313266747016149746942563620123363567830</span>, <span class="hljs-number">38870276147948776185895736786967052877630678445167794720629622233720262046311</span>, <span class="hljs-number">77740552295897552371791473573934105755261356890335589441259244467440524092622</span>, <span class="hljs-number">65272129800844107409942106936565504535526858731806674109262983928354583095895</span>, <span class="hljs-number">40335284810737217486243373661828302096057862414748843445270462850182701102441</span>, <span class="hljs-number">80670569621474434972486747323656604192115724829497686890540925700365402204882</span>, <span class="hljs-number">71132164451997872611332654436010501409235594610130869007826346394204339320415</span>, <span class="hljs-number">52055354113044747889024468660718295843475334171397233242397187781882213551481</span>, <span class="hljs-number">13901733435138498444408097110133884711954813293929961711538870557237962013613</span>, <span class="hljs-number">27803466870276996888816194220267769423909626587859923423077741114475924027226</span>, <span class="hljs-number">55606933740553993777632388440535538847819253175719846846155482228951848054452</span>, <span class="hljs-number">21004892690156990221623936669768370720642651302575188919055459451377231019555</span>, <span class="hljs-number">42009785380313980443247873339536741441285302605150377838110918902754462039110</span>, <span class="hljs-number">84019570760627960886495746679073482882570605210300755676221837805508924078220</span>, <span class="hljs-number">77830166730304924439350653146844258790145355371737006579188170604491383067091</span>, <span class="hljs-number">65451358669658851545060466082385810605294855694609508385120836202456301044833</span>]<br>a2= <span class="hljs-number">102146678855348749881681741830301892566150942749854546938156269348575567682569</span><br>b2= <span class="hljs-number">57926598868103510549704115342815226386495366694945712679089221082045615713293</span><br>c= <span class="hljs-number">79112540456632613121737537841885533313599936328220061653608162113976717833173</span><br>xor = <span class="hljs-number">0x2079677330734e7d07116d73543d03316c6501555c02403b7201080612101049</span><br>n = crack_unknown_modulus(output)<br>a=(output[<span class="hljs-number">2</span>]-output[<span class="hljs-number">1</span>])*inverse((output[<span class="hljs-number">1</span>]-output[<span class="hljs-number">0</span>]),n)%n<br>b=(output[<span class="hljs-number">1</span>]-a*output[<span class="hljs-number">0</span>])%n<br>seed = (inverse(a,n)*(output[<span class="hljs-number">0</span>]-b))%n<br><br><br><span class="hljs-comment"># sage</span><br><span class="hljs-comment"># sum = seed</span><br><span class="hljs-comment"># nbits=len(m)</span><br><span class="hljs-comment"># A=Matrix(ZZ,nbits+1,nbits+1)</span><br><span class="hljs-comment"># for i in range(nbits):</span><br><span class="hljs-comment">#     A[i,i]=2</span><br><span class="hljs-comment">#     A[i,-1]=m[i]</span><br><span class="hljs-comment"># for i in range(nbits+1):</span><br><span class="hljs-comment">#     A[-1,i]=1</span><br><span class="hljs-comment"># A[-1,-1]=sum</span><br><span class="hljs-comment"># A[:,-1]=2**100</span><br><span class="hljs-comment"># r=A.LLL()</span><br><span class="hljs-comment"># for i in r:</span><br><span class="hljs-comment">#     if len(set(i[:-1])) == 2:</span><br><span class="hljs-comment">#         print(i)</span><br><br>key=[-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">0</span>]<br>key0=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(key)):<br>    <span class="hljs-keyword">if</span> key[i]==-<span class="hljs-number">1</span>:<br>        key0.append(<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">if</span> key[i]==<span class="hljs-number">1</span>:<br>        key0.append(<span class="hljs-number">0</span>)<br>state = <span class="hljs-built_in">int</span>(<span class="hljs-string">&#x27;&#x27;</span>.join([<span class="hljs-built_in">str</span>(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> key0]), <span class="hljs-number">2</span>)<br><br><span class="hljs-comment"># çŸ©é˜µå¿«é€Ÿå¹‚</span><br><span class="hljs-comment"># a = 102146678855348749881681741830301892566150942749854546938156269348575567682569</span><br><span class="hljs-comment"># b = 57926598868103510549704115342815226386495366694945712679089221082045615713293</span><br><span class="hljs-comment"># c = 79112540456632613121737537841885533313599936328220061653608162113976717833173</span><br><span class="hljs-comment"># state = 1459518099080641908882248947391577149455413355</span><br><span class="hljs-comment"># A=[state,1]</span><br><span class="hljs-comment"># A = Matrix(Zmod(c),A)</span><br><span class="hljs-comment"># C = Matrix(Zmod(c),[[a, 0], [b, 1]])</span><br><span class="hljs-comment"># state=A*C^(10**10000)</span><br><span class="hljs-comment"># print(state)</span><br><br><br>state=<span class="hljs-number">5413978693489756582509930284917854732906886271552898511650182850401353715151</span><br>state_md5=hashlib.md5(<span class="hljs-built_in">str</span>(state).encode()).hexdigest()<br>state_md5=bytes_to_long(state_md5.encode())<br>flag=long_to_bytes(state_md5^xor)<br><span class="hljs-built_in">print</span>(flag)<br><span class="hljs-comment"># b&#x27;DASCTF&#123;D0u_Ge_1S_R4al1y_G00d!!!&#125;&#x27;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;é¢˜ç›®æè¿°&quot;&gt;é¢˜ç›®æè¿°&lt;/h1&gt;
&lt;p&gt;å¦‚é¢˜ç›®åå­—ä¸€æ ·ï¼Œæœ‰å¥½å¤šä¸ªlcgï¼Œ&lt;del&gt;å½“æ—¶çœ‹æ™•äº†&lt;/del&gt; &lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=</summary>
      
    
    
    
    <category term="CTF" scheme="https://sch01ar.github.io/categories/CTF/"/>
    
    
    <category term="wp" scheme="https://sch01ar.github.io/tags/wp/"/>
    
  </entry>
  
  <entry>
    <title>èƒŒåŒ…åŠ å¯†ç®—æ³•</title>
    <link href="https://sch01ar.github.io/2022/11/29/%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98%E7%AE%97%E6%B3%95/"/>
    <id>https://sch01ar.github.io/2022/11/29/%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98%E7%AE%97%E6%B3%95/</id>
    <published>2022-11-28T16:00:00.000Z</published>
    <updated>2022-12-01T09:50:05.003Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2><p>åœ¨ä¸€æ¬¡CTFæ¯”èµ›ä¸­é‡åˆ°äº†ï¼Œå†™äº†10ä¸ªforåµŒå¥—ç¡¬çˆ†å‡ºæ¥äº†ï¼Œå¤ç°çš„æ—¶å€™å‘ç°æ˜¯èƒŒåŒ…åŠ å¯†ã€‚</p><p><img src="/img/bag.png" /></p><h2 id="merklehellman-å…¬é’¥åŠ å¯†ç®—æ³•">Merkleâ€“Hellman å…¬é’¥åŠ å¯†ç®—æ³•</h2><p>æ•´ä½“åŠ å¯†æµç¨‹ <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy<br>x = [<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>]<span class="hljs-comment">#æ˜æ–‡å¯¹åº”çš„2è¿›åˆ¶æ•°</span><br>a = [<span class="hljs-number">3</span>,<span class="hljs-number">7</span>,<span class="hljs-number">16</span>,<span class="hljs-number">50</span>,<span class="hljs-number">120</span>]<span class="hljs-comment"># äº§ç”Ÿä¸€ä¸ªè¶…é€’å¢åºåˆ—ï¼Œç§°ä½œç§é’¥</span><br><span class="hljs-comment">#å¯¹ç§é’¥aè¿›è¡ŒåŠ å¯†ï¼Œäº§ç”Ÿå…¬é’¥bã€‚</span><br>m = <span class="hljs-number">251</span><span class="hljs-comment">#é€‰å–ä¸€ä¸ªæ¨¡æ•°</span><br>w = <span class="hljs-number">300</span><span class="hljs-comment">#é€‰å–ä¸€ä¸ªä¹˜æ•°</span><br>b = [w * x % m <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> a]<span class="hljs-comment">#äº§ç”Ÿå…¬é’¥</span><br>S = numpy.dot(x,b)<span class="hljs-comment">#åŠ å¯†ç»“æœ</span><br></code></pre></td></tr></table></figure>å¯ä»¥å‘ç°ï¼ŒåŠ å¯†ååˆ†å®¹æ˜“ï¼Œä½†è§£å¯†ååˆ†å›°éš¾ï¼Œè¿™ä¹Ÿæ˜¯éå¯¹ç§°åŠ å¯†çš„ç‰¹ç‚¹ã€‚ ###åŠ å¯†</p><h4 id="ç”Ÿæˆç§é’¥">ç”Ÿæˆç§é’¥</h4><p>è¶…é€’å¢åºåˆ—ï¼Œä¹Ÿå°±æ˜¯aä¸­æ¯ä¸€ä½å…ƒç´ éœ€è¦å¤§äºå…¶ä¹‹å‰æ‰€æœ‰å…ƒç´ çš„å’Œã€‚<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">a =[randint(<span class="hljs-number">20</span>, <span class="hljs-number">50</span>)]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(nbits - <span class="hljs-number">1</span>):<br>    a.append(randint(<span class="hljs-number">2</span> * a[-<span class="hljs-number">1</span>], <span class="hljs-number">3</span> * a[-<span class="hljs-number">1</span>]))<br></code></pre></td></tr></table></figure></p><h4 id="ç”Ÿæˆå…¬é’¥">ç”Ÿæˆå…¬é’¥</h4><p>æ¨¡æ•°mè¦æ±‚ï¼š<code>m &gt; sum(a)</code>ä¹˜æ•°wè¦æ±‚ï¼š<code>gcd(w,m) == 1</code> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    m = randint(<span class="hljs-number">2</span> * a[-<span class="hljs-number">1</span>] + <span class="hljs-number">1</span>, <span class="hljs-number">3</span> * a[-<span class="hljs-number">1</span>])<br>    w = randint(<span class="hljs-number">2</span> * a[-<span class="hljs-number">1</span>] + <span class="hljs-number">1</span>, <span class="hljs-number">3</span> * a[-<span class="hljs-number">1</span>])<br>    <span class="hljs-keyword">if</span> gcd(w, m) == <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">break</span><br><br>b = [w * x % m <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> a]<br></code></pre></td></tr></table></figure> bå’Œmä½œä¸ºå…¬é’¥ã€‚åŠ å¯†ï¼š<code>S = numpy.dot(x,b)</code></p><h3 id="è§£å¯†">è§£å¯†</h3><p>æ‹¿åˆ°å…¬é’¥<spanclass="math inline">\(M=(m_1,m_2,\ldots,m_n)\)</span>ï¼Œæ„é€ å¦‚ä¸‹çŸ©é˜µ<span class="math display">\[\begin{bmatrix}2 &amp; 0 &amp; \ldots &amp; 0 &amp; m_1 \\0 &amp; 2 &amp; \ldots &amp; 0 &amp; m_2 \\\vdots &amp; \vdots &amp; \ddots &amp; \vdots &amp; \vdots \\0 &amp; 0 &amp; \ldots &amp; 2 &amp; m_n \\1 &amp; 1 &amp; \ldots &amp; 1 &amp; S \\\end{bmatrix}\]</span>è¿™ä¸ªçŸ©é˜µçš„æ‰€æœ‰è¡Œå‘é‡çš„çº¿æ€§ç»„åˆæ„æˆäº†ä¸€ä¸ªæ ¼ï¼Œæ¥ä¸‹æ¥å°†é€šè¿‡æ˜æ–‡çš„ç‰¹ç‚¹å’Œæ ¼ä¸Šçš„ç‰¹æ®Šè§£æ³•æ¥è¿›è¡Œè§£å¯†ã€‚</p><h4 id="lll">LLL</h4><p>å¯¹äºæ˜æ–‡<spanclass="math inline">\(X=(x_1,x_2,\ldots,x_n)\)</span>è¿™ä¸€ç»„æ•°æ¥è¯´ï¼Œæ„é€ ä¸€ä¸ªå‘é‡<span class="math display">\[a=\sum_{i=1}^nx_iv_i-v_{n+1}=(2x_1-1,2x_2-1,\ldots,2x_n-1,0)\]</span>æ˜¾ç„¶ï¼Œaå‘é‡åœ¨æ ¼Lä¸Šã€‚å› ä¸ºXä¸­çš„æ‰€æœ‰xåªèƒ½å–å€¼0æˆ–1ï¼Œå› æ­¤aå‘é‡çš„é•¿åº¦å¾ˆå°ï¼Œçº¦ä¸º<spanclass="math inline">\(\sqrt{n}\)</span>ï¼Œå¯¹äºå¾ˆå¤§çš„æ ¼åŸºæ¥è¯´ï¼Œaå‘é‡æ— ç–‘æ˜¯æ ¼Lä¸Šçš„æœ€å°å‘é‡ï¼Œå› æ­¤æˆ‘ä»¬åˆ©ç”¨LLLç®—æ³•å³å¯æ±‚å‡ºaå‘é‡ã€‚</p><h4 id="ä¾‹é¢˜">ä¾‹é¢˜</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">sum</span>=<span class="hljs-number">492226042629702</span><br>nbits=<span class="hljs-number">32</span><br>M=[<span class="hljs-number">19620578458228</span>, <span class="hljs-number">39616682530092</span>, <span class="hljs-number">3004204909088</span>, <span class="hljs-number">6231457508054</span>, <span class="hljs-number">3702963666023</span>, <span class="hljs-number">48859283851499</span>, <span class="hljs-number">4385984544187</span>, <span class="hljs-number">11027662187202</span>, <span class="hljs-number">18637179189873</span>, <span class="hljs-number">29985033726663</span>, <span class="hljs-number">20689315151593</span>, <span class="hljs-number">20060155940897</span>, <span class="hljs-number">46908062454518</span>, <span class="hljs-number">8848251127828</span>, <span class="hljs-number">28637097081675</span>, <span class="hljs-number">35930247189963</span>, <span class="hljs-number">20695167327567</span>, <span class="hljs-number">36659598017280</span>, <span class="hljs-number">10923228050453</span>, <span class="hljs-number">29810039803392</span>, <span class="hljs-number">4443991557077</span>, <span class="hljs-number">31801732862419</span>, <span class="hljs-number">23368424737916</span>, <span class="hljs-number">15178683835989</span>, <span class="hljs-number">34641771567914</span>, <span class="hljs-number">44824471397533</span>, <span class="hljs-number">31243260877608</span>, <span class="hljs-number">27158599500744</span>, <span class="hljs-number">2219939459559</span>, <span class="hljs-number">20255089091807</span>, <span class="hljs-number">24667494760808</span>, <span class="hljs-number">46915118179747</span>]<br>A=Matrix(ZZ,nbits+<span class="hljs-number">1</span>,nbits+<span class="hljs-number">1</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(nbits):<br>    A[i,i]=<span class="hljs-number">2</span><br>    A[i,-<span class="hljs-number">1</span>]=M[i]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(nbits+<span class="hljs-number">1</span>):<br>    A[-<span class="hljs-number">1</span>,i]=<span class="hljs-number">1</span><br>A[-<span class="hljs-number">1</span>,-<span class="hljs-number">1</span>]=<span class="hljs-built_in">sum</span><br>r=A.LLL()<br><span class="hljs-built_in">print</span>(r[<span class="hljs-number">0</span>])<br><span class="hljs-comment">#(-1, -1, 1, -1, 1, -1, -1, -1, -1, 1, 1, -1, -1, -1, -1, 1, -1, -1, -1, 1, -1, -1, -1, -1, 1, -1, -1, 1, 1, -1, 1, 1, 0)</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œæ³¨æ„ä¸€ä¸‹ï¼Œç¬¬ä¸€è¡Œå‘é‡ä¸­æ˜¯æœ‰+1ä¸-1ï¼Œéœ€è¦è¿›è¡Œå–åï¼Œå³-1ä»£è¡¨1ï¼Œ1ä»£è¡¨0ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;åœ¨ä¸€æ¬¡CTFæ¯”èµ›ä¸­é‡åˆ°äº†ï¼Œå†™äº†10ä¸ªforåµŒå¥—ç¡¬çˆ†å‡ºæ¥äº†ï¼Œå¤ç°çš„æ—¶å€™å‘ç°æ˜¯èƒŒåŒ…åŠ å¯†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/img/bag.png&quot; /&gt;&lt;/p&gt;
&lt;h2 id=&quot;merklehellman-å…¬é’¥åŠ å¯†ç®—æ³•&quot;&gt;Merkle</summary>
      
    
    
    
    <category term="CTF" scheme="https://sch01ar.github.io/categories/CTF/"/>
    
    
    <category term="éå¯¹ç§°åŠ å¯†" scheme="https://sch01ar.github.io/tags/%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86/"/>
    
  </entry>
  
  <entry>
    <title>Hitcon 2022-ãŠ™ï¸BabySSS</title>
    <link href="https://sch01ar.github.io/2022/11/28/hitcon2022-BabySSS/"/>
    <id>https://sch01ar.github.io/2022/11/28/hitcon2022-BabySSS/</id>
    <published>2022-11-27T16:00:00.000Z</published>
    <updated>2022-12-01T09:37:56.735Z</updated>
    
    <content type="html"><![CDATA[<p>I implemented a toy Shamir's Secret Sharing for fun. Can you help mecheck is there any issues with this?</p><h1 id="shamirs-secret-sharingå¯†é’¥åˆ†äº«ç®—æ³•">Shamir's SecretSharingå¯†é’¥åˆ†äº«ç®—æ³•</h1><p><span class="math display">\[f(x)=a_0 + a_1x + a_2x^2 + â€¦â€¦ + a_{k-1}x^{k-1} mod p\]</span></p><h1 id="é¢˜ç›®æºç ">é¢˜ç›®æºç </h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> random <span class="hljs-keyword">import</span> SystemRandom<br><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha256<br><span class="hljs-keyword">from</span> secret <span class="hljs-keyword">import</span> flag<br><br>rand = SystemRandom()<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">polyeval</span>(<span class="hljs-params">poly, x</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">sum</span>([a * x**i <span class="hljs-keyword">for</span> i, a <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(poly)])<br><br><br>DEGREE = <span class="hljs-number">128</span><br>SHARES_FOR_YOU = <span class="hljs-number">8</span>  <span class="hljs-comment"># I am really stingy :)</span><br><br>poly = [rand.getrandbits(<span class="hljs-number">64</span>) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(DEGREE + <span class="hljs-number">1</span>)]<br>shares = []<br><span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(SHARES_FOR_YOU):<br>    x = rand.getrandbits(<span class="hljs-number">16</span>)<br>    y = polyeval(poly, x)<br>    shares.append((x, y))<br><span class="hljs-built_in">print</span>(shares)<br><br>secret = polyeval(poly, <span class="hljs-number">0x48763</span>)<br>key = sha256(<span class="hljs-built_in">str</span>(secret).encode()).digest()[:<span class="hljs-number">16</span>]<br>cipher = AES.new(key, AES.MODE_CTR)<br><span class="hljs-built_in">print</span>(cipher.encrypt(flag))<br><span class="hljs-built_in">print</span>(cipher.nonce)<br><span class="hljs-comment">#[(41458, 3015894889650529600470920314593280408459518223054415623846810748413393737686521849609926975694824777687791824408686652245102687392987299828716863372946074882798754477101786150262288970710451710086966378817944448615584285684364802621112755627795146504720812935041851556318832824799502759754100408717888912062197676588256634343721633045179136302533777168978134770315363985448879229514802330846792965525004570768212871252658334277172395338054448791891165981203069346039654617938169527772805687564575525262812469960675835101499054296722994451502140787064163668418661661374437567033971648550576296023422536253955229), (3389, 188433716494377932944071544153838579057591833387651830021721770473524507947811754295899393634645349682360212761145039355690817927625249659010181081209481357850193656763556243022791637306094953982811471415645267589939465925098159204147714779617946431727015863707468081949286110249296858079354949234074465541940264775783884708819566758872542606519408358277173683256608326688673226933790117016596834640875497643330432185114931410656582728964222203181026468387428893233826461), (20016, 100434774699078525844435127144579870564983915777345068724291926367405061427748836490810414860997895358378538088786283372231649911113841061354335739776409724471256377867811133591349442950556374825868587940833009529662869081130218551306459690738900795035660420986807973542512081415453215211908130387754214098414826747340962722685373241806099462750595976574593799013733614097923338311883793416643213898201680852118540438376386415411317989072583126108177482838299109479175882214603698768498421016054035672774286507312986602290254323930575001551875601243671354491241420409219), (50683, 444545881882748849210617532697661279371689521082184772844723908765173319859389018743414369945234307906596253496624659734919646710483514374218993496994560985318096082923429834553341897367168830049334302307406087637232329348570485341223211629167329394484624055745054495405880099706580380696671879365741197827080224977821589102425678989782880274304484630899425664722718972847034030888019348402685383311095030884356731112886316823960378572796288532824588478234949384868912708000223119984161992105752059185137674711077940232530298853451166664700609238496874366152042676602089571801873748042888046623717879084695143810047335029), (6445, 101461065764578261241074518788237888467081270902741849861528201922043223477790661159690684156056890167304291810116447916457265705130707166062372766839626095333813681671546097679623755546322833727082145873422243641505450049118758544298328784536759107951763715458884889255549767465897671061295486677353893450789955616926292534325337544782386120469581214993770910137353221116457111551538222138388416162630076391624447865248920466274175229034129561913505977209131490066291917549232913771218316393849495621818397), (1359, 301175604076484656987097022479686300460199620068959954988990822483114048418823291831080744590394713639405681060973359346474547015206086229256524657214311815578895906855833813636970640902962286472992468394831014254279137613828904924898823470285520515090889491445149243620044782726415898188702226878029241518020146726699446397961112596830223444821094650508662477147134721631935528182772284099429814417490160457082241680661), (45286, 244867719210730952183489456726726432791149629831242968845409984537752132549250274779516590253042559196452609852176114909791657154092483479876795482861784431886143414585698773882088948703730268947925790809436449512089696895048994874003651088538416399435467483409931121063976149037130454114161175715871108284419975118570732022104749321213013756795645219060997019373915339235627535694458093194617642834806820772479160496966470147893963746139947337914575231526069667124822677688977724313174612816604463495630041075005651663546036363128325535621487658461744362098985183050127661470315454320073092665472364666768205258769), (5649, 4766101906865350375503575239791521167258753430948472304582908507542293595346756303331383584550516424087839316050412570112796817549423179461056531056102741963677007097061600281918678364910813585444151640384802648969082273001142879806475184857246441212406056540028447374033197873299250076862108042582790928405869475508762352345569281589853917902601519294573327847401601789315980414998055948162169170771240383220643819333682845459742335249254576151835966500230706707674854493184181354958093926469960861)]</span><br><span class="hljs-comment">#b&#x27;G$\xf5\x9e\xa9\xb1e\xb5\x86w\xdfz\xbeP\xecJ\xb8wT&lt;&lt;\x84\xc5v\xb4\x02Z\xa4\xed\x8fB\x00[\xc0\x02\xf9\xc0x\x16\xf9\xa4\x02\xb8\xbb&#x27;</span><br><span class="hljs-comment">#b&#x27;\x8f\xa5z\xb4mZ\x97\xe9&#x27;</span><br></code></pre></td></tr></table></figure><h1 id="é¢˜ç›®åˆ†æ">é¢˜ç›®åˆ†æ</h1><p>é¢˜ç›®ç»™äº†8ç»„xï¼Œyçš„å€¼ï¼Œå¯é€šè¿‡CRTæ¨¡xæ±‚å‡ºa_0 ï¼Œé€šè¿‡æ¨¡x^2 å¯æ±‚å‡ºa_1ï¼ŒåŒç†å¯æ±‚å‡ºæ‰€æœ‰ç³»æ•°ï¼Œæ¢å¤å‡ºpolyevalå‡½æ•°ï¼Œä»è€Œå¾—åˆ°æ­£ç¡®çš„secretã€‚</p><h1 id="exp">EXP</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Cipher <span class="hljs-keyword">import</span> AES<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha256<br><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> sympy.ntheory.modular <span class="hljs-keyword">import</span> crt<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">polyeval</span>(<span class="hljs-params">poly, x</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">sum</span>([a * x**i <span class="hljs-keyword">for</span> i, a <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(poly)])<br><br>shares = [(<span class="hljs-number">41458</span>, <span class="hljs-number">3015894889650529600470920314593280408459518223054415623846810748413393737686521849609926975694824777687791824408686652245102687392987299828716863372946074882798754477101786150262288970710451710086966378817944448615584285684364802621112755627795146504720812935041851556318832824799502759754100408717888912062197676588256634343721633045179136302533777168978134770315363985448879229514802330846792965525004570768212871252658334277172395338054448791891165981203069346039654617938169527772805687564575525262812469960675835101499054296722994451502140787064163668418661661374437567033971648550576296023422536253955229</span>), (<span class="hljs-number">3389</span>, <span class="hljs-number">188433716494377932944071544153838579057591833387651830021721770473524507947811754295899393634645349682360212761145039355690817927625249659010181081209481357850193656763556243022791637306094953982811471415645267589939465925098159204147714779617946431727015863707468081949286110249296858079354949234074465541940264775783884708819566758872542606519408358277173683256608326688673226933790117016596834640875497643330432185114931410656582728964222203181026468387428893233826461</span>), (<span class="hljs-number">20016</span>, <span class="hljs-number">100434774699078525844435127144579870564983915777345068724291926367405061427748836490810414860997895358378538088786283372231649911113841061354335739776409724471256377867811133591349442950556374825868587940833009529662869081130218551306459690738900795035660420986807973542512081415453215211908130387754214098414826747340962722685373241806099462750595976574593799013733614097923338311883793416643213898201680852118540438376386415411317989072583126108177482838299109479175882214603698768498421016054035672774286507312986602290254323930575001551875601243671354491241420409219</span>), (<span class="hljs-number">50683</span>, <span class="hljs-number">444545881882748849210617532697661279371689521082184772844723908765173319859389018743414369945234307906596253496624659734919646710483514374218993496994560985318096082923429834553341897367168830049334302307406087637232329348570485341223211629167329394484624055745054495405880099706580380696671879365741197827080224977821589102425678989782880274304484630899425664722718972847034030888019348402685383311095030884356731112886316823960378572796288532824588478234949384868912708000223119984161992105752059185137674711077940232530298853451166664700609238496874366152042676602089571801873748042888046623717879084695143810047335029</span>), (<span class="hljs-number">6445</span>, <span class="hljs-number">101461065764578261241074518788237888467081270902741849861528201922043223477790661159690684156056890167304291810116447916457265705130707166062372766839626095333813681671546097679623755546322833727082145873422243641505450049118758544298328784536759107951763715458884889255549767465897671061295486677353893450789955616926292534325337544782386120469581214993770910137353221116457111551538222138388416162630076391624447865248920466274175229034129561913505977209131490066291917549232913771218316393849495621818397</span>), (<span class="hljs-number">1359</span>, <span class="hljs-number">301175604076484656987097022479686300460199620068959954988990822483114048418823291831080744590394713639405681060973359346474547015206086229256524657214311815578895906855833813636970640902962286472992468394831014254279137613828904924898823470285520515090889491445149243620044782726415898188702226878029241518020146726699446397961112596830223444821094650508662477147134721631935528182772284099429814417490160457082241680661</span>), (<span class="hljs-number">45286</span>, <span class="hljs-number">244867719210730952183489456726726432791149629831242968845409984537752132549250274779516590253042559196452609852176114909791657154092483479876795482861784431886143414585698773882088948703730268947925790809436449512089696895048994874003651088538416399435467483409931121063976149037130454114161175715871108284419975118570732022104749321213013756795645219060997019373915339235627535694458093194617642834806820772479160496966470147893963746139947337914575231526069667124822677688977724313174612816604463495630041075005651663546036363128325535621487658461744362098985183050127661470315454320073092665472364666768205258769</span>), (<span class="hljs-number">5649</span>, <span class="hljs-number">4766101906865350375503575239791521167258753430948472304582908507542293595346756303331383584550516424087839316050412570112796817549423179461056531056102741963677007097061600281918678364910813585444151640384802648969082273001142879806475184857246441212406056540028447374033197873299250076862108042582790928405869475508762352345569281589853917902601519294573327847401601789315980414998055948162169170771240383220643819333682845459742335249254576151835966500230706707674854493184181354958093926469960861</span>)]<br>c = <span class="hljs-string">b&#x27;G$\xf5\x9e\xa9\xb1e\xb5\x86w\xdfz\xbeP\xecJ\xb8wT&lt;&lt;\x84\xc5v\xb4\x02Z\xa4\xed\x8fB\x00[\xc0\x02\xf9\xc0x\x16\xf9\xa4\x02\xb8\xbb&#x27;</span><br>cn = <span class="hljs-string">b&#x27;\x8f\xa5z\xb4mZ\x97\xe9&#x27;</span><br>poly=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">129</span>):<br>    x, y = <span class="hljs-built_in">zip</span>(*shares)<br>    tmp=crt(x,y)[<span class="hljs-number">0</span>]<br>    shares = [(x, (y - tmp) // x) <span class="hljs-keyword">for</span> x, y <span class="hljs-keyword">in</span> shares]<br>    poly.append(tmp)<br><br>secret = polyeval(poly, <span class="hljs-number">0x48763</span>)<br>key = sha256(<span class="hljs-built_in">str</span>(secret).encode()).digest()[:<span class="hljs-number">16</span>]<br>cipher = AES.new(key, AES.MODE_CTR,nonce=cn)<br><span class="hljs-built_in">print</span>(cipher.decrypt(c))<br><span class="hljs-comment">#hitcon&#123;doing_SSS_in_integers_is_not_good_:(&#125;</span><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;I implemented a toy Shamir&#39;s Secret Sharing for fun. Can you help me
check is there any issues with this?&lt;/p&gt;
&lt;h1 id=&quot;shamirs-secret-shar</summary>
      
    
    
    
    <category term="CTF" scheme="https://sch01ar.github.io/categories/CTF/"/>
    
    
    <category term="wp" scheme="https://sch01ar.github.io/tags/wp/"/>
    
  </entry>
  
</feed>
